### 10-1-1. カスタムビューの作成と操作 (Create and interact with custom views)

Sigmaは、ワークブックでカスタムビューの作成をサポートしています。カスタムビューを使用すると、ワークブックの公開バージョンに影響を与えることなく、ワークブックを操作して変更を加えることができます。

カスタムビューは、アドホックなデータ分析に役立ちます - データをソートまたはフィルタリングしたり、新しいワークブック要素を追加したり、ワークブックのレイアウトを編集したりすることが、あなただけが見ることができるビューで行えます。例えば、特定のチームや地域のデータを表示するためにテーブルをフィルタリングしたり、ワークブックにアクセスできる他のユーザーが見るものを変更せずに、新しいチャートの追加を試みたりすることができます。複数のユーザーが、互いの作業に影響を与えることなく、同じワークブックで同時にカスタムビューを開くことができます。

カスタムビューは、いくつかの異なるカスタマイズとコラボレーションのワークフローをサポートしています。
* **アドホック分析のための作成と変更:** ワークブックに変更を加えることで、[アドホックなデータ探索を開始](https://help.sigmacomputing.com/docs/create-and-interact-with-custom-views#start-customizing-your-workbook)します。権限によっては、要素のプロパティ、フォーマット、アクションに対して[より高度な変更](https://help.sigmacomputing.com/docs/create-and-interact-with-custom-views#make-more-changes-while-in-a-custom-view)を加えることもできます。
* **変更の保存または破棄:** 探索が終わったら、[個人的な使用または共有のために変更を保存](https://help.sigmacomputing.com/docs/create-and-interact-with-custom-views#save-as-saved-view)したり、[ビューを終了](https://help.sigmacomputing.com/docs/create-and-interact-with-custom-views#exit-a-custom-view)したり、[変更を公開済みワークブックにマージ](https://help.sigmacomputing.com/docs/create-and-interact-with-custom-views#merge-your-changes-to-the-published-version)したりできます。
* **以前のカスタマイズされた変更に戻る:** [過去のカスタムビューにアクセス](https://help.sigmacomputing.com/docs/create-and-interact-with-custom-views#return-to-previous-customized-changes)できます。
* **分析を他の人と共有する:** [カスタムビューを共有するためのリンクを送信](https://help.sigmacomputing.com/docs/create-and-interact-with-custom-views#share-by-link)するか、[共有ビューを作成](https://help.sigmacomputing.com/docs/create-and-interact-with-custom-views#save-as-shared-view)できます。

#### **ユーザーとシステムの要件 (User and system requirements)**
* カスタムビューを作成したいワークブックへのアクセス権が必要です。
* すべてのユーザーがカスタムビューを作成できますが、カスタマイズや共有時に利用できるオプションは、個々のアカウント権限に依存します（必要な権限は以下のタスクセクションに記載されています）。詳細は、「[Account type and license overview](https://help.sigmacomputing.com/docs/account-type-and-license-overview)」を参照してください。

#### **カスタムビューで更新を行う (Make updates in custom views)**

##### **ワークブックのカスタマイズを開始する (Start customizing your workbook)**
ワークブックの公開バージョンから、カスタムビューに入るには2つの方法があります。
* **要素を操作する。** フィルタリング、ソート、データの追加や名前の変更など、要素への変更もカスタムビューを開きます。
* **(Full explore権限を持つアカウントタイプが必要)** `Customize this view`アイコンを選択する。

公開済みのワークブックからこれらのアクションのいずれかを実行すると、ワークブックのヘッダーが緑色に変わり、カスタムビューにいることを示します。

##### **カスタムビューでさらに変更を加える (Make more changes while in a custom view)**
`Can explore`のワークブックアクセス権と`Full explore`権限がある場合、エディタパネルにアクセスしてカスタムビューからより高度な変更を加えることができます。
1.  カスタムビューに入ったら、`Show panels`アイコンを選択して`Properties`、`Format`、`Actions`タブにアクセスします。ワークブックで何と対話しているかに応じて、異なるパネルが表示されます。
2.  個々のアカウントタイプの権限に応じて、エディタパネルから分析的なワークブック機能の全範囲を使用できます。例えば、[新しい要素の作成](https://help.sigmacomputing.com/docs/create-a-data-element)、[要素のコピー＆ペースト](https://help.sigmacomputing.com/docs/copy-and-paste-elements)、[ワークブックレイアウトの編集](https://help.sigmacomputing.com/docs/design-workbook-layouts)、[基盤となるデータへのドリルダウン](https://help.sigmacomputing.com/docs/view-underlying-data)、[エクスポートの送信またはスケジュール設定](https://help.sigmacomputing.com/docs/send-and-schedule-exports)などです。

#### **変更の保存または破棄 (Saving or discarding your changes)**
カスタムビューでの変更は作業中に自動的に保存されますが、他の形式や構成で変更を保存することもできます。

##### **保存済みビューとして保存する (Save as saved view)**
頻繁にアクセスする一連のフィルターやビジュアライゼーションなど、特定の変更構成をブックマークするには、保存済みビューを作成できます。詳細は、「[保存済みビューの作成と共有](https://help.sigmacomputing.com/docs/create-and-share-saved-views)」を参照してください。

##### **新しいワークブックまたはテンプレートとして保存する (Save as a new workbook or template)**
`Create, edit, and publish workbooks`アカウントタイプの権限がある場合、変更を新しいワークブックとして、または自分自身や他の人が複製して作業するためのテンプレートとして保存することもできます。

カスタムビューを新しいワークブックまたはテンプレートとして保存するには：
1.  ドキュメントメニューから`File`を選択し、`Save as workbook`または`Save as template`を選択します。
2.  希望のフィールドを構成します。
    * **ワークブックとして保存:** 新しいワークブックの名前を入力し、新しいワークブックを保存したい場所を選択します。
    * **テンプレートとして保存:** テンプレートの名前を入力します。テンプレートを他のユーザーと共有したい場合は、希望のメンバー/チームを検索して選択し、彼らに与えたい使用権限を選択します。
3.  `Save`を選択します。

##### **変更を公開バージョンにマージする (Merge your changes to the published version)**
カスタマイズしているワークブックに対する`Can edit`アクセス権がある場合、カスタムビューで行った変更をワークブックの公開バージョンにマージできます。
1.  ドキュメントメニューから、`Edit` > `Edit workbook`を選択します。
2.  `Merge changes into draft`モーダルで、変更を確認し、`Merge changes`を選択します。
    * この時点で変更をマージしたくない場合は、`Discard changes`を選択して後でそれらに戻ることができます。「[以前のカスタマイズされた変更に戻る](#return-to-previous-customized-changes)」を参照してください。

##### **カスタムビューを終了する (Exit a custom view)**
カスタムビューを終了する際、ワークブックの公開バージョンに戻るか、ワークブックのドラフトに戻ることができます。
* **公開バージョンに終了するには:** `Close view`を選択します。ワークブックのヘッダーが白に戻り、カスタムビューを終了したことを示します。
* **ドラフトに終了するには:** ドキュメントメニューから、`Edit` > `Edit workbook`を選択し、`Discard changes`を選択します。
    * 後で変更に戻りたい場合は、「[以前のカスタマイズされた変更に戻る](#return-to-previous-customized-changes)」を参照してください。

#### **以前のカスタマイズされた変更に戻る (Return to previous customized changes)**

##### **以前閉じたカスタムビューにアクセスする (Access your previously closed custom views)**
自分自身の以前のカスタムビューを表示できます。
1.  ドキュメントメニューから、`Custom views`を選択します。
2.  最新のカスタムビューを表示するには、`Recent custom view`の下にあるビューを選択します。
3.  以前のすべてのカスタムビューを表示するには、`All views`を選択します。
4.  `Custom views`タブを選択して、以前のカスタムビューを表示します。
他のユーザーのカスタムビュー履歴にはアクセスできません。

#### **分析を他の人と共有する (Share your analysis with others)**

##### **リンクで共有する (Share by link)**
保存してアクセスする必要のないカスタムビューの変更をすばやく共有したい場合は、ブラウザのアドレスバーからリンクをコピー＆ペーストしてワークブックへのリンクを送信できます。ユーザーがワークブックを閲覧できるようになる前に、アクセス権を設定する必要がある場合があります。「[ワークブックを共有する](https://help.sigmacomputing.com/docs/share-a-workbook)」を参照してください。

##### **共有ビューとして保存する (Save as shared view)**
カスタムビューで他のユーザーとより広範に作業・協力したい場合は、保存済みビューを作成して共有します。「[保存済みビューの作成と共有](https://help.sigmacomputing.com/docs/create-and-share-saved-views)」を参照してください。

### 10-1-2. 保存済みビューの作成と共有 (Create and share saved views)

> 📘
> 保存済みビューは、以前はブックマークとして知られていました。

保存済みビューを使用すると、公開されたワークブックの上で行った変更を「ブックマーク」し、いつでもそれらに戻ることができます。保存済みビューは、フィルターやコントロールの追加から、新しいチャートやデータの追加まで、さまざまな複雑さの変更を保存することをサポートしています。自分専用の保存済みビュー（パーソナルビュー）を作成することも、組織の他のメンバーと共有する（共有ビュー）こともできます。

このドキュメントでは、以下について説明します。
* **保存済みビューを使用する際の考慮事項:** 保存済みビューがあなたのワークフローに適しているかどうかを評価します。
* **保存済みビューでの変更のブックマーク:** 新しいパーソナルまたは共有ビューを作成します。
* **ビューを共有して他のユーザーと共同作業する:** 既存の保存済みビューを他のユーザーと共有します。
* **以前のビューにアクセスする:** 最新またはすべての保存済みビューを表示します。
* **保存済みビューの管理:** 既存の保存済みビューを編集するか、保存済みビューの名前の変更/削除を行います。

#### **ユーザーとシステムの要件 (User and system requirements)**
* ワークブックへのアクセス権を持つすべてのユーザーが、パーソナルビューを保存できます。
* 保存済みビューを共有するには、`Create, edit, and publish workbooks`アカウントタイプの権限が必要です。「[Account type and license overview](https://help.sigmacomputing.com/docs/account-type-and-license-overview)」を参照してください。
* ゲストユーザーは共有ビューを作成できません。

#### **保存済みビューを使用する際の考慮事項 (Considerations when using saved views)**
保存済みビューは、基盤となるワークブックに依存します。基盤となる公開済みワークブックでのフィルターの追加/削除、ページの複製、要素の削除などの変更は、保存済みビューに影響を与えたり、壊したりする可能性があります。ワークブックの公開バージョンと保存済みビューとの間に競合がある場合、手動で保存済みビューを更新する必要がある場合があります。

結果として、保存済みビューはバージョン管理ツールとしては推奨されません。保存済みビューは、特定のチームが頻繁に戻りたいフィルターのセットを保存するなど、後で参照・編集するために特定のワークブック構成を保持するのに最適です。

バージョン管理ワークフローをサポートしたい場合は、代わりに[バージョンタグ](https://help.sigmacomputing.com/docs/add-version-tags)の使用を検討してください。

#### **新しい保存済みビューを作成または共有する (Create or share a new saved view)**
保存済みビューを作成する際、パーソナルビューまたは共有ビューとして作成できます。パーソナルビューはあなただけが見ることができ、あなただけがアクセスする必要のある変更を保存するのに役立ちます。共有ビューは、組織の複数のメンバーと共有でき、共同作業に使用できます。

保存済みビューを作成するには：
1.  カスタムビューで変更を加えます。
2.  ドキュメントメニューから、`Custom view`を選択し、次に`Save this custom view`を選択します。
3.  希望のビュー名を入力します。
4.  パーソナルビューまたは共有ビューとして保存します。
    > ❗️
    > ワークブックの各バージョンには、共有ビューの制限が10個あります。パーソナルビューに制限はありません。
    * **パーソナルビュー:** `Save`を選択します。
    * **共有ビュー:** `Shared view`の隣にあるチェックボックスを選択し、`Save`を選択します。
5.  (任意) ワークブックを閲覧する際のデフォルトのランディングページとしてこのビューを設定するには、`Set as default view`を選択します。

#### **既存の保存済みビューを共有する (Share an existing saved view)**
> 💡
> 保存済みビュー（パーソナルまたは共有）のリンクを別のユーザーに送信すると、あなたの保存済みビューの変更が、そのユーザーに新しいカスタムビューとして利用可能になります。このカスタムビューは、あなたが保存済みビューに加える更新を引き続き継承します。同じ共有ビューで共同作業するには、パーソナルビューを共有ビューにする必要があります。

既存のパーソナルビューを共有ビューとして共有するには：
1.  ドキュメントメニューから、`Custom views`を選択し、次に`All views`を選択します。
2.  `Saved views`タブから、共有したいパーソナルビューの隣にある`More`をクリックし、`Set as shared view`を選択します。これにより、ワークブックへの`Can view`または`Can edit`アクセス権を持つすべてのユーザーが共有ビューを表示できるようになります。

#### **以前に保存したビューにアクセスする (Accessing previously saved views)**
以前に保存したビューにアクセスするには：
1.  ドキュメントメニューから、`Custom views`を選択します。
2.  最新の保存済みビューを表示するには、`Recent saved views`の下にあるビューを選択します。
3.  以前のすべてのカスタムビューを表示するには、`All views`を選択します。
4.  `Saved views`タブを選択して、以前のカスタムビューを表示します。

#### **保存済みビューを管理する (Manage saved views)**

##### **保存済みビューを編集する (Editing saved views)**
既存の保存済みビューに変更を加えて保存するには：
1.  保存済みビューを開きます。ドキュメントメニューから、`Custom views`を選択し、次に`All Views`を選択します。`Saved views`タブから、あなたの保存済みビューを選択します。
2.  保存済みビューで、ワークブックに変更を加えます。
3.  ドキュメントメニューから、`Custom views` > `Save to [あなたの保存済みビューの名前]`を選択します。

##### **保存済みビューの名前の変更または削除 (Renaming or deleting saved views)**
既存の保存済みビューの名前を変更または削除するには：
1.  ドキュメントメニューから、`Custom views`を選択し、次に`All Views`を選択します。
2.  `Saved views`タブから、あなたの保存済みビューの隣にある`More ⋮`を選択します。
3.  `Edit name`または`Delete`を選択します。
    * **Edit name:** 希望の名前を入力します。
    * **Delete:** `Delete`を選択します。
  
### 10-1-3. 列の詳細を表示する (View column details)

Sigmaでは、JSONを除くすべての[列タイプ](https://help.sigmacomputing.com/docs/supported-data-types-and-formats)について、列の詳細を表示できます。列の詳細は、自動生成されたデータ分布の統計情報を提供し、データの形状と品質を評価することを可能にします。

このドキュメントでは、列データにアクセスする方法と、列詳細の概要で提供されるフィールドについて説明します。

#### **ユーザー要件 (User requirements)**
列の詳細を表示するには、ワークブックまたはデータモデルに対する`Can view`アクセス権が必要です。

#### **個々の列の詳細にアクセスする (Access individual column details)**
個々の列の詳細と統計情報を表示するには：
1.  キャレット()をクリックして、列のドロップダウンメニューを開きます。
2.  `Column Details`を選択します。

特定の列の詳細は列タイプによって異なりますが、全体的な構造は同じです。
<img width="789" height="456" alt="249de06b93326d78c7df17cf7cdad254b15e81c7a288064231a109d1768f64f6-column_details" src="https://github.com/user-attachments/assets/4c814c88-47bd-4537-b3d5-e9c3a0140561" />

#### **列のサマリーと統計を確認する (Review column summaries and statistics)**
列データを確認することで、主要な列の値とデータのサマリーを表示できます。

##### **基本的な列データを確認する (Review basic column data)**
`About`セクションで、列データとその計算方法に関する情報を表示します。ここには`type`、`name`、および`formula`(fx)がリストされます。

##### **列の値を確認する (Review column values)**
`Top Values`セクションは、データ分布を視覚化するのに役立ちます。テキスト、数値、および日付タイプの列で利用可能な`Top Values`リストには、列の最も一般的な値が含まれており、トレンドや共通の特性を特定するのに役立ちます。
`Value Distribution`ヒストグラムも、数値と日付の列で利用可能で、その列の外れ値や全体的なデータの形状を特定するのに役立ちます。

##### **データサマリーを確認する (Review data summary)**
`Summary`セクションには、`Values`、`Nulls`、`Row count`、`Distinct values`などの主要な列の合計がリストされており、データ品質と多様性を評価するのに役立ちます。
* **Values**と**Nulls**は、列内のnullおよび非null値の数を示し、データセットの完全性やさらなるデータクリーニングの必要性を示すことができます。
* **Row count**と**Distinct values**は、その列のデータのサイズと多様性の感覚を与えます。

##### **データ分布サマリーを確認する (Review data distribution summary)**
`Statistics`セクションには、さまざまな列の統計がリストされます。最小値と最大値は、日付とテキストの列で表示されます。これらと以下にリストされる他の統計は、数値タイプの列で利用可能です。
* **Minimum (最小値)** - 列の最小値。
* **25th Percentile (25パーセンタイル)** - 列の値の下位25パーセンタイルに入る値。
* **Median (中央値)** - ソートされた列の値の中点。
* **75th Percentile (75パーセンタイル)** - 列の値の下位75パーセンタイルに入る値。
* **Maximum (最大値)** - 列の最大値。
* **Average (平均)** - すべての列の値の平均。
* **Standard Deviation (標準偏差)** - 列の計算された標準偏差。
* **Variance (分散)** - 列の統計的分散。

これらの統計は、データの広がりを理解したり（25パーセンタイルと75パーセンタイル）、外れ値を見つけたり（最小値と最大値）、データの一貫性を評価したり（分散と標準偏差）することで、データへのさらなる分析を行う際に役立つ場合があります。

### 16-1-4. キーボードショートカット: Mac OS (Keyboard shortcuts: Mac OS)

このドキュメントでは、Mac OSのキーボードショートカットの概要を説明します。Microsoft Windows固有のショートカットについては、「[キーボードショートカット: Microsoft Windows](https://help.sigmacomputing.com/docs/keyboard-shortcuts-microsoft-windows)」を参照してください。

Sigma内で`⌘ + /`を押すことで、キーボードショートカットを表示することもできます。

#### **一般 (General)**

| | |
| :--- | :--- |
| **検索を開く** | `/` |
| **ヘルプを開く** | `⇧ + /` |
| **ショートカットを表示** | `⌘ + /` |

#### **共通 (Common)**

| | |
| :--- | :--- |
| **元に戻す** | `⌘ + Z` |
| **やり直し** | `⌘ + ⇧ + Z` |
| **データを更新** | `⌘ + ⇧ + R` |
| **クエリ履歴** | `⌘ + ⇧ + H` |
| **選択をクリア** | `Esc` |

#### **選択 (Selection)**

| | |
| :--- | :--- |
| **複数の行または列を個別に選択** | `⌘ + 左クリック` |
| **行または列の範囲を選択** | `⇧ + 左クリック` |
| **すべての列を選択** | `⌘ + A` |
| **右側のすべての列または行を選択** | `⌘ + ⇧ + →` |
| **左側のすべての列または行を選択** | `⌘ + ⇧ + ←` |

> 💡
> 複数の列を選択してから、いずれかの列をクリックしてドラッグすることで、複数の列のサイズを同時に変更できます。

#### **ワークブック (Workbook)**

| | |
| :--- | :--- |
| **列の数式を編集** | `=` |
| **列を追加** | `⇧ + ＋` |
| **列を非表示** | `⇧ + H` |
| **列の名前を変更** | `⇧ + R` |
| **列を削除** | `Del` |
| **列のグループ化を切り替え** | `⇧ + G` |
| **列フィルターを追加** | `⇧ + F` |
| **列を先頭に移動** | `⌘ + ⇧ + ↑` |
| **列を末尾に移動** | `⌘ + ⇧ + ↓` |
| **列の詳細を表示** | `⌘ + I` |
| **最大化を切り替え** | `space` |
| **テーブルを切り替え** | `⇧ + T` |
| **次の要素** | `tab` |
| **前の要素** | `⇧ + tab` |
| **次のページ** | `⌥ + tab` |
| **前のページ** | `⌥ + ⇧ + tab` |
| **要素をカスタマイズ** | `⌘ + \` |
| **要素を削除** | `⌘ + Del` |
| **要素を複製** | `⌘ + D` |
| **昇順でソート** | `S + A` |
| **降順でソート** | `S + D` |
| **書式をコピー** | `⌘ + ⌥ + C` |
| **書式を貼り付け** | `⌘ + ⌥ + V` |
| **選択範囲からコンテナを作成** | `⌘ + G` |
| **選択範囲からコンテナを削除** | `⌘ + ⇧ + G` |

#### **列のフォーマット (Column formats)**

| | |
| :--- | :--- |
| **フォーマット: 自動** | `!` |
| **フォーマット: 数値** | `#` |
| **フォーマット: 通貨** | `$` |
| **フォーマット: パーセント** | `%` |
| **フォーマット: 指数** | `^` |
| **精度を減らす** | `<` |
| **精度を上げる** | `>` |

#### **数式編集 (Formula editing)**

| | |
| :--- | :--- |
| **数式バーを開く** | `=` |
| **上に移動** | `⌘ + ↑` |
| **下に移動** | `⌘ + ↓` |
| **クエリを送信** | `⌘ + return` |
| **オートコンプリートを開く** | `⌘ + space` |
| **コメントを切り替え** | `⌘ + /` |
| **行の先頭** | `⌘ + ←` |
| **行をインデント** | `tab` |
| **インデントを減らす** | `⇧ + tab` |
| **現在の行を削除** | `⇧ + ⌥ + K` |
| **行を選択** | `⌘ + L` |
| **行を上にシフト** | `⌘ + ⌥ + ↑` |
| **行を下にシフト** | `⌘ + ⌥ + ↓` |
| **行を結合** | `⌘ + J` |
| **行を複製** | `⇧ + ⌘ + D` |

#### **テキスト編集 (Text editing)**

| | |
| :--- | :--- |
| **太字** | `⌘ + B` |
| **斜体** | `⌘ + I` |
| **リンクを作成** | `⌘ + K` |
| **箇条書きリストを切り替え** | `⌘ + ⇧ + 8` |
| **番号付きリストを切り替え**| `⌘ + ⇧ + 7` |
| **左揃え** | `⌘ + ⌥ + L` |
| **中央揃え** | `⌘ + ⌥ + T` |
| **右揃え** | `⌘ + ⌥ + R` |
| **数式バーを開く** | `=` |

#### **入力テーブル (Input tables)**

| | |
| :--- | :--- |
| **下にフィル** | `⌘ + D` |
| **右にフィル** | `⌘ + R` |
| **右のセルを選択** | `tab` |
| **選択範囲を右に拡大** | `⇧ + →` |
| **左のセルを選択** | `⇧ + tab` |
| **選択範囲を左に拡大** | `⇧ + ←` |
| **下のセルを選択** | `return` |
| **選択範囲を下に拡大** | `⇧ + ↓` |
| **上のセルを選択** | `⇧ + return` |
| **選択範囲を上に拡大** | `⇧ + ↑` |
| **行を選択** | `⇧ + space` |
| **行を追加** | `⌘ + ⌥ + =` |
| **切り取りとコピー** | `⌘ + X` |
| **貼り付け** | `⌘ + V` |
| **元に戻す** | `⌘ + Z` |
| **やり直し** | `⌘ + ⇧ + Z` |

### 10-1-5. キーボードショートカット: Microsoft Windows (Keyboard shortcuts: Microsoft Windows)

このドキュメントでは、Microsoft Windowsのキーボードショートカットの概要を説明します。Mac OS固有のショートカットについては、「[キーボードショートカット: Mac OS](https://help.sigmacomputing.com/docs/keyboard-shortcuts-mac-os)」を参照してください。

Sigma内で`ctrl + /`を押すことで、キーボードショートカットを表示することもできます。

#### **一般 (General)**

| | |
| :--- | :--- |
| **検索を開く** | `/` |
| **ヘルプを開く** | `shift + /` |
| **ショートカットを表示** | `ctrl + /` |

#### **共通 (Common)**

| | |
| :--- | :--- |
| **元に戻す** | `ctrl + Z` |
| **やり直し** | `ctrl + shift + Z` |
| **データを更新** | `ctrl + shift + R` |
| **クエリ履歴** | `ctrl + shift + H` |
| **選択をクリア** | `Esc` |

#### **選択 (Selection)**

| | |
| :--- | :--- |
| **複数の行または列を個別に選択** | `ctrl + 左クリック` |
| **行または列の範囲を選択** | `shift + 左クリック` |
| **すべての列を選択** | `ctrl + A` |

> 💡
> 複数の列を選択してから、いずれかの列をクリックしてドラッグすることで、複数の列のサイズを同時に変更できます。

#### **ワークブック (Workbook)**

| | |
| :--- | :--- |
| **列の数式を編集** | `=` |
| **列を追加** | `shift + ＋` |
| **列を非表示** | `shift + H` |
| **列の名前を変更** | `shift + R` |
| **列を削除** | `Del` |
| **列のグループ化を切り替え** | `shift + G` |
| **列フィルターを追加** | `shift + F` |
| **列の詳細を表示** | `ctrl + I` |
| **最大化を切り替え** | `space` |
| **テーブルを切り替え** | `shift + T` |
| **次の要素** | `tab` |
| **前の要素** | `shift + tab` |
| **要素を追加** | `ctrl + shift + ＋` |
| **要素を削除** | `ctrl + Del` |
| **要素を複製** | `ctrl + D` |
| **昇順でソート** | `S + A` |
| **降順でソート** | `S + D` |
| **書式をコピー** | `ctrl + alt + C` |
| **書式を貼り付け** | `ctrl + alt + V` |
| **選択範囲からコンテナを作成** | `ctrl + G` |
| **選択範囲からコンテナを削除** | `ctrl + shift + G` |

#### **列のフォーマット (Column formats)**

| | |
| :--- | :--- |
| **フォーマット: 自動** | `!` |
| **フォーマット: 数値** | `#` |
| **フォーマット: 通貨** | `$` |
| **フォーマット: パーセント** | `%` |
| **フォーマット: 指数** | `^` |
| **精度を減らす** | `<` |
| **精度を上げる** | `>` |

#### **数式編集 (Formula editing)**

| | |
| :--- | :--- |
| **数式バーを開く** | `=` |
| **上に移動** | `ctrl + ↑` |
| **下に移動** | `ctrl + ↓` |
| **クエリを送信** | `ctrl + enter` |
| **オートコンプリートを開く** | `ctrl + space` |
| **コメントを切り替え** | `ctrl + /` |
| **行の先頭** | `ctrl + ←` |
| **行をインデント** | `tab` |
| **インデントを減らす** | `shift + tab` |
| **現在の行を削除** | `shift + alt + K` |
| **行を選択** | `ctrl + L` |
| **行を上にシフト** | `ctrl + alt + ↑` |
| **行を下にシフト** | `ctrl + alt + ↓` |
| **行を結合** | `ctrl + J` |
| **行を複製** | `shift + ⌘ + D` |

#### **テキスト編集 (Text editing)**

| | |
| :--- | :--- |
| **太字** | `ctrl + B` |
| **斜体** | `ctrl + I` |
| **リンクを作成** | `ctrl + K` |
| **箇条書きリストを切り替え** | `ctrl + shift + 8` |
| **番号付きリストを切り替え**| `ctrl + shift + 7` |
| **左揃え** | `ctrl + alt + L` |
| **中央揃え** | `ctrl + alt + T` |
| **右揃え** | `ctrl + alt + R` |
| **数式バーを開く** | `=` |

#### **入力テーブル (Input tables)**

| | |
| :--- | :--- |
| **下にフィル** | `ctrl + D` |
| **右にフィル** | `ctrl + R` |
| **右のセルを選択** | `tab` |
| **選択範囲を右に拡大** | `shift + →` |
| **左のセルを選択** | `shift + tab` |
| **選択範囲を左に拡大** | `shift + ←` |
| **下のセルを選択** | `enter` |
| **選択範囲を下に拡大** | `shift + ↓` |
| **上のセルを選択** | `shift + enter` |
| **選択範囲を上に拡大** | `shift + ↑` |
| **行を選択** | `shift + space` |
| **行を追加** | `⌘ + ⌥ + =` |
| **切り取りとコピー** | `ctrl + X` |
| **貼り付け** | `ctrl + V` |
| **元に戻す** | `ctrl + Z` |
| **やり直し** | `ctrl + shift + Z` |

### 10-2-1. データにドリルする (Drill Anywhere)

Sigmaは、ほとんどの[ビジュアライゼーション](https://help.sigmacomputing.com/docs/intro-to-charts)タイプに対して、ドリルパス（Drill Anywhere機能と呼ばれる）をサポートしています。

ドリルパスはアドホックなデータ探索のために設計されており、ワークブックへの`Can Edit`または`Can Explore`アクセス権を持つユーザーのみが利用できます。

閲覧者などのより広範なターゲットオーディエンスを持つワークブックを作成している場合や、複数のターゲットビジュアライゼーションで同じドリルパスを使用したい場合は、代わりに[ドリルダウンコントロール](https://help.sigmacomputing.com/docs/drill-down-control)を作成する必要があります。

#### **要件 (Requirements)**
* `Drill Anywhere`を使用するには、ワークブックに対する`Can Edit`または`Can Explore`の[アクセス権](https://help.sigmacomputing.com/docs/share-a-workbook)が必要です。
* デフォルトのViewerアカウントはこの機能にアクセスできません。
* ビジュアライゼーションのドリルダウン列リストをカスタマイズするには、`Can Edit`アクセス権が必要です。

#### **Drill Anywhereのドリルパス機能を使用する (Use the Drill Anywhere drill path feature)**
1.  ビジュアライゼーション上の値を右クリックして、そのコンテキストメニューを開きます。
    * この例では、棒グラフの2017年の`[Year]`列のコンテキストメニューを開いています。
2.  `Drill down...`をクリックして、`Drill down`モーダルを開きます。

<img width="1400" height="819" alt="46b72fb-1" src="https://github.com/user-attachments/assets/31ae2aeb-995d-4ab4-a58d-5020702a404d" />

3.  ドリルダウンしたい列をクリックします。
    * この例では、`[Store Region]`にドリルダウンしています。

<img width="1400" height="817" alt="624bed5-2" src="https://github.com/user-attachments/assets/0ae2363a-a75d-4fa8-943f-58babe2e2a2d" />

4.  2019年の`[Year]`について`[Store Region]`にドリルダウンすると、Sigmaは新しい日付フィルターを追加し、`X-AXIS`を`[Year]`から`[Store Region]`に切り替えます。

<img width="1400" height="817" alt="624bed5-2" src="https://github.com/user-attachments/assets/6efa4a0c-24b6-46ca-b7b7-aa07febd1fab" />

5.  Sigmaは、2019年の地域別の売上合計を表示します。

<img width="1400" height="819" alt="25958b2-3" src="https://github.com/user-attachments/assets/0c822628-fe74-4d45-ad8a-36e1bd590f7e" />

     * この例では、ビジュアライゼーションが[最大化](https://help.sigmacomputing.com/docs/maximize-an-element)されているため、基盤となるデータテーブルの構造もそれに応じて更新されるのを確認できます。
    * データは`[Year]`でグループ化される代わりに、`[Store Region]`でグループ化されます。

#### **ビジュアライゼーションのドリルダウン列リストをカスタマイズする (Customize a visualization's drill down column list)**
1.  ワークブックがまだ編集モードでない場合は、ページの右上隅にある`Edit`をクリックします。
2.  ビジュアライゼーション内の値を右クリックして、そのコンテキストメニューを開きます。
3.  `Drill down`をクリックして、`Drill down`モーダルを開きます。

<img width="1402" height="676" alt="b392b1a-4" src="https://github.com/user-attachments/assets/47d73fd4-ec7b-4db4-aaf2-b3a7e8078174" />

4.  `Edit List`をクリックします。

<img width="410" height="423" alt="14a11ca-5" src="https://github.com/user-attachments/assets/e422c833-4931-4067-b916-adf84da6473b" />

5.  チェックボックスを使用して、利用可能にしたい列のみを選択します。

<img width="407" height="417" alt="8e094a0-6" src="https://github.com/user-attachments/assets/a314498a-7ef3-4080-9473-e881551bda41" />

6.  `Save`をクリックします。

### 10-2-2. 基盤となるデータを表示する (View underlying data)

ワークブックを閲覧、探索、または編集中、すべての[データ要素](https://help.sigmacomputing.com/docs/intro-to-element-types)は、キャンバスに複数の要素を表示するためにデフォルトで最小化されています。個々のデータ要素を最大化して、その詳細に焦点を当て、基盤となるデータを表示することができます。

[ビジュアライゼーション](https://help.sigmacomputing.com/docs/intro-to-charts)または[ピボットテーブル](https://help.sigmacomputing.com/docs/working-with-pivot-tables)要素が最大化されると、それはワークブックページの全幅に拡大され、要素の基盤となるデータテーブルが公開されます。要素と基盤となるデータは本質的にリンクしているため、一方に加えられた変更は自動的にもう一方に反映されます。

[テーブル](https://help.sigmacomputing.com/docs/create-and-manage-tables)要素が最大化されると、それはワークブックページ全体を埋めるように拡大されます。基盤となるデータは、テーブル自体で既に公開されているため、追加のテーブルに表示する必要はありません。

> 📘
> データ要素はどの[ワークブックモード](https://help.sigmacomputing.com/docs/workbook-modes-overview)（表示、探索、または編集）でも最大化できますが、変更は探索および編集モードでのみ行うことができます。

#### **データ要素を最大化する (Maximize a data element)**
1.  データ要素にカーソルを合わせるか、選択します。
2.  要素ツールバーで、`Maximize element`をクリックします。
    > 💡
    > `Aggregate values`のチェックが外れているデカルトチャートを表示している場合、基盤となるデータもチャートに合わせてグループ化されていない状態で表示されます。

#### **データ要素を最小化する (Minimize a data element)**
ページツールバーで、`Minimize element`をクリックします。

<img width="1148" height="946" alt="20ad29f-2" src="https://github.com/user-attachments/assets/cfc7806e-b71c-48c9-b097-ac034dce3e30" />

#### **インタラクティブデモ (Interactive demo)**
埋め込まれた棒グラフにカーソルを合わせると、要素の右上隅に要素ツールバーが表示されます。
* チャートを最大化して基盤となるデータテーブルを表示するには、`Maximize element`をクリックします。
* 完全なワークブックキャンバスに戻るには、`Minimize element`をクリックします。
[インタラクティブデモ画像挿入]

#### **関連リソース (Related resources)**
* [データ要素の概要](https://help.sigmacomputing.com/docs/intro-to-element-types)
* [ワークブックのモード概要：表示、探索、編集](https://help.sigmacomputing.com/docs/workbook-modes-overview)
  
### 10-2-3. AIでチャートを説明する (Explain charts with AI)

`Explain this chart`機能は、AIを使用して任意のチャートの説明を即座に生成します。詳細には、主要なインサイト、観察、データ分布のサマリー、および視覚化されたデータの理解を深め、情報に基づいた意思決定を促進するのに役立つその他のコンテキストが含まれます。

このドキュメントでは、AIが生成したチャートの説明を紹介し、この機能にアクセスして利用する方法を説明します。

> 🚩
> AI機能の使用は、以下の[免責事項](https://help.sigmacomputing.com/docs/ai-feature-disclaimer)の対象となります。

#### **システムとユーザー要件 (System and user requirements)**
AIでチャートを説明する機能には、以下が必要です。
* あなたの組織で[OpenAIインテグレーション](https://help.sigmacomputing.com/docs/manage-openai-integration)が構成されている必要があります。
* Azure OpenAIを使用している場合、OpenAIインテグレーションで`GPT-4o model` (gpt-4o-2024-11-20)以降が構成されている必要があります。
* `Explain charts with AI`権限が有効になっているアカウントタイプを割り当てられている必要があります。

#### **AIが生成した説明について (About AI-generated explanations)**
`Explain this chart`機能を使用すると、Sigmaはチャートのスナップショットをキャプチャし、この画像とチャートの基盤となるデータをあなたのOpenAIモデルに渡します。モデルはその後、情報を処理し、コンテキストを分析して、チャートによって視覚化されたデータの説明を生成します。Sigmaはこの説明を提示し、結果に関するフィードバックを提供できるようにします。これは将来の応答を改善するために使用できます。

AI機能を使用する際のデータの保護と保存方法に関する情報については、「[Manage OpenAI integration](https://help.sigmacomputing.com/docs/manage-openai-integration)」の「Frequently asked questions」を参照してください。

#### **チャートを説明する (Explain a chart)**
1.  ワークブックを開きます。
2.  説明したいチャートにカーソルを合わせるか、選択します。
3.  要素ツールバーで、`More`をクリックして要素メニューを開き、`Explain this chart`を選択します。

<img width="701" height="439" alt="0c1cd3925edb54aaf3ea6239d49ddd9650897a056094c836511392c598fcf294-explain-chart" src="https://github.com/user-attachments/assets/63fd566a-a394-43c8-b3c6-7ec9ea2ea57e" />

4.  `Explain`モーダルは、生成されるとリアルタイムで説明を表示します。必要に応じて結果を利用または操作します。
    * `Copy text`をクリックして、結果を保存または共有します（例えば、テキスト要素に貼り付けてチャートを補足するなど）。
    * `Helpful`または`Not helpful`をクリックし、将来の応答を改善するための追加詳細を送信します。
<img width="810" height="500" alt="caa8a847c5569d8ce0fef482973947d326681f7ecdd1ed8c6f1555a1b53e4096-explain-chart-modal" src="https://github.com/user-attachments/assets/df58855d-2277-4afd-92a9-616e101063b1" />
 
### 10-2-4. チャートの値をハイライトする (Highlight chart values)

#### **チャートの値をハイライトする (Highlight Values in a Chart)**

任意の一つの値をクリックして、それをハイライトします。
複数の値を選択するには、キーボードで`⌘ Command` (Mac OS) または `Ctrl` (Windows) を押しながら、各値をクリックします。

{Hightlight Value in a Chart動画挿入]

### 10-3-1. ワークブックでコメントを使用する (Use comments in workbooks)

ワークブックやデータモデルにコメントを追加して、チャートやコントロール要素にコンテキストを提供したり、同僚からのフィードバックを求めたり、リクエストを行ったりすることができます。ワークブックやデータモデルにコメントすると、以前にバージョンを公開したことのあるすべてのドキュメント編集者にメールが送信されます。

コメントを追加する際は、ワークブックが公開または保存されていることを確認してください。探索（exploration）にコメントを追加したい場合は、まずその探索を新しいワークブックとして保存する必要があります。ワークブックのカスタムビューにコメントを追加する場合は、変更をワークブックにマージするか、コメントする前にカスタムビューを保存してください。

#### **ユーザー要件 (User requirement)**
ワークブックでコメントを表示および追加するには、`Can comment on workbooks`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。

#### **コメントを表示する (View comments)**
ワークブックまたはデータモデルのコメントを表示するには、ドキュメント名をクリックし、ドキュメントメニューで`Comments`を選択します。
パネルが開き、すべてのコメントスレッドが表示されます。

<img width="1497" height="619" alt="33f3b8347bbc7f6b7f0169c3b9446f4d3b66e84dd00a41026e4c7e7f81174188-comments" src="https://github.com/user-attachments/assets/414ae867-9529-487e-8ff0-3ed21c025c9d" />

##### **コメントパネルを閉じる (Close the comments panel)**
コメントパネルを閉じるには、パネルの右上隅にある`Close comments panel`をクリックします。

#### **新しいコメントを追加する (Add a new comment)**
ワークブックまたはデータモデルに新しいコメントを追加するには：
1.  ドキュメントヘッダーでドキュメント名をクリックし、ドキュメントメニューで`Comments`を選択します。
2.  テキストボックスにコメントを入力します。コメントで他のSigmaユーザーを@-メンションして、コメントを通知することができます。
3.  `Comment`をクリックするか、キーボードショートカット（Macでは⌘ + enter、Windowsではctrl + enter）を押します。

<img width="1491" height="504" alt="b33a5fd796e63c1e0de927f87335c951a5a4634f7e44001475ba3b6ba54db7f4-comment-at-data-model" src="https://github.com/user-attachments/assets/ab7848a0-d57c-4b31-96e9-deba17f607ee" />

> 💡
> コメントに画像を追加することもできます。「[コメントで画像をキャプチャして注釈を付ける](https://help.sigmacomputing.com/docs/capture-and-annotate-images-in-comments)」を参照してください。

##### **個々の要素にコメントする (Comment on an individual element)**
特定の要素にコメントを追加するには：
1.  要素にカーソルを合わせます。
2.  要素の右上隅にある要素メニューをクリックします。
3.  `Comment`を選択します。

<img width="1500" height="608" alt="778eb6543d8d60f3a05a29ef45f85a40d017c11d3ce089511c46813639ae3477-comment-at-element" src="https://github.com/user-attachments/assets/9632adb5-d569-483a-8bf4-b937e24fc1f8" />

4.  特定の要素が選択された状態でコメントパネルが開きます。
5.  コメントを入力します。
6.  `Comment`をクリックします。

##### **コメントでユーザーをメンションする (Mention a user in a comment)**
メンションされたユーザーは、あなたのコメントに関するメール通知を受け取ります。
1.  コメントを追加する際、「@」と入力すると、メンションできるすべてのユーザーのリストが表示されます。
2.  名前またはメールアドレスを入力してユーザーを検索し始めます。
3.  スクロールまたは矢印キーを使用して、メンションしたい人を探し、クリックまたはEnterかTabを押してユーザーを選択します。
4.  コメントを保存すると、ユーザーはメール通知を受け取ります。

メンションされたユーザーがワークブックを閲覧する権限を持っていない場合、コメントの下にグレーのボックスが表示され、それらの権限を付与するように促されます。ユーザーに閲覧アクセス権を付与するには、`Grant view access`をクリックします。ユーザーにワークブックを閲覧する権限を付与しない場合、彼らはメール通知を受け取りません。

#### **コメントに返信する (Reply to a comment)**
特定のコメントに返信してコメントスレッドを開始するには：
1.  `Comments`パネルで、返信したいコメントまでスクロールします。
2.  コメントの左下隅にある`Reply`をクリックします。
3.  テキストボックスが開きます。
4.  返信を追加します。
5.  `Reply`をクリックして返信を追加します。

#### **コメントを管理する (Manage comments)**
ワークブックまたはデータモデルのコメントを編集、削除、解決できます。

##### **コメントを編集する (Edit a comment)**
自分のコメントのみ編集できます。作成したコメントを修正するには：
1.  `Comments`パネルで、編集したいコメントを探し、`More`をクリックします。
2.  `Edit`を選択します。
3.  コメントを更新します。
4.  `Save changes`をクリックします。

##### **コメントを削除する (Delete a comment)**
ユーザーは自分のコメントを削除できます。Adminアカウントタイプを割り当てられたユーザーは、どのコメントでも削除できます。
1.  `Comments`パネルで、編集したいコメントの`More`を選択します。
2.  `Delete`を選択します。
削除されたコメントに返信があった場合、返信は引き続き表示されます。返信がなかった場合、Sigmaはスレッドを削除します。

##### **コメントスレッドを解決する (Resolve a comment thread)**
コメントを解決すると、`Show resolved`オプションがオンになっていない限り、コメントとすべての返信はコメントパネルから非表示になります。
コメントスレッドを解決するには：
1.  解決したいコメントスレッドの最初のコメントにカーソルを合わせます。
2.  チェックボックス `(Resolve thread)` を選択します。
解決されたコメントへの返信を含む、コメントスレッド全体が解決されます。

##### **コメントスレッドを再開する (Reopen a comment thread)**
以前に解決されたコメントスレッドを再開するには：
1.  コメントパネルから、`See resolved`オプションをオンにします。
2.  再開したいコメントスレッドまでスクロールします。
3.  `Re-open thread`をクリックするか、スレッドの下部にある`Reply`をクリックして返信を追加します。
コメントスレッドが再開されます。

#### **コメント通知を見つける (Find your comment notifications)**
ドキュメントのバージョンを公開したことがあるすべてのユーザーは、ワークブックまたはデータモデルに追加されたすべてのコメントについてメール通知を受け取ります。さらに、コメントで具体的にメンションされると、メール通知を受け取ります。メールのタイトルは「[Sigma Computing] New Mention on <workbook name>」となります。

### 10-3-2. コメントで画像をキャプチャして注釈を付ける (Capture and annotate images in comments)

Sigmaでは、ワークブック要素の画像をキャプチャし、それに注釈を付けてコメントで共有することができます。

このドキュメントでは、画像をキャプチャして注釈を付ける方法について説明します。

#### **システムとユーザー要件 (System and user requirements)**
スクリーンショットに注釈を付ける機能には、以下が必要です。
* あなたがワークブックの所有者であるか、`Can explore`のワークブック権限を付与されている必要があります。
* ワークブックは保存されている必要があります。探索（explorations）ではコメントはサポートされていません。

#### **画像の保存と削除 (Image storage and deletion)**
Sigmaは注釈付きのスクリーンショットをそのクラウドストレージに保存します。Sigmaは、あなたの組織に固有の暗号化キーでサーバーサイドで画像を暗号化します。保存された画像へのアクセスはIAMポリシーによって保護されており、ユーザー認証と、それが由来するワークブックへの権限が必要です。Sigmaはまた、TLSを介して転送中の画像も暗号化します。

デフォルトでは、画像は90日後に期限切れになります。Sigmaは期限切れから24時間以内に画像を削除します。Sigma組織の管理者は、有効期限ポリシーを更新して最大2年まで延長するか、最小1日まで短縮することができます。

組織からすべての画像を削除するには、管理者は画像のタイムアウト期間を1に設定し、その後注釈をオフにします。すべての画像は48時間以内にSigmaストレージから削除されます。

削除された注釈付き画像を含むコメントは、画像があった場所にプレースホルダーを表示します。コメント内のすべてのテキストは残ります。

#### **要素の画像をキャプチャして注釈を付ける (Capture and annotate an image of an element)**
1.  要素のメニューから、`Comment`を選択します。
    ワークブックページの右側に、コメントを追加するためのオプションを持つメニューが開きます。

<img width="717" height="369" alt="0a2fa88-comment-image-context" src="https://github.com/user-attachments/assets/acab4c87-4c83-447a-a06d-815cfa7a2c43" />


2.  `Capture screenshot`を選択します。
3.  表示されるモーダルで、カーソルで描画して画像に注釈を付けます。
    (任意) カラーピッカーを使用して線の色を変更します。
    (任意) 元に戻す/やり直すオプションを使用します。

<img width="916" height="720" alt="a6b4eee-comment-image-modal" src="https://github.com/user-attachments/assets/c7446f94-0309-4390-a6f4-59ea48351f2b" />

4.  画像にコメントを追加します。コメントでチームメンバーをメンションするには、`@username`の規則を使用します。
5.  `Share in comment`をクリックします。
    Sigmaは、注釈付きの画像をワークブックの`Comments`パネルに配置し、コメントでメンションされたユーザーにメールを送信します。

<img width="288" height="718" alt="170631d-comment-image-final" src="https://github.com/user-attachments/assets/02103948-2f84-4a38-9627-e2736968b9ea" />

### 10-4-1. 組織内のファイルを検索する (Search for files in your organization)

Sigmaで検索を実行して、組織内のファイルを見つけることができます。これには以下が含まれます。
* ワークブック
* データセット
* テンプレート
* ドキュメント用のフォルダ
* ワークスペース
* データベースのテーブル
* データモデル

#### **ユーザー要件 (User requirements)**
どのユーザーでもドキュメントを検索できますが、少なくとも`Can view`のアクセス権が付与されているドキュメントしか表示できません。

#### **ファイルを検索する (Search for files)**
ファイルを検索するには：
1.  **ホーム**に移動し、`Search`を選択します。
2.  検索語を入力します。関連するファイルが表示されたらそれを選択するか、キーボードで`Return`を押して検索ページに移動します。
3.  検索結果は関連性に応じて自動的に順序付けられ、以前のユーザーアクティビティやドキュメントのエンゲージメントが考慮されます。
4.  [任意] 検索ページを使用している場合、結果をフィルタリングして、最も関連性の高いものを見つけることができます。
    * **Document type:** 希望するドキュメントタイプの隣にあるチェックボックスを選択します。
    * **Badge type:** 希望するバッジタイプの隣にあるチェックボックスを選択します。
    * **Owner:** ドキュメントの所有者を検索して選択します。

### 11-1-1. ワークブックまたはデータモデルを共有する (Share a workbook or data model)

ワークブックまたはデータモデルの所有者であるか、`Can Edit`権限を持っている場合、そのドキュメントを個人、チーム、およびSigma組織内の全員と共有できます。

> 🚩
> ドキュメントを誰かと共有すると、その人には接続データソース内のデータに対する`View`アクセス権も付与されます。

特定のバージョンのみにユーザーアクセスを許可してドキュメントを共有したい場合は、「[ワークブックまたはデータモデルのタグ付きバージョンを共有する](https://help.sigmacomputing.com/docs/add-version-tags#share-tagged-versions-of-a-document)」を参照してください。

#### **要件 (Requirements)**
ドキュメントを共有する機能には、以下が必要です。
* `Share documents`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* あなたがワークブックまたはデータモデルの所有者であるか、そのドキュメントに対する`Can edit`アクセス権を付与されている必要があります。

#### **ユーザー、チーム、およびすべての組織メンバーとの共有について (About sharing with users, teams, and all organization members)**
ドキュメントを個々のユーザーと共有する場合、利用可能な権限はユーザーのアカウントタイプに依存します。

| ドキュメントアクセス | 必要な最小アカウントタイプ権限 | 説明 |
| :--- | :--- | :--- |
| **Can view** | `View workbooks` または `View datasets` | ユーザーは`View`モードでワークブック要素を表示および操作できます。ユーザーはデータモデルの概要を表示および操作できます。 |
| **Can explore** | `Full explore` | ワークブックのみ。`Can view`の機能に加えて、ユーザーは`Explore`モードでワークブックのカスタムビューを作成するためにワークブック要素を変更できます。 |
| **Can edit** | `Create, edit, and publish workbooks` または `Create, edit, and publish datasets` | `Can view`および`Can explore`の機能に加えて、ユーザーはドキュメントを管理（名前の変更、移動、削除）、非表示のページを表示、公開バージョンを更新できます。`Share documents`アカウントタイプ権限が有効な場合、ユーザーはワークブックを他の組織メンバーと共有することもできます。 |

ドキュメントを組織のすべてのメンバーまたは特定のチームと共有する場合、個々のユーザーアクセスは、ドキュメントアクセスとアカウントタイプ権限の間で最も制限の厳しい許可（最も権限の少ないもの）に基づきます。

例えば、組織のすべてのメンバーに`Can edit`アクセス権を付与したが、あるユーザーが`View workbooks`権限のみが有効なアカウントタイプを割り当てられている場合、その特定のユーザーは`Can view`のワークブックアクセスに制限されます。

ドキュメントのアクセスとモードに関する詳細は、「[Folder and document permissions](https://help.sigmacomputing.com/docs/folder-and-document-permissions)」および「[Workbook modes overview](https://help.sigmacomputing.com/docs/workbook-modes-overview)」を参照してください。

#### **ドキュメントを組織のメンバーまたはチームと共有する (Share a document with an organization member or team)**
ドラフトまたは公開済みのドキュメントを共有できます。
1.  ドキュメントヘッダーで、`Share`()をクリックして`Share Workbook`または`Share Data model`モーダルを開きます。ドキュメントメニューからドキュメントを共有することもできます。
2.  検索バーに、ワークブックまたはデータモデルを共有したいチームまたは組織のメンバーを入力します。
3.  各チームまたはユーザーについて、ドロップダウンから`Permission`を選択します。ドキュメントにタグ付きバージョンがある場合、特定のバージョンタグに権限を制限することもできます。「[ドキュメントのタグ付きバージョンを共有する](https://help.sigmacomputing.com/docs/add-version-tags#share-tagged-versions-of-a-document)」を参照してください。
4.  必要に応じて、追加のチームまたはメンバーに対して繰り返します。
5.  (任意) ドキュメントへのアクセス権を得るユーザーへのメールメッセージに含めるメッセージを追加します。
    * デフォルトでは、Sigmaサービスはメールメッセージを送信します。メールを送信したくない場合は、チェックボックスの選択を解除します。
6.  `Share`をクリックします。

#### **ドキュメントのタグ付きバージョンを共有する (Share tagged versions of a document)**
特定のワークブックでユーザーやチームが見ることができる内容、またはユーザーがアクセスできるデータモデルのバージョンを制御するには、タグ付きバージョンをユーザーまたはチームと共有します。

特定のバージョンタグへのアクセスのみでドキュメントを共有すると、ドキュメントの公開バージョンへのアクセスを事実上取り消し、共有されたタグ付きバージョンへのアクセスのみに制限します。特定のユーザーまたはチームに対して、ドキュメントの公開バージョンのようにタグ付きバージョンを使用できます。

例えば、East地域に完全にフィルタリングされたSalesワークブックのバージョンを作成し、そのバージョンにEastというタグを付け、そのタグ付きバージョンをSales - Eastチームと共有することができます。Sales - Eastチームのメンバーは、そのバージョンのワークブックに対する表示（および探索）アクセス権を持ちますが、ソースワークブックにはいかなる変更も加えることはできません。
> 📘
> タグ付きバージョンのワークブックがユーザーにデータソースへのアクセスを許可している場合、タグ付きバージョンのワークブックに対する`Can explore`権限を持つユーザーは`Save As`を選択し、編集用にバージョンタグ付きワークブックのコピーを保存できます。

ワークブックまたはデータモデルのタグ付きバージョンを共有するには、以下を実行します。
1.  ドキュメントヘッダーで、`Share`()をクリックして`Share Workbook`または`Share Data model`モーダルを開きます。ドキュメントメニューからドキュメントを共有することもできます。
2.  検索バーに、ワークブックまたはデータモデルのタグ付きバージョンを共有したいチームまたは組織のメンバーを入力します。
3.  各チームまたはユーザーについて、ドロップダウンから`Permission`を選択し、次に権限にカーソルを合わせて、アクセスを許可するドキュメントのタグを選択します。ユーザーまたはチームとワークブックのすべてのバージョンを共有するには、`All`（デフォルト）を選択します。

<img width="790" height="512" alt="a5be3fb-vt-share-workbook" src="https://github.com/user-attachments/assets/ca111814-e869-45dd-a76f-d5823e6d12aa" />

4.  `Share`をクリックします。

ドキュメントバージョンから[タグを削除](https://help.sigmacomputing.com/docs/add-version-tags#remove-a-tag-from-a-document-version)すると、そのタグ付きバージョンのドキュメントへのアクセス権しか持たないユーザーとチームは、ドキュメントへのアクセスを失います。

#### **ワークブックを組織と共有する (Share a workbook with your organization)**
ワークブックへのリンクをコピーし、組織内のユーザーと共有できます。ゲストユーザーと外部ユーザーは、組織と共有されたワークブックにアクセスできません。
1.  ワークブックヘッダーで、`Share`()をクリックして`Share Workbook`モーダルを開きます。ドキュメントメニューからワークブックを共有することもできます。
2.  モーダルの下部にある`General access link`セクションで、`Allow sharing by link`を切り替えます。
3.  `All members of your organization`について、利用可能な権限から選択します。利用可能な権限は以下の通りです。
    * Can view
    * Can explore
    * Can edit
4.  権限を設定した後、`Copy Link`をクリックしてワークブックへのリンクをコピーし、他の人と共有してからモーダルを閉じます。

#### **ドキュメントの所有権を移管する (Transfer ownership of a document)**
ワークブックまたはデータモデルの所有権をあるユーザーから別のユーザーに移管できます。ドキュメントの所有権を移管する前に、将来の所有者がドキュメントを含むフォルダにアクセスできることを確認するか、ドキュメントを移動してください。
> 📘
> 所有権を移管するには、`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。

ワークブックまたはデータモデルの所有権を移管するには、ドキュメントを将来の所有者と共有し、次に彼らを所有者として割り当てます。
1.  ドキュメントヘッダーで`Share`()をクリックします。
2.  検索バーに、所有権を移管したいユーザーを入力します。
3.  ユーザーに任意の権限レベルを付与し、`Share`をクリックします。
4.  再度`Share`()をクリックし、所有権を移管したいユーザーを探します。
5.  ユーザーの権限ドロップダウンメニューで、`Owner`を選択します。
6.  変更は自動的に保存されます。
> 📘
> ユーザーを非アクティブ化する際、彼らのすべてのドキュメントの所有権を別のユーザーに移管できます。「[ユーザーを非アクティブ化する](https://help.sigmacomputing.com/docs/manage-members-and-teams#deactivate-a-user)」を参照してください。

#### **ワークブックのカスタムビューを共有する (Share a custom view of a workbook)**
ワークブックをカスタマイズしてカスタムビューを作成した場合、リンクを使用して他の人とカスタムビューを共有できます。
1.  ドキュメントヘッダーで、`Share and export` > `Share`をクリックします。
2.  `Share Workbook`モーダルで、`Link to current custom view`のチェックボックスが選択されていることを確認します。
3.  カスタムビューへのリンクを誰とでも共有するには、`Allow general sharing by link`を切り替え、権限を選択し、リンクをコピーします。
4.  既にワークブックへのアクセス権を持つ他のユーザーとカスタムビューへのリンクを共有するには、`Copy link`を選択します。
> 💡
> カスタムビューに変更を加えた場合、変更を共有するためには新しいリンクを作成する必要があります。

#### **探索を共有する (Share an exploration)**
まだワークブックを保存していない場合でも、探索を共有できます。ヘッダーで`Share`()をクリックし、`Allow access by link`をオンにします。

<img width="642" height="122" alt="e6161703fe063c85e50be5973036d42f5b18faaf886898ef49cf58c8ea212aa3-wb-share-exploration" src="https://github.com/user-attachments/assets/cac4da99-7ff7-4541-92c7-c4a9411a0f0e" />

#### **ページを非表示にしてワークブックのコンテンツへのアクセスを制限する (Limit access to workbook contents by hiding pages)**
ワークブックの`Can Explore`および`Can View`権限のみを持つユーザーから、ワークブックのページを非表示にすることができます。ページを非表示にするには、「[ワークブックのページの可視性を管理する](https://help.sigmacomputing.com/docs/manage-workbook-page-visibility)」を参照してください。

#### **コンテンツへのアクセスリクエストに応答する (Respond to requests for access to content)**
ワークブックの所有者として、ユーザーがあなたのコンテンツにアクセスしようとして権限がない場合、彼らはアクセスをリクエストできます。アクセスリクエストはドキュメント所有者にメールで送信されます。
リクエストに応答するには、以下を実行します。
1.  メール通知を開き、`Respond to the Request`ボタンをクリックします。

<img width="628" height="444" alt="c023140aafe7cda56a490017a129802a9c11519b9d639f1fc3c6fea7d109f06c-wb-share-email" src="https://github.com/user-attachments/assets/3d13ce38-0d3d-4086-8b98-4a75a481f7b2" />

    Sigmaサービスへのウェブブラウザウィンドウが開きます。ログイン後、`Share Workbook`モーダルが開きます。アクセスリクエストを表示および応答できます。
2.  (任意) リクエストしているユーザーについて、権限ドロップダウンメニューをクリックして適切なアクセスレベルを選択します。
    > 📘
    > ユーザーには、そのアカウントタイプが許可するよりも高いアクセス権を付与することはできません。

<img width="877" height="289" alt="8c5d9f1e54c9cf2fd6f1aba5226b3cb8a501273c5eb1c3aaad357b067cd504a5-share-wb-request" src="https://github.com/user-attachments/assets/f199037e-3655-4fe2-9973-1e5f82481f41" />

3.  リクエストを承認するには、`Approve`をクリックします。
4.  リクエストを拒否するには、`Deny`をクリックします。
   `Save`をクリックします。

#### **ドキュメントの所有権を移管する (Transfer ownership of a document)**
ワークブックまたはデータモデルの所有権をあるユーザーから別のユーザーに移管できます。ドキュメントの所有権を移管する前に、将来の所有者がドキュメントを含むフォルダにアクセスできることを確認するか、ドキュメントを移動してください。
> 📘
> 所有権を移管するには、`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。

ワークブックまたはデータモデルの所有権を移管するには、ドキュメントを将来の所有者と共有し、次に彼らを所有者として割り当てます。
1.  ドキュメントヘッダーで`Share`()をクリックして`Share workbook`または`Share data model`モーダルを開きます。ドキュメントメニューからドキュメントを共有することもできます。
2.  検索バーに、所有権を移管したいユーザーを入力します。
3.  ユーザーに任意の権限レベルを付与します。
4.  `Share`をクリックします。
5.  ドキュメントヘッダーで再度`Share`()をクリックして`Share workbook`または`Share data model`モーダルを開きます。
6.  所有権を移管したいユーザーを探します。
7.  ユーザーの権限ドロップダウンメニューで、`Owner`を選択します。
8.  変更は自動的に保存されます。
> 📘
> ユーザーを非アクティブ化する際、彼らのすべてのドキュメントの所有権を別のユーザーに移管できます。「[ユーザーを非アクティブ化する](https://help.sigmacomputing.com/docs/manage-members-and-teams#deactivate-a-user)」を参照してください。

#### **ワークブックのカスタムビューを共有する (Share a custom view of a workbook)**
ワークブックをカスタマイズしてカスタムビューを作成した場合、リンクを使用して他の人とカスタムビューを共有できます。
1.  ドキュメントヘッダーで、`Share and export` > `Share`をクリックします。
2.  `Share Workbook`モーダルで、`Link to current custom view`のチェックボックスが選択されていることを確認します。
3.  カスタムビューへのリンクを誰とでも共有するには、`Allow general sharing by link`を切り替え、権限を選択し、リンクをコピーします。
4.  既にワークブックへのアクセス権を持つ他のユーザーとカスタムビューへのリンクを共有するには、`Copy link`を選択します。
> 💡
> カスタムビューに変更を加えた場合、変更を共有するためには新しいリンクを作成する必要があります。

#### **探索を共有する (Share an exploration)**
まだワークブックを保存していない場合でも、探索を共有できます。ヘッダーで`Share`()をクリックし、`Allow access by link`をオンにします。

#### **ページを非表示にしてワークブックのコンテンツへのアクセスを制限する (Limit access to workbook contents by hiding pages)**
ワークブックの`Can Explore`および`Can View`権限のみを持つユーザーから、ワークブックのページを非表示にすることができます。ページを非表示にするには、「[ワークブックのページの可視性を管理する](https://help.sigmacomputing.com/docs/manage-workbook-page-visibility)」を参照してください。

#### **コンテンツへのアクセスリクエストに応答する (Respond to requests for access to content)**
ワークブックの所有者として、ユーザーがあなたのコンテンツにアクセスしようとして権限がない場合、彼らはアクセスをリクエストできます。アクセスリクエストはドキュメント所有者にメールで送信されます。
リクエストに応答するには、以下を実行します。
1.  メール通知を開き、`Respond to the Request`ボタンをクリックします。
2.  Sigmaサービスへのウェブブラウザウィンドウが開きます。ログイン後、`Share Workbook`モーダルが開きます。アクセスリクエストを表示および応答できます。
3.  (任意) リクエストしているユーザーについて、権限ドロップダウンメニューをクリックして適切なアクセスレベルを選択します。
    > 📘
    > ユーザーには、そのアカウントタイプが許可するよりも高いアクセス権を付与することはできません。
4.  リクエストを承認するには、`Approve`をクリックします。
5.  リクエストを拒否するには、`Deny`をクリックします。
6.  `Save`をクリックします。

#### **共有コンテンツにアクセスする (Access shared content)**
別のユーザーがあなたと直接ドキュメントを共有すると、それはSigmaホームページの`Shared with Me`セクションに表示されます。
Sigma組織のすべてのユーザーと共有されたドキュメントは、`Shared with Me`には表示されません。
* Sigma組織のすべてのユーザーと共有されたデータモデルにアクセスするには、名前で検索します。
* リンクを介してSigma組織のすべてのユーザーと共有されたワークブックにアクセスするには、Sigmaホームページの`Recents`セクションを検索するか、リンクを介してアクセスします。


### 11-2-1. フォルダを共有する (Share a folder)

フォルダを使用して、ドキュメントを分類し、人々と共有することができます。フォルダへのアクセス権を付与することで、他のユーザーやチームとフォルダを共有します。フォルダは4つのレベルのアクセス権限をサポートしています。
* Can view (閲覧可能)
* Can explore (探索可能)
* Can contribute (貢献可能)
* Can manage (管理可能)

このドキュメントでは、フォルダの権限とフォルダの共有方法について説明します。利用可能な権限の詳細については、「[Folder and document permissions](https://help.sigmacomputing.com/docs/folder-and-document-permissions)」を参照してください。

#### **ユーザー要件 (User requirements)**
フォルダを共有する機能には、以下が必要です。
* `Share documents`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* あなたがフォルダの所有者であるか、そのフォルダに対する`Can manage`アクセス権を付与されている必要があります。

#### **権限タイプ (Permission types)**
権限オプションは、フォルダとワークスペースで同じです。フォルダまたはワークスペースレベルで設定された権限は、そのワークスペースまたはフォルダ内のすべてのドキュメントに適用されます。

| 権限 | フォルダアクセスと機能 |
| :--- | :--- |
| **Can view** | - 共有スペース内のドキュメントとフォルダへの閲覧専用アクセス |
| **Can explore**| - 共有スペース内のワークブックへの探索アクセス<br>- 共有スペース内のすべてのデータセットへの閲覧専用アクセス |
| **Can contribute**| - 自身のドキュメントとフォルダの作成および編集<br>- 共有スペース内の他のユーザーのドキュメントとフォルダの閲覧および探索<br>- 自身が作成したすべてのものを管理。自身のドキュメントとフォルダの削除、名前の変更、移動を含む<br>ワークスペースへの`Can contribute`アクセス権を持つユーザーは、そのワークスペースで個人的に作成したすべてのドキュメントに対して自動的に`Can edit`アクセス権を取得します。 |
| **Can manage** | - 自身のドキュメントとフォルダの作成および編集<br>- 共有スペース内の他の人のドキュメントとフォルダの編集<br>- 共有スペース内のすべてのものを管理。アクセス管理、共有、削除、名前の変更、および誰のドキュメントやフォルダの移動も含む。<br>ワークスペースまたはフォルダでの`Can manage`は、そのフォルダ内のどのドキュメントに対しても`Can edit`を付与します。 |

#### **フォルダを共有する (Share a folder)**
いくつかの方法で、Sigma内の他のユーザーやチームとドキュメントのフォルダを共有できます。

##### **フォルダ内から共有する (Share from within the folder)**
1.  フォルダを開きます。
2.  画面上部のフォルダ名の隣にある`Share`をクリックします。`Share Folder`モーダルが開きます。
3.  テキストボックスに、追加したい個々のユーザーまたはチームの名前を入力します。
4.  (任意) ユーザーまたはチームのアクセスレベルを変更するには、ドロップダウンをクリックして各チームまたはメンバーの権限タイプを選択します。権限を選択しない場合、デフォルトの権限は`Can explore`に設定されます。
5.  (任意) フォルダに追加されたことをユーザーに通知するには、`Send email`チェックボックスを選択します。`Add a message`に、メール本文に含めるメッセージを入力します。
6.  `Save`をクリックします。

##### **ナビゲーションページから共有する (Share from a navigation page)**
1.  共有したいフォルダに移動します。
2.  フォルダの親フォルダを開きます。
3.  共有したいフォルダの隣にある`More`をクリックします。
4.  `Share...`を選択して`Share Folder`モーダルを開きます。
5.  テキストボックスに、追加したい個々のユーザーまたはチームの名前を入力します。
6.  (任意) アクセスレベルを変更します。
7.  (任意) メール通知を送信します。
8.  `Save`をクリックします。

#### **フォルダへのアクセス権を修正または取り消す (Modify or revoke access to a folder)**
ユーザーやチームにフォルダへの初期アクセス権を与えた後で、いつでもそのアクセスレベルを変更したり、アクセスを完全に取り消したりすることができます。
1.  親フォルダで`More`をクリックして`Share...`を選択するか、個々のフォルダのページで`Share`をクリックして`Share Folder`モーダルを開きます。
2.  `Share Folder`モーダルで、`Person or team with access`セクションを確認します。
3.  アクセスタイプを修正するか、アクセスを取り消します。
    * 新しいアクセスレベルを選択するには、`Permission`ドロップダウンメニューを使用します。
    * アクセスを完全に取り消すには、チームまたはメンバーにカーソルを合わせ、`Remove access`をクリックします。
4.  `Save`をクリックします。

#### **コンテンツへのアクセスリクエストに応答する (Respond to request for access to content)**
ユーザーがあなたのコンテンツにアクセスしようとして権限がない場合、彼らはアクセスをリクエストできます。これにより、フォルダの所有者に`Request for access`という件名のメール通知が送信されます。
リクエストに応答するには、以下を実行します。
1.  メール通知で、`Respond to the request`をクリックします。`Share Folder`モーダルが開き、現在のアクセスリクエストを表示できます。
2.  (任意) ドロップダウンメニューを使用して、ユーザーのアクセスレベルを設定します。
    > 📘
    > ユーザーには、そのアカウントタイプが許可するよりも高いアクセス権を付与することはできません。
3.  リクエストを承認または拒否します。
    * リクエストを承認するには、`Approve`をクリックします。
    * リクエストを拒否するには、`Deny`をクリックします。
4.  `Share Folder`モーダルを閉じます。付与または拒否したアクセスは、`Approve`または`Deny`を選択した後に保存されます。

### 11-3-1. ワークブックテンプレートを共有する (Share workbook templates)

ワークブックテンプレートを使用すると、ユーザーはワークブックの構造をテンプレート化して共有し、迅速かつ一貫性のある再利用が可能になります。

#### **ユーザー要件 (User requirements)**
ワークブックテンプレートを共有する機能には、以下が必要です。
* `Share documents`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* あなたがテンプレートの所有者であるか、`Can edit`のテンプレート権限を付与されている必要があります。

#### **テンプレートの権限オプション (Template permission options)**
テンプレートには2つの権限タイプが利用可能です。
* **Can Use (使用可能)** – ユーザーがテンプレートを閲覧し、それからワークブックを作成できるようにします。
* **Can Edit (編集可能)** – 「Can Use」のすべての権限に加えて、ユーザーがテンプレートを編集し、共有できるようにします。

#### **テンプレートを共有する (Share a template)**
1.  ホームページの左側ナビゲーションパネルから`Templates`ギャラリーページを開きます。
2.  編集したいテンプレートを見つけます。
3.  その`More`ボタンをクリックしてメニューを開きます。
4.  `Open`をクリックします。
5.  ワークブックヘッダーで、共有アイコン()をクリックします。
    Sigmaが共有モーダルを開きます。

<img width="1676" height="49" alt="2472e4d-2" src="https://github.com/user-attachments/assets/5db2c0f5-09f5-47c4-9b2f-0ed78d863439" />

6.  `Member or Team`の下で、共有したいユーザーまたはチームを選択します。
7.  `Permission`の下で、[権限タイプ](https://help.sigmacomputing.com/docs/share-templates#template-permission-options)を選択します。
8.  (任意) 招待状に含めるメッセージを記入します。
9. `Save`をクリックします。

### 11-3-2. 組織間でワークブックテンプレートを共有および承認する (Share and accept cross-org workbook templates)

組織間共有を使用すると、異なるSigma組織間でワークブックテンプレートを共有および承認できます。**受信側組織**が共有テンプレートを承認する際、テンプレートにデータを設定するために独自のデータソースを選択する必要があり、**共有元組織**からのデータが開示されないように保証されます。

このドキュメントでは、組織間でワークブックテンプレートを共有および承認する方法について説明します。

#### **ユーザー要件 (User requirements)**
組織間共有を通じてワークブックテンプレートを共有または承認するには、`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。

#### **別の組織とテンプレートを共有する (Share a template with another organization)**
1.  **ホーム**ページに移動します。
2.  ナビゲーションメニューで、`Templates`を選択します。
3.  `Templates`ページで、共有したいテンプレートを探し、`More`をクリックしてメニューから`Share`を選択します。
    > 📘
    > 新しいテンプレートを追加するには、まず`Create Template`をクリックし、保存済みのワークブックからテンプレートを作成します。

<img width="1148" height="468" alt="cross-org-wb-template_share" src="https://github.com/user-attachments/assets/e119beb8-9706-49f3-855d-2409ec94359b" />

4.  `Share Template`モーダルで、`Share across Sigma Orgs`をクリックします。

<img width="880" height="550" alt="cross-org-wb-template_share-across-sigma-orgs" src="https://github.com/user-attachments/assets/f9727be8-76b6-4f3c-ab29-0c3dd3374e2d" />

5.  `Cross Org Share Template`モーダルで、必要な情報を提供します。
    * `Company Login URL Slug`フィールドに、受信側組織に関連付けられたスラッグを入力します。これは通常、Sigma URLの`app.sigmacomputing.com/`に続く一意の識別子です。
    * [任意] `Add a message`フィールドに、Sigmaが受信側組織の管理者に送信する招待メールに含めるメッセージを入力します。
    * `Share Template`をクリックします。

<img width="880" height="550" alt="cross-org-wb-template_share-template" src="https://github.com/user-attachments/assets/5820b83d-2a2b-46e3-bd7c-759dcccbb4b3" />

#### **あなたの組織と共有されたテンプレートを承認する (Accept a template shared with your organization)**
あなたの組織が共有テンプレートを使用するための招待を受け取った場合、あなたまたは別の管理者は、それを受け入れる前にデータソースを交換（組織のデータでテンプレートを設定するため）する必要があります。これが完了するまで、テンプレートは組織のメンバーには利用できません。

1.  招待メールで、`Open in Sigma`をクリックします。
2.  `Swap Data Sources Overview`モーダルで、Sigmaは元のテンプレートで使用されているデータと密接に一致する接続とデータソースを識別します。これらの候補から選択してデータを自動的に交換するか、個々のデータソースの列を手動で選択して照合します。
    * **一致する接続とデータソースを使用する:**
        1.  `Matching Connection`および`Matching Data Sources`フィールドで、関連するオプションを選択します。
        2.  `Choose`をクリックして、交換されたデータでテンプレートをプレビューします。

<img width="880" height="434" alt="cross-org-wb-template_swap-data-sources-overview" src="https://github.com/user-attachments/assets/408f1c25-7cef-400e-8d65-1486c3b5b6d6" />

     * **データを手動で選択してマッピングする:**
        1.  `Match Manually`をクリックします。
        2.  `Swap Data Sources`画面で、テンプレートの元のデータソースからの列名をプレビューし、`Select Source`をクリックします。
        3.  `Select source to replace`モーダルで、テンプレートを設定するために希望のデータソースを選択します。
        4.  選択したデータを確認し、`Select`をクリックして続行します。
       
   <img width="1033" height="616" alt="cross-org-wb-template_select-data-source" src="https://github.com/user-attachments/assets/f9358854-2c39-4e0d-8699-7a7819824b05" />

        5.  `Swap Data Sources`画面で、テンプレートの元のデータソース列を、交換したデータソース列にマッピングします。
        6.  `Choose`をクリックして、交換されたデータでテンプレートをプレビューします。

  <img width="1149" height="374" alt="cross-org-wb-template_manually-match-columns" src="https://github.com/user-attachments/assets/f9b035df-5e29-47eb-8496-2a3f8df4f0c7" />

3.  交換されたデータでテンプレートを保存するには、ワークブックヘッダーの`Accept`をクリックします。それ以外の場合は、`Swap sources`をクリックし、ステップ2を繰り返して異なるデータを選択します。

<img width="1149" height="280" alt="cross-org-wb-template_accept" src="https://github.com/user-attachments/assets/7424ab3a-2045-4425-861b-16d98f7615b9" />


### 11-4-1. 条件付きエクスポートまたはアラートをスケジュールする (Schedule a conditional export or alert)

特定の条件が満たされた場合にのみ送信されるエクスポートをスケジュールし、条件付きアラートとして機能させることができます。データが利用可能かどうかに基づいて、またはコントロールや列の特定の値に基づいてエクスポートをトリガーします。この柔軟性により、定期的なエクスポートを微調整し、エクスポートされるレポートの効率性と関連性を確保できます。

例えば、特定の列のデータが特定の値を超えた場合や、特定の異常な条件に一致した場合にSlack通知を送信するなど、外れ値や異常検出のワークフローをサポートするために条件付きアラートを構成します。「[検出された外れ値と異常に対するアラート](https://help.sigmacomputing.com/docs/schedule-a-conditional-export-or-alert#alert-on-detected-outliers-and-anomalies)」を参照してください。

このドキュメントでは、事前定義された条件で定期的なエクスポートをスケジュールする方法について説明します。

#### **ユーザー要件 (User requirements)**
スケジュールされたエクスポートに条件を追加する機能には、以下が必要です。
* `Schedule exports`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* あなたがワークブックの所有者であるか、`Can explore`または`Can edit`の[ワークブック権限](https://help.sigmacomputing.com/docs/share-a-workbook)を付与されている必要があります。
> 📘
> エクスポート先によっては、追加の要件が適用される場合があります。詳細は「[Account type permission availability matrix](https://help.sigmacomputing.com/docs/account-type-and-license-overview#sharing-and-exports)」の「Sharing and exports」セクションを参照してください。

#### **条件付きエクスポートとアラートについて (About conditional exports and alerts)**
事前定義されたデータ条件は、Sigmaがスケジュールされたエクスポートを開始するかどうかを決定するためのフィルターとして機能します。エクスポートの期限が来ると、Sigmaはデータを確認し、条件が満たされている場合にのみ続行します。定期的なスケジュールはエクスポートがタイムリーであることを保証し、条件はそれが関連性があることを保証します。

[コントロール値でエクスポートをフィルタリングする](https://help.sigmacomputing.com/docs/send-and-schedule-exports#use-controls-to-customize-report-content)場合、Sigmaは条件が満たされているかを確認する前にフィルターを実行します。
> 🚧
> PDFまたはPNG形式へのスケジュールされたエクスポートまたは直接ダウンロードを実行する際、Sigmaはデバッグおよびトラブルシューティング目的で使用されるトレースログに、該当するコントロール値をURLパラメータとして保存することがあります。コントロールを使用して機密データをフィルタリングするワークブックコンテンツをエクスポートまたはダウンロードする際は注意してください。

#### **データの可用性に基づいてエクスポートをスケジュールする (Schedule an export based on data availability)**
特定のデータ要素または入力テーブルが事前定義されたデータ条件を満たす場合にのみ開始される定期的なエクスポートをスケジュールします。
1.  ワークブックヘッダーで、ワークブックの名前に関連付けられた下矢印()をクリックし、`Share and export > Schedule exports...`を選択します。
2.  これがワークブックの最初のスケジュールの場合は`Add schedule`を、そうでない場合は`+ New schedule`をクリックします。
3.  `Frequency`セクションの`Send`で、`If a condition is met`を選択します。
4.  (任意) `If a condition is met`の場合にのみエクスポートを送信することを選択した場合、1日、1週間、または合計で設定された回数発生した後に通知を停止するスイッチをオンにできます。（この機能はベータ版です）
5.  `Condition`セクションで、条件設定を指定します。
    * `Send`で、エクスポートを送信する条件を指定します。
        * **If there's no data:** 対象要素にデータがない場合にスケジュール通りエクスポートします。
        * **If there's data:** 対象要素にデータがある場合にスケジュール通りエクスポートします。
    * `In data element`で、データの可用性が適用される対象要素を選択します。
    > 📘
    > 条件は単一の対象要素に適用されますが、ワークブック全体、特定のページ、および個々の要素をエクスポートするようにスケジュールを構成できます。
6.  `Test condition`をクリックして、対象要素が現在条件を満たしているかを確認します。

<img width="623" height="243" alt="7d188d072d379cce41c82d2d55cd122c097843d371e8f09d45606279ffbc4b09-scheduleexportconditional2_1" src="https://github.com/user-attachments/assets/062f90e4-e457-4d74-a4d7-2b750862b990" />


7.  `Schedule exports`モーダルの残りのセクションを完了します。
> 📘
> 宛先の利用可能性はアカウントタイプの権限に依存します。
* [メールへのエクスポート](https://help.sigmacomputing.com/docs/export-to-email)
* [Slackへのエクスポート](https://help.sigmacomputing.com/docs/export-to-slack)
* [Google Sheetsへのエクスポート](https://help.sigmacomputing.com/docs/export-to-google-sheets)
* [Google Driveへのエクスポート](https://help.sigmacomputing.com/docs/export-to-google-drive)
* [Webhookへのエクスポート](https://help.sigmacomputing.com/docs/export-to-webhook)
* [クラウドストレージへのエクスポート](https://help.sigmacomputing.com/docs/export-to-cloud-storage)
* [メールバーストとしてエクスポート](https://help.sigmacomputing.com/docs/export-as-email-burst)
8.  `Create`をクリックして構成されたスケジュールを保存します。

#### **条件文に基づいてエクスポートをスケジュールする (Schedule an export based on a conditional statement)**
特定のデータ要素または入力テーブルが事前定義された条件文を満たす場合にのみ開始される定期的なエクスポートをスケジュールします。

1.  ワークブックヘッダーで、ワークブックの名前に関連付けられた下矢印()をクリックし、`Share and export > Schedule exports...`を選択します。
2.  これがワークブックの最初のスケジュールの場合は`Add schedule`を、そうでない場合は`+ New schedule`をクリックします。
3.  `Frequency`セクションの`Send`で、`If a condition is met`を選択します。
4.  (任意) `If a condition is met`の場合にのみエクスポートを送信することを選択した場合、1日、1週間、または合計で設定された回数発生した後に通知を停止するスイッチをオンにできます。（この機能はベータ版であり、ベータ機能の通知の対象となります）。
5.  `Condition`セクションで、条件設定を指定します。
    * `Send`で、`If a condition is met`を選択して、対象要素の特定のデータ条件が満たされた場合にスケジュール通りエクスポートします。
    * `In data element`で、条件が適用される対象要素を選択します。
    > 📘
    > 条件は単一の対象要素に適用されますが、ワークブック全体、特定のページ、および個々の要素をエクスポートするようにスケジュールを構成できます。
6.  条件文を定義します。`Check if`で、条件を適用する要素の値を選択します。
    * **Any value:** 列内の一つ以上の値が条件に一致する必要があります。
    * **All values:** 列内のすべての値が条件に一致する必要があります。
    * 選択した要素がKPIの場合、追加の条件を確認できます。
        * **{Element title}:** 要素の`Value`プロパティ列の一つ以上の値が基準を満たす必要があります。
        * **Comparison value (%):** 要素の`Comparison`プロパティ列の一つ以上の値が基準を満たす必要があります。
7.  `Any value`または`All values`を選択した場合、`In column`で使用する列を指定します。
8.  `Is`で、比較演算子を選択します。
9.  `Value`で、比較値を選択します。
10. `Test condition`をクリックして、対象要素が現在条件を満たしているかを確認します。結果が期待と合わない場合は、正しい条件と対象要素を選択したことを確認してください。
<img width="623" height="243" alt="7d188d072d379cce41c82d2d55cd122c097843d371e8f09d45606279ffbc4b09-scheduleexportconditional2_1" src="https://github.com/user-attachments/assets/f458f35c-d3c2-4d38-a46f-4969b07da7d5" />

11. `Schedule exports`モーダルの残りのセクションを完了します。詳細については、希望するエクスポート先に基づいた以下のドキュメントを参照してください。
    > 📘
    > 宛先の利用可能性はアカウントタイプの権限に依存します。
    * [メールへのエクスポート](https://help.sigmacomputing.com/docs/export-to-email)
    * [Slackへのエクスポート](https://help.sigmacomputing.com/docs/export-to-slack)
    * [Google Sheetsへのエクスポート](https://help.sigmacomputing.com/docs/export-to-google-sheets)
    * [Google Driveへのエクスポート](https://help.sigmacomputing.com/docs/export-to-google-drive)
    * [Webhookへのエクスポート](https://help.sigmacomputing.com/docs/export-to-webhook)
    * [クラウドストレージへのエクスポート](https://help.sigmacomputing.com/docs/export-to-cloud-storage)
    * [メールバーストとしてエクスポート](https://help.sigmacomputing.com/docs/export-as-email-burst)
12. `Create`をクリックして構成されたスケジュールを保存します。

#### **要素の条件付きアラートをスケジュールする (Schedule a conditional alert for an element)**
特定のデータ要素または入力テーブルを監視するために、メールやSlackメッセージなどの条件付きアラートとして定期的なエクスポートをスケジュールします。
> 💡
> このドキュメントの前のセクションの手順を使用して条件付きアラートを作成できますが、この方法は特定のフィールドを自動入力して、条件付きアラートを迅速に構成しやすくします。

1.  要素ツールバーで、`More`をクリックして要素メニューを開き、`Alert when`を選択します。
    > 📘
    > アラートは公開されたコンテンツに対してのみ作成できます。対象要素が公開されていないか、未公開の変更が含まれている場合、Sigmaはワークブックを公開するように促します。
2.  `Schedule exports`モーダルで、アラートを構成します。Sigmaは`Condition`セクションにデフォルトの条件文を構成し（対象要素のタイプに基づく）、対象要素のタイトルをメールの`Subject`またはSlackの`Message`として自動入力し、`Attachments`フィールドで対象要素を選択します。
3.  必要に応じてフィールドをカスタマイズし、残りのセクションを完了します。詳細については、このドキュメントの「[データの可用性に基づいてエクスポートをスケジュールする](https://help.sigmacomputing.com/docs/schedule-a-conditional-export-or-alert#schedule-an-export-based-on-data-availability)」および「[条件文に基づいてエクスポートをスケジュールする](https://help.sigmacomputing.com/docs/schedule-a-conditional-export-or-alert#schedule-an-export-based-on-a-conditional-statement)」を参照してください。
4.  `Create`をクリックしてスケジュール構成を保存します。

#### **検出された外れ値と異常に対するアラート (Alert on detected outliers and anomalies)**
データ内の検出された外れ値や異常に基づいてアラートを設定できます。しきい値で定義された異常か、数式を記述して外れ値や異常を検出し、その数式の出力に基づいてアラートを発します。

例えば、以下のいずれかを実行できます。
* 静的なしきい値アラートを構成する
* 数式ベースのしきい値アラートを構成する

##### **静的なしきい値アラートを構成する (Configure a static threshold alert)**
例えば、ウェブサイトへの異常なページ訪問を監視したい場合、特定の日付のページビューが25,000ビューなどの既知のしきい値を超えたときにSlackメッセージを送信するアラートを構成することがあります。この例は、SigmaサンプルデータベースのGoogle Analytics Eventsデータで再現できます。

1.  ウェブサイト分析データソースについて、[テーブルグルーピング](https://help.sigmacomputing.com/docs/create-and-manage-tables#group-columns-in-a-table)を使用して、日ごとの総ページビューを計算します。

<img width="822" height="487" alt="df56b7024c87e393ed8d0b9e35453694a90ca890abe843ab165a6658fc020f2e-outlier-base" src="https://github.com/user-attachments/assets/bc6065ae-b19b-4e80-901d-039bdf02e905" />

2.  [日付コントロール要素](https://help.sigmacomputing.com/docs/intro-to-control-elements#date)を使用して、テーブルを現在から1日前までにフィルタリングし、前日のデータを表示します。

<img width="822" height="565" alt="b703db189a944375cc124de602a0a82529ea49a48da32c9553afa2818298c0f4-outlier-pv-grouped" src="https://github.com/user-attachments/assets/5b369dbc-8942-4503-ae52-f797f78d9475" />

3.  テーブルで、ページビューが特定のしきい値を超えたときにアラートを構成します。
    * `More`をクリックして要素メニューを開き、`Alert when`を選択します。
4.  必要に応じてメールまたはSlackの受信者とメッセージを設定します。
5.  `Condition`セクションで、`Check if`を`Any value`に設定します。
6.  `In column`で、`Total Page Views`列を選択します。
7.  `Is`で、しきい値を評価する演算子を選択します。この場合は`Greater Than`です。
8.  `Value`で、しきい値を設定します。この場合は、`25000`のしきい値を設定します。
9.  `More options`セクションで、`Customize control values`のチェックボックスを選択します。
10. `Controls`で、日付コントロールを選択し、選択が正しいことを確認します。

<img width="595" height="282" alt="7301b698c390350c5e17057e49fe7519a65fec6dddf553d9cfa30ecae3aeabca-outlier-control-config" src="https://github.com/user-attachments/assets/1aa31b8f-3f66-4267-aebd-7bb1278cd5d6" />

11. `Create`をクリックしてアラートを保存します。

##### **数式ベースのしきい値アラートを構成する (Configure a formula-based threshold alert)**
例えば、ウェブサイトへの異常なページ訪問を監視したい場合、異常なトラフィックを識別する数式を記述し、その数式の出力が異常なトラフィックを示したときにSlackメッセージを送信するアラートを構成することがあります。
Sigmaコミュニティの「[How to Detect Outliers in Sigma](https://community.sigmacomputing.com/dashboards-and-workbooks/how-to-detect-outliers-in-sigma-294)」のガイダンスに従い、データテーブルとアラートを次のように設定します。この例は、SigmaサンプルデータベースのGoogle Analytics Eventsデータで再現できます。

1.  ウェブサイト分析データソースについて、テーブルグルーピングを使用して、日ごとの総ページビューを計算します。
2.  `Total Page Views`列の標準偏差を計算するためにサマリー列を追加します：`Stddev([Total Page Views])`。サマリー列の名前を`Standard Deviation`に変更します。
3.  `Total Page Views`列の平均値を計算するためにサマリー列を追加します：`Avg([Total Page Views])`。サマリー列の名前を`Average`に変更します。

<img width="647" height="438" alt="35c00a38e0d7f16c130a06ebbfa1d8e4baaab7b49990b270e318f8a3941eff68-outlier-summaries" src="https://github.com/user-attachments/assets/b727de49-7f8b-4857-9f58-0f6980199a5d" />

4.  データに基づいて、上限と下限が何と見なされるかを決定します。2つの新しいサマリー列を追加します。
    * `Upper Bound`という名前のサマリー列：`[Average] + (1.5 * [Standard Deviation])`
    * `Lower Bound`という名前のサマリー列：`[Average] - (1.5 * [Standard Deviation])`

<img width="740" height="406" alt="d5c22cb975622cb1346e1239040dab6a303a7af2005432c80cc4c8991ca2a8c4-outliers-all-summaries" src="https://github.com/user-attachments/assets/94d07ce8-fc23-4e5b-996a-c043f3cb913a" />

5.  テーブルグルーピングに`isOutlier`という新しい計算列を追加して、各`Total Page Views`の値が許容範囲内にあるか、外れ値であるかを評価します：`If(Between([Total Page Views], [Lower Bound], [Upper Bound]), False, True)`
    `isOutlier`列の値が`True`である各列は、定義した数式によれば外れ値と見なされます。
     テーブルで、ページビューが異常で`isOutlier`列がtrueの場合にアラートを構成します。
    * `More`をクリックして要素メニューを開き、`Alert when`を選択します。

<img width="505" height="413" alt="ba3f06d951fef787d552523ead39cdb1c1e121af92327dc4b1575208fc34933d-outlier-web-traffic-isoutlier" src="https://github.com/user-attachments/assets/dad332b5-c76b-46b6-aac1-6ed657889a8f" />

6.  必要に応じてメールまたはSlackの受信者とメッセージを設定します。
a.  `Condition`セクションで、`Check if`を`Any value`に設定します。
b. `In column`で、`isOutlier`列を選択します。
c. `Is`で、デフォルトの演算子である`Equal to`のままにします。
d. `Value`で、`isOutlier`列が`True`の場合にアラートを送信するために`True`を選択します。
e. `Create`をクリックしてアラートを保存します。

### 11-5-2. ワークブックのデータをダウンロードする (Download workbook data)

いつでもSigmaからワークブック全体、特定のワークブックページ、または特定のワークブック要素をダウンロードできます。また、エクスポートをスケジュールしたり、スケジュールされたエクスポートをオンデマンドで送信したりすることもできます。「[ワークブックのエクスポートについて](https://help.sigmacomputing.com/docs/send-and-schedule-exports)」を参照してください。

ワークブックを編集中にエクスポートしようとすると、ドラフトバージョンをダウンロードするオプションしかありません。公開バージョンをダウンロードしたり、他の宛先にエクスポートしたりしたい場合は、ワークブックの公開バージョンを開いてください。

> 🚧
> PDFまたはPNG形式へのスケジュールされたエクスポートまたは直接ダウンロードを実行する際、Sigmaはデバッグおよびトラブルシューティング目的で使用されるトレースログに、該当するコントロール値をURLパラメータとして保存することがあります。コントロールを使用して機密データをフィルタリングするワークブックコンテンツをエクスポートまたはダウンロードする際は注意してください。

#### **エクスポートの種類と制限 (Export types and limitations)**
ファイルタイプとエクスポート場所に基づいて、エクスポートにはサイズ制限があります。詳細は、「[ダウンロード、エクスポート、およびアップロードの制限](https://help.sigmacomputing.com/docs/download-and-export-limitations)」を参照してください。

#### **ユーザー要件 (User requirements)**
ワークブックからデータをダウンロードするには、`Download`権限が有効になっているアカウントタイプを割り当てられている必要があります。「[ライセンスとアカウントタイプの概要](https://help.sigmacomputing.com/docs/account-type-and-license-overview)」を参照してください。

#### **ワークブック全体をダウンロードする (Download an entire workbook)**
ワークブック全体をダウンロードするには：
1.  ワークブックメニュー()から、`Share and export > Export...`を選択します。
2.  `Export`ダイアログで、デフォルトの`Direct download`の選択を維持します。
3.  `Attachments`で、デフォルトの`Entire workbook`の選択を維持し、ダウンロードするファイルの形式を選択します。
4.  `Export`をクリックします。
Sigmaはデバイスにファイルをダウンロードします。

#### **ワークブックページをダウンロードする (Download a workbook page)**
ワークブックページメニューまたはワークブックメニューからワークブックページをダウンロードできます。
1.  ダウンロードしたいワークブックページを探し、ページメニュー()を開いて`Export...`を選択します。
2.  `Export`ダイアログで、デフォルトの`Direct download`の選択を維持します。
3.  `Attachments`で、デフォルトのページを選択したままにするか、別のワークブックページを選択します。
4.  ダウンロードするファイルの形式を選択します。
5.  `Export`をクリックします。
Sigmaはデバイスにファイルをダウンロードします。

#### **データ要素をダウンロードする (Download a data element)**
1.  公開済みまたはドラフトのワークブックで、要素を選択します。
2.  要素のメニューから、`More`を選択します。
3.  `Export`を選択し、ダウンロードしたいファイル形式を選択します。
    * 利用可能なオプションは要素のタイプによって異なります。
Sigmaはデバイスにファイルをダウンロードします。

### 11-4-3. メールへのエクスポート (Export to email)

ワークブック、そのページ、および個々の要素を、設定されたスケジュールまたは必要に応じてメール受信者に送信できます。例えば、役員チームのメンバーに、チームのKPIのPDFファイルを定期的にメールで送信することができます。

ワークブックには複数のエクスポートスケジュールを設定できます。送信する各メールには、合計の添付ファイルサイズが[エクスポート制限](https://help.sigmacomputing.com/docs/download-and-export-limitations)未満である限り、複数の添付ファイルを含めることができます。

Sigmaは、ワークブックの最新の公開バージョンからエクスポートを生成します。ワークブックのタグ付きバージョンをエクスポートすることも選択できます。選択したファイル形式によっては、ブックマークをエクスポートすることもできます。ワークブックのドラフトまたは探索に加えた変更は、変更を公開しない限りエクスポートできません。

#### **ユーザー要件 (User requirements)**
* メールにデータをエクスポートするには、`Export to email`権限が有効になっているアカウントタイプを割り当てられている必要があります。
* 受信者としてクエリを実行するメールエクスポートを設定するには、アカウントタイプに`Run exports as recipient`権限も有効になっている必要があります。
* バージョンタグ付きのワークブックを送信するには、バージョンタグが存在し、ワークブックに適用されている必要があります。管理者はバージョンタグを作成でき、ワークブック作成者はワークブックのバージョンにタグを付けることができます。詳細は、「[バージョンタグ付け](https://help.sigmacomputing.com/docs/add-version-tags)」を参照してください。
> 📘
> 組織が特定のIPアドレスからのメールトラフィックを制限している場合は、`198.37.153.185`を許可リストに追加してください。あるいは、代わりに使用するカスタムSMTPサーバーを構成することもできます。「[カスタムSMTPサーバー](https://help.sigmacomputing.com/docs/custom-smtp-server)」を参照してください。

#### **エクスポート制限 (Export limit)**
メールでのエクスポートのサイズ制限は30MBです。これは、すべての添付ファイルを合わせた合計の制限です。
エクスポートがこの制限を超えると、エクスポート全体が失敗し、スケジュールされたエクスポートの所有者に通知されます。この制限を繰り返し超えるスケジュールされたエクスポートは、自動的に一時停止され、その所有者に通知されます。
「[ダウンロード、エクスポート、およびアップロードの制限](https://help.sigmacomputing.com/docs/download-and-export-limitations)」を参照してください。

#### **必要に応じてメールにエクスポートする (Export to email as needed)**
アドホックなメールエクスポートを送信するには：
1.  ワークブックメニュー()から、`Share and export > Export...`を選択します。
    > 📘
    > メールへのエクスポートオプションが利用できない場合、ワークブックは`Edit`モードです。メールへのエクスポートを試みる前に、ドラフトを公開するか、ワークブックの最新の公開またはタグ付きバージョンに戻ってください。
2.  `Email`を選択します。
3.  `Recipient`フィールドに、一つ以上のカンマ区切りのSigmaチーム、Sigmaユーザー、またはメールアドレスを入力します。`Run queries as recipient`設定を使用しない限り、最大1,000人の受信者にメールを送信できます。
    > 📘
    > 組織でエクスポート認証が構成されている場合、承認されたドメインに関連付けられたメールアドレスにのみエクスポートを送信できます。
4.  (任意) `Subject`フィールドに、件名を入力します。
5.  (任意) `Message`フィールドに、メッセージを入力します。
6.  ワークブックにバージョンタグまたはブックマークがある場合は、送信したいものを選択します。
7.  `Attachment`セクションで、添付ファイルとしてエクスポートしたいものを選択します。
8.  各添付ファイルについて、サポートされているファイル形式を選択します。
9.  (任意) デフォルトでは、Sigmaはメール本文にワークブックへのリンクを含めます。リンクを含めたくない場合は、`Include link to workbook`チェックボックスの選択を解除します。
10. (任意) デフォルトでは、エクスポートはエクスポート作成者がアクセスできるデータをキャプチャします。エクスポートを受信者がアクセスできるものだけに制限するには、`Run queries as recipient`のチェックボックスを選択します。
    > 🚩
    > `Run queries as recipient`は、300人以下の受信者にメールを送信し、すべての受信者がSigmaユーザーである場合にのみ成功します。
11. (任意) 選択した添付ファイルの形式に応じて、添付ファイルの結合やzipファイルでの送信など、その他のオプションを構成できます。
12. `Export`をクリックします。

#### **スケジュールされたメールエクスポート (Schedule an emailed export)**
スケジュールされたメールは、タグ付きバージョンを選択しない限り、ワークブックの最新の公開バージョンを送信します。

スケジュールされたメールレポートを設定するには：
1.  ワークブックメニュー()から、`Share and export > Schedule exports…`を選択します。
2.  これがワークブックの最初のスケジュールの場合は`Add schedule`を、そうでない場合は`+ New schedule`をクリックします。

<img width="561" height="642" alt="68db2e8fab344361e9b5a56f914bf1bac4d962842421afb2b6b3bcebb14de965-export-email" src="https://github.com/user-attachments/assets/73534b17-d6ab-42f0-9c86-b73fed5e78a4" />

3.  `Recipient`フィールドに、一つ以上のカンマ区切りのSigmaチーム、Sigmaユーザー、またはメールアドレスを入力します。`Run queries as recipient`オプションを使用しない限り、最大1,000人の受信者にメールを送信できます。
    > 📘
    > 組織でエクスポート認証が構成されている場合、承認されたドメインに関連付けられたメールアドレスにのみエクスポートを送信できます。
4.  (任意) `Subject`フィールドに、件名を入力します。
5.  (任意) `Message`フィールドに、メッセージを入力します。
6.  ワークブックにタグ付きバージョンまたはブックマークがある場合は、送信したいものを選択します。
7.  `Attachments`セクションで、添付ファイルとしてエクスポートしたいものを選択します。
8.  各添付ファイルについて、サポートされているファイル形式を選択します。
    > 🚧
    > PDFまたはPNG形式へのスケジュールされたエクスポートまたは直接ダウンロードを実行する際、Sigmaはデバッグおよびトラブルシューティング目的で使用されるトレースログに、該当するコントロール値をURLパラメータとして保存することがあります。
9.  `Frequency`セクションで、配信スケジュールを設定します。
    * (任意) `Daily`のドロップダウンを選択し、`Weekly`, `Monthly`, または`Custom`を選択します。
    * `Daily`の場合、`Once a day`または`Multiple times`を選択します。
    * `Weekly`の場合、メールを送信する曜日を選択し、`Once a day`または`Multiple times`を選択します。
    * `Monthly`の場合、メールを送信する月の日と時刻を選択します。
    * `Custom`の場合、cron構文を使用してスケジュールを指定します。
    * `Multiple times`を選択した場合は、頻度を指定します。
    > 📘
    > 特定の頻度を設定するオプションがない場合、組織でエクスポート頻度が制限されている可能性があります。
10. (任意) ドロップダウンメニューを使用して、デフォルトのスケジュールタイムゾーンを調整します。
11. (任意) エクスポートを送信する頻度を選択します：`Always`または`If a condition is met`のみ。「[条件付きエクスポートまたはアラートをスケジュールする](https://help.sigmacomputing.com/docs/schedule-a-conditional-export-or-alert)」を参照してください。
12. (任意) `If a condition is met`の場合にのみエクスポートを送信することを選択した場合、通知を停止するスイッチをオンにできます。
13. (任意) デフォルトでは、Sigmaはメール本文にワークブックへのリンクを含めます。リンクを含めたくない場合は、`Include link to workbook`チェックボックスの選択を解除します。
14. (任意) デフォルトでは、エクスポートはエクスポート作成者がアクセスできるデータをキャプチャします。エクスポートを受信者がアクセスできるものだけに制限するには、`Run queries as recipient`のチェックボックスを選択します。
    > 🚩
    > `Run queries as recipient`は、300人以下の受信者にメールを送信し、すべての受信者がSigmaユーザーである場合にのみ成功します。
    > 💡
    > エクスポートが受信者として実行される場合、各クエリは受信者ごとに個別に実行されます。受信者リストが大きいほど、データベースに送信されるクエリが増え、処理時間が長くなります。
15. (任意) 選択した添付ファイルの形式に応じて、添付ファイルの結合やzipファイルでの送信など、その他のオプションを構成できます。
16. (任意) `Customize control values`のチェックボックスを選択して、一つ以上のワークブックコントロールの値に従ってエクスポートされたデータをフィルタリングします。
17. `Create`をクリックします。

### 11-5-4. Slackへのエクスポート (Export to Slack)

組織でSlack通知が有効になっている場合、ワークブック、そのページ、および個々の要素を、設定されたスケジュールまたは必要に応じてSlackアカウントの任意のチャネルに送信できます。

例えば、経営チームに週次の稼働時間レポートを提供したいが、チームは主にSlackでコミュニケーションを取っている場合、Slackチャネルまたは特定のユーザーにエクスポートを設定して、経営陣がレポートを確実に閲覧できるようにすることができます。

ワークブックには複数のエクスポートスケジュールを設定できます。Slackエクスポートは、エクスポートを開始したユーザーがアクセスできるデータをキャプチャします。

Sigmaは、ワークブックの最新の公開バージョンからエクスポートを生成します。ワークブックのタグ付きバージョンをエクスポートすることも選択できます。選択したファイル形式によっては、ブックマークをエクスポートすることもできます。ワークブックのドラフトまたは探索に加えた変更は、変更を公開しない限りエクスポートできません。サポートされているファイル形式のマトリックスについては、「[利用可能なエクスポート先とフォーマット](https://help.sigmacomputing.com/docs/send-and-schedule-exports#available-export-destinations-and-formats)」を参照してください。

このドキュメントでは、Slackへのエクスポートを送信およびスケジュールする方法について説明します。

#### **ユーザー要件 (User requirements)**
Slackへのエクスポート機能には、以下が必要です。
* 組織で[Slackインテグレーション](https://help.sigmacomputing.com/docs/export-to-slack#configure-the-slack-integration)が有効になっている必要があります。プライベートチャネルに通知を送信したい場合は、プライベートチャネルにSigmaを追加する必要もあります。「[プライベートSlackチャネルにSigmaを追加する](https://help.sigmacomputing.com/docs/export-to-slack#add-sigma-to-a-private-slack-channel)」を参照してください。一つのSigma組織は、一つのSlackワークスペースにしか接続できません。
* `Export to Slack`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。

#### **エクスポートサイズの制限 (Export size limit)**
Slackへのエクスポートのサイズ制限は、ファイルあたり1GBです。「[ダウンロード、エクスポート、およびアップロードの制限](https://help.sigmacomputing.com/docs/download-and-export-limitations)」を参照してください。

#### **Slackメッセージを書式設定する (Format a Slack message)**
Slackは特定の書式設定マークアップをサポートしています。Slackヘルプセンターの「[メッセージを書式設定する](https://slack.com/help/articles/202288908-Format-your-messages)」を参照してください。
また、他の書式設定を使用してハイパーリンクを作成したり、特定のユーザーやグループに通知したりすることもできます。

<img width="404" height="312" alt="829a9a6400a830731e64493d0211e29b39bd36d703cfa8dc9b511cac0ffd7294-slack-member-id" src="https://github.com/user-attachments/assets/05b4edb5-0aa8-431c-a417-3eb33845468e" />

| 書式設定 | 構文 | 詳細 |
| :--- | :--- | :--- |
| **個人に通知** | `<@user_id>` | ユーザーのSlackユーザープロファイルからSlackメンバーIDを取得します。 |
| **チャネルに通知** | `@here` または `@channel` | Slackヘルプセンターの「[チャネルまたはワークスペースに通知する](https://slack.com/help/articles/202009646-Notify-a-channel-or-workspace)」を参照してください。 |
| **テキストをハイパーリンク** | `<URL\|text>` | 例えば、Sigmaドキュメントをハイパーリンクするには、`<https://help.sigmacomputing.com\|Sigma Documentation>`と入力します。 |

#### **アドホックな通知を送信する (Send an ad hoc notification)**
ワークブックからSlackに情報をエクスポートするには：

1.  ワークブックメニュー()から、`Share and export > Export...`を選択します。
    > 📘
    > Slackオプションが利用できない場合、ワークブックは`Edit`モードです。エクスポートを試みる前に、ドラフトを公開するか、ワークブックの最新の公開またはタグ付きバージョンに戻ってください。
2.  `Slack`を選択します。
3.  `To`フィールドに、Slackチャネルの名前（例：`#team-channel`）を入力します。あるいは、チャネルID（例：`A123BC4DE5F`）を入力します。
    * プライベートチャネルに通知を送信したい場合は、まずSigma通知ボットをチャネルに追加する必要があります。プライベートチャネルで`@Sigma`と入力して有効にします。「[プライベートSlackチャネルにSigmaを追加する](https://help.sigmacomputing.com/docs/export-to-slack#add-sigma-to-a-private-slack-channel)」を参照してください。
4.  (任意) `Message`フィールドにメッセージを入力します。オプションについては「[Slackメッセージを書式設定する](https://help.sigmacomputing.com/docs/export-to-slack#format-a-slack-message)」を参照してください。
5.  ワークブックにバージョンまたはブックマークがある場合は、送信したいものを選択します。
6.  `Attachments`セクションで、添付ファイルとしてエクスポートしたいものを選択します。
7.  各添付ファイルについて、サポートされているファイル形式を選択します。
8.  (任意) メッセージ本文にワークブックへのリンクを含めるには、`Include link to workbook`のチェックボックスを選択します。
9.  (任意) 選択した添付ファイルの形式に応じて、添付ファイルの結合やzipファイルでの送信など、その他のオプションを構成できます。
10. `Export`をクリックします。

#### **Slack通知をスケジュールする (Schedule a Slack notification)**
Sigmaは、ワークブックの最新の公開バージョンからエクスポートを生成します。ドラフトの変更は、公開されない限り送信されません。

Slack通知へのエクスポートをスケジュールするには：
1.  ワークブックメニュー()から、`Share and export > Schedule exports…`を選択します。
2.  これがワークブックの最初のスケジュールの場合は`Add schedule`を、そうでない場合は`+ New schedule`をクリックします。
3.  `Slack`を選択します。

<img width="558" height="601" alt="5edc5dedb3e6b87f5915476839fea49deab90ed4d441175c41b3b11176719756-export-slack" src="https://github.com/user-attachments/assets/70223b5e-3686-47ee-9e62-8f7a78813a5d" />

4.  `To`フィールドに、Slackチャネルの名前を入力します。
5.  (任意) `Message`フィールドにメッセージを入力します。
6.  `Attachments`セクションで、添付ファイルとしてエクスポートしたいものを選択します。
7.  各添付ファイルについて、サポートされているファイル形式を選択します。
    > 🚧
    > PDFまたはPNG形式へのスケジュールされたエクスポートまたは直接ダウンロードを実行する際、Sigmaはデバッグおよびトラブルシューティング目的で使用されるトレースログに、該当するコントロール値をURLパラメータとして保存することがあります。
8.  `Frequency`セクションで、配信スケジュールを設定します。
    * (任意) `Daily`のドロップダウンを選択し、`Weekly`, `Monthly`, または`Custom`を選択します。
    * `Daily`の場合、`Once a day`または`Multiple times`を選択します。
    * `Weekly`の場合、メールを送信する曜日を選択し、`Once a day`または`Multiple times`を選択します。
    * `Monthly`の場合、メールを送信する月の日と時刻を選択します。
    * `Custom`の場合、cron構文を使用してスケジュールを指定します。
    * `Multiple times`を選択した場合は、頻度を指定します。
    > 📘
    > 特定の頻度を設定するオプションがない場合、組織でエクスポート頻度が制限されている可能性があります。
9.  (任意) ドロップダウンメニューを使用して、デフォルトのスケジュールタイムゾーンを調整します。
10. (任意) エクスポートを送信する頻度を選択します：`Always`または`If a condition is met`のみ。「[条件付きエクスポートまたはアラートをスケジュールする](https://help.sigmacomputing.com/docs/schedule-a-conditional-export-or-alert)」を参照してください。
11. (任意) `If a condition is met`の場合にのみエクスポートを送信することを選択した場合、通知を停止するスイッチをオンにできます。
12. (任意) メッセージ本文にワークブックへのリンクを含めるには、`Include link to workbook`のチェックボックスを選択します。
13. (任意) `Customize control values`のチェックボックスを選択して、一つ以上のワークブックコントロールの値に従ってエクスポートされたデータをフィルタリングします。
14. (任意) 選択した添付ファイルの形式に応じて、その他のオプションを構成できます。
15. `Create`をクリックします。

### 11-5-5. Google Sheetsへのエクスポート (Export to Google Sheets)

一つ以上の個別のワークブック要素を、設定されたスケジュールまたは必要に応じてGoogle Sheetsに送信できます。スケジュールに従ってGoogle Sheetsにエクスポートする場合、スケジュールが実行されるたびに同じGoogle Sheetが置き換え（上書き）されます。「[Google Sheetsへのエクスポートをスケジュールする](#schedule-exports-to-google-sheets)」を参照してください。

Sigmaは、ワークブックの最新の公開バージョンからエクスポートを生成します。ドラフトの変更はエクスポートされません。

#### **ユーザー要件 (User requirements)**
Google Sheetsへのエクスポート機能には、以下が必要です。
* `Export to Google Sheet`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* 指定されたGoogle Sheetの編集者である必要があります。

#### **Googleアカウントの承認 (Google account authorization)**
初めてGoogle SheetsまたはGoogle Driveにエクスポートまたはスケジュールエクスポートする際、SigmaはあなたのGoogleアカウントへのエクスポートを承認するよう促します。
`Authorize`をクリックし、画面の指示に従ってください。承認を完了すると、`Export`または`Schedule Exports`ダイアログに戻ります。

<img width="455" height="253" alt="feab067440de15865df7eef8e3f2bdab8cc316c31eca1f720adbafa0f207d227-export-to-drive" src="https://github.com/user-attachments/assets/493b7acd-a968-4491-bfff-b2851744f4a8" />

#### **必要に応じてGoogle Sheetsにエクスポートする (Export to Google Sheets as needed)**
Google Sheetsにエクスポートするには：
1.  ワークブックメニュー()から、`Share and export > Export...`を選択します。
2.  `Google Sheets`を選択します。
3.  これがGoogle製品への初めてのエクスポートである場合、Sigmaはインテグレーションを有効にするよう促します。「[Googleアカウントの承認](#google-account-authorization)」を参照してください。
4.  `Sheets URL`に、エクスポートしたいGoogle SheetのURLを入力します。Google Sheetを共有するためにコピーするURLではなく、ウェブブラウザでGoogle Sheetを表示しているときに見えるURLを使用してください。
5.  エクスポートするデータを選択します。ワークブック要素のみがサポートされています。
6.  `Export`をクリックします。

#### **Google Sheetsへのエクスポートをスケジュールする (Schedule exports to Google Sheets)**
> 🚩
> Google Sheetsへのエクスポートは、スケジュールが実行されるたびに同じシートを上書きします。

Google Sheetsへのエクスポートをスケジュールするには：
1.  ワークブックメニュー()から、`Share and export > Schedule exports…`を選択します。
2.  これがワークブックの最初のスケジュールの場合は`Add schedule`を、そうでない場合は`+ New schedule`をクリックします。
3.  `Google Sheets`を選択します。
    これがGoogleへのスケジュールされたエクスポートを初めて作成する場合、Sigmaはインテグレーションを有効にするよう促します。

<img width="623" height="597" alt="237c8e76b0003b0fb9aaa88fd58f25be0fba8dd0daee5e76249a69235d363f7f-export-google-sheet" src="https://github.com/user-attachments/assets/d430f2d7-e720-440d-9e0e-6b0233f1b050" />


4.  `Sheets URL`に、エクスポートしたいGoogle SheetのURLを入力します。
5.  エクスポートするデータを選択します。ワークブック要素のみがサポートされています。
6.  `Frequency`セクションで、配信スケジュールを設定します。
    * (任意) `Daily`のドロップダウンを選択し、`Weekly`, `Monthly`, または`Custom`を選択します。
    * `Daily`の場合、`Once a day`または`Multiple times`を選択します。
    * `Weekly`の場合、メールを送信する曜日を選択し、`Once a day`または`Multiple times`を選択します。
    * `Monthly`の場合、メールを送信する月の日と時刻を選択します。
    * `Custom`の場合、cron構文を使用してスケジュールを指定します。
    * `Multiple times`を選択した場合は、頻度を指定します。
    > 📘
    > 特定の頻度を設定するオプションがない場合、組織でエクスポート頻度が制限されている可能性があります。
   * (任意) ドロップダウンメニューを使用して、デフォルトのスケジュールタイムゾーンを調整します。
   *(任意) エクスポートを送信する頻度を選択します：`Always`または`If a condition is met`のみ。「[条件付きエクスポートまたはアラートをスケジュールする](https://help.sigmacomputing.com/docs/schedule-a-conditional-export-or-alert)」を参照してください。
   * (任意) `If a condition is met`の場合にのみエクスポートを送信することを選択した場合、通知を停止するスイッチをオンにできます。
7. (任意) `Customize control values`のチェックボックスを選択して、一つ以上のワークブックコントロールの値に従ってエクスポートされたデータをフィルタリングします。
8. `Create`をクリックします。

### 11-5-6. Google Driveへのエクスポート (Export to Google Drive)

個々のワークブック要素、ワークブックページ、またはワークブック全体を、設定されたスケジュールまたは必要に応じてGoogle Driveに送信できます。Google Driveに送信するものに応じて、異なるファイル形式でデータをエクスポートできます。サポートされているファイル形式の詳細については、「[ワークブックのエクスポートを送信またはスケジュールする](https://help.sigmacomputing.com/docs/send-and-schedule-exports)」を参照してください。

Google Sheetsに直接エクスポートするには、「[Google Sheetsへのエクスポート](https://help.sigmacomputing.com/docs/export-to-google-sheets)」を参照してください。

Sigmaは、ワークブックの最新の公開バージョンからエクスポートを生成します。ドラフトの変更はエクスポートされません。

#### **ユーザー要件 (User requirements)**
Google Driveへのエクスポート機能には、以下が必要です。
* `Export to Google Drive`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* 指定されたGoogle DriveフォルダのManager, Content manager, またはContributorである必要があります。

#### **Googleアカウントの承認 (Google account authorization)**
初めてGoogle SheetsまたはGoogle Driveにエクスポートまたはスケジュールエクスポートする際、SigmaはあなたのGoogleアカウントへのエクスポートを承認するよう促します。

<img width="455" height="253" alt="feab067440de15865df7eef8e3f2bdab8cc316c31eca1f720adbafa0f207d227-export-to-drive" src="https://github.com/user-attachments/assets/50af9be9-2b80-4a39-8385-355526c3e6d0" />

`Authorize`をクリックし、画面の指示に従ってください。承認を完了すると、`Export`または`Schedule Exports`ダイアログに戻ります。

#### **必要に応じてGoogle Driveにエクスポートする (Export to Google Drive as needed)**
Google Driveにエクスポートするには：
1.  ワークブックメニュー()から、`Share and export > Export...`を選択します。
2.  `Google Drive`を選択します。
3.  これがGoogle製品への初めてのエクスポートである場合、Sigmaはインテグレーションを有効にするよう促します。「[Googleアカウントの承認](#google-account-authorization)」を参照してください。

<img width="622" height="598" alt="cb527f88d68ef1f967a9375a9a7e81cb5b81311953e8f85774c945cb02ac7a6d-export-gdrive" src="https://github.com/user-attachments/assets/d2356b16-131d-403c-b8b5-5389f3909759" />

4.  `Drive folder`に、エクスポートを含む新しいフォルダの名前を入力します。既存のフォルダは使用できません。エクスポートは、以下の構造に一致する名前で宛先フォルダにファイルを作成します。
    `<Workbook Name>_<Element Name>_<Timestamp>`
5.  `Create folder`をクリックします。
6.  Sigmaはフォルダを作成し、フォルダへのURLを表示します。
7.  `Attachments`で、エクスポートしたいデータとファイル形式を選択します。
8.  `Export`をクリックします。

#### **Google Driveへのエクスポートをスケジュールする (Schedule an export to Google Drive)**
Google Driveへのエクスポートをスケジュールするには：
1.  ワークブックメニュー()から、`Share and export > Schedule exports...`を選択します。
2.  これがワークブックの最初のスケジュールの場合は`Add schedule`を、そうでない場合は`+ New schedule`をクリックします。
3.  `Google Drive`を選択します。
4.  `Drive folder`に、エクスポートを含む新しいフォルダの名前を入力します。
5.  `Create folder`をクリックします。
6.  `Attachments`で、エクスポートしたいデータとファイル形式を選択します。
7.  `Frequency`セクションで、配信スケジュールを設定します。
    * (任意) `Daily`のドロップダウンを選択し、`Weekly`, `Monthly`, または`Custom`を選択します。
    * `Daily`の場合、`Once a day`または`Multiple times`を選択します。
    * `Weekly`の場合、メールを送信する曜日を選択し、`Once a day`または`Multiple times`を選択します。
    * `Monthly`の場合、メールを送信する月の日と時刻を選択します。
    * `Custom`の場合、cron構文を使用してスケジュールを指定します。
    * `Multiple times`を選択した場合は、頻度を指定します。
    > 📘
    > 特定の頻度を設定するオプションがない場合、組織でエクスポート頻度が制限されている可能性があります。
8.  (任意) ドロップダウンメニューを使用して、デフォルトのスケジュールタイムゾーンを調整します。
9.  (任意) エクスポートを送信する頻度を選択します：`Always`または`If a condition is met`のみ。「[条件付きエクスポートまたはアラートをスケジュールする](https://help.sigmacomputing.com/docs/schedule-a-conditional-export-or-alert)」を参照してください。
10. (任意) `If a condition is met`の場合にのみエクスポートを送信することを選択した場合、通知を停止するスイッチをオンにできます。
11. (任意) `Customize control values`のチェックボックスを選択して、一つ以上のワークブックコントロールの値に従ってエクスポートされたデータをフィルタリングします。
12. `Create`をクリックします。

### 11-4-7. クラウドストレージへのエクスポート (Export to cloud storage)

ワークブックにSnowflakeまたはRedshift接続からの要素がある場合、それらの要素のデータをそれらの接続に関連付けられたクラウドストレージにエクスポートできます。クラウドストレージは、大規模な、数GBにわたるデータのエクスポートに特に便利です。

* Snowflake接続では、Amazon Simple Storage Service (Amazon S3)、Google Cloud Storage (GCS)、またはMicrosoft Azure Blob Storage (Azure)にエクスポートできます。
* Redshift接続では、Amazon S3にエクスポートできます。

Sigmaは、ワークブックの最新の公開バージョンからエクスポートを生成します。ドラフトの変更はエクスポートされません。

#### **ユーザー要件 (User requirements)**
ワークブックをクラウドストレージにエクスポートするための要件は、接続によって異なります。

* **Snowflake接続**
    * ワークブックのデータソースは、Snowflake接続から取得されている必要があります。
    * `Export to cloud`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* **Redshift接続**
    * 組織でRedshiftが構成されている必要があります。「[Connect to Redshift](https://help.sigmacomputing.com/docs/connect-to-redshift)」を参照してください。
    * ワークブックのデータソースは、Redshift接続から取得されている必要があります。
    * `Export to cloud`権限が有効になっているアカウントタイプを割り当てられている必要があります。
    * アンロードしたいデータを持つRedshiftクラスターが必要です。

#### **サポートされているファイルタイプとエクスポート制限 (Supported file types and export limits)**
* CSV形式のファイル (.csv)
* GZIP圧縮がサポートされています (.csv.gz)
* ファイルサイズの制限は5GBです。「[Download and export limitations](https://help.sigmacomputing.com/docs/download-and-export-limitations)」を参照してください。
> 🚩
> Sigmaからエクスポートされたデータは、SnowflakeまたはRedshiftからクラウドストレージの宛先に単一のファイルとして直接アンロードされます。その結果、データはSigmaで見えるのと同じ書式設定にはなりません。

#### **クラウドストレージへのエクスポートを構成する (Configure exports to cloud storage)**
これは複数ステップのプロセスです。必要なステップは接続によって異なります。

* **Snowflake接続**
    1.  [Snowflake用にクラウドストレージを構成する](https://help.sigmacomputing.com/docs/export-to-cloud-storage-snowflake)
    2.  [宛先URIを書式設定する](https://help.sigmacomputing.com/docs/export-to-cloud-storage-snowflake#format-a-destination-uri)
    3.  希望通りにデータをエクスポートする：
        * [アドホックなエクスポートをクラウドストレージに送信する](https://help.sigmacomputing.com/docs/export-to-cloud-storage-snowflake#send-an-ad-hoc-export-to-cloud-storage)
        * [クラウドストレージのエクスポートをスケジュールする](https://help.sigmacomputing.com/docs/export-to-cloud-storage-snowflake#schedule-a-cloud-storage-export)

* **Redshift接続**
    1.  [Redshift用にクラウドストレージを構成する](https://help.sigmacomputing.com/docs/export-to-cloud-storage-redshift)
    2.  [宛先URIを書式設定する](https://help.sigmacomputing.com/docs/export-to-cloud-storage-redshift#format-a-destination-uri)
    3.  希望通りにデータをエクスポートする：
        * [アドホックなエクスポートをクラウドストレージに送信する](https://help.sigmacomputing.com/docs/export-to-cloud-storage-redshift#send-an-ad-hoc-export-to-cloud-storage)
        * [クラウドストレージのエクスポートをスケジュールする](https://help.sigmacomputing.com/docs/export-to-cloud-storage-redshift#schedule-a-cloud-storage-export)
      
#### **クラウドストレージを構成する (Configure cloud storage)**

##### **Snowflake用にクラウドストレージを構成する (Configure cloud storage for Snowflake)**
Sigmaからクラウドストレージにエクスポートする前に、Snowflakeのストレージインテグレーションを設定する必要があります。
Snowflakeの指示に従ってストレージインテグレーションを作成してください。Snowflakeドキュメントの「[CREATE STORAGE INTEGRATION](https://docs.snowflake.com/en/sql-reference/sql/create-storage-integration)」を参照するか、お使いのクラウドストレージプロバイダーのガイドに従ってください。
* **Amazon S3:** Snowflakeドキュメントの「[Option 1: Configuring a Snowflake storage integration to access Amazon S3](https://docs.snowflake.com/en/user-guide/data-load-s3-config-storage-integration)」を参照してください。
* **Google Cloud Storage:** Snowflakeドキュメントの「[Configuring an integration for Google Cloud Storage](https://docs.snowflake.com/en/user-guide/data-load-gcs-integration)」を参照してください。
* **Azure:** Snowflakeドキュメントの「[Configuring an Azure container for loading data](https://docs.snowflake.com/en/user-guide/data-load-azure-config)」を参照してください。Option 1の手順に従ってください。

ストレージインテグレーションを設定した後、SigmaのSnowflake接続で使用されるSnowflakeロールに、ストレージインテグレーションに対する`USAGE`権限を付与します。Sigmaの管理者は、接続設定で接続によって使用されるロールを確認できます。「[Connect to Snowflake](https://help.sigmacomputing.com/docs/connect-to-snowflake)」を参照してください。
> 📘
> SigmaのSnowflake接続でロールが指定されていない場合、Snowflakeはデフォルトのロールを使用します。

##### **Redshift用にクラウドストレージを構成する (Configure cloud storage for Redshift)**
Sigmaからクラウドストレージにエクスポートする前に、エクスポート先となるAmazon S3バケットを設定する必要があります。AWSドキュメントの「[バケットの作成](https://docs.aws.amazon.com/AmazonS3/latest/userguide/create-bucket-overview.html)」を参照してください。
AWS Identity and Access Management (IAM)ロールに適切な書き込みアクセス権限を付与します。`s3:PutObject`権限を付与する必要があります。詳細は、AWSドキュメントの「[PutObject](https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutObject.html)」および「[Amazon S3コンソールを使用してバケットポリシーを追加する](https://docs.aws.amazon.com/AmazonS3/latest/userguide/add-bucket-policy.html)」を参照してください。
Redshiftからテストエクスポートを設定して、RedshiftからS3へのデータアンロードが可能であることを確認します。エクスポートは次のようになります。
`unload ('select * from venue') to 's3://amzn-s3-demo-bucket/tickit/unload/venue_' iam_role 'arn:aws:iam::0123456789012:role/MyRedshiftRole';`
このコマンドに関する詳細は、AWSドキュメントの「[Amazon S3からのデータのアンロード](https://docs.aws.amazon.com/redshift/latest/dg/r_UNLOAD.html)」を参照してください。

#### **宛先URIを書式設定する (Format a destination URI)**
SnowflakeとRedshiftの両方の接続で、宛先URIはクラウドストレージサービス内のエクスポートのターゲットファイルパスを表します。
以下のテンプレートを使用してURIを書式設定します。
`<schema>://<bucket>/<filepath>/<filename><filetype><compression>`
ここで：
* **Schema:** エクスポート先。「s3」（AWS S3へエクスポートする場合）、「gcs」（GCSへエクスポートする場合）、「azure」（Azureへエクスポートする場合）を指定します。
* **Bucket:** クラウドストレージプロバイダーがサポートする最上位のストレージオブジェクト。
* **File path** (任意): バケットまたはコンテナ内のターゲットサブディレクトリ。
* **File name:** エクスポートされるファイルに使用するファイル名。
* **File type:** エクスポートされるファイルのファイル形式。`.csv`でなければなりません。
* **Compression** (任意): エクスポートされるファイルの圧縮オプション。`.gz`のみ可能です。

**URIの例**
`s3://my-sigma-bucket/cloud-exports/sales.csv.gz`

URIがバケット内の既存のファイルと同一の場合、既存のファイルは上書きされます。

#### **アドホックなエクスポートをクラウドストレージに送信する (Send an ad hoc export to cloud storage)**
1.  ワークブックメニュー()から、`Share and export > Export...`を選択します。
    > 📘
    > `Cloud Storage`オプションが利用できない場合、ワークブックは`Edit`モードです。エクスポートを試みる前に、ドラフトを公開するか、ワークブックの最新の公開またはタグ付きバージョンに戻ってください。
2.  `Cloud storage`を選択します。
3.  `Element`メニューから、エクスポートするワークブック要素を選択します。
4.  クラウドストレージ情報を入力します。
    * **Snowflakeの場合:** `Storage integration`にSnowflakeストレージインテグレーションの名前を入力し、`Cloud storage URI`に宛先URIを入力します。
    * **Redshiftの場合:** `IAM role`にAWS IAMロールを入力し、`Cloud storage URI`に宛先URIを入力します。
5.  指定された要素について、ファイル形式を選択します。CSVまたはCSV, gzippedから選択できます。
6.  `Export`をクリックします。

#### **クラウドストレージのエクスポートをスケジュールする (Schedule a cloud storage export)**
1.  ワークブックメニュー()から、`Share and export > Schedule exports...`を選択します。
2.  `Cloud storage`を選択します。
3.  `Element`メニューから、エクスポートするワークブック要素を選択します。
4.  クラウドストレージ情報を入力します。
5.  指定された要素について、ファイル形式を選択します。
6.  (任意) `Prefix file name with the current date and time`のチェックボックスを選択します。
    > 🚩
    > このオプションを選択しない場合、スケジュールされた各エクスポートで同じファイル名が使用され、エクスポートが実行されるたびにファイルが上書きされます。
7.  `Frequency`セクションで、配信スケジュールを設定します。
8.  (任意) デフォルトのスケジュールタイムゾーンを調整します。
9.  (任意) エクスポートを送信する頻度を選択します：`Always`または`If a condition is met`のみ。
10. (任意) `Customize control values`のチェックボックスを選択して、エクスポートされたデータをフィルタリングします。
11. `Create`をクリックします。

### 11-5-8. Webhookへのエクスポート (Export to webhook)

> 📘
> この機能は現在、認証済みエンドポイントへのエクスポートをサポートしていません。

SigmaのWebhookエクスポートを使用すると、独自のWebhookエンドポイント、またはMarketo、Segment、Airtableなどの他のアプリケーションに、Webhookを使用してデータを送信できます。ワークブックデータを必要に応じてエクスポートしたり、定期的なエクスポートのために一つ以上のスケジュールを作成したりできます。各スケジュールは、複数のエンドポイントと送信条件をサポートできます。

Sigmaは、ワークブックの最新の公開バージョンからエクスポートを生成します。ワークブックのタグ付きバージョンをエクスポートすることも選択できます。ドラフトの変更はエクスポートされません。

#### **ユーザー要件 (User requirements)**
Webhookへのエクスポート機能には、以下が必要です。
* `Export to webhook`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
> 📘
> 組織が特定のIPアドレスからのトラフィックを制限している場合は、SigmaのIPアドレスを許可リストに追加してください。詳細は、「[SigmaのIPを許可リストに追加する](https://help.sigmacomputing.com/docs/connect-to-data-sources#add-sigma-ips-to-the-allowlist)」を参照してください。

#### **サポートされているフォーマット (Supported formats)**
すべてのWebhookエクスポートで、以下のファイルタイプが利用可能です。
* CSV
* JSON
* PDF

#### **エクスポート制限 (Export limit)**
Webhookには100万行のエクスポート制限があります。「[ダウンロード、エクスポート、およびアップロードの制限](https://help.sigmacomputing.com/docs/download-and-export-limitations)」を参照してください。

#### **アドホックなWebhookエクスポートを送信する (Send an ad hoc webhook export)**
1.  ワークブックメニュー()から、`Share and export > Export`を選択します。
2.  `Export`モーダルが開きます。
3.  `Webhook`を選択します。
4.  `Endpoint`に、一つ以上のターゲットWebhookエンドポイントを入力します。
    * 複数のエンドポイントはカンマで区切ります。
    * エンドポイントURLは`https://`で始まる必要があります。
5.  ワークブックにタグ付きバージョンがある場合は、どのバージョンから要素をエクスポートするかを選択します。
6.  `Attachments`セクションで、エクスポートするワークブック要素を選択します。
7.  添付ファイルについて、サポートされているファイル形式を選択します。
8.  `Export`をクリックします。
> 📘
> エクスポートには、公開されたワークブックのコンテンツのみが含まれます。ドラフトの変更は反映されません。

#### **定期的なエクスポートをスケジュールする (Schedule a recurring export)**
1.  ワークブックメニュー()から、`Share and export > Schedule exports...`を選択します。
2.  これがワークブックの最初のスケジュールの場合は`Add schedule`を、そうでない場合は`+ New schedule`をクリックします。
3.  `Webhook`を選択します。

<img width="624" height="598" alt="9956f7d7c2c6c41a53545b8df1a83bf15f6024bee5a6d0d6abc3785dd6216454-export-webhook" src="https://github.com/user-attachments/assets/9a37f041-14fd-4a06-8eaa-8df618be2e71" />

4.  `Endpoint`に、一つ以上のターゲットWebhookエンドポイントを入力します。
5.  ワークブックにタグ付きバージョンがある場合は、どのバージョンから要素をエクスポートするかを選択します。
6.  `Attachments`セクションで、エクスポートするワークブック要素を選択します。
7.  添付ファイルについて、サポートされているファイル形式を選択します。
8.  `Frequency`セクションで、配信スケジュールを設定します。
    * (任意) `Daily`のドロップダウンを選択し、`Weekly`, `Monthly`, または`Custom`を選択します。
    * (任意) デフォルトのスケジュールタイムゾーンを調整します。
    * (任意) エクスポートを送信する頻度を選択します：`Always`または`If a condition is met`のみ。「[条件付きエクスポートまたはアラートをスケジュールする](https://help.sigmacomputing.com/docs/schedule-a-conditional-export-or-alert)」を参照してください。
    * (任意) `If a condition is met`の場合にのみエクスポートを送信することを選択した場合、通知を停止するスイッチをオンにできます。
    * (任意) `Customize control values`のチェックボックスを選択して、一つ以上のワークブックコントロールの値に従ってエクスポートされたデータをフィルタリングします。
9.  `Create`をクリックします。

### 11-5-9. メールバーストとしてエクスポート (Export as email burst)

スケジュールされたメールバーストとして、動的な受信者リストにカスタムフィルタリングされたレポートを送信できます。例えば、個々の営業担当者に、彼らが販売するすべての製品カテゴリの四半期ごとの個人業績数値を送信することができます。各営業担当者は1つの地域のみを担当しているため、レポートをカスタマイズして関連する地域固有のデータを提供し、店舗地域のページコントロールでページ上の要素をフィルタリングします。

<img width="1094" height="940" alt="3cfe80dab4d5dcb4cf1c3bae65aaaf5daefe7f21a912dcfaee20f6209bdf5a94-export-burst-empty" src="https://github.com/user-attachments/assets/8b9e3797-5875-41b5-87a0-5201c28b68a8" />


この例では、West Store Regionに割り当てられた営業担当者は、このレポートをメールの添付ファイルとして受信箱で受け取ります。

<img width="1089" height="935" alt="95ec44a113cc94f9f8185bb2493197df5872ded827809eb4b7803e5ecef2f381-export-burst-received" src="https://github.com/user-attachments/assets/c13b9292-d4f2-49d3-83ab-e56cd7bb1fe6" />

#### **制限事項 (Limitations)**
メールバーストとしてエクスポートする場合、特定の制限が適用されます。
* 分割に使用するコントロールは、列から値をソースとするリストコントロールでなければなりません。最大500個の値で分割できます。
* 分割に使用する列は、数値またはテキストのデータ型でなければなりません。
* 動的受信者のソースは、リストコントロールが値のソースとして使用するのと同じデータソースの列でなければなりません。最大500人の動的受信者に送信できます。
* メールでのエクスポートのサイズ制限は30MBです。これは、すべての添付ファイルを合わせた合計の制限です。エクスポートがこの制限を超えると、エクスポート全体が失敗し、スケジュールされたエクスポートの所有者に通知されます。スケジュールされたエクスポートが繰り返しこの制限を超えると、自動的に一時停止され、その所有者に通知されます。「[ダウンロード、エクスポート、およびアップロードの制限](https://help.sigmacomputing.com/docs/download-and-export-limitations)」を参照してください。

> 🚧
> PDFまたはPNG形式へのスケジュールされたエクスポートまたは直接ダウンロードを実行する際、Sigmaはデバッグおよびトラブルシューティング目的で使用されるトレースログに、該当するコントロール値をURLパラメータとして保存することがあります。コントロールを使用して機密データをフィルタリングするワークブックコンテンツをエクスポートまたはダウンロードする際は注意してください。

#### **ユーザー要件 (User requirements)**
* `Export as email burst`権限が有効になっているアカウントタイプを割り当てられている必要があります。
> 📘
> 組織が特定のIPアドレスからのメールトラフィックを制限している場合は、`198.37.153.185`を許可リストに追加してください。あるいは、代わりに使用するカスタムSMTPサーバーを構成することもできます。「[カスタムSMTPサーバー](https://help.sigmacomputing.com/docs/custom-smtp-server)」を参照してください。

#### **メールバーストをスケジュールする (Schedule an email burst)**
1.  ワークブックメニュー()から、`Share and export > Schedule export...`を選択します。
2.  これがワークブックの最初のスケジュールの場合は`Add schedule`を、そうでない場合は`+ New schedule`をクリックします。
3.  `Export as email burst`を選択します。
4.  `Split by...`で、分割基準として使用するコントロールを選択します。
5.  メールバーストの受信者を選択します。動的受信者と標準受信者の両方を含めることができます。
    * **Dynamic recipients (動的受信者):** 分割基準値として使用されるリストコントロールを設定するために使用されるデータソースから列を選択します。動的受信者は、関連する分割基準コントロール値に関連する添付ファイルのみを受け取ります。すべての添付ファイルを静的な受信者リストに送信するには、空のままにします。
    * **Standard recipients (標準受信者):** 一つ以上のカンマ区切りのSigmaチーム、Sigmaユーザー、またはメールアドレスを入力します。`Dynamic recipients`と合わせて、合計で最大1,000人の受信者にメールを送信できます。標準受信者はすべての添付ファイルを受け取ります。
    > 📘
    > 管理者によって組織でエクスポート認証が構成されている場合、承認されたドメインに関連付けられたメールアドレスにのみエクスポートを送信できます。`Standard recipients`の場合、スケジュールを作成しようとすると、許可されていないドメインを含むメールアドレスがあるとSigmaが通知します。`Dynamic recipients`の場合、制限されたアドレスへのメールは送信されません。「[エクスポート受信者を制限する](https://help.sigmacomputing.com/docs/manage-features#restrict-export-recipients-and-frequency)」を参照してください。

<img width="562" height="605" alt="56e6d9ab1b095e113cafa19647a477350e0e80db5767ed12cd3ed1e5ba2ffc15-export-burst" src="https://github.com/user-attachments/assets/05ca4af6-8fbe-452d-99fb-17a3199f62c5" />

6.  (任意) `Subject`フィールドに、件名を入力します。
7.  (任意) `Message`フィールドに、メッセージを入力します。
8.  ワークブックにタグ付きバージョンがある場合は、送信するバージョンを選択します。デフォルトでは、公開バージョンが送信されます。
9.  `Attachments`セクションで、添付ファイルとしてエクスポートしたいものを選択します。
10. `Frequency`セクションで、配信スケジュールを設定します。
    * (任意) `Daily`のドロップダウンを選択し、`Weekly`, `Monthly`, または`Custom`を選択します。
    * (任意) デフォルトのスケジュールタイムゾーンを調整します。
    * (任意) エクスポートを送信する頻度を選択します：`Always`または`If a condition is met`のみ。「[条件付きエクスポートまたはアラートをスケジュールする](https://help.sigmacomputing.com/docs/schedule-a-conditional-export-or-alert)」を参照してください。
    * (任意) `If a condition is met`の場合にのみエクスポートを送信することを選択した場合、通知を停止するスイッチをオンにできます。（この機能はベータ版です）。
    > 📘
    > 条件は分割基準コントロール値ごとに個別に評価されますが、発生回数は条件全体で評価されます。
11. (任意) デフォルトでは、Sigmaはメール本文にワークブックへのリンクを含めます。リンクを含めたくない場合は、`Include link to workbook`チェックボックスの選択を解除します。
12. (任意) 選択した添付ファイルの形式に応じて、添付ファイルの結合やzipファイルでの送信など、その他のオプションを構成できます。
13. (任意) `Customize control values`のチェックボックスを選択して、一つ以上のワークブックコントロールの値に従ってエクスポートされたデータをフィルタリングします。
14. `Create`をクリックします。

### 11-5-10. Microsoft Teamsへのエクスポート (Export to Microsoft Teams)

ドキュメント、レポート、およびデータをMicrosoft Teamsに送信するには、SigmaからMicrosoft Teamsへのエクスポートをスケジュールまたは設定します。チーム内の任意のパブリックチャネルにエクスポートできます。

<img width="390" height="260" alt="f1b5cf15dfd239d686f83a85f696e4f4f289dba4ffa03192a33c9092c8a73580-teams-export-border-small" src="https://github.com/user-attachments/assets/c70a45ef-d8a8-4fba-a860-ca12c37a9bbf" />

要素、ワークブックページ、またはワークブック全体をMicrosoft Teamsにエクスポートします。エクスポートは、ワークブックの最新の公開バージョンから送信されるか、代わりに送信するワークブックの保存済みビューまたはタグ付きバージョンを選択することもできます。ワークブックのドラフトまたはカスタムビューに加えた変更は、変更を公開または保存しない限りエクスポートできません。

サポートされているファイル形式のマトリックスについては、「[利用可能なエクスポート先とフォーマット](https://help.sigmacomputing.com/docs/send-and-schedule-exports#available-export-destinations-and-formats)」を参照してください。

このドキュメントでは、Microsoft Teamsへのエクスポートを送信およびスケジュールする方法について説明します。

#### **ユーザー要件 (User requirements)**
Microsoft Teamsへのエクスポート機能には、以下が必要です。
* 組織で[Microsoftインテグレーション](https://help.sigmacomputing.com/docs/microsoft-integration)が設定されている必要があります。
* Sigma Notificationsアプリが、あなたのチームの最初に名前が付けられたチャネルに追加されている必要があります。
    > 📘
    > 最初に名前が付けられたチャネルは、チーム作成時に最初に命名されたチャネルです。それは「General」チャネルまたはホームチャネルとも呼ばれ、名前を変更することができます。「[Microsoft Teamsでチャネルを編集する](https://support.microsoft.com/en-us/office/edit-a-channel-in-microsoft-teams-b23f3e72-c0e8-4318-b51f-3a213e0259b1)」を参照してください。
* `Export to Microsoft Teams and SharePoint`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。

#### **エクスポートサイズの制限 (Export size limit)**
Microsoft Teamsへのエクスポートのサイズ制限は、ファイルあたり1GBです。「[ダウンロード、エクスポート、およびアップロードの制限](https://help.sigmacomputing.com/docs/download-and-export-limitations)」を参照してください。

#### **前提条件 (Prerequisites)**
エクスポートを送信したいMicrosoft TeamsチャネルのチャネルURLを知っている必要があります。Microsoft Teamsで、チャネルメニューを開き、`Get link to channel`を選択します。

#### **アドホックな通知をMicrosoft Teamsチャネルに送信する (Send an ad hoc notification to a Microsoft Teams channel)**
アドホックな通知をMicrosoft Teamsチャネルに送信するには、Sigma Notificationsアプリがチームの最初に名前が付けられたチャネルに追加されている必要があります。共有するチャネルは、標準または共有である必要があります。

通知は、共有されたファイルをMicrosoft Teamおよびチャネルに対応するSharePointフォルダに保存された添付ファイルとして送信します。複数の添付ファイルは、複数のメッセージとして共有されます。各メッセージはSigma Notificationsボットから送信され、`New Export`と共有されているワークブックおよび要素のタイトルが含まれます。

1.  ワークブックメニューから、`Share and export > Export...`を選択します。
2.  `Microsoft Teams`を選択します。
3.  `Channel URL`フィールドに、Microsoft TeamsチャネルのURLを入力します。
    > 📘
    > プライベートチャネルに通知を送信することはできません。
4.  (任意) `Message`フィールドにメッセージを入力します。
5.  ワークブックにバージョンまたは保存済みビューがある場合は、送信したいものを選択します。
6.  `Attachments`セクションで、添付ファイルとしてエクスポートしたいものを選択します。
7.  各添付ファイルについて、サポートされているファイル形式を選択します。
8.  (任意) メッセージ本文にワークブックへのリンクを含めるには、`Include link to workbook`のチェックボックスを選択します。
9.  (任意) 選択した添付ファイルの形式に応じて、その他のオプションを構成できます。
10. `Export`をクリックします。

#### **Microsoft Teamsチャネルへの通知をスケジュールする (Schedule a notification to a Microsoft Teams channel)**
スケジュールされた通知をMicrosoft Teamsチャネルに送信するには、Sigma Notificationsアプリがチームの最初に名前が付けられたチャネルに追加されている必要があります。共有するチャネルは、標準または共有である必要があります。

通知は、共有されたファイルをMicrosoft Teamに対応するSharePointサイトに保存された添付ファイルとして送信します。複数の添付ファイルは、複数のメッセージとして共有されます。各メッセージはSigma Notificationsボットから送信され、`New Export`と共有されているワークブックおよび要素のタイトルが含まれます。

1.  ワークブックメニューから、`Share and export > Schedule exports…`を選択します。
    > 📘
    > Microsoft Teamsオプションが利用できない場合、ワークブックは`Edit`モードです。エクスポートを試みる前に、ドラフトを公開するか、ワークブックの最新の公開またはタグ付きバージョンに戻ってください。
2.  これがワークブックの最初のスケジュールの場合は`Add Schedule`を、そうでない場合は`+ New schedule`をクリックします。
3.  `Microsoft Teams`を選択します。
4.  `Channel URL`フィールドに、Microsoft TeamsチャネルのURLを入力します。
    > 📘
    > プライベートチャネルに通知を送信することはできません。
5.  (任意) `Message`フィールドにメッセージを入力します。
6.  ワークブックにバージョンまたは保存済みビューがある場合は、メッセージを送信するために使用したいものを選択します。
7.  `Attachments`セクションで、添付ファイルとしてエクスポートしたいものを選択します。
8.  各添付ファイルについて、サポートされているファイル形式を選択します。
9.  `Frequency`セクションで、配信スケジュールを設定します。
    * (任意) `Daily`のドロップダウンを選択し、`Weekly`, `Monthly`, または`Custom`を選択します。
    * (任意) デフォルトのスケジュールタイムゾーンを調整します。
    * (任意) エクスポートを送信する頻度を選択します：`Always`または`If a condition is met`のみ。「[条件付きエクスポートまたはアラートをスケジュールする](https://help.sigmacomputing.com/docs/schedule-a-conditional-export-or-alert)」を参照してください。
    * (任意) `If a condition is met`の場合にのみエクスポートを送信することを選択した場合、通知を停止するスイッチをオンにできます。
10. (任意) メッセージ本文にワークブックへのリンクを含めるには、`Include link to workbook`のチェックボックスを選択します。
11. (任意) `Customize control values`のチェックボックスを選択して、一つ以上のワークブックコントロールの値に従ってエクスポートされたデータをフィルタリングします。
12. (任意) 選択した添付ファイルの形式に応じて、その他のオプションを構成できます。
13. `Create`をクリックします。

### 11-5-11. Microsoft SharePointへのエクスポート (Export to Microsoft SharePoint)

ドキュメント、レポート、およびデータをMicrosoft SharePointサイトに送信するには、エクスポートをスケジュールまたは設定します。[Microsoft Teamsにエクスポートする](https://help.sigmacomputing.com/docs/export-to-microsoft-teams)際、エクスポートされたファイルはTeamに関連付けられたSharePointサイトにも保存されます。SharePointフォルダに直接ファイルを送信することもできます。

要素、ワークブックページ、またはワークブック全体をMicrosoft SharePointにエクスポートします。エクスポートは、ワークブックの最新の公開バージョンから送信されるか、代わりに送信するワークブックの保存済みビューまたはタグ付きバージョンを選択することもできます。ワークブックのドラフトまたはカスタムビューに加えた変更は、変更を公開または保存しない限りエクスポートできません。

サポートされているファイル形式のマトリックスについては、「[利用可能なエクスポート先とフォーマット](https://help.sigmacomputing.com/docs/send-and-schedule-exports#available-export-destinations-and-formats)」を参照してください。

このドキュメントでは、Microsoft SharePointへのエクスポートを送信およびスケジュールする方法について説明します。

#### **ユーザー要件 (User requirements)**
Microsoft SharePointへのエクスポート機能には、以下が必要です。
* 組織で[Microsoftインテグレーション](https://help.sigmacomputing.com/docs/microsoft-integration)が追加されている必要があります。
    * 一つのSigma組織は、一つのMicrosoft組織にしか接続できませんが、Microsoft組織内の任意のSharePointサイトに共有できます。
* `Export to Microsoft Teams and SharePoint`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。

Sigmaから追加されたファイルはすべて、SharePointアプリによって変更されたものとして表示されます。

#### **前提条件 (Prerequisites)**
エクスポートしたいSharePointフォルダのURLを知っている必要があります。SharePointフォルダへのリンクをコピーするには、`Copy Link`をクリックするか、`Share > Copy Link`に移動します。
サイトのドキュメントまたはページライブラリに直接エクスポートすることはできませんが、ドキュメントライブラリ内のフォルダにはエクスポートできます。
> 🚩
> 個人のSharePointフォルダにはエクスポートできません。個人のSharePointフォルダのURLは、`-my.sharepoint.com`のようにフォーマットされています。

#### **Microsoft SharePointに送信する (Send to Microsoft SharePoint)**
アドホックなエクスポートをMicrosoft SharePointに送信するには：
1.  ワークブックメニューから、`Share and export > Export...`を選択します。
2.  `Microsoft SharePoint`を選択します。
3.  `Folder URL`に、エクスポートしたファイルを送信するSharePointフォルダへのURLを入力します。
4.  `Attachments`セクションで、添付ファイルとしてエクスポートしたいものを選択します。
5.  各添付ファイルについて、サポートされているファイル形式を選択します。
6.  `Create`をクリックします。

#### **Microsoft SharePointへのエクスポートをスケジュールする (Schedule an export to Microsoft SharePoint)**
Microsoft SharePointフォルダへのエクスポートをスケジュールするには：
1.  ワークブックメニューから、`Share and export > Schedule exports…`を選択します。
2.  これがワークブックの最初のスケジュールの場合は`Add Schedule`を、そうでない場合は`+ New schedule`をクリックします。
3.  `Microsoft SharePoint`を選択します。
4.  `Folder URL`に、エクスポートしたファイルを送信するSharePointフォルダへのURLを入力します。
5.  `Attachments`セクションで、添付ファイルとしてエクスポートしたいものを選択します。
6.  `Frequency`セクションで、配信スケジュールを設定します。
    * (任意) `Daily`のドロップダウンを選択し、`Weekly`, `Monthly`, または`Custom`を選択します。
    * (任意) デフォルトのスケジュールタイムゾーンを調整します。
    * (任意) エクスポートを送信する頻度を選択します：`Always`または`If a condition is met`のみ。「[条件付きエクスポートまたはアラートをスケジュールする](https://help.sigmacomputing.com/docs/schedule-a-conditional-export-or-alert)」を参照してください。
    * (任意) `If a condition is met`の場合にのみエクスポートを送信することを選択した場合、通知を停止するスイッチをオンにできます。
7.  (任意) `Customize control values`のチェックボックスを選択して、一つ以上のワークブックコントロールの値に従ってエクスポートされたデータをフィルタリングします。
8.  `Create`をクリックします。

### 11-6-1. エクスポートの追加オプションを構成する (Configure additional options for exports)

Sigmaからワークブックデータをエクスポートする際、追加のオプションを構成して、エクスポートされる外観とコンテンツを制御できます。

#### **ユーザー要件 (User requirements)**
エクスポートオプションを構成するには、関連するエクスポート権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。

#### **カスタム配信スケジュールを設定する (Set up a custom delivery schedule)**
スケジュールされたエクスポートを構成する際、デフォルトの配信オプションがニーズに合わない場合は、カスタムのcronスケジュールを設定して配信時間を定義できます。
1.  `Schedule Exports`ダイアログで、`Frequency`について`Custom`を選択し、cron式を入力します。
2.  cron構文を使用して、分、時、日（月）、月、および曜日（週）を指定します。cron式の記述に関する支援については、「[crontab guru](https://crontab.guru/)」を参照してください。

例えば、毎月1日の午前1時30分にレポートを送信するには、次のように入力します。
`30 1 1 * *`
これは、「曜日に関係なく、毎月1日の午前1時30分に実行する」と解釈されます。

例えば、毎四半期の最初の月曜日の午前1時5分にレポートを送信するには、次のように入力します。
`5 1 * 1/3 1#1`
これは、「月の日にちに関係なく、1月から12月までの3か月ごとに、月の最初の月曜日であれば午前1時5分に実行する」と解釈されます。
> 📘
> カスタム頻度を設定するオプションがない場合、組織でエクスポート頻度が制限されている可能性があります。詳細は、「[Restrict export recipients and frequency](https://help.sigmacomputing.com/docs/manage-features#restrict-export-recipients-and-frequency)」を参照してください。

#### **コントロール値でフィルタリングする (Filter by control values)**
ワークブックがコントロールを使用してページ上または特定の要素のデータをフィルタリングしている場合、一つ以上のコントロールの値でエクスポートされたデータをフィルタリングすることも選択できます。
このオプションは、スケジュールされたエクスポートに対してのみ設定できます。
1.  `Schedule Exports`ダイアログの`More Options`セクションで、`Customize control values`のチェックボックスを選択します。
2.  表示される`Controls`セクションで、検索ボックスでコントロールIDを検索して選択します。
3.  コントロールのコントロール値を選択し、エクスポートに使用したい値に設定します。
4.  別のコントロールを追加するために検索するか、`Create`をクリックしてスケジュールされたエクスポートを保存します。

#### **PDFまたはExcelファイルをマージする (Merge PDF or Excel files)**
複数のPDFまたはExcelファイルをエクスポートする場合、添付ファイルを一つのファイルにまとめることができます。
* 複数のワークブックページまたはデータ要素をPDF添付ファイルとして一つのPDFファイルに。
* 複数のデータ要素をExcel添付ファイルとして一つのExcelファイルに。

添付ファイルを一つのファイルにまとめるには、以下を実行します。
1.  `Export`または`Schedule Exports`ダイアログの`More Options`セクションで、`Combine attachments`のチェックボックスを選択します。
2.  チェックボックスが表示されない場合は、少なくとも2つの添付ファイルに対してファイルタイプとして`Excel`または`PDF`を選択したことを確認してください。

#### **添付ファイルを.zipファイルに圧縮する (Compress attachments to a .zip file)**
ファイルサイズが大きくなる一つ以上の添付ファイルをエクスポートする場合、添付ファイルをZIPファイルに圧縮することを選択できます。
1.  `Export`または`Schedule Exports`ダイアログの`More Options`セクションで、`Send as .zip file`のチェックボックスを選択します。
2.  添付ファイルは`merged-report.zip`という名前の一つのzipファイルに表示されます。

##### **ヘッダーラベルを繰り返す (Repeat header labels)**
ピボットテーブルをExcelまたはCSVにエクスポートする場合、ヘッダーラベルを繰り返して、各ピボットテーブルの行と列のヘッダーがそれぞれのセルに表示されるようにすることができます。

1.  `Export`または`Schedule Exports`ダイアログの`More Options`セクションで、`Repeat header labels`のチェックボックスを選択します。
2.  チェックボックスが表示されない場合は、ファイル形式がExcelまたはCSVであり、ピボットテーブル要素またはピボットテーブル要素を持つページやワークブックをエクスポートしていることを確認してください。

例えば、以下のようなピボットテーブルの場合：

<img width="818" height="402" alt="5087230-pivot-row-column-repeat-source" src="https://github.com/user-attachments/assets/e50c8524-eb59-47ff-937e-61e41cc38fb1" />

ピボットテーブル要素をエクスポートすると、各ピボットテーブルの行と列にヘッダーが表示されます。

<img width="961" height="401" alt="e1fa92f-pivot-export-repeated" src="https://github.com/user-attachments/assets/cc626a88-fd3d-486f-b6f6-daeb6ebcd0eb" />

この設定を構成しない場合、ピボットテーブルの行と列のヘッダーは一度しか表示されません。

<img width="941" height="401" alt="8bd0afb-pivot-export-no-repeat" src="https://github.com/user-attachments/assets/0e99c662-8f30-4004-9821-1c74d189c26f" />

ピボットテーブル自体でこの設定を構成するには、「[行ラベルを繰り返す](https://help.sigmacomputing.com/docs/working-with-pivot-tables#repeat-row-labels)」を参照してください。

##### **メタデータ付きでExcelファイルをダウンロードする (Download Excel files with metadata)**
エクスポートの日時やExcelファイルをダウンロードしたユーザーの名前など、追加のメタデータをExcelファイルに含めたい場合は、以下を実行します。
1.  ワークブックまたはワークブックページの場合、()を選択してメニューを開き、`Export...`を選択します。ワークブック要素の場合、`More` > `Export`を選択し、`Send`の下で`Export`を選択します。
2.  `Export`ダイアログで、デフォルトの`Direct Download`オプションを選択したままにします。
3.  ファイルタイプとして`Excel`を選択します。
4.  `More Options`セクションで、`Include metadata`のチェックボックスを選択します。
5.  `Export`を選択します。

##### **PDFエクスポートのページレイアウトを書式設定する (Format PDF export page layout)**
SigmaからPDFファイルをエクスポートする際、エクスポートされるレポートの書式を改善するために、いくつかの異なるオプションを構成できます。
* 希望のPDFページ幅に合わせてカスタムページ幅を設定します。レターサイズの縦向きPDFエクスポートには1050ピクセル、レターサイズの横向きPDFエクスポートには1380ピクセルを使用します。「[Layout style settings](https://help.sigmacomputing.com/docs/workbook-settings-overview#layout-style-settings)」を参照してください。
* PDFのテーブルに最大1000行のデータを表示します。「[追加の行を表示する](#show-additional-rows)」を参照してください。
* ページブレーク要素を追加して、PDFエクスポートのどこで要素が次のページに送られるかを制御します。「[改ページを追加する](https://help.sigmacomputing.com/docs/configure-additional-options-for-exports#add-a-page-break)」を参照してください。

ワークブックがレガシーレイアウトを使用している場合は、「[Format PDF exports (legacy layouts)](https://help.sigmacomputing.com/docs/format-pdf-exports-legacy-layouts)」を参照してください。

##### **追加の行を表示する (Show additional rows)**
テーブルまたはピボットテーブルの最大1,000行をエクスポートしたい場合は、以下を実行します。
> 📘
> ワークブック全体またはワークブックのページをエクスポートしたい場合、テーブルは隣に要素がなく、コンテナに入っていない状態で、独自の行にある必要があります。

1.  ワークブックを`Edit`モードで開きます。
2.  ワークブックで、最大1,000行のデータを表示したい要素を探します。
3.  `More` > `Export formatting`を選択し、`Expand table to first 1k rows`をクリックします。このオプションが既に設定されている場合、チェックマークが表示されます。

<img width="428" height="434" alt="282d97f4b7b538582726ce5381de9bdd7736164d87baf703acbaa390d30b8f7f-export-expand-table" src="https://github.com/user-attachments/assets/31179401-61b2-4a6f-9cee-3e8fe8a900f8" />

4.  ワークブックを公開します。
5.  ワークブックをPDFにエクスポートして、出力が期待通りに見えることを確認します。
6.  必要な変更を加え、希望の宛先にスケジュールされたエクスポートを設定します。

##### **改ページを追加する (Add a page break)**
ワークブックのPDFエクスポートをどこで別々のページに分割するかを指定したい場合、またはワークブック要素がPDFエクスポートで切れたり期待通りに表示されなかったりする場合は、ワークブックページに一つ以上の改ページ要素を追加します。

1.  ワークブックを`Edit`モードで開きます。
2.  ワークブックの`Add New Element`パネルを開きます。
3.  `PDF export elements`セクションで、`Page break`要素を選択し、ワークブックキャンバスにドラッグします。

<img width="428" height="434" alt="282d97f4b7b538582726ce5381de9bdd7736164d87baf703acbaa390d30b8f7f-export-expand-table" src="https://github.com/user-attachments/assets/17f2996f-293d-4f0d-923e-f12224093321" />

4.  ワークブックを公開します。
5.  ワークブックをPDFにエクスポートして、出力が期待通りに見えることを確認します。
6.  必要な変更を加え、希望の宛先にスケジュールされたエクスポートを設定します。

##### **PDFレイアウト構成の例 (Example PDF layout configurations)**
この例では、構成の変更は行われておらず、縦向きのPDFエクスポートは、ワークブックに表示されているのと同じ行数のテーブルをエクスポートします。

<img width="780" height="1129" alt="365e768-Screenshot_2024-05-13_at_3 44 00_PM" src="https://github.com/user-attachments/assets/8ea19d32-090f-4473-b1ce-6ecfa27309fb" />


この例では、テーブルに最大1,000行のデータを表示するオプションが選択されていますが、ワークブックページに改ページ要素は使用されていません。縦向きのPDFエクスポートを選択すると、最大1000行のテーブルがエクスポートされ、1000行のテーブルの末尾に、同じページにテキスト要素が表示されます。次のページには、別のデータ要素が表示されます。

<img width="1179" height="782" alt="3a6b195-Screenshot_2024-05-13_at_3 52 31_PM" src="https://github.com/user-attachments/assets/a29c202a-7563-4376-99bf-0c061fc5c4f8" />


この例では、テーブルに最大1,000行のデータを表示するオプションが選択されており、テキスト要素と2番目のデータ要素の前にワークブックページで改ページ要素が使用されています。縦向きのPDFエクスポートを選択すると、最大1000行のテーブルがエクスポートされ、1000行のテーブルの末尾に改ページがあります。次のページには、テキスト要素が表示され、その後に別のデータ要素が続きます。

<img width="1176" height="641" alt="292bb9b-Screenshot_2024-05-13_at_3 52 48_PM" src="https://github.com/user-attachments/assets/d53eaf08-61ed-4e42-bb94-c921daa290c1" />


### 11-6-2. スケジュールされたエクスポートを管理する (Manage scheduled exports)

エクスポートのスケジュールをずらしたり、不要になったスケジュールされたエクスポートを削除したり、スケジュールされたエクスポートの構成を更新するなど、スケジュールされたエクスポートを表示および管理できます。

* [ワークブックのスケジュールを管理する](#manage-schedules-for-a-workbook)。
* [自分が所有する、または購読しているスケジュールされたエクスポートを管理する](#manage-your-scheduled-exports-and-subscriptions)。
* 管理者として、[組織のすべてのスケジュールされたエクスポートを管理する](https://help.sigmacomputing.com/docs/manage-organization-schedules)。

> 💡
> 複数のスケジュールされたエクスポートがある場合は、スケジュールをずらすことがベストプラクティスです。スケジュールをずらすことで、Sigmaとデータウェアハウスへの負荷を軽減できます。

#### **ユーザー要件 (User requirements)**
ワークブックのエクスポートを送信およびスケジュールする機能には、以下が必要です。
* 特定の宛先にエクスポートするには、その宛先のエクスポート権限が有効になっているアカウントタイプを割り当てられている必要があります。
* ワークブックのエクスポートをスケジュールするには、`Schedule export`権限が有効になっているアカウントタイプを割り当てられている必要があります。
* あなたがワークブックの所有者であるか、`Can explore`または`Can edit`のワークブック権限を付与されている必要があります。

#### **ワークブックのスケジュールを管理する (Manage schedules for a workbook)**
1.  ワークブックメニュー()から、`Schedule exports`を選択します。
2.  `Schedule Exports`ダイアログが開きます。
3.  ワークブックのスケジュールされたエクスポートのリストを確認し、エクスポートの時間とタイプを確認して、重複するスケジュールや受信者を特定できます。
4.  特定のスケジュールされたエクスポートについては、`More`メニューをクリックして、スケジュールの名前の変更、スケジュールの編集、構成済みのスケジュールされたエクスポートの即時送信、スケジュールされたエクスポートの一時停止、または削除ができます。

##### **スケジュールを編集または削除する (Edit or delete a schedule)**
1.  ワークブックメニュー()から、`Schedule exports`を選択します。
2.  `Schedule Exports`ダイアログが開きます。
3.  送信したいスケジュールを探し、`More`メニューをクリックします。
4.  スケジュールを削除するには`Delete`を、スケジュールに変更を加えるには`Edit`をクリックします。

##### **スケジュールされたエクスポートをオンデマンドで送信する (Send a scheduled export on demand)**
次回のスケジュールされたエクスポートの実行を待たずにスケジュールされたエクスポートを送信したい場合は、オンデマンドで送信できます。
1.  ワークブックメニュー()から、`Schedule exports`を選択します。
2.  送信したいスケジュールを探し、`More`メニュー()をクリックして、`Send now`を選択します。

##### **スケジュールされたエクスポートを一時停止または再開する (Pause or resume a scheduled export)**
スケジュールされたエクスポートを手動で一時停止および再開できます。
1.  ワークブックメニュー()から、`Schedule exports`を選択します。
2.  `Schedule Exports`ダイアログが開きます。
3.  `Actions`列の`More`メニューをクリックし、`Pause`を選択します。
4.  `Status`列で、ステータスが`Paused`に変わります。
5.  エクスポートを再開するには、上記の手順を繰り返しますが、`More`メニューから`Resume`を選択します。

##### **自動的に一時停止されたスケジュールされたエクスポート (Auto-paused scheduled exports)**
スケジュールされたエクスポートが100回以上連続して失敗した場合、または7日以上で5回以上失敗した場合、Sigmaはそのエクスポートスケジュールを一時停止し、スケジュールの所有者にメール通知が届きます。
メール通知には、「ドキュメントのエクスポートに失敗しました。Sigmaはあなたのスケジュールされたエクスポートの一つを一時停止しました。詳細を確認するには、以下のワークブックへのリンクを使用してください。」というメッセージが含まれています。
エクスポートを手動で再開できます。`Status`列には、感嘆符付きで`Paused`と表示されます。一時停止されたエクスポートを再開するには、`Actions`列の`More`メニューから`Resume`を選択します。

#### **あなたのスケジュールされたエクスポートと購読を管理する (Manage your scheduled exports and subscriptions)**
あなたのユーザープロファイルから、あなたが所有または受信するスケジュールされたエクスポートを表示および管理できます。
Sigmaの管理者である場合は、組織のすべてのスケジュールされたエクスポートを表示または管理できます。「[組織のスケジュールを管理する](https://help.sigmacomputing.com/docs/manage-organization-schedules)」を参照してください。

##### **あなたのプロファイルでスケジュールを表示および管理する (View and manage schedules in your profile)**
プロファイルからスケジュールされたエクスポートを表示および管理するには、以下を実行します。
1.  トップメニューバーのユーザーメニューをクリックします。
2.  ドロップダウンメニューから`Profile`を選択します。
3.  ユーザープロファイルから、`Scheduled Exports`を選択します。
4.  表示および管理したいスケジュールされたエクスポートを選択します。
    * `Owned by you`を選択して、あなたが作成したスケジュールされたエクスポートを表示および管理します。
    * `Your subscriptions`を選択して、あなたのメールアドレスに送信されるエクスポートを表示および管理します。
5.  リストされたスケジュールを検索、フィルタリング、ソートして、見つけたいスケジュールをより簡単に見つけることができます。
6.  特定のスケジュールに変更を加えるには、ワークブックの名前を選択してワークブックを開き、スケジュールを管理します。

##### **スケジュールを削除する (Delete a schedule)**
あなたが所有するスケジュールを削除するには：
1.  ユーザーメニューをクリックし、ドロップダウンメニューから`Profile`を選択します。
2.  `Scheduled Exports`を選択します。
3.  削除したいスケジュールされたエクスポートを探し、`More > Delete`をクリックします。

##### **購読を解除する (Unsubscribe from a subscription)**
スケジュールされたエクスポートの購読を解除するには：
1.  ユーザーメニューをクリックし、ドロップダウンメニューから`Profile`を選択します。
2.  `Scheduled Exports`を選択します。
3.  `Your subscriptions`を選択し、購読を解除したい購読を探します。
4.  `More > Unsubscribe`をクリックします。

### 11-7-1. PDFエクスポートの書式設定（レガシーレイアウト） (Format PDF exports (legacy layouts))

ワークブックからのPDFエクスポートの外観を構成し、PDFのページがどこで改ページされるか、特定のテーブル要素で何行エクスポートするかを設定できます。

PDFエクスポートの書式設定をどのように構成するかは、ワークブックで使用されているレイアウトによって異なります。
* **グリッドレイアウト（ほとんどのワークブック）:** 「[エクスポートの追加オプションを構成する](https://help.sigmacomputing.com/docs/configure-additional-options-for-exports)」を参照してください。
* **レガシーレイアウト:** このページでは、レガシーレイアウトのPDFエクスポート書式設定について説明します。

#### **ユーザー要件 (User requirements)**
PDFエクスポートを書式設定する機能には、以下が必要です。
* `Full explore`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* あなたがワークブックの所有者であるか、`Can explore`または`Can edit`の[ワークブック権限](https://help.sigmacomputing.com/docs/share-a-workbook)を付与されている必要があります。

#### **ページセクションについて (About page sections)**
ページセクションを使用すると、レガシーレイアウトを使用するワークブックのワークブックページに要素をレイアウトできます。
ワークブックページに要素がある場合、一つ以上の要素を持つ一つ以上のセクションがあります。
例えば、以下のスクリーンショットのワークブックには3つのセクションが含まれています。

<img width="1580" height="829" alt="20513e9-1" src="https://github.com/user-attachments/assets/692b05b8-5c36-4d96-a67c-c7bf4292e4ae" />

#### **最初の1k行を表示する (Show first 1k rows)**
デフォルトでは、エクスポートされたPDFのテーブルとピボットテーブルは、ダッシュボードに表示される行数のみを表示します。エクスポートでより多くの行を表示したい場合は、テーブルごとに最大1,000行を表示するオプションを構成できます。PDFでは、テーブルごとに1,000行を超えてエクスポートすることはできません。

このオプションを構成すると、テーブルヘッダーはテーブルデータを含むすべてのPDFページに表示され、テーブルの最大1000行のデータがエクスポートされます。

レガシーレイアウトの場合、個々の要素の代わりに**ページセクション**に対してこのオプションを構成する必要があります。セクションには、単一のテーブルまたはピボットテーブル要素のみが含まれている必要があります。

* **始める前に:** このアクションは編集モードでのみ利用可能です。編集を開始するには、ページの右上隅にある`Edit`をクリックします。

1.  キャレットを選択して、ワークブックページの`PAGE ELEMENTS`エディタパネルを開きます。
2.  対象のテーブルまたはピボットテーブルを含むセクションにカーソルを合わせ、`More`をクリックします。

<img width="1571" height="814" alt="4e15d30-2" src="https://github.com/user-attachments/assets/babd14ff-ac16-44a0-80bc-e9488950cece" />

3.  `Export formatting` > `Expand to first 1k rows`を選択します。
    * オプションが既に構成されている場合、`Expand to first 1k rows`の横にチェックマークが表示されます。

<img width="401" height="374" alt="28e60cb-3" src="https://github.com/user-attachments/assets/58f5723f-b422-4b85-b196-f236a1ff71ff" />

エクスポートでテーブルがどのように表示されるかを確認するには、[ページをPDFとしてダウンロードする](https://help.sigmacomputing.com/docs/download-from-a-workbook)か、[Send Nowを使用して](https://help.sigmacomputing.com/docs/manage-scheduled-exports#send-a-scheduled-export-on-demand)既存のスケジュールをテストします。

#### **改ページを追加する (Add page breaks)**
ダッシュボードの任意のセクションの後に改ページを追加することで、エクスポートされたPDFの外観をカスタマイズできます。

1.  キャレットを選択して、ワークブックページの`PAGE ELEMENTS`エディタパネルを開きます。
2.  エディタパネルで、対象のテーブルまたはピボットテーブルを含むセクションにカーソルを合わせ、`More`をクリックします。
3.  `Export formatting` > `Page Break After Section`を選択します。
    * オプションが既に構成されている場合、`Page Break After Section`の横にチェックマークが表示されます。

<img width="401" height="374" alt="28e60cb-3" src="https://github.com/user-attachments/assets/69b2031b-db67-4957-92a5-ae7c52a8b3a6" />

改ページは、次のエクスポートに適用されます。
エクスポートでテーブルがどのように表示されるかを確認するには、以下のいずれかを実行できます。
* ページをPDFとしてダウンロードする
* 既存のスケジュールをテストするために、[スケジュールされたエクスポートをオンデマンドで送信する](https://help.sigmacomputing.com/docs/manage-scheduled-exports#send-a-scheduled-export-on-demand)。

### 12-1-1. 関数インデックス (Function index)

Sigmaは、データから最大限の価値を引き出すための単純な計算、変換、抽出を実行できる200以上の関数をサポートしています。
この関数インデックスをカテゴリ別に閲覧して、利用可能な特定の関数タイプについて詳しく学びましょう。

#### **集計関数 (Aggregate functions)**
集計関数は、複数行のデータを評価して単一の値を返します。例えば、集計関数を使用して、グループ計算（`Sum`や`Avg`など）、特定の値の取得（`Min`や`Max`など）、データ評価によるインサイト提供（`Count`や`CountDistinct`など）、または複数の値の結合（`ArrayAgg`や`ListAgg`など）を実行できます。

| 関数 | 説明 |
| :--- | :--- |
| **ArrayAgg** | 列またはグループ内のnullでない行の値を識別し、それらを単一の配列に集計します。 |
| **ArrayAggDistinct** | 列またはグループ内の個別でnullでない行の値を識別し、それらを単一の配列に集計します。 |
| **Avg** | 列またはグループの平均値を計算します。 |
| **AvgIf** | 指定された条件が`True`の場合に、列またはグループの平均値を計算します。 |
| **Corr** | 2つの列のピアソン相関係数（二変量相関）を計算します。 |
| **Count** | 列またはグループ内のnullでなく空でもない値の数をカウントします。 |
| **CountDistinct** | 列またはグループ内のユニークでnullでなく空でもない値の数をカウントします。重複値はカウントしません。（`Ndv`と同じ） |
| **CountDistinctIf** | 指定された条件が`True`の場合に、列またはグループ内のユニークでnullでなく空でもない値の数をカウントします。 |
| **CountIf** | 指定された条件が`True`の場合に、列またはグループ内のnullでなく空でもない値の数をカウントします。 |
| **GrandTotal** | 列またはグループの総計を計算します。 |
| **ListAgg** | グループまたは列の値を単一のテキスト文字列に結合します。 |
| **ListAggDistinct** | グループまたは列のユニークな値を単一のテキスト文字列に結合します。重複値は含みません。 |
| **Max** | 列またはグループの最大（最大または最新）の値を取得します。 |
| **MaxIf** | 指定された条件が`True`の場合に、列またはグループの最大の値を取得します。 |
| **Median** | 列またはグループの中央値（中間点）を決定します。 |
| **Min** | 列またはグループの最小（最小または最古）の値を取得します。 |
| **MinIf** | 指定された条件が`True`の場合に、列またはグループの最小の値を取得します。 |
| **PercentileCont** | 列またはグループの連続的なk番目のパーセンタイルを計算します。 |
| **PercentileDisc** | 列またはグループの離散的なk番目のパーセンタイルを計算します。 |
| **PercentOfTotal** | 指定された集計合計に対して値が占める割合を計算します。 |
| **RegressionIntercept** | 線形回帰直線のy切片を計算します。 |
| **RegressionR2** | 線形回帰直線の決定係数を計算します。 |
| **RegressionSlope** | 線形回帰直線の傾きを計算します。 |
| **StdDev** | 列またはグループの標準偏差を計算します。 |
| **Subtotal** | 列またはグループの小計を計算します。 |
| **Sum** | 列またはグループの合計を計算します。 |
| **SumIf** | 指定された条件が`True`の場合に、列またはグループの合計を計算します。 |
| **SumProduct** | 指定された列にわたる行の値の積を計算し、その結果の積の合計を列またはグループに対して計算します。 |
| **Variance** | 列またはグループの標本分散（分布の広がり）を推定します。 |
| **VariancePop** | 列またはグループの母分散（分布の広がり）を計算します。 |

#### **配列関数 (Array functions)**
配列関数は、配列（インデックス付けされた値のリスト）を作成、管理、操作します。

| 関数 | 説明 |
| :--- | :--- |
| **Array** | 指定された値を含む配列を返します。 |
| **ArrayContains** | 配列内で特定の値を検索します。値が見つかった場合は`True`、それ以外は`False`を返します。 |
| **ArrayDistinct** | 重複する値のない配列を返します。 |
| **ArrayExcept** | ある指定された配列に含まれ、別の指定された配列には含まれないすべてのユニークな要素の配列を返します。 |
| **ArrayIntersection** | 2つの配列を比較し、重複のないすべての共通要素の配列を返します。 |
| **ArrayJoin** | 配列の要素を単一のテキスト文字列に結合します。 |
| **ArrayLength** | 配列またはリストのエントリ数を決定します。 |
| **ArraySlice** | 開始インデックスと長さで定義された配列の一部を返します。 |
| **Sequence** | 指定された範囲と増分に基づいて、整数の等差数列を配列として返します。 |

以下の**集計関数**も配列を作成します。
* **ArrayAgg**
* **ArrayAggDistinct**

#### **日付関数 (Date functions)**
日付関数は、日時値を評価、変換、操作します。

| 関数 | 説明 |
| :--- | :--- |
| **ConvertTimezone** | 日時値を指定されたタイムゾーンに変換します。 |
| **DateAdd** | 日付に指定された量の時間を加算します。 |
| **DateDiff** | 2つの日付の時間差を計算します。 |
| **DateFormat** | 提供されたフォーマットに基づいて日付値をテキストにフォーマットします。 |
| **DateFromUnix** | Unixタイムスタンプを日付値に変換します。 |
| **DateLookback** | 指定された日付とオフセットによって決定される過去の時点（ルックバック期間）での変数の値を返します。 |
| **DatePart** | 日付値から指定された日付部分を抽出します。 |
| **DateParse** | 指定されたフォーマットのテキスト値を解析し、ISOフォーマットの日時値（日付データ型）を返します。 |
| **DateTrunc** | 日付を指定された日付部分に切り捨てます。 |
| **Day** | 日付値から月の日を数値として返します。 |
| **DayOfYear** | 日付値から年の日を数値として返します。 |
| **EndOfMonth** | 日付値から月の最終日を返します。 |
| **Hour** | 日付値から時間コンポーネントを数値として返します。 |
| **InDateRange** | 日付が指定された日付範囲内にあるかどうかを判断し、`True`または`False`を返します。 |
| **InPriorDateRange**| 日付が前の期間の日付範囲内にあるかどうかを判断し、`True`または`False`を返します。 |
| **LastDay** | 日付値の指定されたコンポーネントを評価し、そのコンポーネントの最後の日時値をISOフォーマットで返します。 |
| **MakeDate** | 年、月、日の単位を表す指定された値を評価し、ISOフォーマットの日時値を返します。 |
| **Minute** | 指定された日時値の分コンポーネントを表す整数を返します。 |
| **Month** | 指定された日時値の月コンポーネントを表す整数を返します。 |
| **MonthName** | 指定された日時値から月コンポーネントの名前を返します。 |
| **Now** | 組織のアカウントタイムゾーンを使用して現在の日時を返します。 |
| **Quarter** | 指定された日時値の四半期コンポーネントを表す整数を返します。 |
| **Second** | 指定された日時値の秒コンポーネントを表す整数を返します。 |
| **Today** | 組織のアカウントタイムゾーンを使用して現在の日付を返します。 |
| **Weekday** | 指定された日時値の曜日を表す整数を返します。 |
| **WeekdayName** | 指定された日時値から曜日の名前を返します。 |
| **Year** | 指定された日時値の年コンポーネントを表す整数を返します。 |

#### **財務関数 (Financial functions)**
財務関数は、お金、投資、利率、その他の財務側面に関連するデータを評価・計算します。

| 関数 | 説明 |
| :--- | :--- |
| **CAGR** | 投資の複利年間成長率を返します。 |
| **Effect** | 実効年利率を返します。 |
| **FV** | 投資の将来価値を返します。 |
| **IPmt** | 金額、期間数、および一定の利率に基づいて、ローンの定期的な支払いの利息部分を返します。 |
| **Nominal** | 名目年利率を返します。 |
| **NPer** | 既知の金額、利率、および定期的な支払額に基づいて、ローンまたは投資の期間数を返します。 |
| **Pmt** | 金額、期間数、および一定の利率に基づいて、ローンの定期的な支払いを返します。 |
| **PPmt** | 金額、期間数、および一定の利率に基づいて、ローンの定期的な支払いの元本部分を返します。 |
| **PV** | 一定かつ定期的な支払いを使用する場合の、ローンまたは投資の現在価値を返します。 |
| **XNPV** | 不規則な間隔での支払いや収入に対する投資の正味現在価値を返します。 |

#### **地理関数 (Geography functions)**
地理関数は、[地理データ型](https://help.sigmacomputing.com/docs/supported-data-types-and-formats#geography)を操作して、場所、ルート、その他の地理空間データを分析できます。
> 📘
> 地理関数は、すべてのデータプラットフォーム接続と互換性があるわけではありません。

| 関数 | 説明 |
| :--- | :--- |
| **Area** | 指定された単位で、地理の面積を計算します。 |
| **Centroid** | 地理の地理的中心を計算します。 |
| **Distance** | 指定された単位で、2つの地理間の最小距離を計算します。 |
| **Geography** | GeoJSONまたはWKT形式を地理データ型に変換します。 |
| **Intersects** | ある地理が別の地理と交差するかどうかを判断します。 |
| **Json** | 地理データをGeoJSONに変換します。 |
| **Latitude** | ポイントの緯度コンポーネントを返します。 |
| **Longitude** | ポイントの経度コンポーネントを返します。 |
| **MakeLine** | 一連のポイントと線分から線を構築します。 |
| **MakePoint** | 緯度と経度のデータからポイントを構築します。 |
| **Perimeter** | 指定された単位で、地理の周囲長を計算します。 |
| **Text** | 地理データをWKT形式に変換します。 |
| **Within** | ある地理が別の地理の完全に内側にあるかどうかを判断します。 |

#### **結合関数 (Join functions)**
結合関数は、ローカル要素とターゲット要素の関連する列に基づいて、ターゲット要素からデータを取得します。

| 関数 | 説明 |
| :--- | :--- |
| **Lookup** | 指定されたターゲット要素の列で値を見つけ、その要素の別の列から対応する行の値を返します。 |
| **Rollup** | 指定されたターゲット要素の列で値を見つけ、その要素の別の列から対応するすべての行の値を集計します。 |

#### **論理関数 (Logical functions)**
論理関数は、論理演算を実行するか、条件文を評価し、通常はブール値（`true`または`false`）の出力を返します。

| 関数 | 説明 |
| :--- | :--- |
| **Between** | 値が指定された範囲内にあるかどうかを判断します。`True`または`False`。 |
| **Choose** | 指定されたインデックス番号に基づいて、リストから一致する値を返します。 |
| **Coalesce** | リストから最初のNullでない値を返します。 |
| **If** | 一つ以上の条件が`true`か`false`かを評価し、対応する値を返します。 |
| **In** | 指定された値が候補値のいずれかと一致するかどうかを判断します。`True`または`False`。 |
| **IsNotNull** | セルに値があるかどうかを判断します。`True`または`False`。 |
| **IsNull** | セルがNullであるかどうかを判断します。`True`または`False`。 |
| **Switch** | SWITCHパラダイムを使用して、指定された値を条件のリストと照合し、一致する応答を返します。 |
| **Zn** | Nullでない値を返すか、Null値の代わりに0（ゼロ）を返します。 |

#### **数学関数 (Math functions)**
数学関数は、算術、三角法、丸め、統計、対数計算などの数学的操作を実行します。

| 関数 | 説明 |
| :--- | :--- |
| **Abs** | 数値の絶対値を返します。 |
| **Acos** | 角度のアークコサインを返します。 |
| **Asin** | 角度のアークサインを返します。 |
| **Atan** | 角度のアークタンジェントを返します。 |
| **Atan2** | 座標ペアのアークタンジェントを返します。 |
| **BinFixed** | 指定された数の同じサイズのビンの中で、値のビンを計算します。 |
| **BinRange** | 指定された下限を使用して、値のビンを計算します。 |
| **BitAnd** | 2つの数値のビット単位の`AND`を計算します。 |
| **BitOr** | 2つの数値のビット単位の`OR`を計算します。 |
| **Ceiling** | 数値を、等しいかより大きい値の最も近い倍数に切り上げます。 |
| **Cos** | 角度のコサインを返します。 |
| **Cot** | 角度のコタンジェントを返します。 |
| **Degrees** | 角度の測定値をラジアンから度に変換します。 |
| **DistanceGlobe** | 地球上の2点間の距離をキロメートルで計算します。 |
| **DistancePlane** | 平面上の2点間の距離を計算します。 |
| **Div** | 除算の整数部分を返します。 |
| **Exp** | 数学定数`e`、つまり`2.71828`を返します。 |
| **Floor** | 数値を、等しいかより小さい値の最も近い倍数に切り下げます。 |
| **Greatest** | リストから最大値を返します。 |
| **Int** | 整数を、それ以下の最大の整数に切り下げます。 |
| **Least** | リストから最小値を返します。 |
| **Ln** | 数値の自然対数、`log_e(n)`を計算します。 |
| **Log** | 数値の対数を計算します。デフォルトは`log_10(n)`です。 |
| **Mod** | 除算の余りの部分を返します。 |
| **MRound** | 数値を、指定された数値の最も近い倍数に切り下げます。 |
| **Pi** | 数学定数`π`、つまり`3.14159...`を返します。 |
| **Power** | ある数値を指定されたべき乗に累乗した結果を計算します。 |
| **Radians** | 角度の測定値を度からラジアンに変換します。 |
| **Round** | 数値を指定された桁数に丸めます。 |
| **RoundDown** | 数値を指定された桁数または小数点以下の桁数に切り下げます。 |
| **RoundUp** | 数値を指定された桁数または小数点以下の桁数に切り上げます。 |
| **RowAvg** | 数値のリストの平均値を計算します。 |
| **Sign** | 数値の符号を計算します。負の場合は`-1`、正の場合は`1`、ゼロの場合は`0`を返します。 |
| **Sin** | 角度のサインを計算します。 |
| **Sqrt** | 数値の平方根を計算します。 |
| **Tan** | 角度のタンジェントを計算します。 |
| **Trunc** | 数値を指定された桁数または小数点以下の桁数に切り捨てます。 |

#### **パススルー関数 (Passthrough functions)**
パススルー関数は、接続されたデータプラットフォーム内で操作を実行するリクエストを送信し、データプラットフォームのネイティブ関数によって生成された応答を返します。

| 関数 | 説明 |
| :--- | :--- |
| **AggDatetime** | `date`データ型を返すデータプラットフォームの集計関数を呼び出します。`CallDatetime`の集計版。 |
| **AggGeography**| `geography`データ型を返すデータプラットフォームの集計関数を呼び出します。`CallGeography`の集計版。 |
| **AggLogical** | `logical`データ型を返すデータプラットフォームの集計関数を呼び出します。`CallLogical`の集計版。 |
| **AggNumber** | `number`データ型を返すデータプラットフォームの集計関数を呼び出します。`CallNumber`の集計版。 |
| **AggText** | `text`データ型を返すデータプラットフォームの集計関数を呼び出します。`CallText`の集計版。 |
| **AggVariant** | `variant`データ型を返すデータプラットフォームの集計関数を呼び出します。`CallVariant`の集計版。 |
| **CallDatetime** | `date`データ型を返すデータプラットフォームの関数を呼び出します。 |
| **CallGeography**| `geography`データ型を返すデータプラットフォームの関数を呼び出します。 |
| **CallLogical** | `logical`データ型を返すデータプラットフォームの関数を呼び出します。 |
| **CallNumber** | `number`データ型を返すデータプラットフォームの関数を呼び出します。 |
| **CallText** | `text`データ型を返すデータプラットフォームの関数を呼び出します。 |
| **CallVariant** | `variant`データ型を返すデータプラットフォームの関数を呼び出します。 |

#### **システム関数 (System functions)**
システム関数は、ユーザーやシステム構成の詳細を含む、Sigma組織に関する情報を返します。

| 関数 | 説明 |
| :--- | :--- |
| **CurrentTimezone** | 管理ポータルで構成された、組織の`IANA time zone`を返します。 |
| **CurrentUserAttributeText** | 現在の（サインインしている）ユーザーの特定の属性の値を返します。 |
| **CurrentUserEmail** | 現在の（サインインしている）ユーザーのアカウントに関連付けられたメールアドレスを返します。 |
| **CurrentUserFirstName** | ユーザーのプロファイルで構成された、現在の（サインインしている）ユーザーの名を返します。 |
| **CurrentUserFullName** | ユーザーのプロファイルで構成された、現在の（サインインしている）ユーザーのフルネームを返します。 |
| **CurrentUserInTeam** | 現在のユーザーが特定のチームのメンバーである場合に`true`を返します。 |

### 12-2-1. 演算子の概要 (Operators overview)

Sigmaは計算のための基本的な演算子をサポートしており、受け入れられた順序でそれらを評価します。これらの演算子は、[論理関数](https://help.sigmacomputing.com/docs/logical-functions)の条件を開発する際に使用できます。

Sigmaは多くの演算子をサポートしています。

**例**
`+`加算演算子を使用して2つの値を加算するなど、値を計算する際、値の1つがNullの場合、結果はNullになります。
`[Column 1] + [Column 2]`

`[Column 2]`の値がNullの場合、数式全体の結果はNullになります。
これを解決するには、`Zn`関数を各値に適用して、Nullの代わりに0を代入できます。
`Zn([Column 1]) + Zn([Column 2])`

| 演算子 | 説明 |
| :--- | :--- |
| **.** | クラス分割記法。VariantおよびJSONデータ型のレベルをナビゲートするために使用されます。 |
| **+** | 2つの数値を加算します。 |
| **-** | ある数値から別の数値を減算します。 |
| **\*** | 2つの数値を乗算します。 |
| **/** | ある数値を別の数値で除算します。 |
| **^** | ある数値を指定されたべき乗に累乗します。 |
| **%** | モジュロ。XをYで除算した余りを計算します。 |
| **&** | アンパサンド。2つの文字列を連結します。 |
| **<** | XがYより小さいかどうかを判断します。 |
| **<=** | XがY以下であるかどうかを返します。 |
| **>** | XがYより大きいかどうかを返します。 |
| **>=** | XがY以上であるかどうかを返します。 |
| **=** | xがyと等しいかどうかを返します。 |
| **!=** | xがyと等しくないかどうかを返します。 |
| **()** | 演算の順序を変更するために使用されます。 |
| **AND** | 2つの論理値が両方ともTRUEであるかどうかを返します。 |
| **OR** | 2つの論理値のいずれかがTRUEであるかどうかを返します。 |
| **NOT** | 値または式を否定します。 |
| **TRUE** | ブールリテラルのTRUEとして解釈されます。 |
| **FALSE**| ブールリテラルのFALSEとして解釈されます。 |
| **NULL** | nullリテラルとして解釈されます。 |

#### **テキスト関数 (Text functions)**
テキスト関数は、文字列データを評価または操作して、テキストの変更、書式設定、抽出などの操作を実行します。

| 関数 | 説明 |
| :--- | :--- |
| **Concat** | 複数の文字列を単一のテキスト値に結合します。 |
| **Contains** | テキスト値内で指定された部分文字列を検索します。部分文字列が見つかった場合は`True`、それ以外は`False`を返します。 |
| **EndsWith** | テキスト値が指定された部分文字列で終わるかどうかを判断します。テキスト値の末尾で部分文字列が見つかった場合は`True`、それ以外は`False`を返します。 |
| **Find** | 文字列内で指定された部分文字列を最初に発見したインデックスを返します。見つからない場合は`0`を返します。 |
| **ILike** | 文字列がパターンに一致する場合に`True`を返します。大文字と小文字を区別しません。 |
| **Left** | 文字列の左側部分（先頭）を、指定された文字数まで返します。 |
| **Len** | スペースを含む、文字列の文字数を返します。 |
| **Like** | 文字列値がパターンに一致する場合に`True`を返します。大文字と小文字を区別します。 |
| **LPad** | 文字列の先頭に文字を追加または削除して、希望の長さに設定します。任意のフィル文字を使用するか、デフォルトで余分なスペースを使用します。 |
| **Lower** | 文字列をすべて小文字に変換します。 |
| **LTrim** | 文字列の先頭のスペースを削除します。 |
| **MD5** | MD5メッセージダイジェストアルゴリズム（ハッシュ関数）のために、文字列のハッシュ値を計算します。 |
| **Mid** | オフセットと長さで定義された、文字列からの部分文字列を返します。`Substring`と同じです。 |
| **Proper** | テキストを適切な大文字小文字（各単語の最初の文字を大文字）に変換します。 |
| **RegexpExtract** | 文字列内で正規表現に一致する部分文字列を返します。 |
| **RegexpMatch** | 文字列が正規表現に一致する場合に`True`を返します。 |
| **RegexpReplace** | パターンに一致する文字列を返し、それを指定された文字列で置き換えます。 |
| **Repeat** | 文字列を指定された回数繰り返した結果を返します。 |
| **Replace** | 指定された文字列のすべてのインスタンスを置換文字列で置き換えます。 |
| **Reverse** | 文字列の文字の順序を逆にします。 |
| **Right** | 文字列の右側部分（末尾）を、指定された文字数まで返します。 |
| **RPad** | 文字列の末尾に文字を追加または削除して、希望の長さに設定します。任意のフィル文字を使用するか、デフォルトで余分なスペースを使用します。 |
| **RTrim** | 文字列の末尾のスペースを削除します。 |
| **SHA256** | テキスト入力を256ビットのハッシュ値に変換します。 |
| **SplitPart** | 区切り文字の各出現位置で文字列を複数の部分に分割し、指定された位置のn番目の部分を返します。 |
| **StartsWith** | 文字列が指定された部分文字列で始まるかどうかを判断します。`True`または`False`を返します。 |
| **Substring** | オフセットと長さで定義された、文字列からの部分文字列を返します。`Mid`と同じです。 |
| **Trim** | 文字列の先頭と末尾の両方のスペースを削除します。 |
| **Upper** | 文字列を大文字（すべて大文字）に変換します。 |

#### **型関数 (Type functions)**
型関数は、値をある[データ型](https://help.sigmacomputing.com/docs/supported-data-types-and-formats)から別のデータ型に変換する型キャストまたは型変換操作を実行します。

| 関数 | 説明 |
| :--- | :--- |
| **Date** | テキストまたは数値をISO日時形式の`date`データ型に変換します。 |
| **JSON** | 値をJSON形式の`variant`データ型に変換します。 |
| **Logical** | 値をブール形式（`true`または`false`）の`logical`データ型に変換します。 |
| **Number** | 値を`number`データ型に変換します。 |
| **Text** | 値を`text`データ型に変換します。 |
| **Variant** | テキスト値を`variant`データ型に変換します。 |

以下の**地理関数**も、値をあるデータ型から別のデータ型に変換します。
| 関数 | 説明 |
| :--- | :--- |
| **Geography** | GeoJSONまたはWKT形式を`geography`データ型に変換します。 |

#### **ウィンドウ関数 (Window functions)**
ウィンドウ関数は、テーブル全体、テーブルのグルーピング（グループ化された行）、または定義された行のウィンドウにわたって操作を実行します。Sigmaは、**累積 (cumulative)**、**移動 (moving)**、**シフト (shifting)**、および**ランキング (ranking)** のウィンドウ関数をサポートしています。

##### **累積ウィンドウ関数 (Cumulative window functions)**
累積ウィンドウ関数は、テーブルまたはグルーピング内の指定された列を評価し、現在行までを含むすべての行の実行合計または累積値を返します。これは、テーブルまたはグルーピング全体のサマリー値を計算する集計値とは異なります。

| 関数 | 説明 |
| :--- | :--- |
| **CumulativeAvg** | 現在行までを含む実行平均を計算します。 |
| **CumulativeCorr**| 従属データ列と独立データ列の間の相関係数を、現在行までを含めて計算します。 |
| **CumulativeCount**| nullでない値の数を、現在行までを含めてカウントします。 |
| **CumeDist** | 現在の行の値に対する値の累積分布を計算します。 |
| **CumulativeMax** | 現在行までを含む最大値を返します。 |
| **CumulativeMin** | 現在行までを含む最小値を返します。 |
| **CumulativeStdDev**| 値の標準偏差を、現在行までを含めて計算します。 |
| **CumulativeSum** | 値の合計を、現在行までを含めて計算します。 |
| **CumulativeVariance**| 列の分散を、現在行までを含めて計算します。 |

##### **移動ウィンドウ関数 (Moving window functions)**
移動ウィンドウ関数は、指定された列を評価し、現在行に関連して移動する定義された行のウィンドウに基づいて値を返します。

| 関数 | 説明 |
| :--- | :--- |
| **MovingAvg** | 移動ウィンドウ内の列の数値平均を計算します。 |
| **MovingCorr**| 移動ウィンドウ内の2つの数値列の相関係数を計算します。 |
| **MovingCount**| 移動ウィンドウ内のnullでない値の数をカウントします。 |
| **MovingMax** | 移動ウィンドウ内の列の最大値を見つけます。 |
| **MovingMin** | 移動ウィンドウ内の列の最小値を見つけます。 |
| **MovingStdDev**| 移動ウィンドウ内の列の標準偏差を計算します。 |
| **MovingSum** | 移動ウィンドウ内の列の合計を計算します。 |
| **MovingVariance**| 移動ウィンドウ内の列の統計的分散を計算します。 |

##### **シフトウィンドウ関数 (Shifting window functions)**
シフトウィンドウ関数は、テーブルまたはグルーピング内の指定された列を評価し、現在行に関連してシフトする行から値を返します。

| 関数 | 説明 |
| :--- | :--- |
| **FillDown** | 列またはグルーピング内のすべての`null`値を、直前のnullでない値で置き換えます。 |
| **First** | 列またはグルーピングの最初の行の値を返します。 |
| **FirstNonNull**| 列またはグルーピングから最初のnullでない値を返します。 |
| **Lag** | 列またはグルーピング内の先行するオフセット行から値を返します。 |
| **Last** | 列またはグルーピングの最後の行の値を返します。 |
| **LastNonNull** | 列またはグルーピングから最後のnullでない値を返します。 |
| **Lead** | 列またはグルーピング内の後続のオフセット行から値を返します。 |
| **Nth** | 列またはグルーピングのn番目の行から値を返します。 |

##### **ランキングウィンドウ関数 (Ranking window functions)**
ランキングウィンドウ関数は、テーブルまたはグルーピング内の指定された列を評価し、各行にランクを割り当てます。

| 関数 | 説明 |
| :--- | :--- |
| **Ntile** | 列の行に、指定されたランクを順に割り当てます。各ランクにほぼ等しい数の行が割り当てられます。 |
| **Rank** | 列内のユニークな値に、ランク1から順にランクを割り当てます。重複する値はスキップします。 |
| **RankDense**| 列内のすべての値に、ランク1から順にランクを割り当てます。重複する値には同じランクを割り当てます。 |
| **RankPercentile**| テーブルの行をパーセンタイルでランク付けします。 |
| **RowNumber** | テーブルの行に、1から始まる番号を付けます。 |
| **VisibilityLimit**| 別のランキング関数によって計算された順序に従って、列に表示される値を指定された値の数に制限します。 |

### 12-3-1. 数式でAIを使用する (Use AI with formulas)

Sigmaの数式アシスタントは、AIを使用して新しい数式を作成したり、数式のエラーを修正したり、ワークブックやデータモデルの要素に適用された既存の数式を説明したりします。これらのAI機能は、生産性と正確性を向上させ、カスタム計算と利用可能な関数を最大限に活用するのに役立ちます。

このドキュメントでは、数式アシスタントを使用して数式を作成、修正、説明する方法について説明します。

> 🚩
> AI機能の使用は、以下の[免責事項](https://help.sigmacomputing.com/docs/ai-feature-disclaimer)の対象となります。

#### **システムとユーザー要件 (System and user requirements)**
数式でAIを使用する機能には、以下が必要です。
* あなたの組織でAIプロバイダーが構成されている必要があります。「[Configure an AI provider](https://help.sigmacomputing.com/docs/configure-an-ai-provider)」を参照してください。
* Azure OpenAIを使用している場合、OpenAI連携で`Embeddings model` (text-embedding-3-small) が構成されている必要があります。
* あなたがワークブックまたはデータモデルの所有者であるか、`Can explore`または`Can edit`のドキュメント権限を付与されている必要があります。
* `Use AI with formulas`権限が有効になっているアカウントタイプを割り当てられている必要があります。「[Account types](https://help.sigmacomputing.com/docs/account-type-and-license-overview)」を参照してください。

#### **AIで数式を作成する (Write a formula with AI)**
数式アシスタントは、計算、データ参照、操作、その他のコンテキストに関するあなたの説明を評価し、希望の出力を達成するための数式を提案します。

1.  ワークブックまたはデータモデルで、更新したい要素の既存の列を選択するか、新しい列を作成して数式バーにアクセスします。
2.  数式バーで、`Formula assistant`をクリックしてメニューを開き、`Write a new formula`を選択します。

<img width="739" height="408" alt="95c5622-image" src="https://github.com/user-attachments/assets/d6fd5574-b262-41e1-9719-9b89a672f874" />

3.  `AI write formula`モーダルで、数式の提案を生成して適用します。
    a. `Description`フィールドに、数式または希望の出力を説明します。
    b. `Write formula`をクリックしてプロンプトを送信します。
    c. `AI response`フィールドで、数式の提案を確認します。
        * 別の数式を生成するには、修正した説明で前のステップ（4aと4b）を繰り返します。
        * 提案された数式を列に適用するには、`Use formula`をクリックします。
<img width="552" height="356" alt="7cd9179-image" src="https://github.com/user-attachments/assets/c76e6b0c-20ff-400e-bfcb-0541df13ea0f" />

 列は、適用された数式の出力を即座に反映します。
<img width="685" height="327" alt="8ce0bfe-image" src="https://github.com/user-attachments/assets/c2acdec8-dd1d-4d1c-861e-2e1606e03f12" />

#### **AIで数式を修正する (Correct a formula with AI)**
Sigmaが数式エラーを検出すると、数式アシスタントは元の数式の意図を解釈し、有効な数式を提案するか、エラーとその修正方法に関する情報を提供します。

1.  更新したい要素で、数式エラーを含む既存の列を選択するか、新しい列を作成して手動で数式を入力します。数式にエラーが含まれている場合、Sigmaは数式バーをオレンジ色の枠でハイライトし、警告アイコン()を表示します。
2.  数式バーで、`Formula assistant`をクリックしてメニューを開き、`Correct this formula`を選択します。

<img width="739" height="408" alt="b6b8d77-image" src="https://github.com/user-attachments/assets/9e04c84d-8f99-440d-a79a-1b640a870e19" />

3.  `AI correct formula`モーダルで、数式アシスタントは有効な数式を提案するか、既存の数式の修正方法を説明します。無効な数式を提案されたものに置き換えるには、`Apply`をクリックします。

<img width="552" height="714" alt="fff47f8-image" src="https://github.com/user-attachments/assets/3503008b-0636-4a24-a47c-7a3c89e105d6" />

 列は、適用された数式の出力を即座に反映します。

<img width="685" height="327" alt="13f26a9-image" src="https://github.com/user-attachments/assets/20f085c5-1619-498a-ae44-8add4081084a" />

#### **AIで数式を説明する (Explain a formula with AI)**
数式アシスタントは、既存の数式を評価し、それが何を達成するかを説明します。詳細には、参照される列、データに適用される変換、および数式の出力に関するその他の情報が含まれます。

1.  説明したい数式を含む要素で、該当する列を選択して数式バーにアクセスします。
2.  数式バーで、`Formula assistant`をクリックしてメニューを開き、`Explain this formula`を選択します。
3.  `AI explain formula`モーダルで、数式アシスタントはAIが生成した説明を表示します。別の説明を表示するには、前のステップを繰り返します。

### 11-3-1. AIクエリを実行する (Perform AI queries)

データウェアハウスに、ジェネレーティブAIモデルを扱うために使用できる一つ以上のSQL関数が含まれている場合、それらのSQL関数をSigmaから実行し、AIクエリを実行できます。

AIクエリを実行すると、クラウドデータウェアハウスからAIモデルを呼び出し、データ内の列に対してそれを実行し、出力をSigmaに返すことができます。

#### **要件 (Requirements)**
* AI関数をサポートするクラウドデータウェアハウスへの接続が設定されている必要があります：
    * Snowflake
    * Databricks
    * Google BigQuery*
    * Amazon Redshift*
* データウェアハウスへの認証に使用されるアカウントには、使用したいAI関数を使用する権限が必要です。
* Sigmaユーザーは、接続に対する少なくとも`Can use`アクセス権を持っている必要があります。
* *モデルの追加構成ステップが必要な場合があります。データウェアハウスのドキュメントを参照してください。*

#### **AIクエリを実行する (Run an AI query)**
AIクエリは、以下の2つの方法のいずれかで実行できます。
* 計算列で`CallVariant`関数を使用してクラウドデータウェアハウスにクエリを実行し、その出力をテーブル列で扱います。
* カスタムSQL要素を使用して、AIクエリでクラウドデータウェアハウスに直接クエリを実行し、その出力をテーブルで扱います。

Sigma組織内のユーザーのためにAIクエリを合理化したい場合は、特定のAIクエリの構文を持つ[カスタム関数](https://help.sigmacomputing.com/docs/intro-to-custom-functions)の作成を検討してください。

お使いのクラウドデータウェアハウスの手順に従ってください。
* [SnowflakeでAIクエリを実行する](#run-an-ai-query-in-snowflake)
* [DatabricksでAIクエリを実行する](#run-an-ai-query-in-databricks)
* [BigQueryでAIクエリを実行する](#run-an-ai-query-in-bigquery)
* [Amazon RedshiftでAIクエリを実行する](#run-an-ai-query-in-amazon-redshift)

##### **SnowflakeでAIクエリを実行する (Run an AI query in Snowflake)**
Snowflakeは、SigmaからAIクエリを実行するために使用できるいくつかの大規模言語モデル（LLM）関数をサポートしています。
例えば、`Call Transcript`列に通話記録があるテーブルがあり、通話のセンチメントを評価したい場合、以下の数式でテーブルに列を追加できます。
`CallNumber("SNOWFLAKE.CORTEX.SENTIMENT", [CALL_TRANSCRIPT])`

別の例として、同じテーブルを使用して、以下の数式でAIモデルに上位3つのトピックを返すよう促すことができます。
`CallVariant("SNOWFLAKE.CORTEX.COMPLETE", "llama2-70b-chat", "return a short, comma-separated list of the top three topics discussed in the call, ignoring any small talk" & [CALL TRANSCRIPT])`

##### **DatabricksでAIクエリを実行する (Run an AI query in Databricks)**
Databricksは、SigmaからAIクエリを実行するために使用できるいくつかのLLM関数をサポートしています。
例えば、ウェブサイト分析データのテーブルがあり、ページタイトル列`Page Title`に基づいてコンテンツのタイプを分類したい場合、以下の数式でテーブルに列を追加できます。
`CallVariant("ai_classify", ([Page Title], CallVariant("ARRAY", ("marketing", "documentation", "API reference")))`

##### **BigQueryでAIクエリを実行する (Run an AI query in BigQuery)**
BigQueryは、`ML.GENERATE_TEXT`などのジェネレーティブAI関数を提供します。
BigQueryでAI関数を使用するには、リモートモデルを構成する必要があります。モデルとUDFを設定した後、SigmaでそのUDFを呼び出すことができます。
例えば、`my_dataset.generate`というUDFを設定した場合、次のようにモデルにプロンプトを出すことができます。
`CallText("my_dataset.generate", "Is this organization in the Fortune 500?", [Call Organization])`

##### **Amazon RedshiftでAIクエリを実行する (Run an AI query in Amazon Redshift)**
Amazon RedshiftでAI関数を使用するには、Amazon SagemakerとRedshiftのユーザー定義関数（UDF）を使用してモデルを作成・構成する必要があります。
モデルを設定した後、Sigmaでそのモデルを呼び出すことができます。例えば、`LLM_extract`というジェネレーティブAIモデルを設定した場合、次のように列から情報を抽出するようモデルにプロンプトを出すことができます。
`CallVariant("your_redshift_db.sagemaker.LLM_extract", "extract logistical details related to in-person meetings" & [Call Transcript])`

### 11-4-1. ワークブックでメトリクスを使用する (Use metrics in a workbook)

メトリクスは、データセットまたは接続テーブルという同じデータソースを共有するワークブックの[データ要素](https://help.sigmacomputing.com/docs/intro-to-element-types)間で再利用できる、カスタムの集計計算です。データソースのレベルでメトリクスを定義し、それらをワークブックに適用して、テーブル、ビジュアライゼーション、ピボットテーブル全体で一貫したメトリックロジックを保証します。

このドキュメントでは、ワークブックでメトリクスを使用して、標準的な計算を簡単かつ効率的に実行する方法について説明します。データモデル、データセット、およびデータベーステーブルにおけるメトリクスの詳細については、「[メトリクスについて](https://help.sigmacomputing.com/docs/about-metrics)」を参照してください。メトリクスを作成または管理するには、「[メトリクスの作成と管理](https://help.sigmacomputing.com/docs/create-and-manage-metrics)」を参照してください。

メトリクスは集計計算であるため、集計されたデータに追加します。
* グループ化されたテーブル
* テーブルのサマリーメトリクス
* ビジュアライゼーション
* ピボットテーブルの値

また、[数式でメトリクスを使用する](#use-a-metric-in-a-calculation-column)こともできます。

#### **要件 (Requirements)**
ワークブックでメトリクスを使用するには、以下のアクセス権が必要です。
* `Full explore`または`Create, edit, and publish workbooks`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* あなたがワークブックの所有者であるか、`Can Explore`または`Can Edit`のワークブック権限を持っている必要があります。

#### **メトリクスの詳細を表示する (View metric details)**
ワークブックでは、`Element properties` > `Metrics`タブでデータ要素の利用可能なメトリクスを表示できます。
任意のメトリクスにカーソルを合わせると、そのタイトル、説明、および数式が表示されます。

メトリクスは要素のデータソースに固有です。定義されたすべてのメトリクスは`Metrics`タブに表示されます。新しいメトリクスを作成するには、「[メトリクスの作成と管理](https://help.sigmacomputing.com/docs/create-and-manage-metrics)」を参照してください。

メトリクスの提案は数式バーにも表示されます。メトリクスの名前を入力し始めると、オートコンプリートの提案が表示されます。利用可能なメトリクスを見つけるには、「metrics」と入力し、利用可能なオプションをスクロールします。メニューをスクロールすると、メトリクスの説明が表示されます。

#### **グループ化されたテーブルにメトリクスを追加する (Add a metric to a grouped table)**
グルーピング内でメトリクスを集計として計算するには：
1.  少なくとも一つの列グルーピングを持つテーブルを選択します。
2.  `Calculations`について、`+` (Add column...) を選択し、メトリクスを選択します。

#### **サマリーバーにメトリクスを追加する (Add a metric to the summary bar)**
テーブル全体の集計としてメトリクスを計算するには：
1.  サマリーバーで、`^`をクリックしてサマリーバーを展開し、`+` (Add summary...) を選択します。
2.  利用可能なメトリクスと列のリストからメトリクス名を選択します。
> 📘
> メトリクスは既に集計されているため、メトリクスに別の集計を追加しないでください。

#### **ビジュアライゼーションにメトリクスを追加する (Add a metric to a visualization)**
ビジュアライゼーションでは、任意の集計計算のようにメトリクスを使用できます。チャートの値軸としてメトリクスを追加したり、ツールチップにメトリクスを追加したりします。チャートによっては、カラースケールなどを指定するためにメトリクスを使用することもできます。

##### **値軸にメトリクスをチャート化する (Chart a metric on the value axis)**
ビジュアライゼーションの値軸（通常はy軸）にメトリクスを追加するには：
1.  軸の名前の隣にある`+` (Add column...) をクリックします。
2.  表示されるメニューの`Metrics`ヘッダーの下で、メトリクスを選択します。

##### **ツールチップにメトリクスを追加する (Add a metric to a tooltip)**
ビジュアライゼーションのツールチップにメトリクスを追加するには、以下の手順に従います。
1.  `Marks`オプションの下で、`Tooltip`タブを選択します。
2.  `Metrics`をクリックします。
3.  リストからメトリクスを選択し、`Select column`エリアにドラッグします。
4.  あるいは、`Select column`エリアのプラスアイコンをクリックし、ドロップダウンメニューからメトリクスを選択します。

#### **ピボットテーブルの値としてメトリクスを追加する (Add a metric as a pivot table value)**
ピボットテーブルでは、`Values`エリアにメトリクスを追加できます。
1.  ピボットテーブルの`Values`セクションで、`+` (Add column...) を選択します。
2.  表示されるメニューの`Metrics`ヘッダーの下で、メトリクスを選択します。

#### **計算列でメトリクスを使用する (Use a metric in a calculation column)**
数式でメトリクスを参照して、計算列で動的な値を生成します。特定のメトリクスを参照するには、`[Metrics/<Metric Name>]`という構文を使用します。

例えば、以下の数式は`Unique Users`という名前のメトリクスを参照します。
`If([Metrics/Unique Users] > 500, "Popular", "Unpopular")`

> 💡
> [動的テキスト](https://help.sigmacomputing.com/docs/dynamic-text)で直接メトリクスを参照することはできませんが、計算列を使用してメトリックの出力を含めることができます。メトリクスを参照する計算列を作成し、その列を動的テキストの数式で参照してください。

### 12-6-1. 再利用可能なカスタム関数を作成する (Create reusable custom functions)

ロジック、集計、およびその他のタイプの操作を組み合わせた、頻繁に使用される複雑な計算を表すために、カスタム関数を定義できます。Sigmaの実践にカスタム関数を追加することには多くの利点があります。
* ロジックを繰り返す代わりに、カスタム関数を使用してビジネスロジックをエンコードします。
* 一般的なビジネスユースケースである複雑な計算をカプセル化し、より簡単に使用できるようにします。
* 独自のウェアハウス関数を公開し、消費可能にします。

#### **要件 (Requirements)**
* カスタム関数を作成および管理するには、`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* 数式を記述するアクセス権を持つユーザーは、組み込みのSigma関数と同じ方法でカスタム関数を使用できます。

#### **制限事項 (Limitations)**
* ワークブックとメトリクス内でカスタム関数を使用できます。
* カスタム関数のすべての引数は必須です。オプションの引数はありません。
* データウェアハウスからのユーザー定義関数（UDF）は、その特定のウェアハウスとスキーマに対してのみ機能します。クロスウェアハウスのサポートはありません。
* 数式、説明、引数、パラメータを含むカスタム関数の定義は、64KB以下でなければなりません。

#### **カスタム関数を作成する (Create custom functions)**
以下の手順は、カスタム関数を作成する方法を説明します。
1.  **Administration**に移動します。
2.  左のナビゲーションタブで**Account**を選択します。
3.  **Account**セクションで、ページの下部までスクロールします。
4.  **Custom functions**ヘッダーの下に、アカウントで以前に定義したすべてのカスタム関数が表示されます。
5.  **Create custom function**セクションで、`Add`をクリックします。
6.  **Add new custom function**ページで、新しい関数を指定します。

<img width="797" height="576" alt="213e6f7-2" src="https://github.com/user-attachments/assets/1163d831-0676-452b-a426-94a457179911" />

| | |
| :--- | :--- |
| **Name** | **必須。**<br>関数に名前を付けます。<br>有効な関数名は、これらのルールに従う必要があります：文字と数字のみを含む、大文字で始まる、他のすべてのカスタムおよび組み込み関数と比較して一意（大文字と小文字を区別しない）、最大128文字長。|
| **Description** | **任意。**<br>関数が何をするかを説明します。<br>複数のデータウェアハウスを常時使用しており、一つ以上のUDFを使用している場合は、UDFのウェアハウスとスキーマを指定します。 |
| **Arguments** | **任意。**<br>引数ごとに`+ Add argument`をクリックして、関数に引数を繰り返し追加します。<br>引数を削除するには、その説明の隣にある`x`をクリックします。<br>各引数について、以下を指定します：Name (必須), Type (必須), Description (任意)。 |
| **Formula** | **必須。**<br>組み込み関数、操作、および定義した引数を使用して、カスタム関数の数式を構築します。|
| **Return type** | 戻り値のデータ型。Sigmaはこのフィールドを自動的に入力します。|
| **Include function in formula bar suggestions** | **任意。**<br>新しいカスタム関数をテストして最終決定した後、スイッチをオンの位置にします。これにより、新しい関数が関連するワークブックの数式バーで提案として表示されるようになります。|

7.  `Save`をクリックします。
保存後、カスタム関数はカスタム関数のリストに表示されます。

<img width="507" height="268" alt="827edf9-4" src="https://github.com/user-attachments/assets/d08191fc-2511-43cb-b925-037667270969" />

#### **カスタム関数を編集する (Edit custom functions)**
既存のカスタム関数を修正するには、以下の手順に従います。
1.  **Custom functions**ページに移動します：`User > Administration > Account > Custom functions`。
2.  編集する予定の関数について、`More`をクリックします。
3.  `Edit`を選択します。
4.  `Update custom function`ダイアログで、必要な変更を加えてから`Save`をクリックします。
    * 引数を削除するには、その説明の隣にある`x`（削除）をクリックします。
    * 関数のシグネチャ（名前、引数の数と型、または数式など）を変更すると、その関数を使用している要素が壊れる可能性があります。

<img width="794" height="649" alt="760d0bc-7" src="https://github.com/user-attachments/assets/65767008-becb-4de8-9f12-8598c01b8558" />

5.  更新されたカスタム関数が、カスタム関数のリストに表示されます。

#### **カスタム関数を非表示にする (Hide custom functions)**
カスタム関数を非表示にして、数式インターフェースで提案として表示されないようにします。関数を非表示にしても、Sigmaインスタンスやアカウントから関数が削除されたり、この関数を使用する要素が壊れたりすることはありません。

関数を非推奨にするための一歩として関数を非表示にすることで、新しい要素やユースケースでの関数の使用を効果的に制限および防止します。

カスタム関数を非表示にするには、以下の手順に従います。
1.  **Custom functions**ページに移動します：`User > Administration > Account > Custom functions`。
2.  非表示にしたい関数について、`More`をクリックします。
3.  `Hide function`を選択します。
4.  カスタム関数のリストで、Sigmaは関数のステータスを`Hidden`に変更します。

`Add custom function`および`Update custom function`インターフェースを使用しているときにも、関数を非表示にできます。

#### **カスタム関数を削除する (Delete custom functions)**
カスタム関数を削除すると、Sigmaインスタンスやアカウントから削除され、この関数を使用する要素が壊れます。

カスタム関数を削除するには、以下の手順に従います。
1.  **Custom functions**ページに移動します：`User > Administration > Account > Custom functions`。
2.  削除する予定の関数について、`More`をクリックします。
3.  `Delete`を選択します。
4.  関数はカスタム関数のリストに表示されなくなります。

#### **カスタム関数の例 (Examples of custom functions)**

##### **Slice: テキスト用のカスタム関数**
この例は、カスタム関数`Slice`を使用してテキストの一部を抽出する方法を示しています。組み込みのSigma関数`Substring`を使用します。

<img width="797" height="609" alt="e4bbeed-12" src="https://github.com/user-attachments/assets/028e8f03-7a97-4cdc-9223-602f0ea3c4a3" />

| 名前 | 説明 |
| :--- | :--- |
| **Slice** | 指定された開始点と終了点で、テキスト文字列のスライスを取得します。|

* **関数の引数:**

| 引数名 | データ型 | 説明 |
| :--- | :--- | :--- |
| text | Text | スライスするテキスト。 |
| start | Number | スライスの開始インデックス。 |
| end | Number | スライスの終了インデックス。 |

* **数式と戻り値の型:**

| 数式 | 戻り値の型 |
| :--- | :--- |
| `Substring([text], [start], [end] - [start] + 1)` | Text |

##### **SplineModel: カスタムウェアハウス関数の複雑な構文をラップする**
データウェアハウスからUDFにアクセスしたい場合、呼び出し構文が正しく、必要なすべての定義がSigmaに移行されることを保証するために、ラッパーとしてカスタム関数を使用することがベストプラクティスです。

そうする場合、特に複数のデータストアを使用している場合は、関数の説明でウェアハウスと関連するスキーマを特定します。これは、関数が名前付きUDFを参照する接続に固有であることを、関数のユーザーに思い出させる役割を果たします。

この例では、組み込みのパススルーSigma関数`CallVariant`を使用して、元のウェアハウス関数から正しいデータ型が取得されることを保証します。

<img width="798" height="608" alt="bd0f5b6-13" src="https://github.com/user-attachments/assets/b3dd9dce-7b55-49bf-9616-5f7621b7b3e2" />


| 名前 | 説明 |
| :--- | :--- |
| **SplineModel** | Snowflake: 入力にスプラインモデルを適用します。<br>(説明はUDFが定義されているウェアハウスを識別します) |

* **関数の引数:**

| 引数名 | データ型 | 説明 |
| :--- | :--- | :--- |
| arg1 | Number | 最初の引数 |
| arg2 | Number | 2番目の引数 |

* **数式と戻り値の型:**

| 数式 | 戻り値の型 |
| :--- | :--- |
| `CallVariant("PRODUCT.SIGMA.SPLINEMODEL", ArrayAgg([arg1]), ArrayAgg([arg2]))` | Variant |

### 13-1-1. 埋め込み分析の概要 (Intro to embedded analytics)

Sigmaは、包括的な分析機能を様々なウェブアプリケーションやワークフローにシームレスに統合できる、柔軟な埋め込みオプションを提供しています。Sigmaのコンテンツと機能をあなた自身の最終ユーザーに直接提供することで、既存システムのユーザーエクスペリエンスを向上させることができます。

#### **埋め込み方法 (Embedding methods)**
Sigmaは、パブリックとセキュアの2つの埋め込み方法をサポートしています。

* **パブリック埋め込み (Public embedding)** は、埋め込まれたコンテンツへのオープンなアクセスを提供し、通常は機密性の低い情報を配布するために使用されます。例えば、オフィスのロビーに設置されたモニターに特定のチャートを表示するために、パブリック埋め込みを利用できます。

* **セキュア埋め込み (Secure embedding)** は、ホストアプリケーションのユーザーセキュリティを実行時に採用する、柔軟なセキュリティオプションを提供します。サーバーサイドAPI（embed API）が、ユーザー詳細やその他のパラメータをSigmaに渡すための一度限りの使用で署名付きURLを生成し、これにより、ユーザーが埋め込みで何を見ることができるか、どのように対話できるかを制御できます。

#### **埋め込みにおける高度なデータセキュリティ (Advanced data security in embeds)**
セキュアな埋め込みを作成する際、埋め込みソリューションがすべてのデータアクセスとセキュリティ要件を満たすように、高度なセキュリティ機能を活用できます。以下のオプションは、既存のシステムとセキュリティ慣行に基づいて、個別または集合的に実装できます。
* 列レベルのセキュリティ
* 行レベルのセキュリティ
* 動的な接続とロールの切り替え
* OAuth

#### **追加の埋め込み構成 (Additional embedding configurations)**
Sigmaの埋め込み分析は、さまざまなユニークな埋め込みユースケースと要件に対応します。以下の機能が、埋め込みユーザーエクスペリエンスを向上させるためにサポートされています。
* JavaScriptのアクションとイベント
* 静的およびレスポンシブデザインソリューション

#### **埋め込み機能のサポート (Embedding feature support)**
埋め込みソリューションは、以下の機能を含む、Sigmaのネイティブアプリケーション機能の多くをサポートしています。
* バージョンタグ付け
* ローカライゼーション
* ブックマーク

### 13-1-2. JWT署名付きセキュア埋め込みURLへの移行 (Migrate to JWT-signed secure embed URLs)

Sigmaをホストアプリケーションにセキュアに埋め込む場合、JSON Web Tokens (JWT)を使用してセキュアな埋め込みURLに署名する必要があります。このドキュメントでは、クライアント資格情報で保護されたセキュア埋め込みURLとJWTで署名されたセキュア埋め込みURLの主な機能の違い、およびJWTで署名されたセキュア埋め込みURLへの移行手順について説明します。

> 🚩
> クライアント資格情報で保護されたURLを持つセキュア埋め込み（以前はユーザーバックエンド埋め込みとして知られていました）は、2025年8月4日をもって非推奨となり、来年初めにサポートが終了します。代わりに、JSON Web Token (JWT)で署名されたセキュア埋め込みURLに移行してください。

JWTで署名されたセキュア埋め込みURLは、クライアント資格情報で保護された埋め込みURLに比べていくつかの改善点があります。
* **簡素化された埋め込み管理:**
    * JWTベースのセキュア埋め込みは、埋め込みを所有する特定のSigmaユーザーではなく、埋め込みAPIキーに関連付けられます。
    * Sigmaにログインする代わりに、埋め込みを直接編集できます。
* **簡素化されたユーザー管理による厳格なセキュリティ:**
    * 既存のSigmaユーザーは、既存のアカウントを使用できます。
    * 自動ユーザー生成を無効にできます。
    * URLからチーム名、アカウントタイプ、ユーザー属性を削除できます。
* **拡張された埋め込み機能:**
    * Ask Sigmaを埋め込むことができます。

#### **主な違い (Key differences)**
JWTを使用するセキュア埋め込みは、クライアント資格情報で保護されたセキュア埋め込みと機能的に非常に似ています。両方とも、パラメータ化されたURLを持つiframeを使用してSigmaからコンテンツを安全に埋め込みますが、いくつかの重要な違いがあります。

| 機能 | クライアント資格情報で保護されたURL | JWTで署名されたURL |
| :--- | :--- | :--- |
| **アクセスに使用されるユーザーアカウント** | 埋め込みアカウント | 埋め込みおよび内部アカウント |
| **埋め込みユーザーの自動生成** | 常にYes | オプションでオフ |
| **埋め込みコンテンツを参照するID** | 埋め込みIDを作成 | ワークブックIDを使用 |
| **埋め込みURLパラメータのサポート** | すべての現在のURLパラメータ | 限定されたURLパラメータセット |
| **埋め込みユーザーによるワークブック編集** | 回避策が必要 | 直接編集をサポート |
| **URL署名** | URL全体が署名される | JWTのみが署名される |
| **埋め込みの管理者管理** | 埋め込み所有者とクライアント資格情報所有者 | クライアント資格情報所有者 |
| **Ask Sigmaの埋め込み** | サポート対象外 | サポート対象 |

#### **JWT署名付きセキュア埋め込みURLへの移行 (Migrate to JWT-signed secure embed URLs)**
クライアント資格情報で保護されたセキュア埋め込みURLからJWTで署名されたセキュア埋め込みURLへ移行するには、いくつかの埋め込みURLパラメータをJWTクレームに置き換え、JWTで署名された新しいURLを生成するためにサーバーサイドAPI関数を更新する必要があります。

JWT署名付きセキュア埋め込みURLへ移行するには、以下を実行します。
1.  既存の埋め込みで使用されているURLパラメータを確認・更新します。
2.  (任意) 埋め込みAPIキーを更新します。
3.  埋め込みURLを生成するサーバーサイドAPI関数を更新します。
4.  以前の埋め込みアーティファクトをテストし、クリーンアップします。

> 💡
> Sigmaの利用状況ダッシュボードへのアクセス権を持つユーザーは、`Embedding`利用状況ダッシュボードで既存の埋め込みURLを特定できます。`Embed Type`が`application - userbacked`のダッシュボードをフィルタリングしてください。


#### **既存のURLパラメータを確認・更新する (Review and update existing URL parameters)**

クライアント資格情報で保護されたセキュア埋め込みURLがほとんどのカスタマイズオプションと設定にURLパラメータを使用するのに対し、JWT署名付きセキュア埋め込みURLはJWTクレームとURLパラメータの組み合わせを使用します。セキュア埋め込みURLを移行するには：

1.  現在使用しているURLパラメータを確認します。
2.  サポートされていない、または置き換える必要があるパラメータを特定します。

JWTで署名されたセキュア埋め込みURLでは、一部のURLパラメータのみがサポートされています。サポートされているURLパラメータの完全なリストについては、「[Embed URL parameters](https://help.sigmacomputing.com/docs/embed-url-parameters)」を参照してください。

サポートされていないURLパラメータについては、以下のリストでオプションを確認してください。

| URLパラメータ | JWTオプション |
| :--- | :--- |
| **hide_run_as_recipient** | 埋め込みユーザーに対して`Run exports as recipient`アカウントタイプ権限を無効にします。 |
| **hide_schedule** | 埋め込みユーザーに対して`Schedule export`アカウントタイプ権限を無効にします。 |
| **hide_send** | 埋め込みユーザーに対して`Download`アカウントタイプ権限を無効にします。 |
| **loading_bg** / **loading_text** | `workbook:loaded` JavaScriptイベントによってトリガーされる、カスタムのローディングページを表示します。実装については、`Embed SDK for React`の使用を検討してください。 |
| **show_footer** | 代わりに`menu_position` URLパラメータを使用してメニューの位置を管理します。 |
| **hide_sheet_interactions**| サポート対象外。 |
| **showUnderlyingData** | サポート対象外。 |
| **use_user_name** | サポート対象外。 |

いくつかのURLパラメータはサポートされていませんが、[JWTクレーム](https://help.sigmacomputing.com/docs/json-web-token-claims-reference)として直接的な同等物があります。

| URLパラメータ | JWTクレーム |
| :--- | :--- |
| **nonce** | `JTI` |
| **eval_connection_id** | `eval_connection_id` |
| **first_name** / **last_name** | `first_name` / `last_name` |
| **account_type** | `account_type` |
| **teams** | `teams` |
| **user_attributes** | `user_attributes` |

JWTで署名されたセキュア埋め込みURLのすべてのURLパラメータは、埋め込みのユーザーに表示されます。そのため、現在設定しているURLパラメータを確認し、エンドユーザーに表示すべきでないものがあるかどうかを判断してください。

> 🚧
> 行レベルのセキュリティ（RLS）のために埋め込みURLでコントロール値を使用している場合は、代わりにユーザー属性を使用し、`user_attributes` JWTクレームを使用して値を管理してください。「[埋め込みコンテンツのデータへのアクセスを制限する](https://help.sigmacomputing.com/docs/restrict-access-to-data-in-embedded-content)」を参照してください。

##### **任意で埋め込みAPIキーを更新する (Optionally update the embed API key)**
JWT署名付きのセキュア埋め込みURLを、非推奨の非JWT署名付きセキュア埋め込みURLとは別に管理したい場合は、JWT署名付きセキュア埋め込みURLの署名に使用する新しい埋め込みAPIキーを作成します。
> 🚩
> このステップは必須ではありません — JWT署名付きセキュア埋め込みURLの署名には、既存の埋め込みAPI資格情報を引き続き使用できます。

新しい埋め込みAPIキーを作成すると、セキュア埋め込みURLをJWTによる署名に移行した後のクリーンアッププロセスも簡素化されます。セキュア埋め込みURLをJWTによる署名に更新した後、古い埋め込みAPIキーを非アクティブ化して、JWTで署名されていないセキュア埋め込みURLへのアクセスを防ぐことができます。

新しい資格情報を作成するには、「[埋め込みクライアント資格情報を生成する](https://help.sigmacomputing.com/docs/generate-embed-client-credentials)」を参照してください。

##### **埋め込みURLを生成するサーバーサイドAPI関数を更新する (Update the server side API function that generates embed URLs)**
移行プロセスの最も重要な部分は、埋め込みURLを生成するために使用するサーバーサイドAPI関数を更新することです。
1.  **URLを更新する (Update the URLs)**
    JWTで署名されたセキュア埋め込みURLは、特定の埋め込みURLの代わりにワークブックURLを使用します。すべてのURLは引き続き`https://app.sigmacomputing.com`で始まりますが、セキュア埋め込みURLを構築するために使用するベースURLの残りの部分は更新する必要があります。

| ワークブックタイプ | 非推奨のURLパス | JWT署名付きURLパス |
| :--- | :--- | :--- |
| **タグなしワークブック** | `/embed/<embedId>` | `/<organizationSlug>/workbook/<workbookId>` |
| **タグ付きワークブック** | `/embed/<embedId>/tag/<tagName>` | `/<organizationSlug>/workbook/<workbookId>/tag/<tagName>` |
| **ワークブックを編集** | `/embed/<embedId>/workbook/<workbookName>-<Id>/edit` | `/<organizationSlug>/workbook/<workbookId>/edit` |

2.  **新しい関数を記述する (Write a new function)**
    JWT埋め込みでは、あなたのコードはパラメータを持つJWTを生成する必要があります。`jose`や`jsonwebtoken`など、パラメータを受け取ってJWTを返すことができるJavaScriptライブラリを使用します。
    UUIDを生成するコードは保持し、その後nonceとクライアント資格情報をJWTジェネレータに渡し、その出力をワークブックURLに追加します。
    > 📘
    > 以前にSigma REST APIエンドポイント`Create an embed for a workbook`を使用してセキュア埋め込み用の埋め込みURLを作成していた場合は、代わりに`List workbooks`エンドポイントを呼び出し、レスポンスの`url`フィールドを使用するようにコードを更新してください。

##### **以前の埋め込みアーティファクトをテストし、クリーンアップする (Test and clean up previous embed artifacts)**
新しいJWT署名付きセキュア埋め込みURLを設定した後、すべてが期待通りに機能することを確認するためにテストします。
新しいセキュア埋め込みURLが希望通りに機能している場合は、以下の手順を実行して、非推奨のセキュア埋め込みURLをシステムから削除することを検討してください。
* 非推奨の埋め込みを削除します。
* セキュア埋め込みの編集を可能にするために「ランディングページ」の回避策を使用していた場合は、その回避策をサポートするために使用していたワークブックを削除します。
* 内部ユーザーが重複した、埋め込み専用のアカウントを使用してセキュア埋め込みにアクセスしていた場合は、その重複アカウントを非アクティブ化します。
* JWT署名付きセキュア埋め込みURL専用に新しいクライアント資格情報を作成した場合は、非推奨のセキュア埋め込みURLの署名に使用していた資格情報を取り消します。

### 13-2-1. パブリック埋め込みの作成と管理 (Create and manage a public embed)

パブリック埋め込みを使用すると、公にアクセス可能なSigmaコンテンツ（ワークブック全体、特定のページ、または個々のチャートやテーブル要素）を共有でき、通常は機密性の低い情報を表示するために使用されます。パブリック埋め込みは、あなたの[CDW](https://help.sigmacomputing.com/docs/connect-to-data-sources)または[DBMS](https://help.sigmacomputing.com/docs/connect-to-data-sources)内のリアルタイムデータに加え、埋め込まれたワークブックで公開された変更を反映します。

このドキュメントでは、パブリック埋め込みアクセスについての概要と、パブリック埋め込みを作成・管理する方法について説明します。

#### **システムとユーザー要件 (System and user requirements)**
パブリック埋め込みを作成・管理する機能には、以下が必要です。
* あなたの組織で[パブリック埋め込みが有効になっている](https://help.sigmacomputing.com/docs/manage-features#enable-or-disable-public-embeds)必要があります。
* あなたは`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。

#### **パブリック埋め込みアクセス (Public embed access)**

##### **誰がパブリック埋め込みにアクセスできますか？ (Who can access a public embed?)**
パブリック埋め込みは、公開URLを持つ誰でも、またはコンテンツが埋め込まれているホストアプリケーションにアクセスできる誰でもアクセス可能です。

##### **ユーザーはパブリック埋め込みでどのデータにアクセスできますか？ (What data can users access in a public embed?)**
埋め込みユーザーは、埋め込まれたコンテンツに表示されるデータのみを閲覧および操作できます。これには、埋め込みに含まれる任意のコントロール要素の値を設定する機能も含まれます。
追加のデータには、必要な[ワークブック権限](https://help.sigmacomputing.com/docs/share-a-workbook)を持つあなたのSigma組織のメンバーのみがアクセスできます。

##### **ユーザーはパブリック埋め込みから何をエクスポートできますか？ (What can users export from a public embed?)**
パブリック埋め込みでは、ユーザーはPNGエクスポートに制限されます。データはExcel、CSV、またはPDFにエクスポートできません。これは、埋め込み内のダウンロードボタンを含む、すべてのエクスポート機能に適用されます。

#### **公開URLを生成する (Generate a public URL)**
ワークブックのコンテンツを埋め込む前に、公開URLを生成する必要があります。その後、このURLを直接リンクとして共有するか、`<iframe>`タグで使用して、Sigma外のアプリケーションにコンテンツを統合できます。

1.  既存のワークブックを開くか、[新しいものを作成](https://help.sigmacomputing.com/docs/create-a-workbook)します。
2.  ワークブックヘッダーで、ワークブックの名前に関連付けられたキャレット()をクリックします。
3.  ワークブックメニューで、`Embedding`を選択します。
4.  `Embed workbook`モーダルで、`Public`タブを選択します。
5.  `Generate public URL for`ドロップダウンで、埋め込みたいコンテンツを選択します。これは、ワークブック全体、特定のページ、または個々のチャートやテーブル要素にすることができます。

<img width="608" height="387" alt="a2295fb7e83e0862c4440f974d31329721a02ddbb4755aef7e0d777c79e13857-public-embed-menu" src="https://github.com/user-attachments/assets/dac8bb47-90d1-44af-b984-dd435377faf5" />

    > 📘
    > モーダルを開くワークブックページを埋め込みたい場合は、ワークブック全体を埋め込む必要があります。
7.  Sigmaはすぐに公開リンクと埋め込みコードを生成します。選択したコンテンツをウェブページとしてユーザーに直接案内するには、公開リンクをコピーして共有します。選択したコンテンツをSigma外のアプリケーション内に統合するには、埋め込みコードをコピーし、「[ホストアプリケーションでパブリック埋め込みを表示する](#display-the-public-embed-in-a-host-application)」で詳細を確認してください。

<img width="585" height="499" alt="c4302f7faf139f3c043305d2a3cbc993d19c2c1a3e54b6368e4a496cbdddaaa6-embed-code-public" src="https://github.com/user-attachments/assets/3c8ead9e-8d4d-46a2-9af5-b319200fa292" />


#### **ホストアプリケーションでパブリック埋め込みを表示する (Display the public embed in a host application)**
HTMLドキュメントで埋め込みコードを使用して、選択したSigmaコンテンツを別のアプリケーションに直接統合します。

1.  HTMLドキュメントに、前のセクション（ステップ5）でコピーした埋め込みコードを貼り付けます。
    **HTMLの例**
    ```html
    <!DOCTYPE html><html lang="en"><head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Sigma Public Embed Sample</title>
        <style>
            body {
                margin: 0;
                height: 100vh;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }
            iframe {
                border: none;
                width: 80%; /* Adjust width as needed */
                height: 80%; /* Adjust height as needed */
                max-width: 1000px; /* Max width limit */
            }
        </style></head><body>
        <h2>Sigma - Public Embed Sample</h2>
        <iframe src="[https://app.sigmacomputing.com/embed/1-3UYrtvMY7HQPQgtIxBizvJ](https://app.sigmacomputing.com/embed/1-3UYrtvMY7HQPQgtIxBizvJ)"></iframe></body></html>
    ```
2.  ブラウザでHTMLドキュメントをプレビューして、埋め込まれたコンテンツが期待通りに表示されることを確認します。

<img width="1297" height="831" alt="4148fd7-image" src="https://github.com/user-attachments/assets/4f256fea-77b4-470c-b03d-47772af52c62" />


#### **公開URLを削除する (Delete a public URL)**
コンテンツが公に共有されるのを防ぐために、公開URLを削除します。
コンテンツが公に共有されるのを防ぐために、公開URLを削除します。このアクションは、対応するワークブックからURLを永久に削除し、それを参照する既存のリンクと埋め込みを壊します。

1.  削除したい埋め込みを含むワークブックを開きます。
2.  ワークブックヘッダーで、ワークブックの名前に関連付けられたキャレット()をクリックします。
3.  ワークブックメニューで、`Embedding`を選択します。
4.  `Embed workbook`モーダルで、`Public`タブを選択します。
5.  削除したい公開URLを探し、`Remove embed`をクリックします。

<img width="585" height="499" alt="c4302f7faf139f3c043305d2a3cbc993d19c2c1a3e54b6368e4a496cbdddaaa6-embed-code-public" src="https://github.com/user-attachments/assets/4f38fbb9-cc72-491e-a4e9-5f4044c3850a" />

6.  Sigmaはすぐに公開URLを削除し、無効化します。
    > 💡
    > 以前に埋め込みコードを使用してSigmaコンテンツを別のアプリケーションに統合した場合は、該当するHTMLドキュメントからそれを削除してください


### 13-3-1. セキュアな埋め込みの作成 (Create a secure embed)

セキュアな埋め込みを使用すると、ユーザーがSigmaを通じて認証する必要なく、Sigmaのコンテンツ（ワークブック全体、特定のページ、または個々のチャートやテーブル要素）を別のアプリケーションに安全に統合できます。セキュアな埋め込みは、実行時にホストアプリケーションのユーザーセキュリティ構成を継承し、Sigmaコンテンツへのアクセスに対する適切なレベルの制御を実装します。

> 🚩
> セキュアな埋め込みはプレミアム機能です。

このドキュメントでは、セキュアな埋め込みを作成するために必要なワークフローの概要を説明します。

#### **要件 (Requirements)**
* あなたは`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられ、管理者から埋め込み資格情報を付与されている必要があります。詳細は、「[埋め込みクライアント資格情報を生成する](https://help.sigmacomputing.com/docs/generate-embed-client-credentials)」を参照してください。
> 📘
> ホストアプリケーションへのアクセス権によっては、サーバーサイドの要件を完了する際にエンジニアリングチームからの支援が必要になる場合があります。

#### **セキュアな埋め込みについて (About secure embedding)**
このドキュメントでは、JSON Web Tokens (JWTs)で署名されたセキュア埋め込みURLを作成するために必要なワークフローの概要を説明します。
* JWTはコンパクトでURLセーフなトークンであり、デジタル署名が可能で、含まれるデータの改ざんが防止されていることを保証します。
* JWT URLは、内部のSigmaユーザーがSigmaアカウントで使用するのと同じメールアドレスで埋め込みコンテンツにアクセスするために認証できます。
* JWT URLを使用すると、Sigmaユーザーでない場合の自動的な埋め込みユーザーアカウントのプロビジョニングを無効にでき、埋め込みコンテンツをSigmaまたはIdPで明示的にプロビジョニングしたユーザーに効果的に制限できます。ユーザーとチームのアクセスの管理方法を選択できます。

##### **認証フロー (Authentication flow)**
この図は、エンドユーザーのブラウザ、クライアントのフロントエンド、クライアントのバックエンド、およびSigma間でアクセスがどのように保護されるかを示しています。

<img width="989" height="492" alt="6f7ec8f50cad3a7a26de9f99fa3682ff1faecfb9cdf922044c0d6f66d7c1898c-Screenshot_2024-08-21_at_9 23 08_AM" src="https://github.com/user-attachments/assets/3cf97dc7-d651-494c-98e2-1f55a17adbbb" />

> 📘
> JWTが発行されると、トークンの一意の識別子である`jti`クレームがサーバーサイドに保存されます。JWTが埋め込まれたSigmaワークブックへのアクセスに使用されると、サーバーは`jti`に渡された値が既に確認済みかどうかをチェックします。もし確認済みであれば、トークンはリプレイ攻撃として拒否され、再利用できないことが保証されます。

#### **セキュアな埋め込みを作成するためのワークフロー (Workflow to create a secure embed)**
各ステップのドキュメントにアクセスするには、以下の手順に従ってください。
1.  **埋め込みクライアント資格情報を生成する。** クライアント資格情報（一意のクライアントIDとクライアントシークレット）は、ホストアプリケーションで埋め込まれたSigmaコンテンツのJWTに署名するために必要です。
2.  **埋め込みコンテンツへのアクセスを管理する。** チームなどを使用して、埋め込みへのユーザーアクセスをどのように管理するかを決定します。
3.  埋め込みたいSigmaコンテンツを指す公開リンクをコピーして、**URLを構築**します。
4.  **Sigmaの埋め込みサンドボックスで埋め込みをテストする。** オプションのインターフェース、セキュリティ、およびユーザー属性クレームを構成およびテストします。
5.  **Sigmaのサービスと対話するための埋め込みAPIを作成する。** このAPIは、ホストアプリケーションとSigma間のリクエストとレスポンスを管理します。詳細は、「[Example embed API via JWT secure method](https://help.sigmacomputing.com/docs/example-embed-api-and-url#example-embed-api-via-jwt-secure-method)」を参照してください。
6.  **APIを実装して、ホストアプリケーションのインターフェースでSigmaコンテンツをレンダリングする。**
> 📘
> 現在非推奨となっている、埋め込み資格情報で署名されたセキュア埋め込みURLの作成に関する詳細は、「[Secure embedding with signed URLs](https://help.sigmacomputing.com/docs/create-and-manage-a-secure-embed-legacy)」を参照してください。

### 13-3-2. 埋め込みクライアント資格情報を生成する (Generate embed client credentials)

クライアント資格情報（一意のクライアントIDと埋め込みシークレット）は、セキュアな埋め込みを作成するために不可欠です。JSONウェブトークン（JWT）は、埋め込みシークレットで生成します。

このドキュメントでは、Sigmaで埋め込みクライアント資格情報を生成する方法について説明します。

#### **システムとユーザー要件 (System and user requirements)**
埋め込みクライアント資格情報を生成する機能には、以下が必要です。
* あなたは`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。

#### **埋め込み資格情報について (About embed credentials)**
Sigmaは、リクエストでどの埋め込みシークレットが参照されているかを判断するためにクライアントIDを使用します。リクエストが行われるたびに、サーバーサイドの埋め込みAPIは埋め込みシークレットを使用してJWTを生成し、Sigmaはそのクライアントシークレットを使用してURL内のJWTを検証します。

クライアントIDと埋め込みシークレットは共に、Sigmaとのサーバーサイドインタラクションのための堅牢なセキュリティフレームワークを作成します。
* **認証 (Authentication):** 資格情報はサーバーを認証し、そのIDをSigmaに検証して、有効なアクセス権を持つ認識され、承認されたエンティティであることを確認します。
* **承認 (Authorization):** 認証に基づいて、Sigmaはリソースへのアクセスを制御し、承認されたエンティティからのリクエストのみをさらに処理することを許可します。
* **データの整合性と否認不可 (Data integrity and non-repudiation):** 埋め込みシークレットでJWTに署名することで、JWTが改ざんされないことが保証され、埋め込みのセキュリティへの信頼が高まります。
* **機密性 (Confidentiality):** サーバーサイドAPIインタラクションで資格情報を使用することで、機密性と不正アクセスまたは操作からの保護を提供することにより、機密データと操作を保護します。

#### **埋め込みクライアント資格情報を生成する (Generate embed client credentials)**
1.  **Administration > Developer Access**に移動します。
    a. Sigmaヘッダーで、ユーザーアバターをクリックしてユーザーメニューを開きます。
    b. `Administration`を選択して管理ポータルを開きます。
    c. サイドパネルで、`Developer Access`を選択します。
2.  `Create New`をクリックして、新しい資格情報を設定します。
3.  `Create client credentials`モーダルで、フォームフィールドを完了します。
    * `Select privileges`セクションで、`Embedding`チェックボックスを選択します。
    * `Name`フィールドに、資格情報を識別するための一意の名前を入力します。
    * [任意] `Description`フィールドに、資格情報の目的についての説明を入力します。
    * `Owner`フィールドで、組織のメンバーを選択します。埋め込みシークレットは、このユーザーに関連付けられたアカウントタイプの権限を使用します。
4.  `Create`をクリックして資格情報を生成します。
5.  `Access Credentials`モーダルで、埋め込みシークレットをコピーし、後で参照できるように安全に保存します（後でSigmaで取得することはできません）。
    * モーダルからクライアントIDをコピーして安全に保存することもできますが、この情報はいつでも`Developer Access`ページから取得できます。

セキュリティ上の目的のため、Sigmaは作成時に埋め込みシークレットを一度だけ表示し、再度表示することはありません。シークレットは取得不可能であるため、作成時に安全に保管することが重要です。

埋め込みシークレットを紛失した場合、またはそれが侵害された場合は、それを取り消して新しいものを生成できます。ただし、これにより以前のシークレットとそれを使用するすべての埋め込みが無効になります。新しいシークレットが生成された場合、埋め込みAPIを修正し、既存のすべての埋め込みを更新する必要があります。

##### **埋め込み資格情報の所有権を割り当てる際のセキュリティルール (Security rules for assigning embed credentials ownership)**
Sigmaは組織の管理者に[他のユーザーになりすます](https://help.sigmacomputing.com/docs/impersonate-users)権限を与えます。同様に、管理者はログインして、別のユーザーまたはアカウントタイプの視点からセキュアな埋め込みを表示できます。

埋め込みクライアント資格情報の所有者は、それらの資格情報が単一のユーザーに使用されるか、他のユーザーを表すアカウントでログインするために使用されるかを決定します。

クライアント資格情報の所有者が管理者である場合、その資格情報はそのSigma組織の任意のユーザーとしてログインするために使用できます。他のユーザーのために有効なJWTを生成するには、Adminアカウントタイプを割り当てられている必要があります。

#### **既存の埋め込みクライアント資格情報を取り消す (Revoke existing embed client credentials)**
埋め込みシークレットを紛失した場合、またはそれが侵害された場合は、それを取り消して新しいものを生成できます。

1.  **Administration > Developer Access**に移動します。
    a. Sigmaヘッダーで、ユーザーアバターをクリックしてユーザーメニューを開きます。
    b. `Administration`を選択して管理ポータルを開きます。
    c. サイドパネルで、`Developer Access`を選択します。
2.  資格情報のリストで、再生成したいものを探し、`More`をクリックして`Revoke`を選択します。
3.  「[埋め込みクライアント資格情報を生成する](#generate-embed-client-credentials)」の手順を完了して、新しい資格情報を生成します。
4.  取り消された資格情報を含む埋め込みAPIを使用しているアプリケーションを更新します。

### 13-3-3. セキュアな埋め込みへのアクセスを管理する (Manage access to a secure embed)

セキュアに埋め込まれたコンテンツに誰がアクセスできるかを管理するには、以下を実行します。
1.  ユーザーの管理方法を選択します。
2.  Sigmaでユーザーを作成します。
3.  チームを作成し、そのチームにユーザーを追加します。
4.  ユーザーにアカウントタイプと権限を割り当てます。
5.  埋め込みコンテンツを持つワークブックへのアクセス権を付与します。

セキュアな埋め込みで使用されるデータへのアクセスを制限するには（行レベルのセキュリティなど）、「[埋め込みコンテンツのデータへのアクセスを制限する](https://help.sigmacomputing.com/docs/restrict-access-to-data-in-embedded-content)」を参照してください。

#### **セキュアな埋め込みでユーザーを管理する方法を選択する (Choose how to manage users in your secure embed)**
埋め込みのユーザーは、自動または手動で管理できます。

* **自動ユーザー管理 (Automatic user management):** ユーザーがセキュアに埋め込まれたコンテンツにアクセスすると、Sigmaはホストアプリケーションへのログインに使用したメールアドレスに基づいて、埋め込みユーザーと呼ばれるユーザーを自動的に作成します。アクセス権を付与された内部ユーザーも、セキュアに埋め込まれたコンテンツにアクセスできます。
* **手動ユーザー管理 (Manual user management):** IDプロバイダー（IdP）を使用するなどして、Sigmaでユーザーを手動でプロビジョニングします。Sigmaでユーザーアカウントを手動で作成するには、[自動埋め込みユーザー作成をオフにします](#turn-off-automatic-embed-user-creation)。

各オプションには異なる考慮事項がありますが、ユーザーを自動的に管理することを選択すると、必要な設定が簡素化され、埋め込みコンテンツへのユーザーアクセスと権限のメンテナンスが削減されます。

| 自動ユーザー管理 | 手動ユーザー管理 |
| :--- | :--- |
| アプリケーションがIdPとして機能 | 既存のIdPまたはOAuthユーザーを再利用 |
| JWTクレームでユーザーを管理 | SigmaまたはIdPでユーザーを管理 |
| メールクレームからユーザーが自動作成される | ユーザーはSigmaに存在する必要がある |

> 🚧
> JWTクレームはセッションではなく、ユーザーに固有のものです。特定のセッションでユーザーが埋め込みで何を表示できるかを管理するために、ユーザー固有のクレーム（チーム、アカウントタイプ、ユーザー属性値など）を使用しないでください。代わりに、ユーザーレベルでアクセスを管理してください。

#### **セキュアな埋め込みへのアクセスを管理するためにユーザーを作成する (Create users to manage access to a secure embed)**
Sigmaでユーザーを作成することにより、セキュアな埋め込みにアクセスできるユーザーを管理します。セキュアな埋め込みでユーザーを管理する方法を選択するに応じて、ユーザーを作成する手順は異なります。
* 埋め込みユーザーの自動作成に依存している場合、セキュアな埋め込みを作成する前にユーザーを作成する必要はありません。ユーザーが作成されるように、チームを作成し、`teams`クレームを含める必要があります。
* 埋め込みにアクセスできるユーザーを手動で管理する場合、ユーザーの作成方法を選択します。
    * Sigmaで使用するIDプロバイダー（IdP）でユーザーをプロビジョニングします。
    * `Create a member` APIエンドポイントからユーザーに招待を送信します。
    * Sigma UIからユーザーに招待を送信します。

##### **自動埋め込みユーザー作成をオフにする (Turn off automatic embed user creation)**
自動ユーザー管理をオフにすると、Sigmaは埋め込みコンテンツにアクセスするすべての人に対して埋め込みユーザーを作成しません。代わりに、内部ユーザーのみがコンテンツにアクセスでき、Sigmaでユーザーを手動でプロビジョニングする必要があります。
> 📘
> 自動埋め込みユーザーアカウントのプロビジョニングを無効にするには、Adminアカウントタイプを割り当てられている必要があります。

自動埋め込みユーザーアカウントのプロビジョニングと更新を無効にするには、以下の手順に従います。
1.  **Administration > Embeds**に移動します。
2.  `Settings`をクリックします。
3.  `Allow automatic embed user creation`トグルをオフにします。
> 🚩
> Sigmaでユーザーアカウントを手動で管理する場合、JWT認証された埋め込みコンテンツにアクセスする必要がある内部ユーザーは、埋め込みコンテンツにアクセスしようとする前に、少なくとも一度はSigmaにログインしていることを確認してください。

#### **ユーザーにアカウントタイプを割り当てる (Assign users an account type)**
埋め込みにアクセスするユーザーがどの機能にアクセスできるかを管理するために、埋め込みにアクセスするユーザーにアカウントタイプを割り当てます。アカウントタイプで有効になっている権限は、エクスポート機能など、特定の機能へのアクセスを管理します。デフォルトのアカウントタイプを使用するか、[カスタムアカウントタイプ](https://help.sigmacomputing.com/docs/create-and-manage-account-types)を作成して割り当てることができます。

デフォルトのアカウントタイプと関連する機能権限の詳細については、「[アカウントタイプとライセンスの概要](https://help.sigmacomputing.com/docs/account-type-and-license-overview)」を参照してください。

埋め込みコンテンツへのアクセスを管理する方法に応じて、異なる方法でユーザーにアカウントタイプを割り当てます。
* 埋め込みユーザーの自動作成に依存している場合、コンテンツにアクセスするすべての人は、`account_type` JWTクレームによって定義された特定のアカウントタイプに割り当てられます。このクレームは、デフォルトまたはカスタムのアカウントタイプを参照できます。クレームでユーザーに割り当てられた値が変更されると、ユーザーのアカウントタイプが更新されます。
    > 📘
    > 埋め込みにアクセスする内部ユーザーは、割り当てられたアカウントタイプを使用します。内部ユーザーには`account_type`クレームを含めないでください。
* 埋め込みにアクセスできるユーザーを手動で管理する場合、ユーザーにアカウントタイプを割り当てます。
    * `Create a member` APIエンドポイントの`memberType`オプションを使用してSigmaでユーザーにアカウントタイプを割り当てるか、Sigma UIで[アカウントタイプを割り当てる](https://help.sigmacomputing.com/docs/manage-members-and-teams#assign-an-account-type)手順に従います。
    * IdPでユーザーにアカウントタイプを割り当てます。「[IdPでカスタムアカウントタイプを使用する](https://help.sigmacomputing.com/docs/configure-saml#use-custom-account-types-with-your-idp)」を参照してください。

#### **アクセスを管理するためのチームを作成する (Create a team to manage access)**
一つ以上のチームを使用して、埋め込みコンテンツへのアクセスをより簡単に管理します。セキュアに埋め込まれたコンテンツを公開する前に、チームを作成します。
1.  埋め込みコンテンツにアクセスするユーザーを管理するためのチームを作成します。`create a team` APIエンドポイントを使用するか、Sigma UIで[チームを作成](https://help.sigmacomputing.com/docs/manage-members-and-teams#create-a-team)できます。
2.  チームを作成した後、ユーザーをチームに割り当てます。
    * 埋め込みユーザーの自動作成に依存している場合、Sigmaはセキュアな埋め込みの`teams` JWTクレームで指定したチームに埋め込みユーザーを自動的に割り当てます。
    > 📘
    > 埋め込みにアクセスする内部ユーザーは、Sigmaで割り当てられているチームを使用します。内部ユーザーには`teams`クレームを含めないでください。
    * 埋め込みにアクセスできるユーザーを手動で管理する場合、作成したチームに内部ユーザーをメンバーとして追加します。
3.  チームを作成し、ユーザーをチームに追加した後、彼らが埋め込みコンテンツにアクセスできることを確認してください。「[ユーザーとチームに埋め込みコンテンツへのアクセス権を付与する](#grant-users-and-teams-access-to-embedded-content)」を参照してください。

#### **ユーザーとチームに埋め込みコンテンツへのアクセス権を付与する (Grant users and teams access to embedded content)**
Sigmaコンテンツをホストアプリケーションに埋め込む場合、そのコンテンツはSigma組織内のワークブックで公開されている必要があります。埋め込みコンテンツ専用のワークブックを作成することも、他の目的で使用される既存のワークブックにコンテンツを埋め込むこともできます。

ユーザーが埋め込みコンテンツにアクセスできるようにするには、一つ以上のチームとワークブックを共有する必要があります。ワークブックの公開バージョン、または特定のタグ付きバージョンを共有できます。

ユーザーとチームに埋め込みコンテンツへのアクセス権を付与するには、以下を実行します。
> 💡
> チームを使用して、埋め込みコンテンツのアクセス管理を簡素化します。ワークスペースや埋め込みワークブックをユーザーと直接共有することは避けてください。

1.  埋め込みコンテンツを持つワークブックを一つ以上のワークスペースまたはフォルダに集めます。
2.  関連するワークスペースを関連するチームと共有します。
    * プログラムで共有するには、`Create or update a grant` APIエンドポイントを使用します。
    * Sigma UIから共有するには、「[フォルダを共有する](https://help.sigmacomputing.com/docs/share-a-folder)」を参照してください。
    > 💡
    > ホストアプリケーションのコンテンツとの異なるインタラクションを制限するために、異なるレベルのアクセス権を付与できます。
3.  埋め込みコンテンツで使用されるデータソースへのアクセス権をチームに付与します。
    * プログラムでアクセス権を付与するには、`Create or update a grant` APIエンドポイントを使用します。
    * Sigma UIを使用するには、「[データまたは接続へのアクセスを管理する](https://help.sigmacomputing.com/docs/manage-access-to-data-and-connections)」を参照してください。

### 13-3-4. JSON Web Tokensを使用して埋め込みAPIを作成する (Create an embed API with JSON Web Tokens)

Sigmaは、[JSON Web Tokens (JWTs)](https://jwt.io/)を使用してセキュアな埋め込みを認証します。JWTは、外部ユーザー（Sigmaに登録済みのアカウントを持たないユーザー）と内部ユーザー（Sigmaアカウントを通じて直接Sigmaにアクセスするユーザー）の両方がアクセスできるコンテンツを埋め込むための安全な方法を提供します。

#### **URLを構成する (Configure your URL)**
埋め込み用のURLを構成するには、ベースURLを構築し、その後で使用したい特定のパラメータとクレームを追加する必要があります。
* [使用するURL](#what-url-to-use)
* JWTクレームを追加する
* URLコントロール値と文字列パラメータを適用する

##### **使用するURL (What URL to use)**
埋め込みには、署名プロセスで提供されるURLパスが必要です。URLの構文は、ワークブック、ページ、単一の要素、またはAsk Sigmaインターフェースのどれを埋め込むかによって異なります。

| | |
| :--- | :--- |
| **ワークブック (Workbook)** | 埋め込む予定のワークブックに移動し、公開モードであることを確認し、構文を変更せずにブラウザから直接URLをコピーします。<br>**API構文:** `https://app.sigmacomputing.com/organization-slug/workbook/workbookName/workbookId`<br>**URL構文:** `https://app.sigmacomputing.com/organization-slug/workbook/workbookName-workbookId` |
| **タグ付きワークブックバージョン (Tagged workbook version)** | ワークブックのタグ付きバージョンについては、URLに`/tag/tagName`を追加します。`/tag/tagName`は、URLの`/workbook/workbookName-workbookUrlId`パスセグメントの後に来る必要があります。<br>**API構文:** `.../workbook/workbookName/workbookId/tag/tagName`<br>**URL構文:** `.../workbook/workbookName-workbookId/tag/tagName` |
| **ページ (Page)** | 目的のワークブックページを選択し、URLをコピーして、サンプル構文に従って編集します。<br>**API構文:** `.../workbook/workbookId/page/pageId`<br>**URL構文:** `.../workbook/workbookName-workbookId/page/pageId` |
| **単一要素 (Single element)** | 目的のワークブック要素を選択し、URLをコピーして、サンプル構文に従って編集します。<br>**API構文:** `.../workbook/workbookId/element/elementId`<br>**URL構文:** `.../workbook/workbookName-workbookId/element/elementId` |
| **Ask Sigma** | URLをコピーし、サンプル構文に従って編集します。<br>**URL構文:** `https://app.sigmacomputing.com/organization-slug/ask`<br>JWTでAsk Sigmaを埋め込む詳細については、「[Embed Ask Sigma](https://help.sigmacomputing.com/docs/embed-ask-sigma)」を参照してください。 |

> 📘
> `/tag/tagName`パラメータは任意ですが、URLの`/workbook/workbookName-workbookUrlId`パスセグメントの後に来る必要があります。**

##### **JWTクレームを追加する (Add your JWT claims)**
URLパラメータの代わりに、JWT署名付きURLはクレームを使用してパラメータを指定します。JWT署名付きURLでパラメータを指定する方法の詳細については、`JWT claims reference`のトピックを参照してください。

##### **クライアント資格情報とシークレットでJWTに署名する (Sign your JWT with client credentials and secret)**
JWTでクライアント資格情報を使用して、埋め込みURLへのアクセスを保護します。
* `kid`クレームにクライアントIDを入力します。
* 希望するコーディング言語に対応するJWTパッケージを使用して、クライアントシークレットを入力します。以下のJavaScriptの例では、`jwt.sign`関数を使用しています。

##### **URLコントロール値と文字列パラメータを適用する (Apply URL control values and string parameters)**
JWT署名付きURLは、URLパラメータを使用したコントロール値の適用をサポートしています。「[URLクエリ文字列パラメータを使用してコントロール値を設定する](https://help.sigmacomputing.com/docs/set-control-values-in-a-url-using-query-string-parameters)」を参照してください。これにより、埋め込まれたワークブックのコントロール値を事前に設定できます。
文字列パラメータの完全なリストについては、「[Embed URL parameters](https://help.sigmacomputing.com/docs/embed-url-parameters)」を参照してください。

#### **JWT署名付きセキュアURLを生成するためのサンプルスクリプト (Example script to generate a JWT-signed secure URL)**
以下のスクリプトは、JWTで署名されたセキュアなURLをプログラムで生成する方法を示しています。
このスクリプトは、いくつかの必須値について環境ファイルを利用しています。本番環境では、これらの値は親アプリケーションによって動的に生成されます。埋め込みクライアントIDとシークレットを生成する手順については、「[埋め込みクライアント資格情報を生成する](https://help.sigmacomputing.com/docs/generate-embed-client-credentials)」を参照してください。

* .env file
Required Embed Configuration
BASE_URL={url path to embed}
CLIENT_ID={your client id}
SECRET={your embed secret}

User-Specific JWT Claims
EMAIL={your embed user's email}
ACCOUNT_TYPE={embed user's account type}
TEAM={embed user's team} 

#### **JWTを使用したサーバーサイドAPIの例 (Example server-side API with JWT)**
`.env`ファイルの値（キーを除く）は、通常、実行時に親アプリケーションによって生成されます。このサンプルスクリプトはJavaScriptで書かれており、`jsonwebtoken`パッケージを使用しています。JWTの構築とクレームの渡し方については、使用するパッケージのドキュメントを参照してください。

```
javascript
const jwt = require('jsonwebtoken');
const { v4: uuid } = require('uuid');
const dotenv = require('dotenv');

dotenv.config();

async function generateSignedUrl() {
    try {
        const time = Math.floor(Date.now() / 1000); // Current Unix timestamp
        const expirationTime = time + Math.min(parseInt(process.env.SESSION_LENGTH) || 3600, 2592000);

        // Convert TEAM into an array if it is a single value
        const teamsArray = process.env.TEAM ? [process.env.TEAM] : [];

        const token = jwt.sign({
            sub: process.env.EMAIL,
            iss: process.env.CLIENT_ID,
            jti: uuid(),
            iat: time,
            exp: expirationTime,
            account_type: process.env.ACCOUNT_TYPE,
            teams: teamsArray,
        }, process.env.SECRET, {
            algorithm: 'HS256',
            kid: process.env.CLIENT_ID
        });

        // Decode the JWT to inspect its content and log it
        const decodedToken = jwt.decode(token, { complete: true });
        console.log('Decoded JWT:', decodedToken); // Log the decoded JWT for debugging
        
        const signedEmbedUrl = `${process.env.BASE_URL}?:jwt=${encodeURIComponent(token)}&:embed=true`;
        // Log important configuration details to ensure they are correctly set
        console.log('BASE_URL:', process.env.BASE_URL);
        console.log('CLIENT_ID:', process.env.CLIENT_ID); // Verify the client ID
        console.log('SESSION_LENGTH:', process.env.SESSION_LENGTH);
        console.log('TEAMS:', teamsArray);
        console.log('ACCOUNT_TYPE:', process.env.ACCOUNT_TYPE);
        console.log('Signed Embed URL:', signedEmbedUrl);

        return signedEmbedUrl;
    } catch (error) {
        console.error("Failed to generate JWT:", error);
        throw new Error("JWT generation failed");
    }
}

module.exports = { generateSignedUrl };
```


結果として得られるsignedUrlは、次の構造に従います。
https://app.sigmacomputing.com/{organization-slug}/workbook/{workbook_id}?:jwt={JWT VALUE}&:embed=true

Sigmaを埋め込む際のJWTの使用に関する詳細な説明とデモンストレーションについては、「QuickStart: Secure Embedding with JWT」を参照してください。

### 13-3-5. JSONウェブトークンクレームのリファレンス (JSON web token claims reference)

[セキュアな埋め込みを作成する](https://help.sigmacomputing.com/docs/create-a-secure-embed)際、JWTの構築でこれらのクレームを使用して、埋め込みURLに情報を渡します。

> 🚧
> JWTクレームはセッションではなく、**ユーザーに固有**のものです。特定の**セッション**でユーザーが埋め込みで何を表示できるかを管理するために、ユーザー固有のクレーム（チーム、アカウントタイプ、ユーザー属性値など）を使用しないでください。代わりに、ユーザーレベルでアクセスを管理してください。各ユーザーは、正しいアクセスレベルと権限で埋め込みにアクセスするために、独自のアカウントを持っている必要があります。異なるセキュアな埋め込み間で、同じ埋め込みユーザーに対して一貫したクレーム値を使用してください。

| クレーム名 | 必須か？ | クレームの説明 | タイプ |
| :--- | :--- | :--- | :--- |
| **sub** | **必須** | ログインするユーザーのメールアドレス。メールアドレスは[RFC-1035](https://www.rfc-editor.org/rfc/rfc1035)に準拠し、空白やアンダースコアなどのサポートされていない文字を含んではいけません。 | string |
| **jti** | **必須** | JWT ID。セッションに関連付けられた一意のID。 | string |
| **iat** | **必須** | 発行時刻。エポックからの秒数として。 | number |
| **exp** | **必須** | 有効期限時刻。エポックからの秒数として。30日を超えることはできません。 | number |
| **alg** | 任意 | `HS256`でなければなりません。含める場合は、ヘッダー内にある必要があります。 | string |
| **kid** | **必須** | 埋め込みクライアントID。ヘッダー内にある必要があります。 | string |
| **iss** | 任意 | 発行者キー。埋め込みクライアントIDを入力します。 | string |
| **oauth_token** | 任意 | `ver: "1.1"`でのみ使用できます。<br>組織レベルのOAuth接続を使用する際のOAuthトークン。このトークンは埋め込みシークレットで暗号化する必要があります。 | string |
| **connection_oauth_tokens** | 任意 | `ver: "1.1"`でのみ使用できます。<br>キーは目的の接続IDで、値は埋め込みユーザーがその接続のデータにアクセスするために使用する暗号化されたOAuthトークンです。 | Record<string,string> |
| **eval_connection_id** | 任意 | ワークブックが関連付けられている接続の代わりに使用する接続。<br>書き戻し機能を使用する場合、接続の切り替えは適用されません。 | string |
| **first_name** | 任意、埋め込みユーザーにのみ影響 | 埋め込みユーザーの名。 | string |
| **last_name** | 任意、埋め込みユーザーにのみ影響 | 埋め込みユーザーの姓。 | string |
| **user_attributes** | 任意、埋め込みユーザーにのみ影響 | 埋め込みユーザーのユーザー属性。`{"attribute1":"value1","attribute2":"value2"}`の形式で複数の属性を渡します。 | Record<string,string> |
| **account_type** | 任意、埋め込みユーザーにのみ影響 | 埋め込みユーザーのアカウントタイプ。アカウントタイプを指定しない場合、Sigmaはセキュアな埋め込みを通じて作成された埋め込みユーザーに値を割り当てる際に、最も高いアカウントタイプをデフォルトとします。<br>埋め込みにアクセスする内部ユーザーは、割り当てられたアカウントタイプを使用します。内部ユーザーには`account_type`クレームを含めないでください。 | string |
| **teams** | 任意、埋め込みユーザーにのみ影響 | 埋め込みユーザーが所属するチーム。`["team1", "team2"]`の形式で複数のチームを渡します。<br>埋め込みにアクセスする内部ユーザーは、Sigmaで割り当てられているチームを使用します。内部ユーザーには`teams`クレームを含めないでください。 | string[] |
| **ver** | 任意 | JWTのバージョン番号。受け入れられる値は`"1.0"`または`"1.1"`のみです。何も提供されない場合は`"1.0"`が想定されます。 | string |
| **aud** | `ver: "1.0"`では任意、`ver: "1.1"`では**必須** | オーディエンスクレーム。`ver: "1.1"`を使用する場合は`sigmacomputing`でなければなりません。`ver: "1.0"`を使用する場合は無視されます。 | string |

### 13-3-6. 埋め込みURLパラメータ (Embed URL parameters)

セキュアな埋め込みを作成する際、セキュアな埋め込みの[JWTクレーム](https://help.sigmacomputing.com/docs/json-web-token-claims-reference)によって提供されるものに加えて、URLクエリ文字列パラメータを使用して追加機能をカスタマイズできます。

JWT署名付きURLでは、以下のクエリ文字列パラメータがサポートされています。
* hide_bookmarks
* hide_folder_navigation
* hide_menu
* lng および lng_variant
* menu_position
* responsive_height
* theme

> 📘
> クライアント資格情報で保護されたセキュア埋め込みURLで利用可能なURLパラメータの詳細については、「[セキュアな埋め込みにURLパラメータを追加する](https://help.sigmacomputing.com/docs/create-and-manage-a-secure-embed-legacy#add-url-parameters-to-a-secure-embed)」を参照してください。

また、クエリ文字列パラメータを使用してコントロール値を設定することもでき、特定のコントロール値が指定された状態でセキュアな埋め込みがロードされるようにします。「[URLクエリ文字列パラメータを使用してコントロール値を設定する](https://help.sigmacomputing.com/docs/set-control-values-in-a-url-using-query-string-parameters)」を参照してください。

#### **使用上の注意 (Usage notes)**
クエリ文字列パラメータは、URLパスの末尾に適用されます。最初のパラメータは疑問符(?)に続き、追加のパラメータはアンパサンド(&)の後に追加されます。
埋め込みURLで提供する値は、URLエンコードされている必要があります。詳細は、「[パラメータのURLエンコーディングリファレンス](https://help.sigmacomputing.com/docs/embed-url-parameters#url-encoding-reference-for-parameters)」を参照してください。

> 📘
> パラメータに複数の値が含まれる場合、値を区切るカンマはエンコードしないでください。URLでは、パラメータの値は`value1%2Cvalue2`ではなく`value1,value2`としてSigmaに渡されるべきです。

#### **利用可能なインターフェースパラメータ (Available interface parameters)**

| パラメータ | 説明 |
| :--- | :--- |
| **hide_bookmarks** | `true`に設定すると、埋め込みメニューから保存済みビューを非表示にします。 |
| **hide_folder_navigation** | `true`に設定すると、フォルダナビゲーションを非表示にします。 |
| **hide_menu** | `true`に設定すると、保存済みワークブックの埋め込みメニューを非表示にします。`menu_position`と共に使用する必要があり、`menu_position`が`top`または`bottom`に設定されている場合にのみ適用されます。 |
| **hide_tooltip** | `true`に設定すると、チャートマークのツールチップを非表示にします。 |
| **lng** | 埋め込みにSigmaテキスト用に使用する言語を設定します。そのロケールに[翻訳ファイルが定義されている](https://help.sigmacomputing.com/docs/manage-workbook-localization)場合、ワークブック内のカスタムテキストに定義された翻訳を適用します。 |
| **lng_variant** | [カスタム翻訳ファイル](https://help.sigmacomputing.com/docs/manage-workbook-localization#add-a-custom-translation-for-a-language)から定義された翻訳を埋め込みに適用します。`lng`と共に使用する必要があります。 |
| **menu_position** | ツールバーの位置（`top`, `bottom`）を変更するか、削除します（`none`）。値が指定されていない場合、デフォルトは`none`です。 |
| **responsive_height** | `true`に設定すると、`workbook:pageheight:onchange`と呼ばれるJavaScriptイベントへの開発者アクセスを有効にします。 |
| **theme** | [ワークブックテーマ](https://help.sigmacomputing.com/docs/workbook-themes)を名前で適用します（大文字と小文字を区別）。デフォルトのワークブックテーマ（`Light`, `Dark`, `Surface`）または組織で定義された任意のカスタムテーマを指定します。 |

この表にリストされていないパラメータは、JWTクレーム、アカウントタイプの権限として利用可能であるか、またはサポートされていません。
> 💡
> `responsive_height`パラメータとレスポンシブな埋め込みの実装に関する詳細は、「Embedding 10: Responsive Embeds」Sigma QuickStartのレスポンシブiframeに関するセクションを参照してください。

### 13-3-7. パラメータのURLエンコーディングリファレンス (URL encoding reference for parameters)

[埋め込みをカスタマイズする](https://help.sigmacomputing.com/docs/intro-to-embedded-analytics)ためや、[URLでコントロール値を設定する](https://help.sigmacomputing.com/docs/set-control-values-in-a-url-using-query-string-parameters)ためにURLにクエリ文字列パラメータを追加する際、URLが正しく機能するように非ASCII文字をエンコードする必要があります。

インターネットアドレスはASCII文字形式でなければなりません。URLでコントロール値や埋め込みパラメータ値（メールアドレスなど）を設定する場合、非ASCII文字（`@`など）は、そのUTF-8エンコードされた同等物に置き換える必要があります。UTF-8はHTMLのデフォルトの文字セットです。

プログラムでクエリ文字列パラメータを持つURLを生成する場合、URLに追加する前にパラメータの値をエンコードするためにURLセーフな関数を使用できます。
* **JavaScriptの場合、** JavaScript関数`encodeURIComponent`を使用します。
* **Pythonの場合、** Pythonメソッド`urllib.parse.urlencode()`を使用します。

コードを使用してURLを生成しない場合は、この一般的なパーセントエンコーディングのリファレンスページを使用して、正しくフォーマットされ、エンコードされたURLを手動で構築します。ここにリストされていない文字をエンコードしたい場合は、ウェブで詳細を検索してください。

#### **句読点コード (Punctuation codes)**
この表は、URLでエンコードする必要がある可能性のある一般的な句読点記号をリストしています。

| 文字 | 名前 | URLエンコーディング構文 |
| :--- | :--- | :--- |
| (space) | space | `%20` |
| # | pound sign, hashtag, octothorpe | `%23` |
| % | percent sign | `%25` |
| ' | apostrophe | `%27` |
| - | hyphen | `%2B` |
| , | comma | `%2C` |
| . | period | `%2E` |
| : | colon | `%3A` |
| = | equals sign | `%3D` |
| ? | question mark | `%3F` |
| @ | at sign | `%40` |
| _ | underscore | `%5F` |

#### **通貨 (Currency)**
この表は、URLでエンコードする必要がある可能性のある一般的な通貨記号をリストしています。

| 文字 | 名前 | URLエンコーディング構文 |
| :--- | :--- | :--- |
| ¢ | cent | `%C2%A2` |
| $ | Dollar | `%24` |
| € | Euro | `%20%82%AC` |
| £ | Pound | `%C2%A3` |
| ¥ | Yen | `%C2%A5` |

### 13-3-8. 埋め込みサンドボックスで埋め込みURLをテストする (Test an embed URL in the embed sandbox)

Sigmaの埋め込みサンドボックス環境を使用すると、コンテンツをホストアプリケーションに統合する前に、埋め込みをテストできます。セキュリティ設定やその他の構成を確認するために、埋め込みユーザーの視点からコンテンツを表示します。

このドキュメントでは、セキュアな埋め込みを開発およびテストするために、埋め込みサンドボックスにアクセスして使用する方法について説明します。

#### **システムとユーザー要件 (System and user requirements)**
* 組織でセキュアな埋め込みが有効になっている必要があります。
* あなたは`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられているか、管理者から埋め込み資格情報を付与されている必要があります。詳細は、「[埋め込みクライアント資格情報を生成する](https://help.sigmacomputing.com/docs/generate-embed-client-credentials)」を参照してください。

#### **埋め込みサンドボックスにアクセスする (Access the embed sandbox)**
1.  埋め込みたいコンテンツを含むワークブックを開きます。
2.  ワークブックヘッダーで、ワークブックの名前に関連付けられたキャレット()をクリックします。
3.  ワークブックメニューで、`Embedding`を選択します。
4.  `Embed workbook`モーダルで、適切なタブを選択します。
    * セキュアな埋め込みにJSON Web Tokensを使用している場合は`JWT`を選択します。
    * JSON Web Tokensを使用していない場合、またはアプリケーション埋め込み（非推奨）を使用している場合は`Secure`を選択します。
5.  テストしたいコンテンツを探し、`Test`をクリックして埋め込みサンドボックスを開きます。

#### **埋め込みサンドボックスで埋め込みを構成する (Configure the embed in the embed sandbox)**
`Embed Sandbox`ページで、`Configure embed`パネルの埋め込み詳細を構成します。

1.  `Embed path`または`Workbook path`フィールドは、前の手順で参照したパスに基づいて自動入力されます。別の埋め込みをテストするには、希望のパスを入力します。
2.  `Client credentials`フィールドで、該当するクライアント資格情報の名前を選択します。
3.  `Configure embed`パネルの`Configuration`セクションでパラメータを設定します。
    * [任意] `Controls`フィールドに、埋め込みに渡すすべてのコントロールIDと値のペアを入力します。
    * [任意] `Theme`フィールドで、組織に保存されているデフォルトまたはカスタムのワークブックテーマを選択します。
    * [任意] `Menu position`フィールドで、埋め込みメニューの位置を選択します。
4.  `Mode`フィールドは、前の手順での選択に基づいて事前入力されます。
5.  `Configure embed`パネルの`Options for selected mode`セクションでパラメータを設定します。
    * **`Secure`モードの場合:**
        * `Email`フィールドに、埋め込みユーザーのアカウントに関連付けられたメールアドレスを入力します。
        * `Embed user teams`フィールドで、その権限を継承する保存済みのSigmaチームを選択します。
        * `Account type`フィールドで、利用可能なデフォルトまたはカスタムのアカウントタイプを選択します。
        * [任意] `User attributes`フィールドに、埋め込みに渡すすべてのユーザー属性と値を入力します。
        * [任意] `Hide folder navigation`トグルをオンにして、埋め込みメニューのフォルダナビゲーションを非表示にします。
        * [任意] `Hide run as recipient`トグルをオンにして、`Send Now`および`Schedule Exports`モーダルの`Run queries as recipient`オプションを非表示にします。
    * **`JWT`モードの場合:**
        * **`JWT`モードの場合、これらのオプションを構成します。**
    これらのオプションは、`Admin`アカウントタイプを持っている場合にのみ表示されます。`Admin`アカウントタイプを持っていない場合、自分自身としてのみ埋め込みをテストできます。
    * **[任意] Email:** 埋め込みにログインするために使用したいユーザーのメールを入力します。デフォルトでは、このフィールドにはSigmaへのログインに使用するメールアドレスが設定されています。
    * **[任意] Assign new teams:** このワークブックを表示する権限を持つチームにユーザーを割り当てたい場合は、トグルをオンにします。このフィールドは外部ユーザーにのみ適用されます。
    * **[任意] Assign new account type:** ユーザーをアカウントタイプに割り当てたい場合は、トグルをオンにします。このフィールドは外部ユーザーにのみ適用されます。
    * **[任意] Assign new user attributes:** 埋め込みに渡すすべてのユーザー属性と値を入力します。

6.  `Configure embed`パネルの`Advanced options`セクションでパラメータを設定します。
    * **[任意] Other parameters:** 埋め込みで構成したい追加のパラメータのキーと値のペアをすべて入力します。
    * **Session length:** 埋め込みURLのブラウザセッションの有効期間（秒単位）を入力します。
    * **External user ID:** 埋め込みを使用する各個人の一意の識別子を入力します。これは、モードが`Secure`に設定されている場合にのみ適用されます。
    * **[任意] Version tag:** 埋め込みコンテンツをレンダリングする際に使用するバージョンタグの名前を入力します。
    * **[任意] Hide tooltips:** チャートマークのツールチップを非表示にするにはトグルをオンに、表示するにはオフにします。
    * **[任意] Disable mobile view:** モバイルビューを無効にするにはトグルをオンに、有効にするにはオフにします。
7.  `Load embed`をクリックして、構成された埋め込みをテストします。
8.  必要に応じて構成を調整し、再度`Load embed`をクリックして変更をレンダリングします。
> 💡
> サンドボックスにページへのアクセス権がないことを示すメッセージが表示される場合は、`Embed user teams`または`Assign new teams`セクションで選択したチームとワークブックが共有されていることを確認してください。

#### **Sigma外で埋め込みをテストする (Test the embed outside of Sigma)**
埋め込みサンドボックスは、Sigma外での検査および追加テスト用のURLを生成できます。

1.  埋め込みをロードした後、`Configure embed`パネルのフッターに`View URL`機能が表示されます。このオプションをクリックして、構成されたパラメータで埋め込みURLを生成します。
2.  ブラウザまたはアプリケーションコードでテストするための一度限りの使用URLを生成するには、`Usable URL`をクリックします。URLは自動的にクリップボードにコピーされます。

### 13-3-9. 一般的な埋め込みのエラーコードとメッセージ (Common embed error codes and messages)

セキュアな埋め込みでエラーが発生すると、アウトバウンドの`workbook:error`イベントが発行されます。ホストアプリケーションが発行されたワークブックエラーイベントをリッスンするように構成し、エラーコードに応じて一つ以上のカスタムエラーメッセージを表示することができます。

このドキュメントでは、セキュアな埋め込みから発行される可能性のあるエラーコードをリストしており、これを使用してエラーの根本原因をトラブルシューティングし、ホストアプリケーションのコードにカスタムハンドリングを追加することができます。

> 📘
> クライアント資格情報で保護されたセキュア埋め込みURLに関連するエラーメッセージについては、「[Secure embed error code reference](https://help.sigmacomputing.com/docs/secure-embed-error-code-reference-legacy)」を参照してください。

#### **一般的なエラーコード (General error codes)**
これらのエラーコードは、ユーザーが埋め込みコンテンツと対話している間に発行される可能性があります。

| エラーコード | 説明 | 考えられる原因 |
| :--- | :--- | :--- |
| **EEXIST** | 重複レコードが検出されました。 | ユーザーまたはチームが既に存在します。 |
| **EPERM** | 要求された操作は許可されていません。 | ユーザーがSigmaに存在せず、自動ユーザー作成が無効になっています。 |
| **ESTALE** | 古いオブジェクトです。 | ワークブックのページまたは要素が削除またはアーカイブされたか、埋め込みコンテンツで使用されている接続がアーカイブされた可能性があります。 |
| **ENOENT** | オブジェクトが存在しません。 | ワークブックが見つからないか、埋め込みユーザーが無効化されています。 |
| **EACCES** | 権限が拒否されました。 | 埋め込まれたワークブックがユーザーと共有されていないか、もはや共有されていない、またはユーザーに割り当てられたアカウントタイプで必要な権限が有効になっていません。 |
| **EINVAL** | 無効な引数です。 | 埋め込みURLに存在しないURLパラメータが含まれている、URLの形式が正しくない、またはJWTが期限切れです。 |
| **ETIMEDOUT**| リクエストがタイムアウトしました。 | エクスポートリクエストを含む、ウェアハウスに送信されたクエリがタイムアウトしました。ウェアハウスが過負荷です。 |
| **NETWORK** | Sigmaに接続できません。 | ローカルネットワークが利用できないか、ファイアウォールまたはブラウザ拡張機能がSigmaへのアクセスを妨げています。 |
| **UNKNOWN** | 他のすべてのエラーに対するデフォルトのAPIエラーメッセージ。| 何か他のエラーです。 |

#### **その他のエラーメッセージ (Other error messages)**
一部のエラーメッセージはコードを返さず、ユーザーにメッセージを表示します。

| エラーメッセージ | 原因 | 次のステップ |
| :--- | :--- | :--- |
| **Session expired. Reload the page.** | セッション長を超えました。 | このエラーを避けるために、コードにタイマーを使用して、`exp` JWTクレームで指定されたセッション長に達する前に、ユーザーに更新オプションを表示するか、埋め込みを自動更新することを検討してください。 |
| **You don't have permission to access this page.** | 無効なclientID、またはその他の原因。 | クライアントIDが埋め込みに正しく渡され、アクティブであることを確認してください。<br>ユーザーまたはチームがSigmaの埋め込みコンテンツへのアクセスを許可されていることを確認してください。<br>ユーザーがSigmaでアクティブであることを確認してください。 |
| **You don't have permission to access this page. Cannot update account type for internal users.** | 内部ユーザーはJWT URLのオプションのクレームを更新できません。 | JWT URLを生成するクライアントサイドAPIを修正して、`first_name`, `last_name`, `user_attributes`, `teams`, `account_type`などのオプションのクレームを渡さないようにしてください。 |
| **You don't have permission to access this page. Invalid sub field in payload.** | JWTの`sub`クレームのメールアドレスが無効です。 | クレームに入力されたメールアドレスが正しく、空白やアンダースコアなどのサポートされていない文字を含んでいないことを確認してください。 |


### 13-4-1. 埋め込みコンテンツのデータへのアクセスを制限する (Restrict access to data in embedded content)

Sigmaは、埋め込みコンテンツで使用されるデータへのアクセスを保護および管理するための多くのオプションを提供しています。

* OAuthまたはユーザー属性を使用して、接続されたデータプラットフォームで定義されたロールベースのアクセス制御（RBAC）を使用します。
* Sigmaの[列レベルのセキュリティ（CLS）](https://help.sigmacomputing.com/docs/column-level-security)を使用して、特定のユーザーまたはチームからの列を制限します。
* Sigmaの[行レベルのセキュリティ（RLS）](https://help.sigmacomputing.com/docs/set-up-row-level-security)を使用して、特定のユーザーまたはチームからの特定のデータ行を制限します。

これらのメソッドはいずれも埋め込みコンテンツに固有のものではありませんが、セキュアな埋め込みでデータへのアクセスを制限するために使用できます。

データアクセスを制限するために値を割り当てる方法は、[埋め込みへのアクセスを管理する方法](https://help.sigmacomputing.com/docs/manage-embed-users)によって異なります。
* 埋め込みユーザーの自動作成に依存している場合、JWTクレームを使用して埋め込みユーザーのユーザー属性値とチームを設定するか、埋め込みユーザーのチームにユーザー属性値を事前に割り当てることができます。
* 埋め込みにアクセスできるユーザーを手動で管理する場合、Sigmaでユーザー属性値をチームに割り当てます。

> 🚧
> JWTクレームはセッションではなく、ユーザーに固有のものです。特定のセッションでユーザーが埋め込みで何を表示できるかを管理するために、ユーザー固有のクレーム（チーム、アカウントタイプ、ユーザー属性値など）を使用しないでください。代わりに、ユーザーレベルでアクセスを管理してください。各ユーザーは、正しいアクセスレベルと権限で埋め込みにアクセスするために、独自のアカウントを持っている必要があります。異なるセキュアな埋め込み間で、同じ埋め込みユーザーに対して一貫したクレーム値を使用してください。

#### **データプラットフォームでロールベースのアクセス制御を使用する (Use role-based access control in your data platform)**
データプラットフォームで定義されたロールベースのアクセス制御（RBAC）を使用して、セキュアに埋め込まれたコンテンツのデータへのアクセスを管理できます。埋め込みでRBACを強制するには、以下の2つの方法のいずれかを使用します。
* OAuth
* ユーザー属性でロールを動的に割り当てる

> 📘
> [バージョンタグを使用して使用される接続を交換する](https://help.sigmacomputing.com/docs/add-version-tags#swap-the-source-of-a-tagged-workbook-version)（推奨）か、JWTクレームを使用して接続を交換するために「Embedding 14: Connection Swapping」の手順に従うことで、埋め込みコンテンツに使用するデータソースをある接続から別の接続に交換することもできます。

##### **セキュアな埋め込みにOAuthを使用する (Use OAuth for your secure embed)**
セキュアな埋め込みURLでOAuthトークンを渡して、埋め込みのユーザーを認証できます。
* Sigmaへの認証とデータプラットフォームへの認証の両方にOAuthを使用する場合、`oauth_token`クレームを使用します。
* Sigmaからデータプラットフォームへの認証にのみOAuthを使用する場合、`connection_oauth_tokens`を使用します。
> 🚩
> `oauth_token`または`connection_oauth_tokens`クレームは暗号化する必要があります。「[JSON web token claims reference](https://help.sigmacomputing.com/docs/json-web-token-claims-reference)」を参照してください。

##### **ユーザー属性でデータプラットフォームのロールを動的に割り当てる (Dynamically assign data platform roles with a user attribute)**
> 📘
> この機能は、すべてのデータプラットフォーム接続でサポートされているわけではありません。

キーペア認証とサポートされている接続を使用する場合、ユーザー属性を使用して、セキュアな埋め込みにアクセスするユーザーが使用するロールを指定できます。「[接続で使用されるロールを動的に割り当てる](https://help.sigmacomputing.com/docs/dynamically-assign-roles-used-by-a-connection)」を参照してください。
> 📘
> OAuthを使用して接続する場合、Snowflakeでこの機能を使用することはできません。

このアプローチは、例えば、各顧客のデータが同じデータベース内の別のスキーマに保存されており、データプラットフォームで行アクセスまたはセキュリティポリシーを使用して、各顧客が自分のデータにのみアクセスできるようにする場合に使用します。

ユーザー属性値に基づいてデータプラットフォームのロールを動的に割り当てるには、以下を実行します。
1.  [ユーザー属性を構成する](https://help.sigmacomputing.com/docs/user-attributes)手順に従います。データプラットフォームの各ロールに相当する値を持つ`Role`ユーザー属性を作成します。
2.  「[接続で使用されるロールを動的に割り当てる](https://help.sigmacomputing.com/docs/dynamically-assign-roles-used-by-a-connection)」の手順に従います。ステップ1で構成したユーザー属性を選択します。
3.  [埋め込みへのアクセスを管理する方法](https://help.sigmacomputing.com/docs/manage-embed-users)に応じて、ユーザーまたはチームにユーザー属性を割り当てます。
    * 埋め込みユーザーの自動作成に依存している場合、サーバーサイドの埋め込みAPIコードに`user_attributes` JWTクレームを追加し、`Role`ユーザー属性を参照するか、埋め込みユーザーを管理するために使用するチームに`Role`ユーザー属性を割り当てます。
    * 埋め込みにアクセスできるユーザーを手動で管理する場合、Sigmaでプロビジョニングされたユーザーを含む関連チームに関連するユーザー属性値を割り当てます。
  
##### **例 (Example)**
この例では、顧客データがSnowflakeアカウントの一つのデータベース`CUSTOMER_DATA`に保存されており、各顧客のデータごとに`CUSTOMER_DATA.ABC`のようなスキーマがあると仮定します。

1.  データベースと関連するスキーマに対する`USAGE`権限が付与された、関連するSnowflakeロールを作成します。
    ```sql
    GRANT USAGE ON CUSTOMER_DATA.ABC TO ROLE ABC
    ```
2.  Sigmaで、`Role`という名前のユーザー属性を作成します。デフォルト値は設定しないでください。
3.  キーペア認証を使用して、Snowflakeアカウントへの接続を作成します。
4.  Snowflake接続の`Role`フィールドで、`Role`ユーザー属性を選択します。
5.  ユーザー属性値を割り当てます。
    * 内部ユーザーの各チームについて、関連するSnowflakeデータにアクセスするための権限を持つロールに相当するユーザー属性値をチームに割り当てます。例：`ABC`。
    * 埋め込みユーザーの自動作成に依存している場合は、サーバーサイドの埋め込みAPIコードに`user_attributes`のJWTクレームを追加し、ホストアプリケーションから渡される変数に基づいて実行時に適切な値を割り当てます。
    ```javascript
    // .env file
    UA_ROLE = $role_var_from_host_app$
    SIGMA_WH_EMBED = $wh_var_from_host_app$
    ```
    次に、実行時にホストアプリケーションによって設定された環境変数の値に`user_attributes`クレームを設定します。
    ```javascript
    {
       "user_attributes": {
          "SnowflakeRole": UA_ROLE
          "Warehouse": SIGMA_WH_EMBED
       }
    }
    ```

#### **セキュアな埋め込みに行レベルのセキュリティを適用する (Apply row-level security to your secure embed)**
行レベルのセキュリティ（RLS）は、データアクセスを制限する方法です。Sigmaでは、ユーザーID、チームメンバーシップ、または割り当てられたユーザー属性値に基づいてRLSを実装できます。データモデル、データセット、またはカスタムSQLでRLSを設定します。「[行レベルのセキュリティを設定する](https://help.sigmacomputing.com/docs/set-up-row-level-security)」を参照してください。

割り当てられたユーザー属性、チーム、またはユーザーを使用してデータソースにRLSを設定した後、埋め込みコンテンツでそれを強制します。
* 埋め込みユーザーの自動作成に依存している場合は、関連するJWTクレーム`user_attributes`、`teams`、または`users`を使用します。「[JSON web token claims reference](https://help.sigmacomputing.com/docs/json-web-token-claims-reference)」を参照してください。
    > 📘
    > 埋め込みにアクセスする内部ユーザーは、ユーザー属性値またはチームメンバーシップを直接割り当てられている必要があります。
* 埋め込みにアクセスできるユーザーを手動で管理する場合、Sigmaでチームまたはユーザーにユーザー属性を割り当てます。UIを使用するには「[ユーザー属性を割り当てる](https://help.sigmacomputing.com/docs/user-attributes)」を、APIを使用するには`Set a user attribute for teams`APIエンドポイントを参照してください。

#### **埋め込みコンテンツに列レベルのセキュリティを適用する (Apply column-level security to embedded content)**
列レベルのセキュリティ（CLS）を使用すると、列レベルのデータへのアクセスを制限または許可できます。セキュアな埋め込みでCLSを適用するには、CLSが構成されたデータソースを使用する必要があります。「[列レベルのセキュリティを構成する](https://help.sigmacomputing.com/docs/column-level-security)」を参照してください。

埋め込みのCLSルールを強制するには：
* 埋め込みユーザーの自動作成に依存している場合は、`user_attributes`、`teams`、または`users`のいずれかのJWTクレームを使用します。
* 埋め込みにアクセスできるユーザーを手動で管理し、CLSルールがユーザー属性に依存している場合は、「[ユーザー属性を割り当てる](https://help.sigmacomputing.com/docs/user-attributes)」を参照してください。
* 埋め込みにアクセスできるユーザーを手動で管理し、CLSルールがチームに依存している場合は、「[チームメンバーを管理する](https://help.sigmacomputing.com/docs/manage-members-and-teams)」を参照してください。

#### **JWTクレームで値を割り当てる高度な例 (Advanced examples for assigning values in JWT claims)**
埋め込みコンテンツのデータへのアクセスを制限するために複数のアプローチを組み合わせる場合、埋め込みAPIの出力がどのようになるかについて、これらの例を参照してください。
> 💡
> 本番のユースケースでは、ホストアプリケーションを構成して、環境変数を使用して実行時にこれらの値を動的に設定します。

##### **ユーザー属性でCLSとRLSを適用する**
関連する各ユーザー属性に`user_attributes`クレームで値を割り当てます。
```javascript
{
  "user_attributes": {
     "CustomerName": "2",
     "Region": "West"
  }
}
```
##### **チームでCLSを、ユーザー属性でRLSを適用する**
RLSを強制するために`user_attributes`クレームに一つの値を指定し、次にデータモデル上の既存のCLSルールを強制するために使用するチームを指定します。

```javascript
{
  "user_attributes": {
     "Region": "West"
  },
  "teams": ["Customer ABC"]
}
```
はい、承知いたしました。
それでは、「Restrict access to data in embedded content」の最後の部分を、ご指示通りにソースコードとして整形します。

Markdown

##### **チームでCLSを、ユーザー属性でRLSを適用する**
RLSを強制するために`user_attributes`クレームに一つの値を指定し、次にデータモデル上の既存のCLSルールを強制するために使用するチームを指定します。

```javascript
{
  "user_attributes": {
     "Region": "West"
  },
  "teams": ["Customer ABC"]
}
```

#####**接続とロールを動的に切り替える**
動的なウェアハウスとロールの切り替えを使用する場合：
```
JavaScript

{
    "eval_connection_id": {
        "1a2b3456-c7d8-91ef-23g4-h56i7jkl8912"
    },
    "user_attributes": {
        "Warehouse": "SIGMA_EMBED_WH",
        "Role": "PUBLIC"
    }
}
```

### 13-4-2. Ask Sigmaを埋め込む (Embed Ask Sigma)

Ask Sigmaインターフェースをあなた自身のアプリケーションやウェブサイトに埋め込んで、ユーザーがデータに対して自然言語でクエリを実行できるようにすることができます。Ask Sigmaに関する詳細は、「[Ask natural language queries with Ask Sigma](https://help.sigmacomputing.com/docs/ask-natural-language-queries-with-ask-sigma)」を参照してください。

#### **要件 (Requirements)**
* [JSON Web Tokensを使用して埋め込みAPIを作成する](https://help.sigmacomputing.com/docs/example-embed-api-and-url#create-an-embed-api-with-json-web-tokens)のすべてのステップを完了して、JWT署名付きのセキュアなURLを準備します。
* 埋め込みユーザーのアカウントタイプを、`Use Ask Sigma`権限を含むアカウントタイプに設定します。
* 埋め込みユーザーのチームが、Ask Sigmaを使用して質問する際に使用する予定のデータソースにアクセスできる権限を持っていることを確認します。

#### **アプリケーションでのAsk Sigmaの表示をカスタマイズする (Customize the display of Ask Sigma in your application)**
JWTトークンで署名された埋め込みURLは、`https://app.sigmacomputing.com/{org-slug}/ask?:jwt=<jwt>`という構造になります。

Ask Sigmaの外観をカスタマイズするために、2つのオプションのURLパラメータを追加できます。

| URLパラメータ | 効果 |
| :--- | :--- |
| **&:embed=true** | trueに設定すると、このパラメータはAsk SigmaインターフェースからSigmaのブランディングを削除します。この設定を適用すると、Sigmaのロゴが削除され、ステップと回答のテキストはSigmaへの言及を行いません。 |
| **&:theme={theme-name}** | テーマは、デフォルトの[ワークブックテーマ](https://help.sigmacomputing.com/docs/workbook-themes)（Light, Dark, または Surface）または組織で定義された任意のカスタムテーマを適用します。値はテーマの名前でなければならず、大文字と小文字を区別します。 |

これらのパラメータの両方を使用することで、Ask Sigmaの体験をあなた自身のアプリケーションやウェブサイトにシームレスに統合できます。例えば、カスタムテーマを適用してAsk Sigmaがあなたのポータルの色を採用するようにし、`embed=true`を設定して体験からSigmaのブランディングを削除することができます。

<img width="1712" height="848" alt="b100a78ba266950e7b67d86f994feaa46d1613486a73ab420a5d8a5c0119953b-ask-sigma-embed-themed" src="https://github.com/user-attachments/assets/19ef2589-c0da-42ff-8ade-13a5396269f2" />


### 13-5-1-1. 埋め込みでインバウンドおよびアウトバウンドイベントを実装する (Implement inbound and outbound events in embeds)

SigmaのJavaScript埋め込みAPIから利用可能なインバウンドおよびアウトバウンドイベントを使用して、埋め込まれたコンテンツとホストアプリケーションとの間のインタラクティビティを構築します。ホストアプリケーションがSigmaの埋め込みにインバウンドイベントを送信するイベントを発行するように設定し、ホストアプリケーションにリスナーをコーディングして、Sigmaの埋め込みアプリケーションから発行されるアウトバウンドイベントに応答させることができます。

例えば、ユーザーがホストアプリケーションのボタンをクリックすると、インバウンドイベントが埋め込まれたSigmaコンテンツに表示される情報を変更できます。

このドキュメントでは、JavaScript埋め込みAPIを構成するインバウンドおよびアウトバウンドイベントを紹介し、Sigmaの埋め込みでそれらを使用する方法を示す例を提供します。イベントを実装するにはさまざまな方法があり、独自の統合要件がある場合があるため、このドキュメントでは埋め込みでのイベントの実装に関するステップバイステップのガイダンスは提供しません。代わりに、独自のアプローチを開発する際に活用できる役立つコンテキストを提供する例をハイライトします。

すべてのインバウンドイベントのリストについては、「[Inbound event reference](https://help.sigmacomputing.com/docs/inbound-event-reference)」を参照してください。
すべてのアウトバウンドイベントのリストについては、「[Outbound event reference](https://help.sigmacomputing.com/docs/outbound-event-reference)」を参照してください。
ホストアプリケーションとSigmaからイベントを送受信する手順を説明するエンドツーエンドのレシピについては、「[QuickStart: Embedding 07: Events](https://help.sigmacomputing.com/docs/quickstart-embedding-07-events)」を参照してください。

> 📘
> インバウンドイベントは以前は「アクション」と呼ばれていました。Sigmaはこの機能を[ワークブックアクション](https://help.sigmacomputing.com/docs/actions-overview)機能と区別するために、「アクション」を「インバウンドイベント」に改名しました。
> Sigmaは、ホストアプリケーションでのインバウンドおよびアウトバウンドイベントの統合を支援するために、JavaScript React SDKを提供しています。詳細は、「[Embed SDK for React](https://github.com/sigma-computing/sigma-react-sdk)」を参照してください。

> 💡
> これらのイベントの追跡と分析には、Pendoなどのツールを使用できます。例えば、Pendoドキュメントの「[Configure Track Events](https://support.pendo.io/hc/en-us/articles/360032294131-Track-Events)」を参照してください。

#### **インバウンドイベント (Inbound events)**
インバウンドイベントは、ホストアプリケーションがSigmaの埋め込みと通信するためのメカニズムです。本質的に、これらはSigmaが処理し、コントロール値を動的に変更することで応答する変数またはコマンドです。

Sigmaは、インバウンドイベントを通信する2つの方法をサポートしています。
* **JavaScript:** 通常、埋め込みをリフレッシュすることなく、ホストアプリケーションから埋め込みコンテンツにデータを送信するために使用されます。この方法は、よりインタラクティブでレスポンシブなユーザーエクスペリエンスを可能にします。
* **URL:** 主に実行時に、埋め込みURLに直接変数値を追加するために使用されます。この方法は、特定のパラメータで埋め込みを初期化するのに理想的です。

両方の方法は、イベントの送信方法に柔軟性を提供し、埋め込みソリューションがさまざまなシナリオと要件に対応できるようにします。

##### **例：インバウンドイベント - Sigmaのコントロールを更新する**
以下のサンプルスクリプトは、ホストアプリケーションから埋め込まれたSigmaコンテンツのiframeに情報を通信する方法を示しています。`postMessage`メソッドを利用して通信を可能にし、ホストアプリケーションがiframeの`contentWindow`に直接メッセージを送信して、イベントタイプと更新するコントロールを指定できるようにします。
ターゲットオリジン`https://app.sigmacomputing.com`は、メッセージが意図した受信者に届くことを保証することで、セキュリティを強化します。

```javascript
// ドキュメントからSigma iframe要素を取得
const sigma_iframe = document.getElementById('sigma-iframe');

// Sigma iframeのcontentWindowにメッセージを投稿
sigma_iframe.contentWindow.postMessage(  
  {  
    // 実行するイベントのタイプを指定
    type: 'workbook:variables:update',  

    // Sigmaで更新するコントロールを新しい値で定義
    variables: { 'Variable1': 'value1', 'Variable 2': 'value2' },  
  },  

  // メッセージが受け入れられるべきターゲットオリジンを提供
  '[https://app.sigmacomputing.com](https://app.sigmacomputing.com)',  
);
```

🚧
このイベント例は、埋め込みコンテンツに現在表示されているコントロール値を更新します。非表示のコントロールには適用されません。

例：インバウンドイベント - 選択された要素またはページを変更する
以下のスニペット例は、埋め込み内で選択された要素またはページをプログラムで変更する方法を示しています。

```JavaScript

const sigma_iframe = document.getElementById('sigma-iframe');

sigma_iframe.contentWindow.postMessage(  
  {  
    type: 'workbook:selectednodeid:update',
    selectedNodeId: string | null,
  },  
  '[https://app.sigmacomputing.com](https://app.sigmacomputing.com)',  
);```
アウトバウンドイベントとリスナー (Outbound events and listeners)
アウトバウンドイベントは、埋め込まれたSigmaコンテンツがホストアプリケーションに通信するメッセージで、Sigma内のコンテンツに加えられたインタラクションや変更に関する更新を提供します。ホストアプリケーションがアウトバウンドイベントを検出して応答するためには、JavaScriptイベントリスナーを実装する必要があります。これにより、ホストアプリケーションとSigma埋め込みとの間のインタラクティビティが促進されます。

例：アウトバウンドイベント - 基本的なイベントリスナー
この最初の例は、イベントリスナーをwindowオブジェクトに追加する方法を示しています。リスナーは、Sigma埋め込みによって送信されたイベントメッセージをチェックし、イベントデータをログに記録します。
```
JavaScript

window.addEventListener('message', function (event) {
  if (event.source === document.getElementById('sigma-iframe').contentWindow &&
      event.origin === "[https://app.sigmacomputing.com](https://app.sigmacomputing.com)") {
    // 受信したイベントデータを処理する
    console.log(event.data);
  }
});```
例：アウトバウンドイベント - 特定のイベントメッセージをフィルタリングする
この2番目の例は、例えばReact DevToolsからのような、関連のないイベントメッセージをフィルタリングする方法を示しています。

```JavaScript

window.addEventListener('message', (message) => {
  // Sigmaに関連しないメッセージをフィルタリングする
  if (message.data.source !== 'react-devtools-bridge') {
    console.log(message.data);
  }
});
```

### 13-5-1-2. インバウンドイベントのリファレンス (Inbound event reference)

Sigmaは、ホストアプリケーションまたは親ウィンドウのユーザー入力によってトリガーされる、以下のインバウンドイベントをサポートしています。

Sigmaの埋め込みでアクションによって発行されるイベントのリストについては、「[アウトバウンドイベントのリファレンス](https://help.sigmacomputing.com/docs/outbound-event-reference)」を参照してください。
例と詳細については、「[埋め込みでインバウンドおよびアウトバウンドイベントを実装する](https://help.sigmacomputing.com/docs/implement-inbound-and-outbound-events-in-embeds)」を参照してください。

#### **workbook:bookmark:create**
このイベントは、埋め込みUIを使用せずにブックマークを作成します。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:bookmark:create';
       name: string;
       isDefault: boolean;
       isShared: boolean;
    }
    ```
* **イベントプロパティ:**
    * **name:** ブックマークの名前。
    * **isDefault:** trueの場合、ドキュメントを開く際にデフォルトでブックマークが表示されます。
    * **isShared:** trueの場合、ブックマークはこのワークブックのすべてのユーザーと共有されます。

---
#### **workbook:bookmark:delete**
このイベントは、埋め込みUIを使用せずにブックマークを削除します。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:bookmark:delete';
       bookmarkId: string;
    }
    ```
* **イベントプロパティ:**
    * **bookmarkId:** ブックマークの一意のID。

---
#### **workbook:bookmark:select**
このイベントは、埋め込みでブックマークを選択またはクリアします。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:bookmark:select';
       bookmarkId?: string | null;
    }
    ```
* **イベントプロパティ:**
    * **bookmarkId:** ブックマークの一意のID。指定された場合、ユーザーはブックマークにリダイレクトされます。指定されない場合、ブックマークはクリアされ、ユーザーはワークブックの公開バージョンにリダイレクトされます。

---
#### **workbook:bookmark:update**
このイベントは、ユーザーの探索（カスタムビュー）からの変更でブックマークを更新するために使用されます。このイベントは、Sigma UIでドキュメントメニューの`Save updates to custom view`をクリックするのと同じです。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:bookmark:update';
    }
    ```

以下の状況では、`workbook:error` iframeイベントがトリガーされます。

| 原因 | エラー |
| :--- | :--- |
| ユーザーが更新するブックマークを選択しなかった。| Bookmark not selected |
| ユーザーが選択したブックマークに変更を加えていないため、更新できない。| Cannot update bookmark, no explore changes made |

#### **workbook:fullscreen:update**
このイベントは、フルスクリーン検索パラメータを更新するために使用されます。ターゲット要素が最大化されている場合、この関数を呼び出すと最小化され、その逆も同様です。UIの`Maximize element`と同等です。
このイベントは、UIを使用せずに要素を最大化および最小化するのに役立ちます。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:fullscreen:update';
       nodeId: string | null;
    }
    ```
* **イベントプロパティ:**
    * **nodeId:** 要素に対応するノードID。

---
#### **workbook:modal:toggle**
このイベントは、埋め込みでモーダルを開いたり閉じたりするために使用されます。このイベントは、ユーザーがUIでモーダルと対話するために必要な権限を持っている必要があります。例えば、`Schedule exports`モーダルには`Schedule export`権限が必要です。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:modal:toggle';
       modalType: 'schedule' | 'export' | undefined;
    }
    ```
* **イベントプロパティ:**
    * **modalType:** 開くモーダルのタイプ。現在開いているモーダルを閉じるには`undefined`を渡します。
        * サポートされているモーダルタイプ: `'schedule'`, `'export'`, `undefined`

---
#### **workbook:mode:update**
このイベントは、埋め込みで`View`モードと`Explore`モードを切り替えるために使用されます。ユーザーがコンテンツを探索するために必要な権限を持っていない場合、または埋め込みが`Explore`モードをサポートしていない場合、このイベントは効果がありません。ワークブックモードに関する詳細は、「[Workbook modes overview](https://help.sigmacomputing.com/docs/workbook-modes-overview)」を参照してください。

* **イベント構造:**
    ```javascript
    {  
       type: 'workbook:mode:update';
       mode: 'view' | 'explore';
    }
    ```
* **イベントプロパティ:**
    * **mode:** 埋め込みがユーザーに提示すべきモード。
        * サポートされているモードは`view`と`explore`です。

---
#### **workbook:selectednodeid:update**
このイベントは、UIを使用せずにノードID（要素IDまたはページID）を選択するために使用されます。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:selectednodeid:update';
       selectedNodeId: string | null;
       nodeType: 'element' | 'page';
    }
    ```
* **イベントプロパティ:**
    * **selectedNodeId:** 選択する要素またはページのノードID。
    * **nodeType:** ノードのタイプ。`'element'`または`'page'`のいずれかです。
 
  #### **workbook:sharinglink:update**
このイベントは、埋め込みユーザーが埋め込みメニュー、埋め込みフッター、およびスケジュールされたエクスポートのメール通知を通じて他のユーザーと共有できるリンクを利用可能にするために使用されます。手順については、「[埋め込みの共有可能なリンクを構成する](https://help.sigmacomputing.com/docs/configure-a-shareable-link-for-an-embed)」を参照してください。

> 📘
> Sigmaは、この共有リンクを与えられた誰にでも、あなたがこのイベントで提供したURLをロードします。コンテンツを表示する前に、アプリケーションがユーザーを認証することを確認してください。

* **イベント構造:**
    ```javascript
    {
      type: 'workbook:sharinglink:update';
      sharingLink: string | null;
      sharingExplorationLink?: string | null;
    }
    ```
* **イベントプロパティ:**
    * **sharingLink:** 埋め込みメニューまたはフッターを通じて埋め込まれたワークブックを共有したい埋め込みユーザーが受け取るURL。設定されると、埋め込みユーザーがエクスポートをスケジュールした場合、受信者が受け取るメールにはこのリンクが含まれます。
    * **sharingExplorationLink:** (任意) 埋め込みメニューまたはフッターを通じて埋め込まれたワークブックを共有したい埋め込みユーザーが受け取るURL。`workbook:explorekey:onchange`アウトバウンドイベントを使用して取得できる`explorekey`を含める必要があります。設定されると、埋め込みユーザーは探索を共有するか、元のワークブックを共有するかを選択できます。

Sigmaは、`sharingLink`と`sharingExplorationLink`で渡された文字列を2つの正規表現を使用して検証します。あなたのURLは、これらのいずれかに一致する必要があります。
リンクは1000文字を超えることはできません。値が検証に合格しない場合、共有リンクは設定されません。

---
#### **workbook:variables:list**
このイベントは、コントロールとその値をリストするために使用されます。

* **イベント構造:**
    ```javascript
    {  
       type: 'workbook:variables:list' 
    }
    ```
* **返される値:**
    ```javascript
    {
       type: 'workbook:variables:current';
       variables: variablesObject;
    }
    ```
* **返されるイベントプロパティ:**
    * **variables:** ワークブック内のコントロールとコントロール値のキーと値のペアのマッピング。

---
#### **workbook:variables:update**
このイベントは、UIを使用せずにワークブックのコントロールとコントロール値を更新するために使用されます。
特定のコントロールタイプのコントロール値の期待されるフォーマットに関する詳細は、「[URLクエリ文字列パラメータを使用してコントロール値を設定する](https://help.sigmacomputing.com/docs/set-control-values-in-a-url-using-query-string-parameters)」を参照してください。

* **呼び出し例:** `frame.contentWindow.postMessage({type: "workbook:variables:update", variables: {ua: 'south'}})`

* **イベント構造:**
    ```javascript
    {  
       type: 'workbook:variables:update';
       variables: variablesObject 
    }
    ```
* **イベントプロパティ:**
    * **variables:** ワークブック内のコントロールのキーと値のペアのマッピング。
 
### 13-5-1-3. アウトバウンドイベントのリファレンス (Outbound event reference)

Sigmaは、埋め込まれたSigmaコンテンツとのユーザーインタラクションを説明する、以下のアウトバウンドイベントをサポートしています。各イベントには、ホストアプリケーションが適切に処理・応答するための、インタラクションに関する特定のプロパティが含まれています。

設定可能なイベントのリストについては、「[インバウンドイベントのリファレンス](https://help.sigmacomputing.com/docs/inbound-event-reference)」を参照してください。
例と詳細については、「[埋め込みでインバウンドおよびアウトバウンドイベントを実装する](https://help.sigmacomputing.com/docs/implement-inbound-and-outbound-events-in-embeds)」を参照してください。

#### **action:outbound**
このイベントは、`Generate iframe event`ワークブックアクションがトリガーされたときに発生します。このイベントを使用して、ワークブックで行われたユーザーアクションに反応することができます。「[埋め込みiframeイベントを生成するアクションを作成する](https://help.sigmacomputing.com/docs/create-actions-that-generate-embed-iframe-events)」を参照してください。

* **イベント構造:**
    ```javascript
    {
       type: 'action:outbound';
       name: string;
       values: Record<string,unknown>;
    }
    ```
* **イベントプロパティ:**
    * **name:** イベントの名前。この名前をワークブックアクションの`Event name`フィールドに入力します。
    * **values:** ホストアプリケーションに渡す一つ以上のイベントキーと値。対応するキーと値のペアをワークブックアクションの`Event key`フィールドに入力します。

---
#### **url:onchange**
このイベントは、URLの検索パラメータが変更されたときではなく、URLパスが変更されたときに発生します。このイベントは、埋め込みのURLを返します。
このイベントは、ユーザーが編集できる独自のワークブックを作成したタイミングについてのインサイトを提供します。

* **イベント構造:**
    ```javascript
    {
       type: 'url:onchange';
       url: string;
    }
    ```
* **イベントプロパティ:**
    * **url:** 検索またはクエリパラメータを含まない埋め込みのパス名。

---
#### **workbook:bookmark:onchange**
このイベントは、ユーザーがブックマークを選択または選択解除したときに発生します。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:bookmark:onchange', 
       bookmarkName: string; 
       workbookId: string;
       versionTagName: string | null; 
       bookmarkId: string;
    }
    ```
* **イベントプロパティ:**
    * **bookmarkName:** ブックマークの名前。
    * **workbookId:** ブックマークが作成されたワークブックのID。
    * **versionTagName:** ワークブックのバージョンに割り当てられたタグ。埋め込みでは常にnullです。
    * **bookmarkId:** ブックマークの一意のID。

#### **workbook:bookmark:oncreate**
このイベントは、埋め込みユーザーが埋め込みUIを使用してブックマークを作成したときに発生します。
このイベントは、ユーザーがいつブックマークを作成したかを分析するのに役立ちます。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:bookmark:oncreate';
       bookmarkName: string;
       workbookId: string;
       versionTagName: string | null;
       bookmarkId: string;
    }
    ```
* **イベントプロパティ:**
    * **bookmarkName:** ブックマークの名前。
    * **workbookId:** ブックマークが作成されたワークブックのID。
    * **versionTagName:** ワークブックのバージョンに割り当てられたタグ。
    * **bookmarkId:** 作成されたブックマークのID。

---
#### **workbook:bookmark:ondelete**
このイベントは、埋め込みユーザーが埋め込みUIを使用してブックマークを削除したときに発生します。

* **イベント構造:**
    ```javascript
    {  
       type: 'workbook:bookmark:ondelete';  
       bookmarkName: string;  
       workbookId: string;  
       versionTagName: string | null;  
       bookmarkId: string;  
     }
    ```
* **イベントプロパティ:**
    * **bookmarkName:** ブックマークの名前。
    * **workbookId:** ブックマークが削除されたワークブックのID。
    * **versionTagName:** ワークブックのバージョンに割り当てられたタグ。
    * **bookmarkId:** 削除されたブックマークのID。

---
#### **workbook:bookmark:onupdate**
このイベントは、埋め込みユーザーが名前の変更、デフォルトビューとしての設定または解除、ブックマークの共有、またはパーソナルビューとして設定することによる非共有化など、埋め込みUIを使用してブックマークを更新したときに発生します。

* **イベント構造:**
    ```javascript
    {  
       type: 'workbook:bookmark:onupdate';  
       workbookId: string;  
       versionTagName: string | null;  
       bookmarkId: string;  
       bookmarkName?: string;  
       isShared?: boolean;  
       isDefault?: boolean;  
    }
    ```
* **イベントプロパティ:**
    * **workbookId:** ブックマークが更新されたワークブックのID。
    * **versionTagName:** ワークブックのバージョンに割り当てられたタグ。
    * **bookmarkId:** 更新されたブックマークのID。
    * **bookmarkName:** (任意) ブックマークの名前。ユーザーによって更新された場合にのみ定義されます。
    * **isShared:** (任意) ブックマークが共有されているかどうか。ユーザーによって更新された場合にのみ定義されます。
    * **isDefault:** (任意) ブックマークがデフォルトビューとして設定されているかどうか。ユーザーによって更新された場合にのみ定義されます。

---
#### **workbook:chart:error**
このイベントは、チャートでエラーが発生したときに発生します。
このイベントは、エラーを検出して対応策を講じるのに役立ちます。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:chart:error';
       nodeId: string;
       message: string | undefined;
       code: string;
    }
    ```
* **イベントプロパティ:**
    * **nodeId:** チャートの要素ID。
    * **message:** エラーメッセージ。
    * **code:** エラーコード。

---
#### **workbook:chart:onvalueselect**
このイベントは、棒グラフのデータポイントをクリックするなど、埋め込まれたビジュアライゼーション要素とのユーザーインタラクション専用に設計されています。このイベントは、基本的なインタラクションの詳細を超え、選択された特定のチャートコンポーネントに関するインサイトを提供する`values`オブジェクトを含みます。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:chart:onvalueselect';
       nodeId: string;
       title: string;
       values: valuesObject;
    }
    ```
* **イベントプロパティ:**
    * **nodeId:** チャートの要素ID。
    * **title:** チャートのタイトル。
    * **values:** 選択されたチャートコンポーネントの色、軸、値を含む、選択されたフィールド列の値を表すキーと値のペアを含みます。

* **シナリオ例:**
    ユーザーが棒グラフの特定の棒をクリックします。イベントは、その棒のカテゴリラベルと値を含む、その棒に関する詳細情報を返します。これにより、ホストアプリケーションは、その正確なインタラクションに関連するコンテキスト固有の応答やさらなるデータインサイトを提供できます。

#### **workbook:dataloaded**
このイベントは、ワークブックがデータの読み込みを完了したときに発生します。
このイベントは、iframeがSigmaの埋め込みの読み込みを完了したことを通知するのに役立ちます。

* **イベント構造:**
    ```javascript
    {  
       type: 'workbook:dataloaded' 
    }
    ```
* **シナリオ例:** ユーザーがワークブックにアクセスした直後にAPI経由でワークブックをPDFとしてエクスポートすると、PDF内で埋め込み要素の読み込みが完了していないことがあります。開発者は、iframe要素のチェックを追加し、エクスポートする前にiframeのコンテンツが完全に読み込まれていることを確認できます。

---
#### **workbook:error**
このイベントは、ワークブックでエラーが発生したときに発生します。このイベントでキャッチして処理できる一般的なエラーコードとメッセージは、「[一般的な埋め込みのエラーコードとメッセージ](https://help.sigmacomputing.com/docs/common-embed-error-codes-and-messages)」にリストされています。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:error';
       message: string | undefined;
       code: string;
    }
    ```
* **イベントプロパティ:**
    * **message:** エラーメッセージ。
    * **code:** エラーコード。

---
#### **workbook:exploreKey:onchange**
このイベントは、埋め込みで新しい探索（exploration）が作成されたときに発生します。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:exploreKey:onchange', 
       exploreKey: string;
    }
    ```
* **イベントプロパティ:**
    * **exploreKey:** 探索に関連付けられた一意のID。

---
#### **workbook:fullscreen:onchange**
このイベントは、ユーザーが要素を最小化または最大化したときに発生します。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:fullscreen:onchange';
       fullScreen: boolean;
    }
    ```
* **イベントプロパティ:**
    * **fullScreen:** trueの場合、要素は最大化されました。falseの場合、要素は最小化されました。

---
#### **workbook:id:onchange**
このイベントは、表示されているワークブックのIDが変更されたときに発生します。

* **イベント構造:**
    ```javascript
    { 
       type: 'workbook:id:onchange'; 
       id: string 
    }
    ```
* **イベントプロパティ:**
    * **id:** ワークブックID。

---
#### **workbook:loaded**
このイベントは、ワークブックのメタデータが読み込まれたが、要素はまだ評価されていないときに発生します。

* **イベント構造:**
    ```javascript
    {
      type: 'workbook:loaded',
      workbook: {
        variables: encodedVariables // Contains workbook metadata
      },
    }
    ```

---
#### **workbook:ondelete**
このイベントは、ユーザーが埋め込みメニューで`Delete`をクリックし、ワークブックが正常に削除されたときに発生します。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:ondelete';
       id: string;
    }
    ```
* **イベントプロパティ:**
    * **id:** ワークブックID。

---
#### **workbook:pageheight:onchange**
このイベントは、ドキュメントの高さが変更されるたびに、その高さを親に伝えます。
このイベントは、`responsive_height`パラメータがtrueに設定されている必要があります。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:pageheight:onchange';
       pageHeight: number;
    }
    ```
* **イベントプロパティ:**
    * **pageHeight:** ページの高さ（ピクセル単位）。

---
#### **workbook:pivottable:oncellselect**
このイベントは、ユーザーが埋め込まれたピボットテーブルでセルまたは複数のセルを選択したときに発生します。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:pivottable:oncellselect';
       nodeId: string;
       title: string;
       cells: cellsObject;
    }
    ```
* **イベントプロパティ:**
    * **nodeId:** ピボットテーブルの要素ID。
    * **title:** ピボットテーブルのタイトル。
    * **cells:** 各セルのオブジェクトのコレクション。

---
#### **workbook:published**
このイベントは、セキュアな埋め込みでユーザーがワークブックを保存および公開したときに発生します。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:published';
       workbookId: string;
    }
    ```
* **イベントプロパティ:**
    * **workbookId:** 公開されたワークブックのID。

---
#### **workbook:saveas**
このイベントは、ユーザーがワークブックの埋め込みメニューで`Save as`オプションを使用してワークブックを正常に保存したときに発生します。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:saveas';
       workbookId: string;
       saveWorkbookId: string;
    }
    ```
* **イベントプロパティ:**
    * **workbookId:** 元のワークブックのID。
    * **savedWorkbookID:** 新しく保存されたワークブックのID。

---
#### **workbook:table:oncellselect**
このイベントは、ユーザーが埋め込まれたテーブルでセルまたは複数のセルを選択したときに発生します。

* **イベント構造:**
    ```javascript
    {
       type: 'workbook:table:oncellselect';
       nodeId: string;
       title: string;
       cells: cellsObject;
    }
    ```
* **イベントプロパティ:**
    * **nodeId:** テーブルの要素ID。
    * **title:** テーブルのタイトル。
    * **cells:** 各セルのオブジェクトのコレクション。

---
#### **workbook:variables:onchange**
このイベントは、埋め込まれたSigmaコンテンツ内のコントロール要素にユーザーまたはシステム起因の更新が適用されたときに発生します。

* **イベント構造:**
    ```javascript
    {
      type: 'workbook:variables:onchange',
      workbook: {
        variables: { 'Variable1': 'value1', 'Variable 2': 'value2' } // Updated variable values
      },
    }
    ```
* **イベントプロパティ:**
    * **workbook.variables:** ワークブック内で更新されたコントロールとその値を含みます。
 
### 13-5-2. 埋め込み用のiframeを管理する (Manage iframes for embeds)

Sigmaの埋め込み分析を利用する際、静的またはレスポンシブなデザインソリューションを実装して、さまざまなデバイスでの表示体験を最適化できます。

このドキュメントでは、埋め込まれたSigmaコンテンツに理想的なデザインを実現するためのいくつかのソリューションについて説明します。これらのソリューションの実装方法の詳細については、「[QuickStart - Embedding 10: Responsive Embeds](https://help.sigmacomputing.com/docs/quickstart-embedding-10-responsive-embeds)」を参照してください。

#### **CSSで固定のiframe高さを設定する (Set a fixed iframe height in your CSS)**
CSSを使用して、画面サイズに関係なく、埋め込みコンテンツのほとんどまたはすべてを表示する固定のiframe高さを設定します。このソリューションにより、指定された高さまでコンテンツの表示を制御できます。コンテンツが固定の高さを超えると、iframeにはスクロールバーが表示されます。
> 📘
> 固定のiframe高さは、画面サイズによっては過剰なスクロールやコンテンツの表示問題（オーバーフローや切り捨てなど）を引き起こす可能性があります。

#### **calc()関数を使用して動的なiframe高さを設定する (Set a dynamic iframe height using the calc() function)**
CSSの`calc()`関数を使用して、ビューポートの高さや他のページ要素に基づいて動的にiframeの高さを設定します。`calc()`関数を使用して、他のCSSプロパティの値を動的に計算することもできます。
> 📘
> `calc()`関数を使用すると、ビューポートや他のページ要素にレスポンシブなiframeを実装できますが、iframe内のコンテンツの調整はできません。

#### **JavaScriptを使用してiframeの高さを調整する（推奨）(Adjust the iframe height using JavaScript (recommended))**
JavaScriptを使用して、埋め込まれたコンテンツの高さに基づいて動的にiframeの高さを調整します。JavaScriptのイベントリスナーがリアルタイムでコンテンツの高さを検出し（`workbook:pageheight:onchange`イベントを使用）、iframeの高さをコンテンツに正確に合わせるように調整します。

### 13-5-3. 埋め込みの共有可能なリンクを構成する (Configure a shareable link for an embed)

埋め込みユーザーが、あなた自身のドメイン名を持つリンクを使用して、ワークブック、探索、またはブックマークを他のユーザーと共有できるようにすることができます。リンク共有は、ページまたは単一要素の埋め込みでは利用できません。

これらのリンクはコピー＆ペーストでき、受信者はあなたのアプリケーションで直接コンテンツにアクセスできます。さらに、`workbook:sharinglink:update` iframeイベントを構成することで、埋め込みメニュー、埋め込みフッター、およびスケジュールされたエクスポートのメール通知に共有可能なリンクを含めることができます。詳細は、「[埋め込みでインバウンドおよびアウトバウンドイベントを実装する](https://help.sigmacomputing.com/docs/implement-inbound-and-outbound-events-in-embeds)」を参照してください。

完全な実装例については、「[Embedding 13: Link Sharing QuickStart](https://help.sigmacomputing.com/docs/quickstart-embedding-13-link-sharing)」およびGitHubリポジトリの付属サンプルコードを参照してください。

#### **埋め込み用の共有可能なURLを設定する (Set up a shareable URL for your embed)**
埋め込みユーザーがリンクを共有できるようにするには、アプリケーションコードを次のように更新します。

1.  `workbook:exploreKey:onchange` iframeイベントを使用して`exploreKey`を抽出します。「[アウトバウンドイベントのリファレンス](https://help.sigmacomputing.com/docs/outbound-event-reference)」を参照してください。
2.  埋め込みユーザーがアプリケーションで探索を作成または更新するたびに、`exploreKey`を含むパラメータをホストアプリケーションのURLに追加します。
    * **例:**
    ```javascript
    window.addEventListener('message', function (event) {
       if (event.source === document.getElementById('sigma-iframe').contentWindow &&
          event.origin === "[https://app.sigmacomputing.com](https://app.sigmacomputing.com)") {
          // exploreKeyの変更を処理する
          if (event.data.type === 'workbook:exploreKey:onchange') {
             // URLにexploreKeyを追加する
             params.append(":exploreKey", event.data.exploreKey);
          }
       }
    });
    ```
3.  埋め込みユーザーがリンクをたどる際に、URLから`exploreKey`を解析するようにアプリケーションを構成します。このステップにより、アプリは`exploreKey`を持つ埋め込みユーザー用のセキュアな埋め込みURLを生成でき、Sigmaが対応する埋め込みビューをレンダリングできるようになります。
    * **例:**
    ```javascript
    // exploreKeyが存在する場合に処理する
    const exploreKey = req.query.exploreKey;
    // exploreKeyが存在する場合、iframeに渡されるセキュアな埋め込みURLに追加する
    if (exploreKey) {
        searchParams += `&:explore=${exploreKey}`;
    }
    searchParams += `&:bookmark=&{bookmarkId}`;
    ```
4.  [任意] 埋め込みユーザーがブックマークを共有できるようにしたい場合は、ステップ1から3を繰り返して`workbook:bookmark:onchange` iframeイベントを使用して`bookmarkId`を抽出し、ホストアプリケーションのURLに追加し、セキュアな埋め込みURLを生成する際にパラメータとして含めます。

#### **アプリケーションに共有機能を追加する (Add sharing functionality to your application)**
`workbook:sharinglink:update`を使用して、埋め込みメニュー、埋め込みフッター、およびスケジュールされたエクスポートに表示される`sharingLink`プロパティにURLを提供します。埋め込みユーザーがデフォルトで探索を共有するようにしたい場合は、このリンクに`exploreKey`パラメータを含めます。

[任意] 埋め込みユーザーに現在の探索へのリンクまたは元のワークブックへのリンクを送信するオプションを与えたい場合は、`sharingExplorationLink`プロパティに`exploreKey`パラメータの値を含む2番目のURLを提供します。ユーザーに常に現在の探索を共有させたい場合は、`sharingLink`の値に`exploreKey`を含め、`sharingExplorationLink`を省略することを選択できます。

* **例:**
```javascript
// 共有リンクをSigmaに送り返す関数
function sendSharingLinks() {
 const baseUrl = window.location.origin + window.location.pathname;
 const sharingLink = currentBookmarkId
     ? `${baseUrl}?&bookmarkId=${currentBookmarkId}`
     : baseUrl;
 const sharingExplorationLink = currentExploreKey
     ? currentBookmarkId
         ? `${baseUrl}?exploreKey=${currentExploreKey}&bookmarkId=${currentBookmarkId}`
         : `${baseUrl}?exploreKey=${currentExploreKey}`
     : null;
 iframe.contentWindow.postMessage(
     {
         type: "workbook:sharinglink:update",
         sharingLink: sharingLink,
         sharingExplorationLink: sharingExplorationLink,
     },
     "[https://app.sigmacomputing.com](https://app.sigmacomputing.com)"
 );
}
```
📘
Sigmaは、この共有リンクを与えられた誰にでも、あなたがこのイベントで提供したURLをロードします。コンテンツを表示する前に、アプリケーションがユーザーを認証することを確認してください。

#### **埋め込みで共有リンクをテストする (Test the sharing links in your embed)**

共有可能なURLを設定し、アプリケーションに追加する手順を完了した後、アプリケーションで結果をテストします。

1.  埋め込みコンテンツのフッターに共有アイコンが表示され、埋め込みメニューに`Share...`オプションが表示されることを確認します。
    > 📘
    > 埋め込みがフッターを除外するように構成されている場合、アプリケーションで独自の共有モーダルまたはボタンを構築し、その方法でユーザーに共有リンクを提供できます。
2.  埋め込みコンテンツのカスタマイズを開始し、`Share`をクリックします。
3.  `Share this content`モーダルで、`Link to current exploration`チェックボックスが表示されることを確認します。
    > 📘
    > `Link to current exploration`チェックボックスは、ユーザーが埋め込みでアクティブな探索を持っており、埋め込みアプリケーション開発者が`sharingExplorationLink`を提供した場合にのみ表示されます。
4.  チェックボックスの選択を解除した状態で`Copy Link`をクリックしてリンクをテストします。新しいプライベートブラウザウィンドウで、リンクをテストして、埋め込み用に構成したユーザー認証が機能し、ページが`sharingLink`プロパティで構成されたURLに解決されることを確認します。
5.  `Link to custom view`チェックボックスが表示されている場合は、チェックボックスを選択し、再度`Copy Link`をクリックします。新しいプライベートブラウザウィンドウで、リンクをテストして、ユーザー認証が機能し、ページが`sharingExplorationLink`プロパティで構成されたURLに解決されることを確認します。
6.  埋め込みメニューで、`Schedule exports...`をクリックします。
7.  自分のメールアドレスに送信する新しいエクスポートスケジュールを作成し、`More` > `Send now`をクリックします。
8.  受信したメールに`Open`ボタンが含まれていることを確認します。`Open`ボタンをクリックして、ユーザー認証が機能し、ページが`sharingLink`プロパティで構成されたURLに解決されることを確認します。

### 13-6-1. React用Embed SDK (Embed SDK for React)

Sigmaは、ウェブユーザーインターフェース、パブリックREST API、JavaScript Embed API、そしてReactフレームワーク用のSDKなど、ユーザーと開発者がそのシステムと対話するためのいくつかの方法を提供しています。

Embed SDK for Reactは、より高度で開発者に優しいインターフェースを提供し、アプリケーションへの統合を簡素化します。これは、より詳細な制御を提供するものの、追加のコーディングが必要になる可能性があるSigmaの低レベルなJavaScript Embed APIとは対照的です。

ソースコードは[Github](https://github.com/sigma-computing/sigma-react-sdk)で自由に利用できます。開発者はリポジトリをクローンし、各ファイルのコード内のコメントを参照できます。

さらに、SDKの使用に関するより詳細なガイドのための[QuickStart](https://help.sigmacomputing.com/docs/quickstart-embedding-12-react-sdk)もあります。

ソースには、Sigmaが提供するコンテンツに基づいたサンプル埋め込みを含む、動作するアプリケーションが含まれています。

### 14-1-1. Sigma REST APIについて (About the Sigma REST API)

SigmaのREST APIは、HTTPを使用して、リソースへのプログラムによる開発者アクセスを提供します。このAPIは、接続、データセット、チーム、ワークブックなど、一般的に使用されるすべてのリソースへの安全なアクセスを可能にします。APIを使用して、Sigmaとのカスタムアプリケーションやインテグレーションを作成できます。エラーを含むすべてのAPIレスポンスは、JSONで返されます。

詳細は、「[Get started with the Sigma REST API](https://help.sigmacomputing.com/docs/get-started-with-the-sigma-rest-api)」を参照してください。

Sigma APIを使用して、ネイティブおよび埋め込みワークフローをサポートするための操作を自動化できます。

#### **APIリファレンスドキュメント (API reference documentation)**
[APIリファレンスドキュメント](https://help.sigmacomputing.com/reference)は、多種多様な一般的なプログラミング言語でのコードサンプルを含む、インタラクティブなAPIコンソールを提供します。特定のエンドポイントのAPIリファレンスページから直接、APIリクエストを実行し、レスポンスを確認できます。

#### **APIレシピ (API recipes)**
[APIレシピ](https://help.sigmacomputing.com/docs/api-recipes)は、多くの一般的なユースケースに対応するJavaScriptのサンプルコードを提供します。個々のレシピのコードは、APIレシピページから直接コピーできます。
あるいは、すべてのレシピをこの[gitリポジトリ](https://github.com/sigma-computing/sigma-api-recipes)からダウンロードすることもできます。
また、これらのレシピをローカルコンピュータで使用するのを支援するための[Sigma REST API Recipes QuickStart](https://help.sigmacomputing.com/docs/quickstart-api-recipes)もあります。

#### **APIでPostmanを使用する (Using Postman with the API)**
非常に人気のあるAPIプラットフォームであるPostmanをSigma APIで活用する方法について議論し、デモンストレーションする[Sigma API with Postman QuickStart](https://help.sigmacomputing.com/docs/quickstart-api-postman)もあります。

### 14-2-1. カスタムプラグインを始める (Get started with custom plugins)

Sigmaはワークブックでプラグイン要素をサポートしています。プラグインは、既存の製品に追加機能をもたらすために構築されたサードパーティのアプリケーションです。例えば、あなたの組織のソフトウェア開発者が、Sigmaではサポートされていないチャートタイプでデータを表示できるプラグインを作成することがあります。

あなたは、あなたの組織に登録されているプラグインにのみアクセスできます。

#### **どこから始めればよいですか？ (Where do I start?)**

Sigmaカスタムプラグインの出発点は、あなたの役割、経験、および目的によって異なります。始めるには、以下のうち、あなたの現在の状況に最も一致するシナリオを見つけてください。

* **シナリオ#1：組織の既存のカスタムプラグインの使用に興味があります。**
    プラグインベースのワークブック要素を作成する方法を理解するには、「[組織のプラグインを使用する](https://help.sigmacomputing.com/docs/use-your-organizations-plugins)」を参照してください。

* **シナリオ#2：組織の管理者または開発者で、プラグインが組織に何をもたらすかを探求することに興味があります。**
    Sigmaの開発チームによって既に作成された一つ以上のサンプルプラグインから始めることをお勧めします。私たちのすべてのサンプルプラグインはホストされており、[あなたの組織に追加](https://help.sigmacomputing.com/docs/register-a-plugin-with-your-organization)できます。それらをSigmaで試すためにソフトウェア開発者である必要はありません。
    始めるには、「[サンプルプラグイン](https://help.sigmacomputing.com/docs/example-plugins)」をご覧ください。

* **シナリオ#3：Sigma用のカスタムプラグインを構築したい開発者です。**
    始めるには、「[Sigmaプラグインを開発する](https://help.sigmacomputing.com/docs/develop-sigma-plugins)」を参照してください。私たちのAPIドキュメントは「[Plugin Development API](https://help.sigmacomputing.com/docs/plugin-development-api)」で利用可能です。
    また、Githubの[Sigmaのサンプルプラグインリポジトリ](https://github.com/sigma-computing/sigma-sample-plugin)にある、Sigmaのサンプルプラグインのソースコードを読むこともできます。

* **シナリオ#4：チームにプラグインを利用可能にしたい組織の管理者です。**
    開発チームのプラグインの一つを立ち上げて実行する準備はできましたか？「[あなたの組織にプラグインを登録する](https://help.sigmacomputing.com/docs/register-a-plugin-with-your-organization)」を参照してください。
    また、同じ登録プロセスを通じて、Sigmaの[サンプルプラグイン](https://help.sigmacomputing.com/docs/example-plugins)のいずれかをあなたのチームで利用可能にすることもできます。

  ### 14-2-2. Sigmaプラグインを開発する (Develop plugins for Sigma)

#### **プラグイン (Plugins)**
プラグインは、既存の製品に追加機能をもたらすために構築されたサードパーティのアプリケーションです。Sigmaはワークブックでプラグインをサポートしています。開発者はSigmaのプラグインAPIを使用してプラグインを構築します。このAPIは、Sigmaワークブックとプラグインとの間でデータとインタラクションイベントを通信します。開発者はこれらのプラグインをホストし、Sigmaの`iframe`要素に埋め込みます。

#### **ユーザー要件 (User requirements)**
Sigma Plugin Dev Playgroundでプラグインを開発およびテストする機能には、以下が必要です。
* 組織の管理者によって作成されたSigma Plugin Dev Playgroundへのアクセス権が必要です。
* `Manage plugins`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* あなたがワークブックの所有者であるか、`Can edit`の[ワークブック権限](https://help.sigmacomputing.com/docs/share-a-workbook)を付与されている必要があります。
* JavaScriptを使用してプラグインを開発し、ウェブブラウザ環境で実行されるように設計されている必要があります。

#### **開発プロジェクトを作成する (Create a development project)**
Sigmaでは、フロントエンド開発に`React`ライブラリを使用しています。Sigmaで組織用のカスタムプラグインを開発する際にも、同じ環境を使用することをお勧めします。異なる方法を選択する場合は、JavaScriptを使用することを確認してください。Sigmaは、[標準のJavaScript API](https://help.sigmacomputing.com/docs/plugin-development-api#javascript-api)と[React Hooks API](https://help.sigmacomputing.com/docs/plugin-development-api#react-hooks-api)の両方をサポートしています。

##### **Reactでプロジェクトを作成する (Create a project with React)**
1.  ターミナルを開き、プロジェクトを作成する予定のディレクトリに移動します。
2.  新しいプロジェクトを作成します。
    * Facebookの`Create React App`の使用をお勧めします。
    ```
    npx create-react-app <my-cool-plugin>
    ```
3.  プロジェクトのメインディレクトリに移動します。
    ```
    cd <my-cool-plugin>
    ```
4.  パッケージマネージャーを使用して、Sigmaのプラグインライブラリをインストールします。
    * `yarn`をお勧めします。
    ```
    yarn add @sigmacomputing/plugin
    ```
5.  ローカルホストを起動します。
    ```
    yarn && yarn start
    ```
6.  開発を開始します。
    * 「[Plugin Development API](https://help.sigmacomputing.com/docs/plugin-development-api)」から始めます。
    * `Sigma Plugin Dev Playground`を使用して、Sigmaワークブックで直接プラグインをテストします。
    * デフォルトでは、Create React Appの開発サーバーは、`http://localhost:3000`の場所にインスタンスを起動します。

#### **プラグイン開発API (Plugin Development API)**
この機能のAPIドキュメントを表示するには、「[Plugin development API](https://help.sigmacomputing.com/docs/plugin-development-api)」を参照してください。

プラグイン開発者は、Sigma Plugin Dev Playgroundという特別なプラグインへのアクセスが必要です。登録されると、このプラグインは`http://localhost:3000`を指します。詳細は、「[Sigma Plugin Dev Playgroundを登録する](https://help.sigmacomputing.com/docs/register-a-sigma-plugin-dev-playground)」を参照してください。

このプラグインが見つからない場合、または代替のデフォルトホストを持つ開発プレイグラウンドが必要な場合は、組織の管理者に、希望する開発URLを本番URLとして設定した上で「[あなたのSigma組織にプラグインを登録する](https://help.sigmacomputing.com/docs/register-a-plugin-with-your-organization)」ようリクエストしてください。

#### **開発プレイグラウンドを使用する (Use the development playground)**
1.  プラグインの開発URLを`http://localhost:3000`に設定します。
2.  プラグインをリモートで実行します。
    * 「[開発プロジェクトを作成する](https://help.sigmacomputing.com/docs/develop-sigma-plugins#create-a-development-project)」の推奨に従った場合、ターミナルで以下のコマンドを入力します。
    ```
    yarn && yarn start
    ```
3.  ワークブックを作成/開きます。
4.  ワークブックヘッダーで、`Edit`をクリックします。
5.  サイドバーの`+`ボタンをクリックして、ワークブックの`ADD NEW`パネルを開きます。
6.  `UI ELEMENTS`の下にある`PLUGINS`要素タイプを選択します。

<img width="1429" height="822" alt="66e0398-1" src="https://github.com/user-attachments/assets/b1842092-6f38-45d8-9018-fc8a3d91f6e6" />

7.  エディタパネルに利用可能なプラグインのリストが表示されます。`Sigma Plugin Dev Playground`を選択します。

<img width="1792" height="372" alt="2ce6630-2" src="https://github.com/user-attachments/assets/207d3229-d457-48e6-a0bd-1ef7bbee3ace" />

8.  新しいプラグイン要素がページに表示されます。エディタパネルは、Sigmaのプラグイン構成APIを使用してプラグインを構成した場合にのみコンテンツを表示します。同様に、プラグインがコンテンツを表示するように構成されている場合にのみ、要素はコンテンツを表示します。プラグインの構成オプションを変更した場合、入力値はエディタパネルで再追加する必要があります。

##### **次のステップ:**
* コードに変更を加えるにつれて、プラグインを更新できます。このオプションは、要素のメニューから利用できます。
* プラグインのホスティングはあなたの責任です。プラグインを登録する準備ができたら、「[Register a Plugin with Sigma](https://help.sigmacomputing.com/docs/register-a-plugin-with-your-organization)」をご覧ください。

#### **開発中にプラグインをテストする (Test the plugin in development)**
1.  開発サーバーを起動します。「[開発プロジェクトを作成する](https://help.sigmacomputing.com/docs/develop-sigma-plugins#create-a-development-project)」の推奨に従った場合、ターミナルで以下のコマンドを入力します。
    ```
    yarn && yarn start
    ```
2.  ワークブックを作成または開きます。
3.  プラグインを使用して既存の要素を操作したい場合は、その要素を選択します。それ以外の場合は、新しいプラグインベースの要素を作成します。
4.  要素にカーソルを合わせ、右上隅にある縦の•••アイコンボタンをクリックします。
5.  `Point to Development URL`を選択します。

<img width="1569" height="559" alt="c7a2bd4-image" src="https://github.com/user-attachments/assets/573df6fb-5251-4c96-9c9f-affe542b33e0" />

6.  `Configure Dev Server`モーダルで、開発URLを入力します。

<img width="610" height="196" alt="3457cbf-4" src="https://github.com/user-attachments/assets/c2bc105a-607b-4b96-a3a9-e77d09afd797" />

7.  `Confirm`をクリックします。

##### **次のステップ:**
* Sigmaプラグイン要素は、コードへの保存された変更を反映して自動的に更新されます。Sigmaページを更新する必要はありません。
* 一時的な開発URLを設定するために使用したのと同じ要素メニューから、いつでも本番URLに戻すことができます（上記の手順を参照）。
* プラグインの構成オプションを変更した場合、入力値はエディタパネルで再追加する必要があります。

#### **プラグインをホストする (Host your plugin)**
プラグイン開発者として、プラグインのホスティングはあなたの責任です。プロジェクトのホスティングが初めての場合は、これらの人気のホスティングプラットフォームをお勧めします：`Heroku`および`Netlify`。

### 14-2-3. プラグイン開発API (Plugin development API)

#### **PluginConfigOptionsオブジェクト (The PluginConfigOptions Object)**

##### **引数 (Arguments)**
* **name** `string`
    個々の構成オプションの識別子およびラベル。
* **type** `string`
    構成オプションの入力タイプ：
    * `element`: ユーザーがワークブック内のデータ要素を参照できるようにします。通常、データソースの選択に使用されます。
    * `column`: ユーザーがデータ要素の列を選択できるようにします。このタイプが割り当てられた`PluginConfigOptions`には、`source`と`allowMultiple`引数も含まれている必要があります。
    * `text`: ユーザーがテキストボックスにテキストを入力できるようにします。このタイプが割り当てられた`PluginConfigOptions`には、`secure`、`multiline`、`placeholder`、および`default value`引数も含まれている必要があります。
    * `group`: ユーザーが複数の`PluginConfigOptions`をグループ化できるようにします。この構成タイプは、「text」タイプのオブジェクトのみを含むことができます。
    * `toggle`: ユーザーが2つのブール値から選択できるようにします。
    * `checkbox`: ユーザーがオプションを選択できるようにします。
* **source** `string` (typeが“column”でない場合は無視されます)
    データソースとして使用されるデータ要素を格納する`PluginConfigOptions`オブジェクト（タイプ“element”）の`name`引数。
* **allowMultiple** `boolean` (typeが“column”でない場合は無視されます)
    `True`は、ユーザーが複数の値を選択できるようにします。
* **allowTypes** `string | undefined` (typeが“column”でない場合は無視されます)
    ユーザーに入力を防ぎたい、任意またはすべての列タイプのリスト。
    オプション: 'boolean', 'datetime', 'number', 'integer', 'text', 'variant', 'link', 'error'
* **secure** `boolean | undefined` (typeが“text”でない場合は無視されます)
    trueの場合：
    * パスワード入力タイプがテキストボックスに適用されます。
    * 入力値は、クエリ文字列を通じて平文で渡されません（事前ハイドレートされた設定の場合）。値は、プラグインとワークブック間の安全な接続が確立された後にのみ利用可能になります。
    falseの場合：
    * デフォルトのテキスト入力が使用されます。
    * 入力値はクエリ文字列を通じて平文で渡され、プラグインですぐに値にアクセスできます。
* **Multiline** `boolean | undefined` (typeが“text”でない場合は無視されます)
    `<input />`の代わりに`<textarea />`を使用します。
    注：セキュアとして設定することはできますが、パスワードタイプは使用されなくなります。
* **placeholder** `string | undefined` (typeが“text”でない場合は無視されます)
    テキスト入力のプレースホルダーテキスト。
* **defaultValue** `string | undefined` (typeが“text”でない場合は無視されます)
    値が設定されていない場合に、テキスト入力のデフォルトとして使用する値。

##### **例 (Examples)**
* **例 #1**
    以下のオブジェクトは、選択メニューを表示します。メニューには、ワークブック内のすべてのデータ要素が含まれます。ユーザーは、プラグインベースの要素のデータソースとして使用する要素をこのリストから選択します。
    `{ name: 'data source', type: 'element' }`

* **例 #2**
    以下のオブジェクトは、選択メニューを表示します。メニューには、ユーザーが「data source」入力でデータソースとして選択したデータ要素のすべての列がリストされます（上記の例#1を参照）。`allowMultiple`が`true`であるため、ユーザーはリストから複数の列を選択できます。
    `{ name: 'dimension', type: 'column', source: 'data source', allowMultiple: true }`

#### **構成API (Configuration API)**
`client.config.configureEditorPanel(editorPanelConfiguration)`
プラグインのワークブックのエディタパネルを構成します。

##### **引数 (Arguments)**
* **editorPanelConfiguration** `array<{PluginConfigOptions}>`
    プラグイン要素のエディタパネルで利用可能な入力を定義する`PluginConfigOptions`オブジェクトのリスト。

##### **例 (Example)**
```javascript
client.config.configureEditorPanel([
  { name: 'data source', type: 'element' },
  { 
    name: 'dimension',
    type: 'column',
    source: 'data source',
    allowMultiple: true
  },
  { name: 'measures', type: 'column', source: 'data source', allowMultiple: true },
  { name: 'a group of values', type: 'group' },
  { name: 'text input #1', source: 'a group of values', type: 'text' },
  { name: 'text input #2', source: 'a group of values', type: 'text' },
  { name: 'apiKey', type: 'text', secure: true },
]);
```
##### **client.config.get()**
`PluginConfigOptions`の配列を返します。
* **引数:** なし

##### **client.config.getKey(key)**
入力文字列に基づいて、特定の`PluginConfigOptions`オブジェクトを返します。
* **引数:**
    * **key** `string`: ターゲット`PluginConfigOptions`オブジェクトの`name`。

##### **client.config.set(config)**
一つ以上のキー/値ペアのプラグイン構成を更新し、ワークブックに保存します。
* **引数:**
    * **config** `array<{key: string, value: string}>`: 保存するキー/値ペア。ここで`key`は`PluginConfigOptions`オブジェクトの`name`、`value`はユーザーの入力値です。

##### **client.config.setKey(key, value)**
特定の`PluginConfigOptions`オブジェクトに関連付けられた入力値を更新し、ワークブックに保存します。
注：一度に複数の値を設定するには、`client.config.set(config)`を使用してください。
* **引数:**
    * **key** `string`: 関連する`PluginConfigOptions`オブジェクトの`name`。
    * **value** `any`: ユーザーの入力値。

##### **client.config.subscribe(listener)**
構成の変更を購読します。
* **引数:**
    * **listener** `config => void`: 構成に変更が加えられたときに呼び出される関数。

---

#### **標準JavaScript API (Standard Javascript API)**

##### **client.config.getElementColumns(elementId)**
指定された要素からの列情報を解決するPromiseを返します。
* **引数:**
    * **elementId** `string`: ワークブック要素の一意の識別子。

##### **client.elements.subscribeToElementColumns(elementId, listener)**
特定の要素の列情報の変更を購読します。
* **引数:**
    * **elementId** `string`: ワークブック要素の一意の識別子。
    * **listener** `function`: 呼び出されるコールバック関数。

##### **client.elements.subscribeToElementData(elementId, listener)**
特定の要素のデータ行の変更を購読します。データの形状は、`ColumnId`をキーとするセルデータの辞書です: `Dictionary<ColumnId, CellValue[]>`。
* **引数:**
    * **elementId** `string`: ワークブック要素の一意の識別子。
    * **listener** `function`: 呼び出されるコールバック関数。

---

#### **Hooks API**
React Hooksを使用して構築されたHooks APIは、Sigmaプラグインクライアントパッケージに含まれています。

##### **useElementColumns(elementId)**
指定された要素からの列情報を返します。
* **引数:**
    * **elementId** `string`: ワークブック要素の一意の識別子。

##### **useElementData(elementId)**
指定された要素からの行データを返します。データの形状は、`ColumnId`をキーとするセルデータの辞書です: `Dictionary<ColumnId, CellValue[]>`。
* **引数:**
    * **elementId** `string`: ワークブック要素の一意の識別子。

##### **useConfig(key)**
ワークブック要素の現在の構成を返します。キーが提供された場合、関連する構成のみが返されます。
* **引数:**
    * **key** `string` [任意]: 関連する`PluginConfigOptions`オブジェクトの`name`。

### 14-2-4. プラグインの例 (Plugin examples)

Sigmaの開発チームは、以下にリストされている一連のサンプルプラグインを作成しました。

私たちのすべてのサンプルプラグインはホストされており、あなたの組織に追加できます。組織にサンプルプラグインを表示または追加するには、以下にリストされている`Production URL`を使用してプラグインを登録する手順に従ってください。

また、Githubで直接[Sigmaのサンプルプラグインリポジトリ](https://github.com/sigma-computing/sigma-sample-plugins)にアクセスすることもできます。

#### **あなたの組織でサンプルを使用する (Use an example in your organization)**
以下の例は、あなたの組織に追加すると表示できます。
サンプルプラグインを組織に追加するには、以下にリストされている`Production URL`を使用して[プラグインを登録する](https://help.sigmacomputing.com/docs/register-a-plugin-with-your-organization)手順に従ってください。これらのURLはプラグインを登録する際に使用するためのものであり、ワークブック内で構成されるまでブラウザに何も表示されない場合があります。

* **Recharts Bar Chart**
    `Recharts`ライブラリで構築された基本的な棒グラフ。
    [ソースコード](https://github.com/sigma-computing/sigma-sample-plugins/tree/main/recharts-bar-chart) | **Production URL:** `https://sigma-sample-bar-chart-54049.netlify.app/`

* **D3 Candlestick**
    D3で構築されたローソク足ビジュアライゼーション。
    [ソースコード](https://github.com/sigma-computing/sigma-sample-plugins/tree/main/d3-candlestick) | **Production URL:** `https://sigma-sample-candlestick-chart-1664e5.netlify.app/`

* **D3 Graph**
    複数のデータソースとメモリ内結合の使用法を示します。
    [ソースコード](https://github.com/sigma-computing/sigma-sample-plugins/tree/main/d3-graph) | **Production URL:** `https://d3-graph-3a0d0f.netlify.app/`

* **D3 Sunburst**
    D3で構築されたサンバーストビジュアライゼーション。
    [ソースコード](https://github.com/sigma-computing/sigma-sample-plugins/tree/main/d3-sunburst) | **Production URL:** `https://d3-sunburst-b97c7c.netlify.app/`

* **Frappe Heatmap**
    基本的なFrappeビジュアライゼーションの例。
    [ソースコード](https://github.com/sigma-computing/sigma-sample-plugins/tree/main/frappe-heatmap) | **Production URL:** `https://frappe-heatmap-9a4163.netlify.app/`

#### **サンプルをローカルで実行する (Run an example locally)**
1.  ターミナルを開き、サンプルを保存したいディレクトリに移動します。
2.  Sigmaのサンプルプラグインリポジトリをクローンします。
    ```
    git clone [https://github.com/sigmacomputing/sigma-sample-plugins.git](https://github.com/sigmacomputing/sigma-sample-plugins.git)
    ```
3.  試したいプラグインに移動します。
    ```
    cd sigma-sample-plugins/<plugin-name>
    ```
4.  プラグインを実行します。
    ```
    yarn && yarn start
    ```
> 📘
> 追加の手順については、特定のサンプルプラグインのメインディレクトリにあるREADMEファイルをご覧ください。

### 14-2-5. アクションと連携するようにプラグインを構成する (Configure plugins to work with actions)

ワークブックは、2つの方法でプラグインを使用するアクションをサポートしています。
* **トリガー要素としてのプラグイン:** プラグインを使用して、ワークブック要素のアクションをトリガーできます。例えば、プラグインを使用して、ワークブックのコントロールやチャートを更新するアクションをトリガーできます。
* **ターゲット要素としてのプラグイン:** ワークブック要素がプラグイン内の効果をトリガーできるようにするアクションを作成できます。例えば、テーブルのセルを選択するなどのアクションが、プラグインのビジュアライゼーションをフィルタリングできます。

このドキュメントでは、ワークブックアクションと連携するようにプラグインコードを編集する方法について説明します。

トリガー要素としてのプラグインに関する詳細は、「[アクションの概要](https://help.sigmacomputing.com/docs/actions-overview)」の「Action triggers」を参照してください。ターゲット要素としてのプラグインに関する詳細は、「[プラグインを修正するアクションを作成する](https://help.sigmacomputing.com/docs/create-actions-that-modify-plugins)」を参照してください。

#### **前提条件 (Prerequisites)**
* 基本的なプラグインを作成しておく必要があります。手順については、「[Getting Started](https://help.sigmacomputing.com/docs/develop-sigma-plugins)」を参照してください。
* Dev Playgroundが設定されていることを確認してください。設定手順については、「[開発プレイグラウンドを使用する](https://help.sigmacomputing.com/docs/develop-sigma-plugins#use-the-development-playground)」を参照してください。

#### **トリガー要素として使用するプラグインを構成する (Configure plugins to use as trigger elements)**
プラグインを使用してワークブック要素のアクションをトリガーするには、プラグインコードに以下の変更を加えます。使用される関数の詳細については、Sigmaプラグインリポジトリの`README`を参照してください。

1.  `useEditorPanelConfig()`を呼び出して、構成オブジェクトのリストを作成します。`useEditorPanelConfig()`は、以下のタイプの構成オブジェクトのリストを期待します。
    * **type** : `string`、フィールドタイプ。プラグインをトリガー要素として使用する場合、`'action-trigger'`でなければなりません。
    * **name** : `string`、定義しているアクショントリガーの名前。
2.  `useConfig()`関数を使用して、`useEditorPanelConfig()`で定義された構成オブジェクトにアクセスします。
3.  Sigma内で構成されたアクションを呼び出す関数を返すために、`useEditorPanelConfig()`で定義された構成オブジェクトの名前で`useActionTrigger()`関数を呼び出します。例えば、構成オブジェクトの名前が`'ExampleAction'`の場合、`useActionTrigger(config.ExampleAction)`を呼び出します。
4.  希望のアクションをプログラムします。アクションは、`useActionTrigger()`によって返された関数を呼び出す必要があります。例えば、クリック時にステップ3の保存済み関数が呼び出されるように、ワークブックにUIボタンを構成することができます。
5.  プラグインを保存して更新します。これで、プラグインはSigmaのアクションと互換性があります。
6.  ワークブックで、希望のアクションシーケンスを設定します。トリガーできる効果とこれらのアクションの作成方法に関する詳細は、「[アクションの概要](https://help.sigmacomputing.com/docs/actions-overview)」の「Action effects」を参照してください。

#### **ターゲット要素として使用するプラグインを構成する (Configure plugins to use as target elements)**
ワークブック要素がプラグイン内の効果をトリガーできるようにするアクションを作成するには、まずプラグインコードに以下の変更を加える必要があります。使用される関数の詳細については、Sigmaプラグインリポジトリの`README`を参照してください。

1.  `useEditorPanelConfig()`を呼び出して、構成オブジェクトのリストを作成します。`useEditorPanelConfig()`は、以下のタイプの構成オブジェクトのリストを期待します。
    * **type** : `string`、フィールドタイプ。要素を使用してプラグイン効果をトリガーする場合、`'action-effect'`でなければなりません。
    * **name** : `string`、定義しているアクション効果の名前。
2.  `useConfig()`関数を使用して、`useEditorPanelConfig()`で定義された構成オブジェクトにアクセスします。
3.  呼び出されると、プラグインで希望の効果をもたらす関数を作成します。
4.  `useActionEffect()`を呼び出します。`useActionEffect()`は、構成オブジェクト（`useEditorPanelConfig()`で定義）と関数（希望のプラグイン効果をもたらす作成した関数）を受け取ります。`useActionEffect()`は何も返さないことに注意してください。
5.  プラグインを保存して更新します。これで、プラグインはSigmaのアクションと互換性があります。
6.  ワークブックで、プラグインの効果をトリガーするために使用したい要素を作成します。
7.  希望のアクションシーケンスを構成します。「[プラグインを修正するアクションを作成する](https://help.sigmacomputing.com/docs/create-actions-that-modify-plugins)」を参照してください。

### 15-1-1. Sigmaの管理 (Administer Sigma)

もしあなたがSigmaの管理者であれば、管理ポータルでSigma組織を構成およびカスタマイズできます。

管理ポータルにアクセスするには：
1.  **ホーム**に移動し、あなたのイニシャルが表示されたユーザーアイコンを選択します。
2.  **Administration**を選択します。

#### **管理者の能力 (Admin abilities)**
`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/user-account-types)を割り当てられたユーザーは、以下のことができます。
* 管理ポータル内のすべての構成にアクセスし、編集する
* Sigma組織内のすべてのドキュメントにアクセスし、編集する
* ユーザー、チーム、権限を管理する
* 監査ログやAI機能などのオプション機能を有効にする
* 組織または個々のユーザーに対してプライベートベータ機能を有効にするかどうかを決定する

他のユーザーは、割り当てられたアカウントタイプで有効になっている権限に応じて、管理ポータルの特定のセクションにアクセスできる場合があります。
* `Usage dashboard`セクションの権限は、`Usage`ページの利用状況ダッシュボードへのアクセスを許可します。
* `Manage all branding settings`は、カスタムSMTPサーバーの設定を含む、すべてのブランディング設定を管理するアクセスを許可します。
* `Manage all workbook themes and fonts`は、ワークブックテーマの設定など、特定のブランディング機能へのアクセスを許可します。
* `Manage plugins`は、プラグインを管理するアクセスを許可します。

#### **一般的な管理タスク (Common administration tasks)**

* **ユーザーのオンボーディングと、ロールベースのアクセス管理および認証方法の構成:**
    * **ユーザーとチームの管理:** [新しいユーザーを招待](https://help.sigmacomputing.com/docs/manage-members-and-teams#invite-new-users)し、[チームを作成](https://help.sigmacomputing.com/docs/manage-members-and-teams#create-a-team)して、新しいユーザーをオンボーディングします。[チーム管理者](https://help.sigmacomputing.com/docs/manage-members-and-teams#promote-a-team-admin)を設定して管理を簡素化します。
    * **権限とアクセスの構成:** [アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)をカスタマイズし、ユーザーに割り当てます。各アカウントタイプで有効になっている[権限を構成](https://help.sigmacomputing.com/docs/account-type-and-license-overview#customize-an-account-type)し、アカウントタイプの権限が[ドキュメントアクセス](https://help.sigmacomputing.com/docs/folder-and-document-permissions)や[データ権限](https://help.sigmacomputing.com/docs/data-permissions)とどのように相互作用するかを理解します。
    * **認証方法の設定:** [SAML](https://help.sigmacomputing.com/docs/configure-saml)または[OAuth](https://help.sigmacomputing.com/docs/configure-okta-oauth-for-sigma)認証方法を設定するか、[SCIM](https://help.sigmacomputing.com/docs/configure-scim)を構成してチームとユーザー管理を一元化します。

* **Sigmaとサードパーティのインテグレーションを設定し、追加の組織設定を管理する:**
    * **Sigmaとサードパーティツールを統合する:** AI機能を使用するための[OpenAI](https://help.sigmacomputing.com/docs/configure-an-ai-provider)、[Slack](https://help.sigmacomputing.com/docs/export-to-slack)を使用したエクスポート、dbtジョブ、メタデータ、およびSemantic Layerを使用するための[dbt](https://help.sigmacomputing.com/docs/configure-a-dbt-integration)とのインテグレーションを設定・管理します。
    * **Sigmaの機能を構成する:**

### 15-2-1. アカウントタイプとライセンスの概要 (Account type and license overview)

> 🚩
> あなたの組織がLite/Essential/Proライセンスモデルを利用している場合は、[こちらのアカウントタイプとライセンスの概要](https://help.sigmacomputing.com/docs/account-type-and-license-overview-legacy)を参照してください。

アカウントタイプとライセンスは、Sigmaのユーザー管理と価格設定構造の基本的な構成要素です。アカウントタイプにより、ユーザーがSigmaのデータやドキュメントにどのようにアクセスし、対話するかを決定する詳細な権限を選択できます。選択された権限によって、請求目的で使用されるアカウントタイプのライセンス階層が決定されます。

このドキュメントでは、Sigmaのライセンス階層の概要を説明し、アカウントタイプとライセンスの関係を解説します。また、各アカウントタイプにどのライセンスが割り当てられるかを決定する権限の包括的な比較も提供します。

#### **ライセンス階層 (License tiers)**
Sigmaは、組織の多様なユーザー要件とアクセス制御ポリシーに対応するため、異なるサービスレベルをサポートする4つのライセンス階層を提供しています。

| | View | Act | Analyze | Build¹ |
| :--- | :--- | :--- | :--- | :--- |
| **概要** | 準備されたデータやインサイトに基本的なインタラクションでアクセスする必要があるレポート消費者に適しています。 | データに積極的に入力・更新する共同作業型のデータ貢献者に最適です。 | ワークブックを自身で構築することなく、より深い分析能力を必要とする意思決定データ消費者に最適化されています。 | データをモデリング、変換、分析するデータアーキテクト、BIアナリスト、レポートビルダー向けに設計されています。 |
| **主な機能** | ・ワークブックの閲覧<br>・定義済みコントロールとドリルパスの使用<br>・集計された基盤データの表示<br>・PDFへのワークブックページ、PNGへのチャートのエクスポート<br>・コメントの追加と表示<br>・ワークブックをお気に入りに指定<br>・Ask Sigmaで自然言語クエリを実行 | **View**ライセンスの機能に加え：<br>・フォームの送信と入力テーブルの編集<br>・アクションのトリガー<br>・コメントへの注釈付け<br>・基盤となるデータの表示とフィルタリング<br>・AIでチャートを説明 | **Act**ライセンスの機能に加え：<br>・アドホック分析の実行<br>・レポートのスケジュール設定<br>・CSV, Excel, Google Sheetsへのエクスポート<br>・アラートの作成<br>・AI搭載の数式アシスタントの使用 | **Analyze**ライセンスの機能に加え：<br>・ワークブックの作成、編集、共有<br>・アクションでデータアプリとワークフローを構築<br>・データのモデリング、共有、マテリアライズ<br>・クラウドサービスへのデータエクスポート<br>・ユーザー、インテグレーション、接続の管理<br>・SQLとPythonの記述<br>・カスタムSQLロジックの表示 |

¹ Buildライセンスは、組織の設定とユーザーを管理できるシステム管理者もサポートします。

#### **アカウントタイプとライセンスの関係 (Account type and license relationship)**
アカウントタイプにより、管理ユーザーは組織のユーザーがアクセスできる機能と能力を決定する詳細な権限を選択できます。Sigmaは、有効化された権限の最も高いライセンス階層に基づいて、各アカウントタイプに自動的にライセンスを割り当てます。この関係により、ユーザーベースとユーザー要件の継続的な変化に適応する、より柔軟でスケーラブルなアクセス制御が可能になります。

#### **アカウントタイプ権限の利用可能性マトリックス (Account type permission availability matrix)**
以下の表は、各ライセンス階層に関連付けられたアカウントタイプの権限を比較したものです。アカウントタイプを構成する際、管理者はライセンス階層内および階層間で、権限の任意の組み合わせを有効または無効にできます。

| 機能エリア | 権限名 | View | Act | Analyze | Build |
| :--- | :--- | :---: | :---: | :---: | :---: |
| **データウェアハウス** | **View connections** | ✅ | ✅ | ✅ | ✅ |
| | **Manage connections¹** | | | | ✅ |
| | **Annotate tables¹** | | | | ✅ |
| | **Create stored procedure actions** | | | | ✅ |
| | **Call stored procedure actions** | | ✅ | ✅ | ✅ |
| **書き戻し** | **Create input tables²** | | ✅ | ✅ | ✅ |
| | **Schedule materializations²** | | | | ✅ |
| | **Upload CSV** | | | | ✅ |
| | **Create warehouse views²** | | | | ✅ |
| **データモデリング** | **View datasets²** | ✅ | ✅ | ✅ | ✅ |
| | **Create, edit, and publish datasets²**| | | | ✅ |
| **機能** | **Write Python** | | | | ✅ |
| | **Write SQL** | | | | ✅ |
| **ドキュメント** | **View workbooks²** | ✅ | ✅ | ✅ | ✅ |
| | **Can comment on workbooks⁴** | ✅ | ✅ | ✅ | ✅ |
| | **Basic explore²'³** | | | ✅ | ✅ |
| | **Full explore²'³** | | | ✅ | ✅ |
| | **Create, edit, and publish workbooks²**| | | | ✅ |
| | **Set workbook data refresh²** | | | | ✅ |
| **バージョンタグ** | **Apply tag²** | | | | ✅ |
| **組織管理** | **View usage dashboard** | | | | ✅ |
| | **View SQL in usage dashboard** | | | | ✅ |
| | **Manage all branding settings** | | | | ✅ |
| | **Manage all workbook themes and fonts**| | | | ✅ |
| | **Manage plugins** | | | | ✅ |
| | **Manage all badges** | | | | ✅ |
| **共有/フォルダ** | **Download²** | | | ✅ | ✅ |
| | **Export to email²** | | | ✅ | ✅ |
| | **Run exports as recipient²** | | | ✅ | ✅ |
| | **Export to Google Sheet²** | | | ✅ | ✅ |
| | **Export to Google Drive²** | | | ✅ | ✅ |
| | **Export to Slack²** | | | ✅ | ✅ |
| | **Schedule export²** | | | ✅ | ✅ |
| | **Share documents²** | | | | ✅ |
| | **Export to cloud²** | | | | ✅ |
| | **Export to webhook²** | | | | ✅ |
| | **Export as email burst** | | | | ✅ |
| | **Create new folders²** | | | ✅ | ✅ |
| | **Contribute to shared folders²** | | | | ✅ |
| | **Create new workspace** | | | | ✅ |
| **AI** | **Explain charts with AI⁵** | | ✅ | ✅ | ✅ |
| | **Use AI with formulas⁵** | | | ✅ | ✅ |
| | **Use Ask Sigma⁵** | ✅ | ✅ | ✅ | ✅ |

¹ 個々の接続へのアクセスは[データアクセス](https://help.sigmacomputing.com/docs/data-permissions)によって決定されます。
² 個々のデータセット、データモデル、ワークブックへのアクセスは[フォルダとドキュメントの権限](https://help.sigmacomputing.com/docs/folder-and-document-permissions)によって決定されます。
³ 包括的なユーザー能力の比較については、[Basic explore vs. Full explore](https://help.sigmacomputing.com/docs/workbook-modes-overview#basic-explore-vs-full-explore)を参照してください。
⁴ すべてのライセンス階層でコメントの追加と表示を有効にします。AnalyzeおよびBuildライセンスのみで、コメント内のスクリーンショットキャプチャと注釈を有効にします。
⁵ Ask Sigma、AIによるチャート説明、AI搭載の数式アシスタントなどのAI機能は、組織でAIプロバイダーが構成されている必要があります。

### 15-4-1. 認証を管理する (Manage authentication)

Sigmaは、ユーザー名とパスワードによる認証、またはSAMLやOAuthのシングルサインオン方法など、さまざまな認証方法をサポートしています。パスワード認証を使用する場合、二要素認証がデフォルトで有効になっています。詳細は、「[アカウントの必須二要素認証](https://help.sigmacomputing.com/docs/mandatory-two-factor-authentication-for-accounts)」を参照してください。

#### **ユーザー要件 (User requirements)**
組織の認証方法とオプションを管理するには、`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。

#### **認証方法 (Authentication methods)**

* **Password (パスワード)**
    Sigmaは、新しい組織メンバーに、少なくとも8文字長で、一般的に使用されるパスワードや類似のパスワードではない、Sigmaアカウント固有のパスワードを作成するよう促します。
* **SAML**
    Sigmaは、あなたが提供するシングルサインオン（SSO）プロトコルを通じて組織メンバーのアカウントを認証します。「[SSO with SAML](https://help.sigmacomputing.com/docs/configure-saml)」を参照してください。
* **SAML or Password (SAMLまたはパスワード)**
    組織メンバーは、SSOまたは固有のパスワードのいずれかで認証します。
* **OAuth**
    Sigmaは、OAuthシングルサインオン（SSO）を通じて組織メンバーのアカウントを認証します。
* **OAuth or Password (OAuthまたはパスワード)**
    Sigmaは、OAuthシングルサインオン（SSO）または固有のパスワードのいずれかで組織メンバーのアカウントを認証します。

> 🚧
> 認証方法をパスワードからSSOまたはOAuthに変更する場合、ユーザーがアカウントを維持するためには、ユーザーのメールアドレスが完全に一致している必要があります。

#### **認証方法とオプションを管理する (Manage authentication method and options)**
組織の認証方法とオプションを管理するには、以下を実行します。
1.  画面右上のユーザーメニューで`Administration`を選択して、管理ポータルを開きます。
2.  左のナビゲーションパネルで`Authentication`を選択します。
3.  `Authentication Method & Options`の下で、`Edit`をクリックします。
4.  `Authentication Method`で、ドロップダウンメニューから認証方法を選択します。
    * `SAML`または`SAML or password`を選択した場合、「[Single Sign On with SAML](https://help.sigmacomputing.com/docs/configure-saml)」を参照してください。
    * `OAuth`または`OAuth or password`を選択した場合、「[Configure OAuth](https://help.sigmacomputing.com/docs/configure-okta-oauth-for-sigma)」を参照してください。
    * `Password`を選択した場合は、これらの手順を続行します。
5.  [任意] ゲストユーザーアカウントを有効にするには、`Allow Guest Access`のトグルをオンにします。「[Guest User Accounts](https://help.sigmacomputing.com/docs/guest-user-accounts)」を参照してください。
6.  [任意] ユーザーが再認証を求められる頻度をカスタマイズするには、`Session Length in Hours`を設定します。この設定は、SAMLまたはパスワードでログインするユーザーにのみ適用されます。
7.  [任意] 一つ以上のドメインからのメールを持つ誰でも、個人招待なしで組織にアカウントを作成できるように承認するには、`Company Domain Signup`の下に一つ以上のカンマ区切りのメールドメインを指定します。詳細は、「[Company domain signup](#company-domain-signup)」を参照してください。
8.  組織の認証を構成した後、`Save`をクリックします。

#### **会社のドメインでのサインアップ (Company domain signup)**
`Password`認証をサポートする認証方法を使用する場合、許可リストにドメインを追加することを選択できます。デフォルトでは、新しいユーザーは招待状を受け取った場合にのみサインアップできます。会社のメールドメインを追加すると、会社のメールアドレスを持つ誰でも、個人招待なしでSigmaアカウントを作成できます。

Sigmaは、新しいユーザーに許可リストにあるドメインからのメールを入力するよう促します。メールを確認した後、ユーザーはアカウントを作成し、Sigmaユーザーとして登録できます。

#### **管理者によるパスワードリセット (Admin-initiated password reset)**
`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)が割り当てられており、組織がパスワードベースの認証方法を使用している場合、組織内のユーザーにパスワードリセットメールを送信できます。
1.  管理ポータルで、`People`タブをクリックします。
2.  `Members`タブで、ユーザーを検索または参照して見つけます。名前またはメールアドレスで検索できます。
3.  ユーザーについて、`More` > `Reset user password`をクリックします。
4.  Sigmaはユーザーにパスワードリセットメールを送信します。メールは、組織の管理者がパスワードのリセットを要求したことをユーザーに通知します。

#### **一括パスワードリセット (Bulk password reset)**
`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)が割り当てられており、組織がパスワードベースの認証方法を使用している場合、複数のユーザーに対してパスワードリセットを開始できます。
1.  管理ポータルで、`People`タブをクリックします。
2.  `Members`タブで、各ユーザーについて、名前の左側にあるチェックボックスを選択します。
3.  ツールバーで、`Reset password`をクリックします。
4.  選択内容を確認し、`Confirm`をクリックします。
5.  選択されたユーザーは、管理者がパスワードのリセットを要求したことを通知するメールを受け取ります。

### 15-5-1. dbtインテグレーションの管理 (Manage dbt Integration)

この記事では、dbtジョブをSigmaと統合する方法について説明します。dbtジョブから生成されたドキュメントとメタデータに、Sigma内で直接アクセスできます。

このSigmaとの統合の利点には、以下のようなものがあります。
* **データの鮮度:** dbtジョブの実行データがSigmaに表示され、データの鮮度を確認できます。
* **データ品質:** Sigmaで列やモデルに対するdbtの品質テストを表示でき、データ品質の問題に対する透明性が高まります。
* **データカタログ作成:** dbtのテーブルと列の説明がSigmaに表示され、ユーザーが探索するデータに関する追加のインサイトを提供します。

dbt Semantic Layerの統合を構成またはクエリするには、「[dbt Semantic Layer統合を構成する](https://help.sigmacomputing.com/docs/configure-a-dbt-semantic-layer-integration)」および「[dbt Semantic Layer統合にクエリを実行する](https://help.sigmacomputing.com/docs/query-a-dbt-semantic-layer-integration)」を参照してください。

#### **dbtデータ (dbt Data)**
Sigmaで利用可能なdbtメタデータは以下の通りです。
* **テーブルの説明:** テーブルビューに関するdbtソースの情報を提供します。
* **列の説明:** 列ビューに関するdbtソースの情報を提供します。
* **最終更新時刻:** `Last Modified`の日付を表示して、そのモデルがいつ実行されたか、つまりデータが最後にいつ更新されたかを確認できます。
* **テスト:** テストは、dbtプロジェクト内のモデルやその他のリソース（ソース、シード、スナップショットなど）について行われるアサーションです。

> 📘
> Sigmaのデータモデルとワークブックで情報スキーマに永続化された列の説明やその他の詳細を表示するには、dbtで`persist_docs`構成オプションを有効にする必要があります。dbtドキュメントの「[persist_docs](https://docs.getdbt.com/reference/project-configs/persist_docs)」を参照してください。このオプションを有効にしない場合、情報スキーマのメタデータは接続テーブルを閲覧しているときにのみ表示されます。
> dbtでこのオプションを有効にした後、Sigmaでテーブルを同期して列の説明が表示されるようにします。「[データを同期する](https://help.sigmacomputing.com/docs/sync-your-data)」を参照してください。

#### **要件 (Requirements)**
dbtインテグレーションを構成および管理するには、`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
始める前に、dbtサービス トークンが必要です。dbtドキュメントの「[Service account tokens](https://docs.getdbt.com/docs/dbt-cloud-apis/service-tokens)」を参照してください。サービストークンは、dbtアカウントへの少なくとも読み取りアクセス権を持っている必要があります。例えば、Teamプランの場合は`Read-Only`、Enterpriseプランの場合は`account viewer`です。

#### **dbtインテグレーションを構成する (Configure dbt integration)**
以下の手順を完了して、dbtへの接続を作成および構成します。
1.  画面右上のユーザーメニューで`Administration`を選択して、管理ポータルを開きます。
2.  `Account`タブで、`Integrations`セクションまで下にスクロールします。`dbt`の右側にある`Add`をクリックします。
3.  `dbt Integration`の下で、`Service Token`と`API Host`を入力します。
    * **Service Token:** dbtドキュメントの「[Service account tokens](https://docs.getdbt.com/docs/dbt-cloud-apis/service-tokens)」を参照してください。
    * **API Host:** 特定のAPIホストを入力します。dbtドキュメントの「[API access URLs](https://docs.getdbt.com/docs/dbt-cloud-apis/api-overview#access-urls)」を参照してください。
4.  `Save`をクリックします。
5.  `dbt`タブで、dbtジョブ、列、およびテーブルのメタデータを表示できます。
    > 📘
    > Sigmaがデータを取得するためにdbtでジョブが実行されるまで、dbtタブは接続ビューに表示されません。
6.  `Details`セクションでは、統合したdbtモデルのメタデータを表示できます。`Last Modified`フィールドで、dbtジョブの鮮度を確認できます。

#### **dbtを削除する (Remove dbt)**
dbtジョブをSigmaと正常に統合した後、インテグレーションを`Remove`するオプションが表示されます。

### 15-6-1. 組織のAI機能を構成する (Configure AI features for your organization)

Sigmaは、ユーザーのインサイトを加速させるために、いくつかのAI搭載機能¹を提供しています。
* **Ask Sigma**は、データに関する質問をしたり、AIが生成した応答と対話したりできる自然言語クエリ（NLQ）インターフェースです。「[Ask natural language queries with Ask Sigma](https://help.sigmacomputing.com/docs/ask-natural-language-queries-with-ask-sigma)」を参照してください。
* **数式アシスタント (formula assistant)**は、AIを使用して新しい数式を作成したり、数式のエラーを修正したり、既存の数式を説明したりします。「[Use AI with formulas](https://help.sigmacomputing.com/docs/use-ai-with-formulas)」を参照してください。
* **このチャートを説明 (Explain this chart)**は、AIを使用して任意のチャートの説明を即座に生成します。「[Explain charts with AI](https://help.sigmacomputing.com/docs/explain-charts-with-ai)」を参照してください。

¹ Sigma Computingは、既存の機能の改善と拡張に継続的に取り組んでいます。新しいAI機能が利用可能になり次第、このドキュメントは更新されます。

> 🚩
> AI機能の使用は、以下の[免責事項](https://help.sigmacomputing.com/docs/ai-feature-disclaimer)の対象となります。
> AI接続は、AIプロバイダーとしてSigmaによってのみ使用され、データが保存される場所とは別です。

管理者として、AIプロバイダーの構成、AI機能使用の権限構成、およびAsk Sigmaで利用可能なデータソースの選択ができます。
* [AIプロバイダーを構成する](#configure-an-ai-provider)
* [AI機能の権限を構成する](#configure-permissions-for-ai-features)
* [Ask Sigmaで利用可能にするデータソースを選択する](#select-data-sources-to-make-available-to-ask-sigma-beta)

#### **ユーザー要件 (User requirements)**
`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。

#### **AIプロバイダーを構成する (Configure an AI provider)**
Sigmaは現在、AIプロバイダーとしてウェアハウスAIモデル（SnowflakeおよびDatabricks接続上）と外部モデル（OpenAIおよびAzure OpenAI Foundry）をサポートしています。
* データプラットフォームでホストされているAIモデルの構成に関する情報については、「[Configure warehouse AI model integration](https://help.sigmacomputing.com/docs/configure-warehouse-ai-model-integration)」を参照してください。
* OpenAIまたはAzure OpenAI Foundryの構成に関する情報については、「[Manage OpenAI integration](https://help.sigmacomputing.com/docs/manage-openai-integration)」を参照してください。

#### **AI機能の権限を構成する (Configure permissions for AI features)**
どのSigmaユーザーがAI機能にアクセスできるかを制御するには、特定のアカウントタイプに対して関連する権限を有効または無効にします。

| AI機能 | 使用を有効にするアカウントタイプ権限 |
| :--- | :--- |
| **Ask Sigma** | `Use Ask Sigma` |
| **Formula assistant** | `Use AI with formulas` |
| **Explain this chart** | `Explain charts with AI` |

これらの権限にアクセスできるライセンス階層の詳細を含む詳細は、「[License and account type overview](https://help.sigmacomputing.com/docs/account-type-and-license-overview)」を参照してください。

#### **Ask Sigmaで利用可能にするデータソースを選択する (ベータ版) (Select data sources to make available to Ask Sigma (Beta))**
> 🚩
> このドキュメントはパブリックベータ機能について説明しており、現在作成中です...

Ask Sigmaで利用可能にするデータソースを選択します。人気のデータソースを選択して、ユーザーの結果の関連性を向上させます。
> 📘
> Ask Sigmaは、ユーザーに付与されたデータソースへのアクセス権を尊重します。各ユーザーは、自分がアクセスできるデータソースのみを表示およびクエリできます。

1.  **Administration > AI Settings**に移動します。
    a. Sigmaヘッダーで、ユーザーアバターをクリックしてユーザーメニューを開きます。
    b. `Administration`を選択して管理ポータルを開きます。
    c. サイドパネルで、`AI Settings`を選択します。
2.  `Ask Sigma data sources`セクションで、検索バーに用語を入力して、Ask Sigmaでのユーザーの質問への回答に使用するために利用可能にしたいテーブル、データモデル要素、およびデータセットを検索します。テーブル内のデータソースは、使用頻度順にリストされます。
    > 🚧
    > データモデルのタグ付きバージョンは、Ask Sigmaでは利用できません。
3.  Ask Sigmaで利用可能にしたいソースの隣にあるチェックボックスを選択します。
    > 📘
    > 以前に利用可能にするソースを選択した場合、Ask Sigmaで利用可能なソースのリストからそれらを削除したい場合を除き、チェックを入れたままにしてください。
4.  すべての関連データソースを選択した後、`Sync`をクリックします。
    > 📘
    > 初回同期後にデータプラットフォームでデータソースやメタデータを変更した場合は、この画面に戻り、手動でデータソースを再同期して、Ask Sigmaがそれらの変更にアクセスできるようにしてください。

##### **Ask Sigmaがユーザーの質問に答える際にデータソースを選択する方法 (How Ask Sigma selects data sources when answering user questions)**
Ask Sigmaは、以下の要因に基づいて、この順序でユーザーの質問に答えるために使用するデータソースを決定します。
1.  **データソースへのユーザーの権限。**
2.  **質問に対するデータの関連性。**
3.  **データの既知の有効性。** 例えば、データモデルに「推奨」バッジが付いている場合、Ask Sigmaはそれを提案する可能性が高くなります。
4.  **データソースの使用頻度。**

> 📘
> Ask Sigmaがどのデータソースを使用するかを決定するために、データソースにメタデータを追加する必要はありません。Ask Sigmaは、認定バッジ、ソースの説明、列の説明など、既存の利用可能なメタデータを使用して、ユーザーの質問への関連性を判断しますが、列名のみを使用して関連性を判断することもできます。

### 15-7-1. カスタムホームページを設定する (Set up custom homepages)

Sigmaでは、カスタムホームページを設定して、組織内のさまざまなユーザーに最も関連性の高い情報を提供できます。複数のカスタムホームページを設定し、それぞれを異なるチームに割り当て、個々のチームのニーズに応じて調整することができます。

例えば、新しいユーザーにガイド、テンプレート、社内の専門家を推奨する「新規ユーザーオンボーディング」ホームページを作成することができます。あるいは、特定の営業チームやエンジニアリングチームが最もよく使用するドキュメントをカスタムホームページで推奨し、それらのチームメンバーが便利にアクセスできるようにすることもできます。

これらのカスタムホームページでは、特定のワークブックの最初のページを、あなたの組織やチームが最初に目にするSigmaホームページの一部として埋め込むことができます。これらは埋め込まれたワークブックであるため、チャート、画像、ビデオ、テキスト、リンク、KPIなど、すべてのワークブック要素を活用できます。

このドキュメントでは、カスタムホームページの設定方法と、既存のホームページ構成の変更方法について説明します。

#### **システムとユーザー要件 (System and user requirements)**
* ホームページを有効化および割り当てするには、`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* ユーザーのグループごとに異なるホームページを設定したい場合は、彼らのために[Sigmaチーム](https://help.sigmacomputing.com/docs/manage-members-and-teams#create-a-team)を作成していることを確認してください。
* カスタムホームページとして設定したいワークブックは、対象となるユーザーと共有されている必要があります（ユーザーは少なくとも`Can view`の[ワークブック権限](https://help.sigmacomputing.com/docs/share-a-workbook)を持っている必要があります）。

> 🚧
> Sigma組織の認証方法としてOAuthを使用している場合、ユーザーが長時間SigmaにサインインしているとOAuthトークンが期限切れになり、アクセスエラーが発生することがあります。
> このシナリオを避けるために、カスタムホームページで使用するワークブックは、サービスアカウントの資格情報で実行するように構成してください。「[サービスアカウントの資格情報でワークブックを実行する](https://help.sigmacomputing.com/docs/run-a-workbook-with-service-account-credentials)」を参照してください。

#### **カスタムホームページを設定する (Set up a custom home page)**
カスタムホームページを設定するには：
1.  **Administration > Account > General Settings** に移動します。
2.  `Custom Home Pages`セクションで、`Enable`を選択します。
3.  `Assign Attribute`をクリックします。
4.  カスタムホームページを設定したいユーザーまたはチームを検索して選択します。
    * 組織全体で同じホームページを使用したい場合は、`All members of your Sigma organization`を検索して選択します。
5.  `Assigned Value`メニューから、カスタムホームページとして使用したいワークブックを検索して選択します。
6.  `Assign`を選択します。
7.  (任意) 異なるチームに異なるホームページを設定したい場合は、各チームに対してステップ5と6を繰り返します。チームに既にカスタムホームページが設定されている場合、利用可能なチームのドロップダウンリストには表示されません。

#### **カスタムホームページの割り当てを編集または削除する (Edit or remove a custom home page assignment)**
カスタムホームページの割り当てを編集または削除するには：
1.  **Administration > Account > General Settings** に移動します。
2.  `Custom Home Pages`セクションで、`Edit`を選択します。`User Attributes`ページが開き、`home_page`属性が設定されています。
3.  編集したい割り当てから、`More`をクリックします。
    * ホームページの割り当てを変更するには、`Edit value`を選択します。
    * ホームページの割り当てを削除するには、`Unassign`を選択します。

#### **カスタムホームページの優先順位を編集する (Edit custom home page priority)**
複数のチームに所属するユーザーがいる場合、どのホームページのリストが優先されるかを決定し、それに応じて並べ替えることができます。
1.  **Administration > Account > General Settings** に移動します。
2.  `Teams Assigned`の下で、リストをドラッグ＆ドロップして優先順位を変更します。Sigmaは、より優先度の高い割り当てのワークブックをユーザーに表示します。

例えば、あるチーム用のホームページと、組織内の他のすべてのユーザー用の別のホームページがあるとします。そのチームを最初の位置に置くと、彼らは割り当てられたワークブックを見ることになります。そのチーム以外のユーザーは、`All Members`に割り当てられたワークブックを見ることになります。

### 15-8-1. アカウントのタイムゾーンを変更する (Change the account time zone)

SigmaはすべてのデータをUTCで表示します。必要に応じて、これを変更して、組織の優先タイムゾーンですべての時間ベースのデータ値を表示することができます。

管理者権限がある場合、**Administration > Account > General Settings > Time**に移動して、組織のタイムゾーンを指定できます。

#### **要件 (Requirements)**
組織の管理者のみが、その組織のアカウントタイムゾーンを定義できます。

#### **タイムゾーンを選択する (Select a time zone)**
1.  **Administration > Account > General Settings** タブに移動します。
2.  **Time**セクションを見つけ、`Edit`をクリックします。
3.  **Account Timezone**ドロップダウンで、メニューからタイムゾーンを選択します。
    > 📘
    > あなたのタイムゾーンがリストにない場合は、アカウントマネージャーまたはサポートにお問い合わせください。
4.  `Save`をクリックします。

#### **タイムゾーンを変更した場合に何が起こるか (What to expect if you change the time zone)**
特にUTCタイムゾーンから切り替える場合は、このリストを注意深く確認してください。タイムゾーンを変更した後、以下のことが予想されます。
* **既存の絶対日付フィルター**は影響を受けませんが、新しいタイムゾーンで日付範囲を表示し始めます。
* **既存の相対日付フィルター**は、新しいタイムゾーンを反映します。
* **URL経由でワークブックのコントロール値に渡される日付値**は、アカウントのタイムゾーンに従って解析されます。このデフォルトの動作を上書きして、Sigmaが日付値をUTC+0タイムゾーンとして解析するようにすることもできます。
* **マテリアライズされたデータセット**は、更新されるまで新しいタイムゾーンに更新されません。
* **タイムゾーン対応の列に保存されているデータ**は、異なる解釈をされる可能性があります。この潜在的な不整合のため、日付値を保存するためにタイムゾーン対応の列を使用することは避けてください。
> 🚧
> SigmaにアップロードされたCSVは、日時値を保存するためにタイムゾーン対応の列を使用します。以前に日付列を持つCSVファイルをアップロードしたことがある場合は、組織のタイムゾーンを変更した後に再度アップロードして、新しいタイムゾーンで日付が誤って解釈されるのを防いでください。

タイムスタンプソースにタイムゾーンに関する情報が含まれていない場合、SigmaはUTCではなく、アカウントのタイムゾーンを自動的に適用します。
### 15-9-1. ウェアハウスビューの詳細を確認する (Review warehouse view details)

管理ポータルの**Warehouse Views**ページは、組織内のユーザーによって作成されたすべてのウェアハウスビューの詳細を確認するための一元的な場所を提供します。このページでは、特定のウェアハウスビューのステータスを検索・確認したり、ビューのパスを検証・コピーしたり、誰がいつビューを作成し、最後に更新したかを含む監査履歴を参照したりできます。また、ビューのソース要素の場所を特定し、そのワークブックに直接移動することもできます。

このドキュメントでは、管理ポータルの**Warehouse Views**ページを活用する方法について説明します。ビューの作成、名前の変更、削除に関する情報については、「[ワークブックのウェアハウスビューを作成・管理する](https://help.sigmacomputing.com/docs/warehouse-views)」を参照してください。

#### **ユーザー要件 (User requirements)**
管理ポータルの**Warehouse Views**ページにアクセスするには、`Admin`[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。

#### **Warehouse Viewsページを活用する (Utilize the Warehouse Views page)**
1.  **Administration > Warehouse Views**に移動します。
    a. Sigmaヘッダーで、ユーザーアバターをクリックしてユーザーメニューを開きます。
    b. `Administration`を選択して管理ポータルを開きます。
    c. サイドパネルで、`Warehouse Views`を選択します。
2.  **Warehouse Views**ページで、検索バー、ステータスフィルター()、および列のソートを使用して、焦点を絞ったリストを表示します。
    * 検索機能は、`Document`および`View name`フィールドで一致するものを探します。
3.  ソース要素名、ビュー名、[ステータス](#warehouse-view-statuses)、最終更新日など、組織のウェアハウスビューに関する詳細を確認します。
4.  特定のウェアハウスビューの名前を変更または削除するには、`Document`列のワークブック名をクリックします。Sigmaはワークブックを開き、そこでソース要素を見つけて[ビューを管理](https://help.sigmacomputing.com/docs/warehouse-views#manage-a-view)できます。

#### **ウェアハウスビューのステータス (Warehouse view statuses)**
ウェアハウスビューには以下のステータスが適用されます。

| ステータス | 説明 |
| :--- | :--- |
| **Pending** | Sigmaはワークブックが公開されるとビューを作成または更新します。|
| **Successful** | Sigmaはビューの作成または更新に成功しました。|
| **In Progress** | Sigmaは現在ビューを作成または更新中です。|
| **Failed** | ビューの作成または更新ができませんでした。¹ |

¹ 失敗ステータスの原因を表示するには、`Failed`ステータスインジケータにカーソルを合わせます。

### 15-10-1. 利用状況の概要 (Usage overview)

Sigmaのすべての組織は、Sigmaが構築した一連の利用状況ダッシュボードを自動的に受け取ります。利用状況ダッシュボードは、組織の使用傾向、クエリ統計、ドキュメントアクセス変更などを表す詳細なテーブルとチャートの形で、組織がSigmaをどのように使用しているかについての測定可能なインサイトを提供します。後で使用するために、このデータと関連するチャートをダウンロードできます。

#### **ユーザー要件 (User requirements)**
`Admin`アカウントタイプであるか、`View usage dashboard`権限が有効になっているカスタムアカウントタイプを割り当てられている必要があります。詳細は、「[アカウントタイプの作成と管理](https://help.sigmacomputing.com/docs/create-and-manage-account-types)」を参照してください。

#### **利用状況レポート (Usage reports)**

* **Users (ユーザー)**
    ユーザーステータスを探索し、アカウントとライセンスタイプの詳細を表示し、ユーザーエンゲージメントとアクティビティを追跡し、組織のチームに関するインサイトを表示します。
* **Document activity (ドキュメントアクティビティ)**
    組織で最も一般的に使用されているドキュメントと、それらに最もアクセスしているユーザーを発見します。これらのインサイトを使用して、未使用のドキュメントを監査し、最もユーザーエンゲージメントを促進するドキュメントを特定できます。
* **Document permissions (ドキュメント権限)**
    誰がドキュメントへの権限を持っているか、権限の起源、アクセスタイプ、および他のユーザーのアクセスタイプを変更したユーザーを発見します。これらのインサイトを使用して、セキュリティ目的でアクセスタイプの変更を監視するのに役立てることができます。
* **Exports (エクスポート)**
    組織のトップエクスポートユーザーに関するデータを表示し、オンデマンドおよびスケジュールされたエクスポートのインスタンスを含む、最も一般的にエクスポートされるドキュメントのリストを閲覧して、何が最も外部に共有されているか、どのユーザーまたはチームによって共有されているかについてのインサイトを得ます。
* **Materializations (マテリアライゼーション)**
    マテリアライゼーションの失敗率や実行時間を含むマテリアライゼーション統計を探索し、マテリアライゼーションを使用する各ドキュメントのリストを閲覧します。組織によって作成および使用されたすべてのマテリアライゼーションの詳細なログで、組織のマテリアライゼーションを追跡します。
* **Queries (クエリ)**
    組織のクエリに関する詳細なデータとインサイトを表示します。成功率とタイムアウト率、実行時間、クエリタイプなどに関する統計を探索します。最も多くのクエリを実行するユーザーとドキュメントを発見し、特定のクエリの人気のある時間と曜日に関するインサイトを得ます。すべてのクエリと関連情報の詳細なログで、組織のクエリを追跡します。
* **Embedding (埋め込み)**
    組織のJWTで署名されたセキュアな埋め込み、パブリック埋め込み、およびアプリケーション埋め込み（レガシー）の使用状況を表示します。JWTで署名されていないセキュアな埋め込みは追跡されません。

#### **利用状況情報にアクセスする (Access your usage information)**
管理ポータルの`Usage`タブにアクセスします。
1.  Sigmaヘッダーで、ユーザーアバターをクリックしてユーザーメニューを開きます。
2.  `Administration`を選択して管理ポータルを開きます。
3.  サイドパネルで、`Usage`を選択します。デフォルトで`Users`ダッシュボードが開きます。
4.  (任意) 別のダッシュボードを開くには、ページ上部のタブのいずれかをクリックします。
> 💡
> 一部の利用状況ダッシュボードのデータ要素には、チャートのデータを簡単にフィルタリングできるコントロールが少なくとも1つあります。これらのコントロールに異なる値を入力して、データを探索してください。

#### **チャートをダウンロードする (Download charts)**
利用状況ダッシュボードで表示されるチャートをダウンロードして、Sigma外でのより柔軟な共有と使用が可能です。
1.  ダウンロードしたいチャートを選択します。
2.  要素ツールバーから、`More`をクリックします。
3.  `Export`にカーソルを合わせ、エクスポートタイプを選択します。

#### **データ更新間隔 (Data update intervals)**
各ダッシュボードのデータは、以下の間隔に従って更新されます。
* **Users:** 毎時
* **Queries:** 毎時
* **Materializations:** 毎時
* **Exports:** 毎時
* **Embedding:** 毎時
* **Document activity:** 毎時
* **Document permissions:** 毎日

### 15-11-1. あなたのSigma組織にプラグインを登録する (Register a Plugin with your Sigma Organization)

Sigmaはワークブックでプラグイン要素をサポートしています。プラグインは、既存の製品に追加機能をもたらすために構築されたサードパーティのアプリケーションです。例えば、あなたの組織のソフトウェア開発者が、Sigmaではサポートされていないチャートタイプでデータを表示できるプラグインを作成することがあります。

組織のメンバーは、自分の組織に登録されているプラグインにのみアクセスできます。

#### **要件 (Requirements)**
プラグインを登録するには、Adminアカウントタイプ、またはプラグイン開発者機能の権限をサポートするカスタムアカウントタイプのいずれかを持っている必要があります。
プラグインはホストされている必要があります。本番URLを提供する必要があります。

#### **プラグインを登録する (Register a Plugin)**
1.  管理ポータルを開きます。
2.  `Account`ページで、`Custom Plugins`セクションまでスクロールします。
3.  セクションの`Add`ボタンをクリックして、`Create New Custom Plugin`モーダルを開きます。
4.  プラグインの`Name`を入力します。
5.  [任意] `Description`を入力します。
6.  プラグインがホストされている`Production URL`を入力します。
7.  プラグインの`Development URL`を入力します。詳細は、「[Sigmaプラグインを開発する](https://help.sigmacomputing.com/docs/develop-sigma-plugins)」を参照してください。
8.  `Create Plugin`をクリックします。
9.  任意のワークブックに[プラグイン要素を追加](https://help.sigmacomputing.com/docs/use-your-organizations-plugins)して、登録したプラグインをテストします。

#### **サンプルプラグイン (Example Plugins)**
Sigmaの開発チームは、一連のサンプルプラグインを作成しました。
私たちのすべてのサンプルプラグインはホストされており、あなたの組織に追加できます。Sigmaのサンプルプラグインの完全なリストを見るには、「[サンプルプラグイン](https://help.sigmacomputing.com/docs/example-plugins)」を参照してください。

### 16-1-1. Sigmaのサポート (Sigma support)

#### **Sigmaに連絡する (Contact Sigma)**
Sigmaチームは、あらゆる段階であなたをサポートするためにここにいます。ライブチャットプラットフォームがサポートエンジニアに連絡する最良の方法ですが、Sigmaに連絡するにはいくつかの方法があります。

| 方法 | 説明 |
| :--- | :--- |
| **ライブチャット (Live chat)** | リアルタイムでサポートエンジニアとチャットします。<br>Sigmaの営業時間（月曜日から金曜日、太平洋時間の午前2時から午後6時まで、[祝日](#holiday-schedule)を除く）中、エージェントは通常1分以内に応答します。営業時間外では、エージェントは重大な問題に30分以内に応答します。その他のすべての問題は、営業時間が再開されたときに対処されます。<br>チャットでSigmaに連絡するには、Sigmaアカウントの`Help`メニューを開き、`Live chat`を選択して`Send us a message`をクリックします。 |
| **エスカレーション (Escalations)** | 重要な問題をエスカレーションするためにライブチャットを使用することもできます。<br>エスカレーションの基準とベストプラクティスに関する情報については、「[重要な問題をエスカレーションする](https://help.sigmacomputing.com/docs/escalate-critical-issues)」を参照してください。 |
| **オフィスアワー (Office hours)** | 経験豊富なサポートエンジニアとの30分間のZoomセッションをスケジュールして、埋め込み、認証、入力テーブルなど、選択したトピックに関する質問に対応します。<br>[こちらをクリック](https://calendly.com/sigma-computing-support/sigma-support-office-hours)してオフィスアワーをスケジュールします。Sigmaアカウントで直接Sigmaのスケジューリングページにアクセスすることもできます。 |
| **サポートリクエスト (Support request)** | サポートリクエストを送信して、サポートエンジニアからのメール応答を受け取ります。<br>リクエストフォームの記入に関する詳細は、「[サポートリクエストを送信する](https://help.sigmacomputing.com/hc/en-us/requests/new)」を参照してください。 |
| **コミュニティ (Community)** | [Sigmaコミュニティ](https://community.sigmacomputing.com/)で質問したり、知識を共有したり、Sigmaのスタッフや他のメンバーと交流したりします。 |

#### **その他の役立つリソース (Other helpful resources)**

| リソース | 説明 |
| :--- | :--- |
| **Status (ステータス)** | [Sigma Computing Status](https://status.sigmacomputing.com/)ページを参照して、現在調査中の既知の問題を確認します。 |
| **Documentation (ドキュメント)** | Sigmaの[公開ドキュメント](https://help.sigmacomputing.com/)を閲覧して、新機能を発見し、Sigmaの使用方法についてさらに学びます。 |
| **QuickStarts (クイックスタート)** | ユースケースの実装に役立つ、ステップバイステップの[QuickStartレシピ](https://help.sigmacomputing.com/docs/quickstarts)を探索します。 |
| **Blog (ブログ)** | [Sigmaブログ](https://www.sigmacomputing.com/blog)をチェックして、データ、BI、およびSigmaが顧客に速度と使いやすさをどのように提供するかに関する最新のニュースと情報を入手します。 |
| **Events (イベント)** | ライブトレーニング、ミートアップ、ウェビナーなどの[イベント](https://www.sigmacomputing.com/events)に参加します。 |

#### **祝日スケジュール (Holiday schedule)**
以下の米国の連邦祝日中は、ライブチャットは利用できません。ただし、オンコールのエージェントは重大な問題に30分以内に応答します。その他のすべての問題は、営業時間が再開されたときに対処されます。
* 元日（1月1日）
* 感謝祭（11月の第4木曜日）
* 感謝祭の翌日
* クリスマス（12月25日）

### 16-1-2. サポートリクエストを送信する (Submit a support request)

[ライブチャット](https://help.sigmacomputing.com/docs/sigma-support#live-chat)が利用できない場合、またはメールでのサポートコミュニケーションを希望する場合は、Sigmaのサポートポータルでサポートリクエストを送信できます。

1.  `support.sigmacomputing.com`にアクセスし、`Submit a request`をクリックするか、[ここをクリック](https://help.sigmacomputing.com/hc/en-us/requests/new)して直接フォームを開きます。
2.  現在Sigmaサポートアカウントにログインしていない場合は、フォームにアクセスするために資格情報を送信してください。
    > 📘
    > Sigmaサポートアカウントは、Sigmaアプリのアカウントとは別のものであり、顧客のオンボーディング中に作成された可能性があります。サインインできず、`Forgot password`リクエストを送信した後にパスワードリセットメールが届かない場合は、既存のSigmaサポートアカウントがない可能性があります。リクエストするには、Sigmaのアカウントマネージャーにお問い合わせください。
3.  `Submit a request`フォームを完了します。
    * [任意] `CC`フィールドに、リクエストとすべての応答のコピーを受け取るべき追加のメールアドレスを入力します。Sigmaサポートアカウントに関連付けられたメールアドレスは、自動的に受信者として保存されます。
    * `Subject`フィールドに、リクエストの簡単な要約を入力します。
    * `Description`フィールドに、問題を説明し、サポートチームが迅速かつ簡単に支援できるように関連情報（エラーメッセージやIDなど）を含めます。
    * `Severity`フィールドをクリックし、ドロップダウンからオプションを選択します。

| | |
| :--- | :--- |
| **S3 (低)** | 一般的な製品に関する質問や機能リクエスト。 |
| **S2 (中)** | 特定の製品機能が低下し、少数のユーザーに影響を与えている。 |
| **S1 (高)** | 一つ以上の製品コンポーネントでSigmaのサービスまたはパフォーマンスが著しく低下し、ビジネスプロセスに影響を与えている。 |
| **S0 (緊急)** | 一つ以上の主要な製品コンポーネントでSigmaサービスにアクセスできず、重要なビジネスプロセスに影響を与えている。 |

    > 🚧
    > `S0`（緊急）の重要度レベルで送信されたリクエストは、曜日や時間に関係なく、オンコールのサポートエンジニアに直ちに警告します。問題が基準を満たす場合にのみ、この重要度レベルを選択してください。
    * [任意] `Attachments`セクションに、サポートチームが問題をよりよく理解するのに役立つ関連ファイルを追加します。
4.  `Submit`をクリックします。

Sigmaは、確認メールとすべてのサポート応答を、ヘルプデスクアカウントに関連付けられたメールアドレスに送信します。

### 16-1-3. 重要な問題のエスカレーション (Escalate critical issues)

月曜日から金曜日の太平洋時間（PT）午前2時から午後6時まで、Sigmaのアプリ内ライブチャットプラットフォームがサポートエンジニアに連絡する最良の方法です。サポート時間外では、ライブチャットプラットフォームを使用してサポートチケットをエスカレーションできます。サポート時間後、またはメールでのコミュニケーションを希望する場合は、[サポートリクエストを送信する](https://help.sigmacomputing.com/docs/submit-a-support-request)こともできます。

このドキュメントでは、エスカレーションフローとベストプラクティス、問題のエスカレーション方法、および一般的なエスカレーション基準カテゴリについて説明します。

#### **エスカレーションフローとベストプラクティス (Escalation flow and best practices)**

##### **どのような種類の問題をエスカレーションできますか？ (What types of issues can be escalated?)**
重要な問題には、Sigmaのコア機能が機能しない、データやビジュアライゼーション関連の問題、または内部および外部のセキュリティ関連の問題など、Sigmaへのアクセスや使用を妨げるものが含まれます。

##### **問題をエスカレーションするとどうなりますか？ (What happens when I escalate an issue?)**
ライブチャット時間外に問題をエスカレーションすると、Sigmaのサポートシステムはオンコールのサポートエンジニアに電話で直ちに通知します。このオプションに進む前に、問題が重要であり、実行可能な回避策がないことを確認してください。

##### **エスカレーションのベストプラクティスは何ですか？ (What are some best practices for escalation?)**
問題をエスカレーションする際のベストプラクティスには、以下が含まれます。
* **問題の影響と深刻度を確認する：**
    * 回避策があるかどうかを特定する。
    * 他のチームメンバーが同じ問題を経験しているかどうかを確認する。
    * 問題が他のブラウザやシークレットモードでも持続するかどうかを確認する。
    * 組織の管理者に相談して、問題の深刻度を確認する。
* **説明的かつ詳細であること：** スクリーンショット、録画、エラーログ、該当するエラーIDなど、経験している問題に関する情報をできるだけ多く提供してください。提供する情報が多いほど、サポートエンジニアはより迅速に支援できます。

##### **ライブチャットやサポートポータルがダウンしている場合、どのように問題をエスカレーションすればよいですか？ (How do I escalate an issue if live chat and/or the support portal is down?)**
ライブチャットが利用できない場合は、サポートポータルで[サポートリクエストを送信](https://help.sigmacomputing.com/docs/submit-a-support-request)してください。サポートポータルもダウンしている場合は、`support@sigmacomputing.com`までSigma Computingにご連絡ください。

#### **ライブチャット経由でエスカレーションする (Escalate via live chat)**
1.  `Help`メニューを選択し、`Live chat`を選択します。
2.  `Send us a message`を選択します。
3.  月曜日から金曜日の太平洋時間午前2時から午後6時の間にライブチャットを使用している場合は、問題の詳細を含むメッセージを送信し、サポートエンジニアの応答を待ちます。サポート時間外にライブチャットを使用している場合は、`Escalate via support ticket`を選択し、自動化されたチャットプロンプトに応答します。
    * 実行可能なロールバックバージョンまたは回避策がある場合は、問題を説明し、営業時間が再開されたときにサポートエンジニアが応答できるように求められます。
    * 実行可能なロールバックバージョンまたは回避策がない場合は、影響を受ける製品エリアを選択し、チケットの件名を入力し、問題を説明するように求められます。Sigmaはその後、サポートチケットを作成し、チャットでそのリンクを共有します。オンコールのサポートエンジニアにインシデントが通知され、通常30分以内に応答します。
    > 📘
    > リンクされたチケットにアクセスできない場合は、既存のSigmaサポートアカウントがないことを示している可能性があります。この場合、Sigmaはアカウントを作成し、Sigmaユーザーアカウントに関連付けられたメールにパスワード設定手順を送信します。

#### **エスカレーションカテゴリ (Escalation categories)**
サポート時間外にライブチャットを使用して問題をエスカレーションする場合、エスカレーション基準を選択するように促されます。以下は、提供されるカテゴリといくつかの問題例の非網羅的なリストです。

| エスカレーション基準カテゴリ | 問題例 |
| :--- | :--- |
| **コア機能が機能しない** | ログインまたは認証のエラー<br>ワークブックの分析および編集に関する問題（クエリがロードされないなど）<br>埋め込みが重大なエラーを表示するか、レンダリングされない |
| **データとビジュアライゼーション関連の問題** | 不正確なデータ出力<br>カスタムプラグインでビジュアライゼーションが表示されない<br>チャートのレンダリング問題により読みやすさが妨げられる |
| **セキュリティ関連の問題（内部または外部）** | 行レベルのセキュリティの漏洩<br>アクセス制御または資格情報の漏洩<br>マルウェア活動<br>認証バイパス |

### 16-2-1. Sigma製品のリリース (Sigma product releases)

この記事では、Sigma Computingが製品への変更をどのようにリリースするか、それらの変更が「[What’s new in Sigma](https://help.sigmacomputing.com/docs/whats-new)」でどのように告知されるか、そして異なるリリースフェーズで何を期待すべきかについて説明します。

#### **Sigma Computingが製品への変更をリリースする方法 (How Sigma Computing releases changes to the product)**
Sigma ComputingはSigmaサービスを継続的に進化させており、新機能や能力を追加し、お客様が製品でできることを改善しています。リリースは、バグ修正と新機能の両方で継続的に行われます。私たちはお客様に提供する価値を最大化するよう努めており、ソフトウェアの提供を遅らせる固定のリリースサイクルは使用していません。

私たちはフィーチャーフラグを使用して段階的なロールアウトで主要な変更をリリースするため、あなたの組織で利用可能な特定の機能が、まだすべてのお客様に利用可能ではない場合があります。段階的にリリースされる更新のドキュメントは、通常、大多数のお客様がその変更にアクセスできるようになった時点で表示されます。

#### **リリースノート (Release notes)**
Sigma Computingは、祝日を除き、毎週金曜日に最近の機能リリース、機能変更、およびバグ修正を発表します。この変更履歴を確認するには、「[What’s new in Sigma](https://help.sigmacomputing.com/docs/whats-new)」を参照してください。お客様は[RSS](https://help.sigmacomputing.com/hc/en-us/articles/4412321919251-What-s-new-in-Sigma/subscription.rss)を使用して変更履歴を購読できます。

#### **ベータ機能 (Beta features)**
Sigma Computingは、一部の機能をプライベートまたはパブリックのベータリリースで利用可能にします。これらの機能は、製品内ではベータアイコン()で、ドキュメントではベータ通知で識別されます。一部の機能には、ベータアイコンを追加できる製品のユーザーインターフェイスコンポーネントがない場合があります。その場合、ベータ通知はドキュメントにのみ表示されます。

* **プライベートベータ (Private beta)** 機能は、デフォルトでは利用できず、公に発表されません。プライベートベータ機能は頻繁な変更の対象であり、ドキュメントが利用可能である場合とない場合があります。限定テストグループへの参加に興味があり、Sigma組織でプライベートベータ機能を有効にしたい場合は、サポートに連絡するか、アカウントエグゼクティブにお問い合わせください。
* **パブリックベータ (Public beta)** 機能は、段階的なロールアウトですべてのお客様に製品で利用可能になります。お客様はパブリックベータ機能へのアクセスをリクエストする必要はありません。パブリックベータ機能には、ドキュメントが利用可能である場合とない場合があります。

すべてのベータ機能は、プライベートかパブリックかに関わらず、そのドキュメントと共に以下の通知の対象となります。
> 🚩
> 「Sigmaは、ベータ、パイロット、非本番、または同様の説明で指定されたサービスに関連する特定の機能（それぞれを「ベータ機能」）を顧客に利用可能にすることがあります。ベータ機能は、顧客の独自の裁量とリスクで使用されることがあります。ベータ機能は評価目的のみを意図しています。Sigmaは、独自の裁量でいつでもベータ機能を中止することができ、それらを一般に利用可能にしないことを選択することがあります。ベータ機能はサービスの一部と見なされますが、「現状有姿」で提供されます。」

#### **一般提供機能 (Generally available features)**
ドキュメントに別段の記載がない限り、機能は製品で一般的に利用可能です（GA）。最初にリリースされる際、GA機能は段階的なロールアウトですべてのお客様に製品で利用可能になります。「[How Sigma Computing releases changes to the product](#how-sigma-computing-releases-changes-to-the-product)」を参照してください。機能が以前にベータリリースでリリースされた場合、リリースノートはリリース発表に「(GA)」を含めることでGAへの移行を示します。

#### **非推奨の機能 (Deprecated features)**
Sigma Computingは、製品から機能と能力を非推奨にすることがあります。
非推奨の機能とは、Sigma Computingがさらなる機能強化を停止する意向を宣言した機能です。非推奨の機能は、既存のお客様に対しては製品で引き続き機能しますが、新しく作成された組織では利用できない場合があります。Sigma Computingは、通知期間後にすべてのお客様に対して製品から削除されるまで、非推奨の機能をサポートし、重要なバグ修正を提供し続けます。ただし、Sigmaのお客様は、将来のサポート終了に備えて計画を開始する必要があります。非推奨の機能は、ドキュメントで非推奨としてマークされています。

以下の機能は非推奨です。
* `GET /v2/workbooks/{workbookId}/schema`
* `PATCH /v2/connections/{connectionId}`
* ライブ編集なしのワークブックモード（ドキュメントは選択された顧客のみ利用可能）
* ウェアハウスデータ編集（ドキュメントは選択された顧客のみ利用可能）
* アプリケーション埋め込み（ドキュメントは選択された顧客のみ利用可能）

#### **削除された機能 (Removed features)**
Sigma Computingは、非推奨期間の後に製品から機能と能力を削除することがあります。
削除された機能はもはやサポートされておらず、使用できません。お客様は、削除された機能や能力を使用する代わりの方法を見つける必要があります。削除された機能のドキュメントは、すべてのお客様に利用できなくなります。

### 16-2-2. サポートされているリージョン、データプラットフォーム、および機能 (Supported regions, data platforms, and features)

Sigmaは様々なクラウドプラットフォームとリージョン、多くのデータプラットフォームへの接続をサポートしており、一部の機能は特定のデータプラットフォームでのみサポートされています。

#### **サポートされているクラウドプラットフォームとリージョン (Supported cloud platforms and regions)**
あなたのSigma組織は、以下のいずれかのクラウドプラットフォームでホストされています。
* Amazon Web Services (AWS)
* Microsoft Azure
* Google Cloud (GCP)

クラウド展開はSigma組織の作成時に選択され、作成後に移行または変更することはできません。
> 💡
> あなたの組織がどのクラウドプラットフォームでホストされているかわからない場合は、管理ポータルでそれを参照できます（`Admin`アカウントタイプが割り当てられている場合）。`Administration` > `Account` > `General Settings`に移動し、`Site`セクションを探します。`Cloud`フィールドが、あなたの組織をホストしているプラットフォームを識別します。

以下の表は、サポートされている特定のクラウドリージョンをリストしています。

| クラウドプラットフォーム | 場所 | サポートされているリージョン | APIエンドポイント |
| :--- | :--- | :--- | :--- |
| AWS | United States West | us-west-2 (primary)<br>us-east-1 (disaster recovery) | aws-api.sigmacomputing.com |
| | United States East | us-east-1 (primary)<br>us-west-2 (disaster recovery) | api.us-a.aws.sigmacomputing.com |
| | Canada | ca-central-1 | api.ca.aws.sigmacomputing.com |
| | Europe | eu-central-1 (primary)<br>eu-north-1 (disaster recovery) | api.eu.aws.sigmacomputing.com |
| | Australia and APAC | ap-southeast-2 | api.au.aws.sigmacomputing.com |
| | United Kingdom¹ | eu-west-2 (primary)<br>eu-west-1 (disaster recovery) | api.uk.aws.sigmacomputing.com |
| Azure | United States | eastus2 (primary)<br>centralus (disaster recovery) | api.us.azure.sigmacomputing.com |
| | Europe² | westeurope (primary)<br>northeurope (disaster recovery) | api.eu.azure.sigmacomputing.com |
| | Canada² | canadacentral | api.ca.azure.sigmacomputing.com |
| GCP | United States³ | us-central-1 | api.sigmacomputing.com |

¹ 英国のAWSホスト組織のSigmaユーザーは、監査ログへのアクセス権を付与されません。
² EUおよびカナダのAzureホスト組織のSigmaユーザーは、監査ログへのアクセス権を付与されません。
³ GCPホスト組織は、プライベート接続をサポートしていません。

#### **サポートされているデータプラットフォームと機能の互換性 (Supported data platforms and feature compatibility)**
Sigmaは以下のデータプラットフォームに接続します。
* AlloyDB
* Azure SQL Database (Beta)
* Amazon Redshift
* Databricks
* Google BigQuery
* MySQL
* PostgreSQL
* Snowflake
* Starburst Galaxy
* SQL Server 2022 and Azure SQL Managed Instance (Beta)

接続はほとんどのSigma機能をサポートしていますが、技術的な差異（SQLの方言、アーキテクチャ、セキュリティなど）により、一部の機能は現在すべてのデータプラットフォームと互換性があるわけではありません。以下の表は、各接続タイプの現在の機能制限をリストしています。

| CDW/DBMS | 機能の制限 |
| :--- | :--- |
| **AlloyDB connections** | 以下の機能をサポートしていません：<br>- Sigmaで作成されたデータセットウェアハウスビュー<br>- 入力テーブル<br>- プライベートリンク<br>- クラウドストレージへのエクスポート<br>- OAuth接続<br>- Sigma結果IDキャッシュ<br>- ロールとウェアハウス切り替えのためのユーザー属性<br>- 地理データ型<br>- 以下の配列関数: Array, ArrayDistinct, ArrayExcept, ArrayIntersection, ArrayJoin, ArraySlice<br>- 以下の集計関数: RegressionIntercept, RegressionR2, RegressionSlope<br>- すべての地理関数: Area, Centroid, Distance, Geography, Intersects, Json, Latitude, Longitude, MakeLine, MakePoint, Perimeter, Text, Within<br>- 以下のパススルー関数: AggGeography, CallGeography |
| **Amazon Redshift connections** | 以下の機能をサポートしていません：<br>- Sigmaで作成されたデータセットウェアハウスビュー<br>- GCPプラットフォーム上のプライベートリンク<br>- OAuth接続<br>- Sigma結果IDキャッシュ<br>- ロールとウェアハウス切り替えのためのユーザー属性<br>- 地理データ型<br>- 以下の配列関数: ArrayContains, ArrayDistinct, ArrayExcept, ArrayJoin, ArraySlice, Sequence<br>- 以下の集計関数: ArrayAgg, ArrayDistinct, ArrayIntersection, Corr, RegressionIntercept, RegressionR2, RegressionSlope<br>- すべての地理関数: Area, Centroid, Distance, Geography, Intersects, Json, Latitude, Longitude, MakeLine, MakePoint, Perimeter, Text, Within<br>- 以下のパススルー関数: AggGeography, CallGeography<br>- 以下のウィンドウ関数: CumulativeCorr, MovingCorr |
| **Azure SQL Database connections** | 以下の機能をサポートしていません：<br>- Sigmaで作成されたデータセットウェアハウスビュー<br>- クラウドストレージへのエクスポート<br>- OAuth接続<br>- Sigma結果IDキャッシュ<br>- ロールとウェアハウス切り替えのためのユーザー属性<br>- 書き戻し機能：CSVアップロード、入力テーブル<br>- 地理データ型<br>- すべての地理関数<br>- 以下の集計関数: RegressionIntercept, RegressionR2, RegressionSlope<br>- 以下のパススルー関数 (CallおよびAggバリエーションを含む): Geography, Variant, Logical<br>- 以下のウィンドウ関数: CumulativeCorr, MovingCorr, Corr<br>- CTEを含むカスタムSQL<br>- サンプル接続 |
| CDW/DBMS | 機能の制限 |
| :--- | :--- |
| **Databricks connections** | 以下の機能をサポートしていません：<br>- GCPプラットフォーム上のプライベートリンク<br>- クラウドストレージへのエクスポート<br>- Sigma結果IDキャッシュ<br>- ロールとウェアハウス切り替えのためのユーザー属性<br>- 地理データ型<br>- 以下の配列関数: Array, ArrayAgg, ArrayDistinct, ArrayExcept, ArrayIntersection, ArraySlice<br>- すべての地理関数: Area, Centroid, Distance, Geography, Intersects, Json, Latitude, Longitude, MakeLine, MakePoint, Perimeter, Text, Within<br>- ML予測<br>- SSH<br>- 以下のパススルー関数: AggGeography, CallGeography<br>- ストアドプロシージャアクション<br>- 入力テーブルの複数選択列 |
| **Google BigQuery connections** | 以下の機能をサポートしていません：<br>- 入力テーブル<br>- プライベートリンク<br>- クラウドストレージへのエクスポート<br>- OAuth接続<br>- ロールとウェアハウス切り替えのためのユーザー属性<br>- 以下の配列関数: Sequence<br>- 以下の集計関数: RegressionIntercept, RegressionR2, RegressionSlope |
| **MySQL connections** | 以下の機能をサポートしていません：<br>- Sigmaで作成されたデータセットウェアハウスビュー<br>- 入力テーブル<br>- GCPプラットフォーム上のプライベートリンク<br>- クラウドストレージへのエクスポート<br>- OAuth接続<br>- Sigma結果IDキャッシュ<br>- ロールとウェアハウス切り替えのためのユーザー属性<br>- 地理データ型<br>- 以下の配列関数: ArrayAgg, ArrayAggDistinct, ArrayDistinct, ArrayExcept, ArrayIntersection, ArrayJoin<br>- 以下の集計関数: Corr, RegressionIntercept, RegressionR2, RegressionSlope<br>- すべての地理関数: Area, Centroid, Distance, Geography, Intersects, Json, Latitude, Longitude, MakeLine, MakePoint, Perimeter, Text, Within<br>- 以下のパススルー関数: AggGeography, CallGeography<br>- 以下のウィンドウ関数: CumulativeCorr, MovingCorr |
| CDW/DBMS | 機能の制限 |
| :--- | :--- |
| **PostgreSQL connections** | 以下の機能をサポートしていません：<br>- Sigmaで作成されたデータセットウェアハウスビュー<br>- 入力テーブル<br>- GCPプラットフォーム上のプライベートリンク<br>- クラウドストレージへのエクスポート<br>- OAuth接続<br>- Sigma結果IDキャッシュ<br>- 地理データ型<br>- 以下の配列関数: Sequence<br>- 以下のテキスト関数: SHA256<br>- すべての地理関数: Area, Centroid, Distance, Geography, Intersects, Json, Latitude, Longitude, MakeLine, MakePoint, Perimeter, Text, Within<br>- 以下のパススルー関数: AggGeography, CallGeography |
| **Snowflake connections** | 以下の機能をサポートしていません：<br>- GCPプラットフォーム上のプライベートリンク<br>- 以下のウィンドウ関数: CumulativeCorr, MovingCorr |
| **Starburst Galaxy connections** | 以下の機能をサポートしていません：<br>- データセットウェアハウスビュー<br>- ワークブックウェアハウスビュー<br>- 書き戻し機能：入力テーブル、CSVアップロード、およびマテリアライゼーション<br>- プライベートリンク<br>- クラウドストレージへのエクスポート<br>- OAuth接続<br>- Sigma結果IDキャッシュ<br>- ロールとウェアハウス切り替えのためのユーザー属性<br>- 以下の配列関数: Array, ArrayDistinct, ArrayExcept, ArrayIntersection, ArraySlice<br>- 以下の集計関数: RegressionIntercept, RegressionR2, RegressionSlope<br>- 以下の地理関数: Centroid, Within, Intersects, Perimeter<br>- 以下のパススルー関数: AggGeography, CallGeography |
| **SQL Server 2022 and Azure SQL Managed Instance connections** | 以下の機能をサポートしていません：<br>- Sigmaで作成されたデータセットウェアハウスビュー<br>- クラウドストレージへのエクスポート<br>- OAuth接続<br>- Sigma結果IDキャッシュ<br>- ロールとウェアハウス切り替えのためのユーザー属性<br>- 書き戻し機能：CSVアップロードと入力テーブル<br>- 地理データ型<br>- すべての地理関数<br>- すべてのパススルー関数<br>- 以下の集計関数: RegressionIntercept, RegressionR2, RegressionSlope<br>- 以下のウィンドウ関数: CumulativeCorr, MovingCorr, Median<br>- CTEを含むカスタムSQL<br>- サンプル接続 |

#### **サポートされているウェブブラウザ (Supported web browsers)**
Sigmaは以下のウェブブラウザをサポートしています。
* **Google Chrome** (推奨): 最新バージョン
* **Safari:** 最新バージョン
* **Mozilla Firefox:** 最新バージョン
* **Microsoft Edge:** 最新バージョン
* **Opera:** 最新バージョン

#### **サポートされている認証方法 (Supported authentication methods)**
Sigmaは以下の認証方法をサポートしています。
* Security Assertion Markup Language 2.0 (SAML 2.0)
* OAuth
