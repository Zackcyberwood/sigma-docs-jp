### 5-1-1. ワークブックとデータモデルのデータリネージを表示する (View workbook and data model data lineage)

データリネージ（系譜）とは、ワークブックまたはデータモデル内のデータ要素間の祖先と関係を指します。すべてのワークブックとデータモデルには**リネージグラフ**が含まれており、ドキュメント内の関係と依存関係を確認・操作することができます。

データリネージのユースケースには、以下のようなものがあります。
* データ要素への変更が子要素にどのように影響するかを判断する
* 予期しないデータのソースを特定する
* 未使用または冗長な要素を削除するために既存のワークブックをクリーンアップする
* データおよび/または権限エラーのソースを診断する
* マテリアライゼーションスケジュールの依存関係を特定する

このドキュメントでは、ワークブックまたはデータモデルのデータリネージを表示し、操作する方法について説明します。

#### **要件 (Requirements)**

データリネージを表示するには、ワークブックまたはデータモデルに対する`Can Edit`[アクセス権](https://help.sigmacomputing.com/docs/share-a-workbook)が必要です。

#### **ワークブックまたはデータモデルのデータリネージを表示する (View data lineage for a workbook or data model)**

1.  ドキュメントヘッダーの`Edit`をクリックして、編集用にドキュメントを開きます。
2.  `(Lineage)`を選択して、ワークブックまたはデータモデルのデータリネージを開きます。
    > 💡
    > 特定の要素の要素ツールバーからリネージを開くこともできます。
    > 1.  要素ツールバーで、`More`を選択します。
    > 2.  メニューで、`View lineage`を選択します。
    > ドキュメントのデータリネージが、その要素がハイライトされた状態で開きます。

データリネージグラフでは、以下のいずれかを実行できます。
* `+`および`-`オプションを使用してズームインおよびズームアウトする。
* ブラウザウィンドウのビューにリネージグラフを合わせる。
* `Show controls`チェックボックスを選択して、コントロール要素を表示または非表示にする。
* カーソルで掴んでドラッグして、グラフ内を移動する。
* クリックしてドラッグすることで、グラフ内の要素を再編成する。要素の位置に加えた変更は、データリネージを閉じるとリセットされます。
* [特定の要素またはページにリネージビューをフォーカスする](#focus-your-lineage-view-on-a-specific-element-or-page)。
* [データリネージから要素を開く](#open-an-element-from-data-lineage)。

#### **特定の要素またはページにリネージビューをフォーカスする (Focus your lineage view on a specific element or page)**

* **始める前に:** このアクションは編集モードでのみ利用可能です。編集を開始するには、ドキュメントヘッダーの`Edit`をクリックします。

1.  `(Lineage)`を選択して、ワークブックまたはデータモデルのデータリネージを開きます。
2.  グラフの上部で、要素を検索するか、ドロップダウンメニューを開いてワークブックまたはデータモデル内の特定のページを選択します。
3.  メニューからページを選択すると、そのページの要素のみが表示されます。

#### **データリネージから要素を開く (Open an element from data lineage)**

* **始める前に:** このアクションは編集モードでのみ利用可能です。編集を開始するには、ドキュメントヘッダーの`Edit`をクリックします。

1.  `(Lineage)`を選択して、ワークブックまたはデータモデルのデータリネージを開きます。
2.  リネージグラフで要素を選択します。
3.  要素の詳細で、`View element`を選択します。

### 5-1-2. ワークブックまたは要素のデータソースを変更する (Change the data source for a workbook or element)

ワークブック全体または特定のデータ要素で使用されるデータソースを変更することができます。

例えば、実験や計算の作成中に本番データベースへの負荷を軽減するために、テストデータ接続からのデータソースでワークブックを構築することがあります。チームや組織とワークブックを公開・共有する準備ができたら、ワークブックで使用されているテストデータソースを本番データソースに置き換えることができます。

また、バージョンタグに基づいて、ワークブックやデータモデルのデータソースを自動的に変更または交換することもできます。「[Swap the source of a tagged version](https://help.sigmacomputing.com/docs/add-version-tags#swap-the-source-of-a-tagged-version)」を参照してください。

#### **要件 (Requirements)**
* 変更したい接続に対する`Can use`[アクセス権](https://help.sigmacomputing.com/docs/data-permissions)が付与されている必要があります。
* ワークブックに対する`Can edit`または`Can explore`のアクセス権が必要です。

#### **ワークブックのデータソースを交換する (Swap the data source for a workbook)**
ワークブック内のすべての要素のデータソースを交換するには（例えば、テストデータウェアハウス接続から本番データウェアハウス接続に変更するなど）、以下を実行します。

1.  ワークブックを`Edit`または`Explore`モードで開きます。
2.  ワークブックメニュー から、`Swap data sources…`を選択します。
3.  `Swap Data Sources Overview`モーダルで、自動選択された`Matching Connection`を確認します。必要に応じて、選択された接続を更新します。
4.  ワークブック内の各要素の`Matching Data Sources`を確認します。いずれかのデータソースに`No Match`がある場合は、`Match Manually`を選択して、一致するデータソースがない各要素に対して異なるデータソースを選択します。
5.  手動マッチページで、要素によって使用されるデータソースを選択し、`Select Source`をクリックします。
6.  新しいデータソースを検索または参照し、`Select`をクリックします。
7.  マッチングが必要な次のデータソースを選択し、これらのステップを繰り返します。
8.  一致しないすべてのデータソースが新しいデータソースにマッチングされた後、`Swap`を選択します。
9.  手動でマッチングする必要があるデータソースがない場合は、`Swap Now`を選択します。

ワークブックは新しいデータソースを使用するように更新されます。一致するデータソースがない要素はエラーを表示します。

> 🚩
> ワークブックに入力テーブルまたはカスタムSQL要素が含まれている場合、それらの要素のデータソースと接続は交換されません。代わりに、新しい接続をデータソースとして要素を再作成する必要があります。
> * **入力テーブルの場合、** 新しい接続で入力テーブルを作成し、古い入力テーブルから新しいものへデータをコピー＆ペーストします。
> * **カスタムSQL要素の場合、** 新しいSQL要素を作成し、新しいデータ接続に対して同等のSQLを記述します。

#### **要素のデータソースを変更する (Change the data source for an element)**
特定の要素に使用されるデータソースを変更することもできます。例えば、Snowflakeデータベースにビューを作成し、Sigmaのテーブル要素をSnowflake接続のベーステーブルの代わりにそのビューを使用するように更新したい場合、ソースを交換できます。

> 🚩
> 入力テーブルまたは接続されたデータウェアハウスを直接クエリするSQLを使用する要素のデータソースは変更できません。SQL要素のソースを変更すると、その要素はもはやSQLを使用しなくなります。

##### **要素のデータソースを交換する (Swap the data source for an element)**
`Edit`または`Explore`モードで要素を選択した後、データソースを変更できます。
1.  ワークブックキャンバスから、`More` > `Element source` > `Change source`を選択します。または、エディタパネルの`Properties`タブで、データソースの名前を探し、 > `Change source`を選択します。
2.  要素の新しいデータソースを検索または参照します。
3.  [任意] データソースをプレビューして特定の列を選択し、`Add`をクリックします。
4.  データソースを選択して、データソースの変更を完了します。

データ要素は更新されます。要素に新しいデータソースに存在しない列を参照する計算列が含まれている場合、その計算列は「unknown column」と表示されます。

##### **テーブル要素で使用されるテーブルを置き換える (Replace the table used by a table element)**
テーブルまたはピボットテーブル要素で使用されるテーブルを別のテーブルに置き換えたい場合は、以下を実行します。
1.  ワークブックキャンバスから、`More` > `Element source` > `Replace table`を選択します。または、エディタパネルの`Properties`タブで、データソースの名前を探し、 > `Replace table`を選択します。
2.  要素の新しいテーブルを検索または参照します。
3.  選択した列を確認し、任意で不要な列の隣にあるチェックボックスの選択を解除します。
4.  `Add`をクリックします。

データ要素は更新されます。テーブルに新しいテーブルに存在しない列を参照する計算列が含まれている場合、その計算列は「unknown column」と表示されます。

### 5-1-3. ワークブックの更新オプションを管理する (Manage workbook refresh options)

Sigmaは、個人がワークブックを開くか更新するたびに、ワークブックのデータを更新します。ユーザーの操作なしで画面に表示されるワークブックなど、設定されたスケジュールでワークブックのデータを更新したい場合は、カスタムの更新スケジュールを設定できます。

データ要素は個別に更新することもできますが、自動スケジュールでは更新できません。

> 🚩
> Sigmaはデータを保存しません。すべての更新は、ウェアハウス内のデータに再度クエリを実行します。自動更新を設定すると、接続に負荷がかかり、多額のウェアハウスコストが発生する可能性があります。

#### **要件 (Requirements)**

更新スケジュールを設定するには、個々のワークブックに対する`Can Edit`[アクセス権](https://help.sigmacomputing.com/docs/share-a-workbook)と、`Set workbook data refresh`権限が有効になっているアカウントタイプを割り当てられている必要があります。

ワークブックがホストアプリケーションに埋め込まれている場合、カスタム更新スケジュールを埋め込みコンテンツに適用するには、セキュアな埋め込みがJSON Web Tokens (JWTs)で認証されている必要があります。「[Create an embed API with JSON Web Tokens (Beta)](https://help.sigmacomputing.com/docs/example-embed-api-and-url#create-an-embed-api-with-json-web-tokens)」を参照してください。

#### **更新スケジュールを設定する (Set up a refresh schedule)**

ワークブックの更新スケジュールを設定するには、以下を実行します。
1.  ワークブックヘッダーの更新ボタンの右側にあるキャレット() `More options`をクリックします。
2.  `Data refresh`を選択します。
3.  `Data refresh settings`モーダルが開きます。
4.  `Refresh schedule`で、`Enable`トグルをオンにします。
5.  `Query data every`フィールドを調整して、ワークブックを更新する頻度を指定します。例えば、10分ごとなど。
6.  [任意] 更新スケジュールを特定の時間枠に制限するには、`Between`フィールドに時間を入力します。Sigmaは、更新スケジュールが有効であるべきかを評価するために、ブラウザのタイムゾーンを使用します。
7.  `Save`をクリックします。

#### **個々のデータ要素を更新する (Refresh individual data elements)**

個々のデータ要素のデータを手動で更新できます。
1.  データ要素を選択します。
2.  要素のツールバーで、`More`をクリックします。
3.  `Refresh data`をクリックします。
4.  要素内のデータが更新されます。

### 5-1-4. ワークブックのローカライゼーションを管理する (Manage workbook localization)

ローカライゼーションにより、ワークブックの編集者はカスタムワークブックのテキストを他の言語に翻訳できます。翻訳はワークブックのプレビューと埋め込みビューに適用されます。

管理者は、Sigma組織内のすべてのワークブックに適用される組織レベルの翻訳を作成することもできます。管理者によって管理される組織レベルの翻訳ファイルの詳細については、「[組織の翻訳ファイルを管理する](https://help.sigmacomputing.com/docs/manage-organization-translation-files)」を参照してください。

#### **要件 (Requirements)**
ワークブックの翻訳を管理するには、`Can edit`の[ワークブック権限](https://help.sigmacomputing.com/docs/share-a-workbook)が付与されている必要があります。
> 📘
> ワークブックのプレビューまたは埋め込みビューのURLと有効なロケール定義を持つ任意のユーザーが、翻訳されたワークブックを閲覧できます。

#### **サポートされている言語とロケール (Supported languages and locales)**
Sigmaは以下の言語とロケールをサポートしています。
| 言語 | ロケール |
| :--- | :--- |
| Chinese (Simplified) | zh-cn |
| Chinese (Traditional) | zh-tw |
| English (United States) | en |
| English (Australia) | en-au |
| English (Canada) | en-ca |
| English (Ireland) | en-ie |
| English (United Kingdom) | en-gb |
| French | fr |
| French (Canada) | fr-ca |
| German | de |
| Italian | it |
| Japanese | ja |
| Korean | ko-kr |
| Polish | pl |
| Portuguese | pt |
| Portuguese (Brazil) | pt-br |
| Russian | ru |
| Spanish | es |
| Spanish (Mexico) | es-mx |
| Swedish | sv-se |
| Thai | th |

#### **ワークブックの翻訳を作成する (Create a workbook translation)**
ワークブックの設定メニューからアクセスできる`Manage locales`パネルを使用して、ワークブックのロケールと翻訳を管理します。

1.  ワークブックを`Edit`モードで開きます。
2.  ワークブックの左サイドバーにある設定アイコン()をクリックして、ワークブックの設定パネルを開きます。
3.  `Manage locales`をクリックします。
4.  新しい言語を追加するには、`Available locales`の隣にあるプラスアイコン(+)をクリックします。
5.  ドロップダウンメニューから言語を選択します。
    > 📘
    > このステップを完了してワークブックのロケールを作成すると、すべての標準Sigmaテキスト（メニューラベル、モーダルテキストなど）の翻訳が有効になります。ワークブックのカスタムテキストを翻訳するには、この手順の残りを完了してください。
6.  ワークブック内のカスタムテキストの翻訳を追加するには、その他アイコン()をクリックし、jsonファイルをダウンロードします。

| オプション | 内容 | いつ使うか |
| :--- | :--- | :--- |
| **Download** | このオプションは、組織レベルの翻訳ファイルが存在しない場合に表示されます。結果のjsonファイルには、ワークブック内のカスタム文字列のすべてのキーと値のペアが含まれます。 | 管理者が組織全体に適用される翻訳を定義していない場合に、カスタムテキストの翻訳を定義するためにこのオプションを選択します。 |
| **Download untranslated strings** | 結果のjsonファイルには、組織レベルの翻訳ファイルのキーと一致しない、ワークブック内のカスタム文字列のキーと値のペアのみが含まれます。 | 組織レベルで定義されている値を上書きしたくない場合に、このオプションを選択します。 |
| **Download all strings** | 結果のjsonファイルには、ワークブック内のカスタム文字列のすべてのキーと値のペアが含まれます。 | このワークブックのカスタム文字列に適用されるすべての翻訳を確認したい場合、または組織レベルの翻訳をこのワークブック用に異なる翻訳で上書きしたい場合に、このオプションを選択します。|

7.  ダウンロードしたファイルを開きます。
8.  `.json`ファイルには、キーと値のペアのリストが含まれています。
    値を適切な翻訳に更新します。
    > 🚩
    > どのキーも編集しないでください。
9. ファイルを編集して保存します。ファイル名は変更しないでください。
10. Sigmaに戻ります。`Upload`をクリックし、更新した`.json`ファイルを選択します。
11. プレビューアイコン()をクリックして、翻訳されたテキストでワークブックのプレビューを開きます。

#### **ワークブックの翻訳を更新する (Update a workbook translation)**
#### **ワークブックの翻訳を更新する (Update a workbook translation)**
ワークブックにテキストの変更を公開するたびに、新しいまたは変更されたテキスト文字列の新しい翻訳を含むロケールの`.json`ファイルをダウンロードして再アップロードする必要があります。新しく追加された文字列は、jsonファイルの末尾に表示されます。

管理者がその言語の組織全体の翻訳ファイルを作成している場合は、未翻訳の文字列のみをダウンロードするか、すべての文字列をダウンロードするかを選択する必要があります。

| オプション | 内容 | いつ使うか |
| :--- | :--- | :--- |
| **Download (ダウンロード)** | このオプションは、組織レベルの翻訳ファイルが存在しない場合に表示されます。結果のjsonファイルには、ワークブック内のカスタム文字列のすべてのキーと値のペアが含まれます。 | 管理者が組織全体に適用される翻訳を定義していない場合に、カスタムテキストの翻訳を定義するためにこのオプションを選択します。 |
| **Download untranslated strings (未翻訳の文字列をダウンロード)** | 結果のjsonファイルには、組織レベルの翻訳ファイルのキーと一致しない、ワークブック内のカスタム文字列のキーと値のペアのみが含まれます。言い換えれば、組織レベルで翻訳が既に存在する場合、そのキーと値のペアはこのファイルでは省略されます。組織レベルのファイルで翻訳されていないキーは、このワークブックで定義された翻訳（もしあれば）を表示するか、まだ翻訳が提供されていない場合は英語の値を表示します。 | 組織レベルで定義されている値を上書きしたくない場合に、このオプションを選択します。 |
| **Download all strings (すべての文字列をダウンロード)** | 結果のjsonファイルには、ワークブック内のカスタム文字列のすべてのキーと値のペアが含まれます。組織レベルのファイルでのみ翻訳されているキーは、管理者がそのファイルで定義した値を表示します。組織レベルのファイルで翻訳されていないキーは、このワークブックで定義された翻訳（もしあれば）を表示するか、まだ翻訳が提供されていない場合は英語の値を表示します。組織レベルのファイルとワークブックレベルのファイルの両方で翻訳されているキーは、このワークブックで定義された翻訳を表示します。 | このワークブックのカスタム文字列に適用されるすべての翻訳を確認したい場合、または組織レベルの翻訳をこのワークブック用に異なる翻訳で上書きしたい場合に、このオプションを選択します。|

#### **言語のカスタム翻訳を追加する (Add a custom translation for a language)**

特定の言語に対して複数のユニークな翻訳を維持することができます。言語のカスタム翻訳を追加すると、例えば、埋め込みダッシュボードの異なる消費者に対して、ワークブック内の文字列を異なる方法で翻訳できます。

言語のカスタム翻訳を追加すると、カスタム翻訳ファイルがベース言語ファイルの**代わり**に使用されます。ベース言語ファイルに加えてカスタムの翻訳セットを適用するには、ベース言語ファイルをカスタム言語ファイルに複製してください。

1.  ワークブックを`Edit`モードで開きます。
2.  ワークブックの左サイドバーにある設定アイコン()をクリックして、ワークブックの設定パネルを開きます。
3.  `Manage locales`をクリックします。
4.  `Available locales`の隣にあるプラスアイコン(+)をクリックします。
5.  ドロップダウンメニューで、`Add custom translations`を選択します。
6.  カスタム翻訳ファイルの名前を入力します。
    > 🚩
    > 管理者が定義した組織レベルのカスタム翻訳セットをこの言語で継承したい場合は、ここで管理者が組織レベルの翻訳ファイルを作成した際に使用したのと同じ名前を使用する必要があります。管理者にファイルの名前を尋ねてください。
7.  `Base language`を設定して、すべての標準Sigmaテキスト（メニューラベル、モーダルテキストなど）に使用する言語を指定します。
8.  `Add`をクリックします。
9.  利用可能なロケールのリストで、追加したカスタム言語バリアントを見つけます。
    > 📘
    > 組織レベルの言語バリアントが存在し、カスタム言語バリアントファイルに同じ名前を使用した場合、組織レベルのファイルはグレーで表示されます。
10. ワークブック内のカスタムテキストの翻訳を追加するには、その他アイコン()をクリックし、jsonファイルをダウンロードします。

| オプション | 内容 | いつ使うか |
| :--- | :--- | :--- |
| **Download (ダウンロード)** | このオプションは、組織レベルの翻訳ファイルが存在しない場合に表示されます。結果のjsonファイルには、ワークブック内のカスタム文字列のすべてのキーと値のペアが含まれます。 | 管理者が組織全体に適用される翻訳を定義していない場合に、カスタムテキストの翻訳を定義するためにこのオプションを選択します。 |
| **Download untranslated strings (未翻訳の文字列をダウンロード)** | 結果のjsonファイルには、組織レベルの翻訳ファイルのキーと一致しない、ワークブック内のカスタム文字列のキーと値のペアのみが含まれます。 | 組織レベルで定義されている値を上書きしたくない場合に、このオプションを選択します。 |
| **Download all strings (すべての文字列をダウンロード)** | 結果のjsonファイルには、ワークブック内のカスタム文字列のすべてのキーと値のペアが含まれます。組織レベルのファイルでのみ翻訳されているキーは、管理者がそのファイルで定義した値を表示します。このワークブックレベルのファイルで翻訳されているキーは、このワークブックで既に定義されている翻訳（もしあれば）を表示するか、まだ翻訳が提供されていない場合は英語の値を表示します。組織レベルのファイルとワークブックレベルのファイルの両方で翻訳されているキーは、このワークブックで定義された翻訳を表示します。 | このワークブックのカスタム文字列に適用されるすべての翻訳を確認したい場合、または組織レベルの翻訳をこのワークブック用に異なる翻訳で上書きしたい場合に、このオプションを選択します。|

11. ダウンロードしたファイルを開きます。
12. `.json`ファイルには、キーと値のペアのリストが含まれています。
13. 値を適切な翻訳に更新します。
    > 🚩
    > どのキーも編集しないでください。
14. ファイルを編集して保存します。ファイル名は変更しないでください。
15. Sigmaに戻ります。`Upload`をクリックし、更新した`.json`ファイルを選択します。
16. プレビューアイコン()をクリックして、翻訳されたテキストでワークブックのプレビューを開きます。

カスタム翻訳は、管理者によって作成された組織レベルのファイルから継承できます。「[組織の翻訳ファイルを管理する](https://help.sigmacomputing.com/docs/manage-organization-translation-files)」を参照してください。

#### **翻訳ファイルでマークダウンと動的テキストを使用する (Use markdown and dynamic text in a translation file)**

JSONの値にマークダウンと動的テキストを使用して、リッチテキストをサポートできます。

値の一部として動的テキストを生成するには、以下の構文を使用します。 `[={formula-id}]`

他のリッチテキストにはマークダウン構文を使用します。

| 表示 | マークダウンバージョン |
| :--- | :--- |
| I love **bold** text. | `I love **bold** text.` |
| *Italics* are great too. | `*Italics* are great too.` |
| Click this [link](https://help.sigmacomputing.com). | `Click this [link](https://help.sigmacomputing.com).` |
| * Bullet points<br>* Make bulleted lists | `* Bullet points`<br>`* Make bulleted lists` |
| 1. Numbers<br>2. Make numbered lists | `1. Numbers`<br>`2. Make numbered lists` |

#### **埋め込みまたはプレビューにロケールと翻訳を適用する (Apply locales and translations to embeds or previews)**
埋め込みまたはプレビューにロケールを適用するには、埋め込みまたはワークブックプレビューのURLに `:lng=<your-locale>` を追加します。ロケールを適用すると、メニューラベルやモーダルテキストなどの標準Sigmaテキストが、ロケールに関連付けられた言語に翻訳されます。そのロケールに翻訳ファイルが定義されている場合、ロケールを適用すると、ワークブック内のカスタムテキストも定義された翻訳で翻訳されます。
言語のカスタム翻訳バリアントを適用する場合は、`:lng_variant=<variant+name>` も追加します。名前の特殊文字にはURLエンコーディングを使用してください。

* **埋め込みAPIコードの例:**
    ```javascript
    // 注：ローカライゼーションの値は大文字と小文字を区別します
    searchParams += '&:lng=fr-ca';
    ```
* **カスタム翻訳バリアントの埋め込みAPIコードの例:**
    ```javascript
    // 注：ローカライゼーションの値は大文字と小文字を区別します
    searchParams += '&:lng=it&:lng_variant=Custom+Italian';
    ```
* **埋め込みURLの例:**
    `https://app.sigmacomputing.com/my-company/workbook/My-Workbook-2PG8oM9uFxNLyzxAukJfBrL?:embed=true&:lng=fr-ca`
* **カスタム翻訳バリアントの埋め込みURLの例:**
    `https://app.sigmacomputing.com/my-company/workbook/My-Workbook-2PG8oM9uFxNLyzxAukJfBrL?:embed=true&:lng=it&:lng_variant=Custom+Italian`
> 💡
> ロケールを適用するために翻訳ファイルは必須ではありません。
> 翻訳ファイルが定義されていなくても、上記のパラメータを使用して埋め込みやプレビューにロケールを適用し、メニューラベルやモーダルテキストなどの標準Sigmaテキストを別の言語で表示することができます。

#### **現在の制限事項 (Current limitations)**
* 自動生成されたデータ要素名（例：Sum of Cost by Year of Date）は、Sigmaが生成する.jsonファイルには含まれません。翻訳を定義する前に、すべてのデータ要素を手動で命名してください。
* 探索モードはサポートされていません。
* 数値と日付のフォーマットはサポートされていません。

### 5-1-5. ワークブックのページの可視性を管理する (Manage workbook page visibility)

デフォルトでは、ワークブックのページは、ワークブックを閲覧、探索、または編集する権限を持つすべてのユーザーに表示されます。個々のページの可視性を変更して、特定のワークブックのコンテンツの閲覧を制限することができます。

このドキュメントでは、Sigmaのページの可視性オプションについて説明し、特定のページの可視性をカスタマイズする方法を解説します。

#### **ユーザー要件 (User requirements)**
ワークブックのページの可視性を管理する機能には、以下が必要です。
* `Create, edit, and publish workbooks`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* あなたがワークブックの所有者であるか、`Can edit`の[ワークブック権限](https://help.sigmacomputing.com/docs/share-a-workbook)を付与されている必要があります。

#### **ページの可視性を理解する (Understanding page visibility)**
ページの可視性はセキュリティ機能ではありません。データへのアクセスを制限する必要がある場合は、「[Dataset Row-Level Security](https://help.sigmacomputing.com/docs/set-up-row-level-security)」を参照してください。
> 📘
> ワークブック内の少なくとも1つのページには、ページの可視性制限が適用されていない状態である必要があります。
> 🚧
> ページの可視性設定は、`View`および`Explore`モードでのみ適用されます。ワークブックの所有者および特定のワークブックに対する`Can edit`権限を付与された任意のユーザーは、ページの可視性設定に関わらず、`Edit`モードですべてのページにアクセスできます。
> 🚧
> `Save As`権限を持つユーザーがワークブックのコピーを保存すると、元のワークブックのページの可視性設定に関わらず、コピーにはすべてのページが表示されます。

##### **ページの可視性アイコン (Page visibility icons)**
ページタブには、現在のページの可視性設定を示すアイコンが表示されます。

| アイコン | 説明 |
| :--- | :--- |
| (アイコンなし) | ページがすべてのユーザーに表示されることを示します。|
| (アイコン) | ページが選択されたユーザーまたはチームにのみ表示されることを示します。|
| (アイコン) | ページがすべてのユーザーから非表示になっていることを示します。|

##### **ワークブックのバージョンとセキュアな埋め込みでのページの可視性 (Page visibility in workbook versions and secure embeds)**
* **タグ付きバージョン (Tagged versions)**
    タグ付きのワークブックバージョンは、タグが適用されたときにワークブックに保存されたページの可視性設定を継承します。したがって、あるバージョンではユーザーがページにアクセスでき、別のバージョンでは同じユーザーから非表示にすることができます。
* **セキュアな埋め込み (Secure embeds)**
    セキュアな埋め込みでのページの可視性は、チーム設定によって決定されます。ページは、ユーザーの割り当てられたチームに表示されている場合（`Show page to all users`または`Only show to select users or teams`を介して）にのみ、埋め込みユーザーに表示されます。
    > 🚧
    > セキュアな埋め込みユーザーが埋め込まれたワークブックのコピーを保存すると、元のワークブックのページの可視性設定に関わらず、コピーにはすべてのページが表示されます。

#### **ページを非表示または再表示する (Hide or unhide a page)**
`Hide page`および`Unhide page`オプションを使用して、すべてのユーザーに対するページの可視性を迅速に更新します。
1.  ワークブックを`Edit`モードで開きます。
2.  カスタマイズしたいページのタブを探します。
3.  タブのキャレット()をクリックしてページメニューを開き、利用可能なオプションを選択します。
    * **Hide page:** `View`または`Explore`モードでワークブックにアクセスするすべてのユーザーからページを非表示にします。ページが現在すべてのユーザーに表示されている場合に利用可能です。
    * **Unhide page:** 任意のモードでワークブックにアクセスするすべてのユーザーにページを表示します。ページが現在すべてまたは選択されたユーザーとチームから非表示になっている場合に利用可能です。

#### **ページの可視性をカスタマイズする (Customize page visibility)**
`Customize page visibility`オプションを使用して、すべてのユーザーまたは特定のユーザーとチームに対するページの可視性を更新します。
1.  ワークブックを`Edit`モードで開きます。
2.  カスタマイズしたいページのタブを探します。
3.  タブのキャレット()をクリックしてページメニューを開き、`Customize page visibility`を選択します。
4.  `Customize Page Visibility`モーダルで、ページの可視性を構成します。
    a. `Page visibility setting`フィールドをクリックし、ドロップダウンからオプションを選択します。
        * **Hide page from all users:** `View`または`Explore`モードでワークブックにアクセスするすべてのユーザーからページを非表示にします。
        * **Show page to all users (default):** 任意のモードでワークブックにアクセスするすべてのユーザーにページを表示します。
        * **Only show to select users or teams:** 選択されたユーザーとチームにのみページを表示します。`View`または`Explore`モードでワークブックにアクセスする残りのユーザーからはページを非表示にします。
    b. ステップ4aで`Only show to select users or teams`を選択した場合は、`Select users`フィールドを使用して、該当するユーザーとチームを検索して選択します。
    c. `Save`をクリックして、ページの可視性の変更を適用します。

### 5-1-6. ドキュメントにショートカットを追加する (Add shortcuts to documents)

複数の場所にドキュメントへのリンクを保存したい場合は、ショートカットを追加できます。

ショートカットを使用して、特定のデータソースをソースピッカーで見つけやすくしたり、主要なワークブックやデータモデルへのアクセスを容易にするためにドキュメントを整理したりします。

例えば、「Sales」ワークスペースにある「Quarterly Sales Targets」ワークブックへのショートカットを、個人の「My Documents」フォルダに追加して、そのワークブックに簡単にアクセスできるようにすることができます。

別の例として、「Marketing」ワークスペースに「Google Analytics」データモデル（またはデータウェアハウステーブル）へのショートカットを追加できます。次にMarketingワークスペースの誰かがワークブックに新しい要素を追加しようとするとき、その標準的なデータモデルが簡単に見つかります。

#### **サポートされているショートカットドキュメント (Supported shortcut documents)**
以下のファイル、フォルダ、その他のオブジェクトへのリンクを、Sigmaのワークスペースまたはフォルダにショートカットとして保存できます。
* ワークブック
* フォルダ（「My Documents」を除く）
* ワークスペース
* データモデル（データモデル内の可視要素を含む）
* データセット
* データウェアハウスのテーブル、ビュー、スキーマ、カタログ、データベース

ショートカットへのショートカットを追加することはできず、「My Documents」フォルダへのショートカットを別のフォルダやワークスペースに追加することもできません。

#### **ショートカットの権限 (Shortcut permissions)**
ドキュメントにショートカットを追加するには、あなたが所有者であるか、そのドキュメントに対する`Can Explore`または`Can Edit`の権限を持っている必要があります。

ワークブック、フォルダ、ワークスペース、データモデル、またはデータセットへのショートカットを作成しても、そのファイルやフォルダへの権限は変更されません。フォルダやワークスペースへのアクセス権を持つ誰もがショートカットを閲覧できますが、ドキュメント（ワークスペース、ワークブック、フォルダ、データモデル、データセット）へのアクセス権を付与されたユーザーのみが、そのドキュメントを開くことができます。

#### **ドキュメントにショートカットを追加する (Add a shortcut to a document)**
サポートされているドキュメントへのショートカットを、別のフォルダまたはワークスペースに追加できます。バージョンタグが付いたワークブック、データモデル、またはデータセットにショートカットを追加することはできません。

1.  ショートカットを追加したいドキュメントを含む親フォルダまたはワークスペースを開きます。例えば、「My Documents」フォルダ内のサブフォルダへのショートカットを追加するには、「My Documents」を開きます。
2.  `More` > `Add shortcut…`を選択します。
3.  ショートカットを追加したいフォルダまたはワークスペースを検索または参照し、`Add`をクリックします。
4.  ドキュメントへのショートカットが、そのフォルダまたはワークスペースで利用可能になります。

ワークブック、データモデル、またはデータセットを表示中にショートカットを追加することもできます。
1.  ヘッダーで、ワークブック、データモデル、またはデータセットのタイトルの隣にある下矢印()を選択して、ドキュメントメニューを開きます。
2.  `File` > `Add shortcut…`を選択します。
3.  ショートカットを追加したいフォルダまたはワークスペースを検索または参照し、`Add`をクリックします。
    ワークブックへのショートカットが、そのフォルダまたはワークスペースで利用可能になります。

#### **データウェアハウスオブジェクトにショートカットを追加する (Add a shortcut to a data warehouse object)**
データウェアハウス内のテーブル、ビュー、スキーマ、カタログ、またはデータベースにショートカットを追加するには：
1.  Sigmaホームから、`Connections`を選択します。
2.  接続を選択し、ショートカットを追加したいオブジェクトを検索または参照します。
3.  オブジェクトにカーソルを合わせ、`More` > `Add shortcut…`を選択します。
4.  ショートカットを追加したいフォルダまたはワークスペースを検索または参照し、`Add`をクリックします。
5.  オブジェクトへのショートカットが、そのフォルダまたはワークスペースで利用可能になります。

その後、データソースを追加する際に、そのショートカットを使用してデータベースオブジェクトをより簡単に見つけることができます。

削除されたドキュメントへのショートカットがある場合、そのショートカットを削除するように促されます。ショートカットをクリックすると、もしアクセス権があれば、削除されたドキュメントを復元するように促されます。

### 5-2-1. テンプレートからワークブックを作成する (Create workbooks from templates)

テンプレートは、迅速かつ一貫性をもって新しいワークブックを構築できる、再利用可能なワークブック構造です。

このドキュメントでは、既存のテンプレートにアクセスし、それらを使用して新しいワークブックを作成する方法について説明します。テンプレートに関する詳細は、「[テンプレートの作成と編集](https://help.sigmacomputing.com/docs/create-and-edit-templates)」および「[テンプレートの共有](https://help.sigmacomputing.com/docs/share-templates)」を参照してください。

#### **要件 (Requirements)**

既存のテンプレートにアクセスし、それを使用して新しいワークブックを作成する機能には、以下が必要です。
* `Can create, edit, and publish workbooks`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* あなたの組織のユーザーによって作成されたテンプレート（`Templates` > `Internal`内）にアクセスするには、あなたがテンプレートの所有者であるか、`Can use`または`Can edit`のテンプレート権限を付与されている必要があります。
* Sigmaテンプレートやあなたの組織と共有されている他のテンプレート（`Templates` > `External`内）にアクセスするには、`Internal`メンバータイプを割り当てられている必要があります。ゲストユーザーは外部テンプレートにアクセスできません。

#### **テンプレートからワークブックを作成する (Create a workbook from a template)**

1.  ホームページの左側ナビゲーションパネルから`Templates`ギャラリーページを開きます。
2.  探索したいテンプレートをクリックします。
3.  テンプレート化されたワークブックが開きます。
4.  テーブル、ビジュアライゼーション、コントロールなど、そのインタラクティブな要素のいずれかをクリックしてテンプレートを探索します。あなたの変更は、テンプレート自体には影響しません。
5.  [任意] テンプレートから編集可能で公開可能なワークブックを作成するには、テンプレートのヘッダーで`Save As`をクリックします。

#### **ワークブックテンプレートであなたのデータを使用する（ソースを交換する）(Use your data in a workbook template (swap sources))**

* **前提条件:** 交換したいデータはSigmaで利用可能である必要があります。

ワークブックテンプレートに独自のデータを注入するには：
1.  ホームページの左側ナビゲーションパネルから`Templates`ギャラリーページを開きます。
2.  使用したいテンプレートをクリックします。
3.  テンプレート化されたワークブックが開きます。
4.  ワークブックが[サンプルデータ](https://help.sigmacomputing.com/docs/sample-connection)上に構築されている場合、ページ上部にポップアップが表示されます。
5.  `Swap now`をクリックします。
6.  これにより、`Swap Data Sources`ページが開きます。
7.  Sigmaは、テンプレートの期待されるデータとあなたのデータを自動的に照合しようと試みます。
8.  しかし、これを上書きすることも、Sigmaが見つけられないソースを手動で選択する必要がある場合もあります。
    * [任意] 一致したソースを置き換えるには、`REPLACE WITH`の下にあるソースの隣の編集()ボタンをクリックします。次に、モーダルから新しいソースを選択します。
9.  テンプレートが追加のソースを必要とする場合は、左端のパネル`ALL SOURCES IN USE`から各ソースの一致を確認します。
10. 準備ができたら、`Swap`をクリックします。
11. ワークブックを探索して、あなたのデータが正しく表示されることを確認します。
12. テンプレートから編集可能で公開可能なワークブックを作成するには、テンプレートのヘッダーで`Save As`をクリックします。

ワークブックはソースの交換もサポートしています。ワークブックにデータを交換し始めるには、ワークブックを編集モードで開き、ヘッダーメニューを開いて`Swap data sources`をクリックします。

### 5-2-2. ワークブックテンプレートの作成と編集 (Create and edit workbook templates)

ワークブック[テンプレート](https://help.sigmacomputing.com/docs/get-started-with-workbook-templates)を使用すると、ユーザーは[ワークブック](https://help.sigmacomputing.com/docs/workbooks-overview)の構造をテンプレート化して共有し、迅速かつ一貫性のある再利用が可能になります。

#### **要件 (Requirements)**

テンプレートを作成および編集する機能には、以下が必要です。
* 既存のワークブックから新しいテンプレートを作成するには、`Create, edit, and publish workbooks`権限を持つ[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられ、既存のワークブックに対する表示アクセス権を持っている必要があります。
* 既存のテンプレートを編集するには、あなたがテンプレートの所有者であるか、`Can edit`のテンプレート権限を付与されている必要があります。

#### **新しいテンプレートを作成する (Create a new template)**

1.  テンプレートの基として使用したいワークブックを開きます。
2.  ドキュメントメニューから、`File` > `Save as template`を選択します。
3.  `Template Name`を入力します。
4.  [任意] テンプレートを共有したい場合は、組織のメンバーまたはチームの名前を入力し、ドロップダウンから希望の権限を選択します。
5.  `Save`をクリックします。新しいテンプレートにリダイレクトされます。

#### **既存のテンプレートを編集する (Edit an existing template)**

1.  ホームページから`Templates`を選択します。
2.  編集したいテンプレートを見つけ、`More` > `Open`を選択します。
3.  テンプレートのヘッダーで、`Edit`を選択します。
4.  変更を加えます。
5.  テンプレートのヘッダーで、`Publish`をクリックして変更を保存します。

### 5-3. ワークブックのライフサイクル

#### 5-3-1. ワークブックのライフサイクル：探索、ドラフト、公開 (Workbook lifecycle: explore, draft, and publish)

ワークブックは、アドホックなデータ探索と複雑な長期レポーティングの両方をサポートします。共同作業が可能なインターフェースと、データ操作への視覚的なアプローチにより、組織内の誰もがライブデータとリアルタイムの共同作業にアクセスできるようになります。この記事では、データ探索から公開、バージョン履歴までの、ワークブックのライフサイクルの基本を紹介します。

##### **アドホックなデータ探索 (Ad hoc data exploration)**
新規の、保存されていないワークブックは「探索（explorations）」とも呼ばれます。探索は、将来の使用のために作業を保存することなく、データを探索して次に進みたい場合のアドホック分析に最適です。
探索を公開済みワークブックとして保存するには、探索のヘッダーにある`Save as`をクリックします。
「[Ad hoc data exploration](https://help.sigmacomputing.com/docs/ad-hoc-data-explorations)」を参照してください。

##### **ワークブックのモード：編集、探索、表示 (Workbook modes: Edit, Explore, and View)**
公開済みのワークブックは、編集、探索、表示の3つの異なるモードでアクセスできます。特定のワークブックでアクセスできるモードは、その個々のワークブックに対してあなたに付与された権限に依存します。「[Workbook modes overview](https://help.sigmacomputing.com/docs/workbook-modes-overview)」を参照してください。

##### **ドラフトと公開 (Drafts and publishing)**
ワークブックに加えられた編集は、共有されたライブドラフトとして自動的に保存されます。複数の編集者が単一のドラフトでリアルタイムに共同作業できます。すべてのアクティブな編集者は、現在編集モードにいる他のユーザーのリストと、それぞれが選択している要素を見ることができます。
`Publish`をクリックすると、ライブドラフト上のすべての編集者によってドラフトされた変更を含む、ワークブックへのすべてのドラフトされた変更が公開されます。
「[Edit, draft, and publish a workbook](https://help.sigmacomputing.com/docs/draft-and-publish-a-workbook)」を参照してください。

##### **バージョン履歴 (Version history)**
Sigmaは、公開されたワークブックのバージョンとそれに関連する変更の履歴を保存します。これをバージョン履歴と呼びます。バージョン履歴には、ワークブックヘッダーにあるバージョンメニューからアクセスします。
「[Workbook versions and version history](https://help.sigmacomputing.com/docs/document-versions-and-version-history)」を参照してください。

### 5-3-2. ドキュメントバッジの表示と管理 (View and manage document badges)

ワークブックとデータモデルに認定バッジ（推奨、警告、非推奨）を設定して、ドキュメントのステータス、品質、信頼性を反映させます。

例えば、以下のようにデータモデルのライフサイクルの段階を示すためにバッジを使用します。
* **Endorsed (推奨):** データモデルは検証済みで信頼でき、品質基準を満たしています。
* **Warning (警告):** データモデルは古い、不完全、またはレビュー中です。
* **Deprecated (非推奨):** データモデルは廃止されたか、もはやメンテナンスされていません。

このドキュメントでは、ワークブックとデータモデルでバッジを表示、設定、削除する方法について説明します。データセットとデータベーステーブルに認定バッジを追加する方法については、「[データセットの作成と管理](https://help.sigmacomputing.com/docs/create-and-manage-datasets)」および「[データカタログのレビューと管理](https://help.sigmacomputing.com/docs/review-and-manage-your-data-catalog)」を参照してください。

#### **ユーザー要件 (User requirements)**
バッジを設定または削除する機能には、以下が必要です。
* `Manage all badges`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* あなたがドキュメントの所有者であるか、任意の[ドキュメント権限](https://help.sigmacomputing.com/docs/folder-and-document-permissions)を付与されている必要があります。

バッジは、ドキュメントへのアクセス権を付与された任意のユーザーに表示されます。

#### **既存のバッジを表示する (View existing badges)**
ホームページから、または個々のワークブックからバッジを表示できます。
* **ホームページ:** ホームページから、`My documents`を選択します。最近アクセスしたドキュメントのうち、どのドキュメントにバッジが割り当てられているかを確認できます。
* **ワークブック内:** バッジはドキュメントメニュー（ワークブックの名前の隣）に表示されます。

#### **バッジを設定する (Set a badge)**
1.  バッジを割り当てたいドキュメントを開きます。
2.  ヘッダーで、ドキュメント名をクリックし、メニューから`File` > `Set badge`を選択します。
3.  `Set badge`モーダルで、ドキュメントに適用するバッジを選択し、次にバッジに関するメモを追加します（任意）。<img width="442" height="343" alt="93c323bcf1da34cef10cde8bd6e76f778618ef5b53c983e1d0d87519ba259f8f-image" src="https://github.com/user-attachments/assets/d31efc12-341e-45b3-bc80-25c4134f7484" />

4.  `Add`（現在バッジが設定されていない場合）または`Update`（既存のバッジを置き換える場合）をクリックしてバッジを設定します。

#### **バッジを削除する (Delete a badge)**
1.  削除したいバッジがあるドキュメントを開きます。
2.  ヘッダーで、ドキュメント名をクリックし、メニューから`File` > `Set badge`を選択します。
3.  `Set badge`モーダルで、`Delete`をクリックしてドキュメントからバッジを削除します。

### 5-3-3. ワークブックのバージョンとバージョン履歴 (Workbook versions and version history)

ワークブックにはバージョンがあります。デフォルトのバージョンは「Published」と「Draft」で、「タグ付きバージョン」と呼ばれる新しいカスタムバージョンを追加することもできます。バージョンタグ付けの詳細については、「[ワークブックとデータモデルにバージョンタグを追加する](https://help.sigmacomputing.com/docs/add-version-tags)」を参照してください。ワークブックの編集と公開の詳細については、「[ワークブックの編集、ドラフト、公開](https://help.sigmacomputing.com/docs/draft-and-publish-a-workbook)」を参照してください。

ワークブックのバージョン履歴には、以前に公開されたすべてのワークブックのバージョンのリストと、保留中のドラフトの変更が含まれています。各公開バージョンには、編集履歴と呼ばれる変更の詳細なリストが含まれています。バージョンと編集履歴を使用して、ドラフトされた変更を確認したり、古い公開バージョンと比較または元に戻したり、チームの誰が特定の編集または一連の変更を行ったかを特定したり、特定のバージョンタグでタグ付けされたバージョンを特定したりできます。ワークブックのバージョン履歴の保持期間に制限はありません。

#### **要件 (Requirements)**
* 編集履歴や現在のドラフトへの編集を含むワークブックのバージョン履歴は、ワークブックに対する`Can Edit`権限を持つユーザーのみが利用できます。
* ワークブックの古いバージョンや変更を復元できるのは、`Can Edit`権限を持つユーザーのみです。
* 2022年12月13日より前に行われた変更については、編集履歴は利用できません。2022年12月13日以降、ライブ編集が有効になっているすべての組織では、編集履歴で編集が追跡されます。ライブ編集が有効になる前に行われた編集は、追跡されません。詳細は、「[ワークブックでのライブ編集による共同作業](https://help.sigmacomputing.com/docs/collaborate-with-live-edit-in-workbooks)」を参照してください。

#### **ワークブックのバージョンについて (About workbook versions)**
ワークブックを開くと、現在のバージョンがワークブックヘッダーに表示されます。
* 公開済みのワークブックを表示している場合、バージョンは`PUBLISHED`です。
* タグ付きバージョンを表示している場合、バージョンタグの名前が表示されます。
* 編集のためにワークブックを開くと、バージョンは`DRAFT`です。

ワークブックは、以下のいずれかのバージョンを持つことができます。
* **Draft (ドラフト):** ワークブックを編集中は、ドラフトモードになり、変更はあなたと現在ワークブックを編集している他の人にのみ表示されます。
* **Published (公開済み):** ワークブックへの表示または探索アクセス権を持つ他の人が変更を見られるようにするには、それを公開します。
* **Tagged (タグ付き):** 特定のユーザーまたは特定の目的のためにワークブックの読み取り専用バージョンを利用可能にしたい場合は、特定のワークブックバージョンにタグを適用できます。例えば、「Development」や「Production」としてワークブックにタグを付けることができます。「[ワークブックとデータモデルにバージョンタグを追加する](https://help.sigmacomputing.com/docs/add-version-tags)」を参照してください。

ワークブックのバージョンのライフサイクルに関する詳細は、「[ワークブックの編集、ドラフト、公開](https://help.sigmacomputing.com/docs/draft-and-publish-a-workbook)」を参照してください。

#### **ワークブックのバージョン履歴を開く (Open version history for a workbook)**
ワークブックに変更を加えると、その変更はバージョン履歴に表示されます。バージョンを公開すると、バージョン履歴が更新されます。
バージョン履歴を表示するには、ワークブックに対する`Can Edit`権限が必要です。

1.  ワークブックを開きます。
2.  ドキュメント名の隣にあるキャレット()をクリックし、`Version history`を選択します。現在のバージョンの名前を選択し、`View version history`を選択することもできます。<img width="1370" height="790" alt="0194740807d15b795f80246ff4cf6000479c03ef296cb63e279a8a87db693814-workbook-vh-open" src="https://github.com/user-attachments/assets/97e12193-3881-404a-8fcf-266565a381d7" />

3.  バージョン履歴パネルが開き、最新バージョンとその変更が表示されます。以前に公開されたバージョンは以下にリストされ、現在公開されているバージョンに対応するバージョンには`Current`というラベルが付いています。 バージョンタイムスタンプの隣にあるシェブロンをクリックして特定のバージョンの詳細な編集履歴を確認するか、特定のバージョンまたは変更を選択してその時点でのワークブックを表示します。<img width="1371" height="577" alt="0ca6cd62dd323090a666c58d665ec54fa14bd8eb46e4941adacb35d485b18b06-selected-change-vh" src="https://github.com/user-attachments/assets/9d51bff1-5490-45b8-b95f-6dd7eafcf7c1" />

4.  ワークブックの最新バージョンに戻るには、`Go back to latest version`を選択します。
5.  バージョン履歴パネルを閉じるには、`X`をクリックします。

#### **ドラフトを以前の変更またはバージョンに復元する (Restore a draft to a previous change or version)**
ワークブックを以前に公開されたバージョンに戻すか、ワークブックのバージョン履歴の特定の変更に戻すには、以前の変更またはバージョンをドラフトとして復元します。以前のバージョンを復元する前に行われた変更は、バージョン履歴に残ります。
バージョン履歴の以前のバージョンまたは変更を復元するには、ワークブックに対する`Can Edit`権限が必要です。

* **ドラフトを以前に公開されたバージョンに復元する**
    ドラフトを以前に公開されたバージョンに復元するには、以下を実行します。
    1.  ワークブックのバージョン履歴を開きます。
    2.  復元したい以前に公開されたバージョンを探します。
    3.  `More`をクリックし、`Restore version as draft`を選択します。
    4.  変更は、リストされたバージョンのタイムスタンプとともに`Restored version from`としてバージョン履歴に表示されます。
    5.  必要に応じて他の変更を行うか、`Publish`をクリックして変更を公開します。

* **バージョン履歴の以前の変更に戻す**
    ワークブックのドラフトを、バージョンまたはドラフトの編集履歴の特定の変更に復元できます。
    > 🚧
    > ワークブックに入力テーブルが含まれており、バージョン履歴の以前の変更にワークブックを復元した場合、入力テーブルの内容はその時点には復元されず、代わりに最新の変更が反映されます。
    > 代わりに、特定の変更に最も近い公開バージョンを復元し、その後で特定の変更を復元することができます。
    ドラフトを編集履歴の以前の変更に戻すには、以下を実行します。
    1.  ワークブックのバージョン履歴を開きます。
    2.  ドラフトを戻したい変更が含まれるバージョンを探します。
    3.  必要に応じて、バージョンの編集履歴を展開し、その変更を探して選択します。
    4.  ワークブックヘッダーで、`Restore version as draft`を選択します。
    5.  変更は`Restored from autosaved draft`としてバージョン履歴に表示されます。
    6.  必要に応じて他の変更を行うか、`Publish`をクリックして変更を公開します。

#### **以前に公開されたバージョンを操作する (Work with previously published versions)**
ワークブックのバージョン履歴を確認する際、以前に公開されたバージョンに対していくつかのアクションを実行できます。`More`を選択して、以下のいずれかを実行します。
* **Restore version as draft:** バージョンをドラフトとして復元します。「[ドラフトを以前に公開されたバージョンに復元する](#restore-a-draft-to-a-previously-published-version)」を参照してください。
* **Edit name and description:** バージョンの名前と説明を変更します。デフォルトでは、バージョンはタイムスタンプでリストされます。
* **Save as new workbook:** バージョンを新しいワークブックとして保存します。
* **Copy link:** 以前のワークブックバージョンへのリンクをコピーします。ワークブックへのアクセス権を持つユーザーのみがリンクを表示できます。
* **Set a tag on the version:** バージョンにタグを設定します。「[ワークブックとデータモデルにバージョンタグを追加する](https://help.sigmacomputing.com/docs/add-version-tags)」を参照してください。

### 5-3-4. ワークブックとデータモデルにバージョンタグを追加する (Add version tags to workbooks and data models)

> 🚩
> データモデルのバージョンタグ付けはパブリックベータ機能であり、迅速で反復的な変更の対象となります。そのため、最新の製品バージョンはこのドキュメントの内容と異なる場合があります。詳細は、「[Beta features](https://help.sigmacomputing.com/docs/beta-features)」を参照してください。
> ワークブックのバージョンタグ付けは一般的に利用可能です。

ワークブックまたはデータモデルのバージョンにタグを追加して、そのドキュメントバージョンの読み取り専用ビューを作成します。その後、タグ付きバージョンを別のチームと共有して彼ら専用にしたり、タグ付きバージョンのワークブックをアプリケーションに埋め込んだり、タグ付きバージョンを使用してバージョン管理を行う開発ライフサイクルを実装したりできます。

ワークブックまたはデータモデルのバージョンにタグを付けると、タグ付きバージョンに影響を与えることなく、典型的なドラフトと公開のワークフローでソースドキュメントの反復作業を続けることができます。詳細は、「[Version tagging workflow](#version-tagging-workflow)」を参照してください。

ワークブックまたはデータモデルの複数のバージョンにタグを付けることができますが、同じタグでドキュメントの複数のバージョンにタグを付けることはできません。

管理者は、承認フローを必要とする保護されたタグの作成を含む、バージョンタグの作成と管理ができます。「[Create and manage version tags](https://help.sigmacomputing.com/docs/create-and-manage-version-tags)」を参照してください。

#### **バージョンタグ付けのワークフロー (Version tagging workflow)**
すべてのワークブックとデータモデルには、公開バージョンとドラフトがあります。ドキュメントに加えられたすべての変更は、[バージョン履歴](https://help.sigmacomputing.com/docs/document-versions-and-version-history)で表示できます。

特定のドキュメントバージョンにタグを付けて、そのドキュメントバージョンのステータスについて何かを示すことができます。例えば、ワークブックのバージョンにタグを付けて、内容の正確性をレビューする必要があること、または本番環境で使用する準備ができていることを示します。
<img width="1759" height="1344" alt="4be75c3ec3cb8eaefd59cade127457cb1258bb6afa73e321f0aa15e50a019c95-version-tag-workflow" src="https://github.com/user-attachments/assets/48cd4525-a2af-400f-b282-51adff62f8bb" />

データモデルにもタグを付け、同様のワークフローを使用して、テスト用または本番用に特定のデータモデルバージョンにタグを付けられます。

タグ付きバージョンがレビューされている間、ドラフトの反復作業を続けることができます。ドラフトまたは公開バージョンに加えられた変更は、タグ付きバージョンには影響しません。詳細は、「[Make changes to a tagged workbook version](#make-changes-to-a-tagged-workbook-version)」を参照してください。
<img width="1375" height="890" alt="6d1aa5d397ed3e77e4b4c358aba2e9e35d18a529aed6b3f1faeffa61e457880a-draft-publish-tag-workflow" src="https://github.com/user-attachments/assets/aec8133a-8631-4bae-a98d-f3db452e6385" />

##### **バージョンタグ付けがデータセットとデータモデルに与える影響 (How version tagging affects datasets and data models)**
データセットをデータソースとして使用するワークブックバージョンにタグを付けると、使用中のデータセットバージョンのコピーが作成され、タグ付きワークブックバージョンで使用されます。タグ付きワークブックバージョンに関連付けられたデータセットは、元のデータセットに変更が加えられても更新されなくなり、ワークブックバージョンがタグ付けされたときに使用されていたデータセットのバージョンが事実上凍結されます。データソース自体は、バージョンタグによって何ら影響を受けません。
<img width="3728" height="2664" alt="4dac999-vt-diagram-dataset" src="https://github.com/user-attachments/assets/e26ce890-aec5-474b-99c5-511642ca76e6" />

データモデルをデータソースとして使用するワークブックは、動作が異なります。データモデルをデータソースとして使用するワークブックバージョンにタグを付けると、ワークブックバージョンはタグ付けされますが、データモデルバージョンはタグ付けされません。新しい列の追加や既存の列のデータ型の変更など、データモデルに加えられた将来の変更は、そのデータモデルに依存するワークブックのバージョンと同期されます。
<img width="3728" height="2664" alt="841bfca-vt-diagram-data-model" src="https://github.com/user-attachments/assets/37455837-ff10-4cf4-95f3-c890752613ae" />

タグ付きバージョンのワークブックのデータソースとして使用されるデータモデルを「凍結」したい場合は、データモデルとワークブックの両方にタグを付け、タグ付きバージョンのワークブックのデータソースとしてタグ付きデータモデルを使用できます。「[Swap the source of a tagged workbook version](#swap-the-source-of-a-tagged-workbook-version)」を参照してください。

##### **タグ付きワークブックバージョンの埋め込み (Embedding tagged workbook versions)**
ワークブックを埋め込む場合、バージョンタグを使用して環境間でコンテンツをプロモートする管理ができます。例えば、「test」と「production」タグを使用して変更を管理し、本番で使用されるバージョンを保護します。その後、埋め込みでタグ付きバージョンへの直接リンクを使用できます。「[タグ付きバージョンのワークブックへのリンク](#link-to-a-tagged-version-of-a-workbook)」を参照してください。

バージョンタグのワークフローとタグ付きバージョンのワークブックへのアクセス制限に関する詳細は、「[タグ付きワークブックバージョンに変更を加える](#make-changes-to-a-tagged-workbook-version)」および「[ドキュメントのタグ付きバージョンを共有する](https://help.sigmacomputing.com/docs/share-a-workbook#share-tagged-versions-of-a-document)」を参照してください。

タグの作成と、リクエスト承認フローを強制するためのタグの保護に関する詳細は、「[バージョンタグの作成と管理](https://help.sigmacomputing.com/docs/create-and-manage-version-tags)」を参照してください。

Sigmaでのバージョンタグ付けを、開発ワークフローに既に統合されているソース管理プラットフォームと統合したい場合は、Sigma REST APIを使用できます。レシピについては、「[QuickStart - Embedding 08: Version Tagging](https://help.sigmacomputing.com/docs/quickstart-embedding-08-version-tagging)」を参照してください。

##### **バージョンタグ付けとマテリアライゼーション (Version tagging and materialization)**
マテリアライズされたデータソースに依存するワークブックのバージョンにタグを付けると、タグ付きバージョンはマテリアライズされたデータソースを使用しない場合があります。

* **マテリアライズされたデータセット:** マテリアライズされたデータセットは、タグ付きバージョンのワークブックでは使用されません。代わりに、タグ付きバージョンのワークブックは、タグが適用されたときに作成されたデータセットのコピーに依存します。
* **マテリアライズされたデータモデル:** タグ付きバージョンのワークブックのソースを交換する場合など、タグ付きバージョンのデータモデルを使用しない限り、マテリアライズされたデータモデルが使用されます。データモデルのタグ付きバージョンはマテリアライズできません。

| オブジェクト | マテリアライズされたバージョンは使用されるか？ | 詳細 |
| :--- | :--- | :--- |
| **データセット** | マテリアライズされたバージョンは使用されない | タグ付きバージョンのワークブックは、元のデータセットの代わりにデータセットのコピーを使用します。 |
| **データモデル** | マテリアライズされたバージョンは使用される | タグ付きバージョンのワークブックはデータモデルを使用し、データモデルに加えられた変更と同期を保ち、マテリアライズされた結果を使用します。 |
| **タグ付きデータモデル** | マテリアライズされたバージョンは使用されない | タグ付きバージョンのワークブックは、タグ付きバージョンのデータモデルを使用します。これは現時点ではマテリアライズできません。 |

マテリアライゼーションの詳細については、「[Materialization](https://help.sigmacomputing.com/docs/about-materialization)」を参照してください。

#### **ワークブックまたはデータモデルのバージョンにタグを付ける (Tag a workbook or data model version)**

ワークブックまたはデータモデルのバージョンにタグを付けることができます。ドキュメントにタグを付けると、そのドキュメントの読み取り専用バージョンが作成され、それを他の人と共有したり埋め込んだりできます。
> 🚧
> データモデルのタグ付きバージョンは、Ask Sigmaでは利用できません。管理者がAsk Sigmaで利用可能なデータソースにデータモデルを含めることを選択した場合、そのデータモデルの公開バージョンのみが利用可能であり、公開バージョンにアクセスできるユーザーのみがそのデータモデルを参照するAsk Sigmaからの回答を受け取ることができます。詳細は、「[組織のAI機能を構成する](https://help.sigmacomputing.com/docs/configure-ai-features-for-your-organization)」を参照してください。

##### **ユーザー要件 (User requirements)**
ドキュメントバージョンにタグを付けるには、以下が真である必要があります。
* ドキュメントに対する`Can Edit`[権限](https://help.sigmacomputing.com/docs/share-a-workbook)が付与されている。
* `Apply Tag`および`Create, edit, and publish workbooks`権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)が割り当てられている。

一部のタグは保護されており、ドキュメントに設定するには追加の権限が必要です。保護されたタグを設定するには、Adminアカウントタイプを割り当てられているか、保護されたタグを設定するアクセス権が付与されている必要があります。アクセス権がない場合は、タグの追加をリクエストできます。「[バージョンタグの作成と管理](https://help.sigmacomputing.com/docs/create-and-manage-version-tags)」を参照してください。

##### **ドキュメントにタグを設定する (Set a tag on a document)**
ドキュメントにタグを設定するには、以下の手順に従います。
1.  ドキュメントを開き、タグを付けたいバージョンを探します。
    * **ドキュメントの最新公開バージョンにタグを付けるには：**
        a. ドキュメント名の隣にある下矢印()をクリックしてドキュメントメニューを開きます。
        b. `Versions` > `Tag this version`を選択します。ドキュメントがドラフト状態で未公開の編集がある場合は、代わりに`Tag latest published version`と表示されます。
    * **ドキュメントの特定のバージョンにタグを付けるには：**
        a. ドキュメント名の隣にある下矢印()をクリックしてドキュメントメニューを開きます。
        b. `Versions` > `Version history`を選択し、タグを付けたいバージョンを探します。
        c. `More` > `Set tag on this version`をクリックします。
    `Set tag on version`モーダルが表示されます。
2.  `Choose tag`で、タグを選択します。
    適用する権限がない保護されたタグを選択した場合、タグの承認者にリクエストを送信するよう促されます。
    * a.`Request reason`に、保護されたタグをドキュメントに適用したい理由を正当化するためのメッセージをメールリクエストに含めて入力します。
    * b. `Request tag on version`をクリックします。
    * Sigmaはリクエストを承認できるユーザーにメールを送信します。
3.  [任意] タグ付きバージョンのドキュメントが異なるデータソースを使用するようにしたい場合は、`Swap sources of the tagged version`のチェックボックスを選択します。例えば、タグ付きバージョンに異なる接続、データベースまたはカタログ、テーブル、データモデル、またはデータセットを使用します。「[タグ付きバージョンのソースを交換する](#swap-the-source-of-a-tagged-workbook-version)」を参照してください。
    > 📘
    > ドキュメントに入力テーブルまたはCSVアップロードから作成されたテーブルが含まれている場合、このオプションを選択しないでください。これらの要素は接続間で移行できません。
4.  [任意] タグ付きバージョンのドキュメントへのアクセス権しか持たないユーザーが、デフォルトでタグ付きバージョンを開くようにしたい場合は、`Set this tag as default`のチェックボックスを選択します。「[ドキュメントのデフォルトバージョンタグを設定する](#set-a-default-version-tag-for-a-document)」を参照してください。
5.  バージョンタグ付きワークブックの場合、ワークブックで使用されているデータソースへの`Can view`アクセス権を付与したい場合は、`Allow user to use data sources when they "Save as"`のチェックボックスを選択します。このチェックボックスが選択されていない場合、ユーザーはデータなしでワークブックのタグ付きバージョンにアクセスします。
6.  `Set tag`をクリックします。
> 🚩
> ワークブックに入力テーブルが含まれている場合、タグ付きバージョンのワークブックには、ソースワークブックの入力テーブルとは別の空の入力テーブルのコピーが含まれます。ソースワークブックの入力テーブルに存在するデータをバージョンタグ付きバージョンに含めたい場合は、以下の手順が必要です：
> 1. 入力テーブルのデータ入力権限を、表示/探索モードで公開バージョンのみ編集可能に変更します。
> 2. バージョンタグを適用します。
> 3. 空のテーブルに手動でデータをコピー＆ペーストします。
> データモデルバージョンの一つの入力テーブルからタグ付きデータモデルバージョンにデータを移行したい場合、データモデルの公開バージョンの入力テーブルにデータを追加できないため、この回避策は利用できません。

#### **ドキュメントのデフォルトバージョンタグを設定する (Set a default version tag for a document)**

ワークブックまたはデータモデルにタグを適用する際、そのタグをデフォルトとして設定できます。デフォルトタグは、公開バージョンへのアクセス権がないユーザーに対して、デフォルトで表示されるドキュメントのバージョンを決定します。ユーザーが公開バージョンへのアクセス権を持っている場合、公開バージョンがデフォルトタグよりも優先されます。

> 📘
> ユーザーがドキュメントの公開バージョンにアクセスできず、デフォルトのバージョンタグが設定されていない場合、ドキュメントはユーザーがアクセスできる最新作成のタグ付きバージョンをロードします。

ドキュメントに対する`Can edit`アクセス権を持つ任意のユーザーが、タグをデフォルトとして設定できます。
1.  ドキュメント名の隣にある下矢印()をクリックしてドキュメントメニューを開きます。
2.  `Versions` > `Version history`を選択します。
3.  デフォルトとして設定したいタグ付きバージョンを探し、`More`を選択します。
4.  `Set tag as default`をクリックします。

タグをデフォルトから削除し、別のデフォルトタグに置き換えない場合は、以下の手順に従います。
1.  ドキュメント名の隣にある下矢印()をクリックしてドキュメントメニューを開きます。
2.  `Versions` > `Version history`を選択します。
3.  デフォルトバージョンタグの隣にある`More`を選択します。
4.  `Remove as default`をクリックします。

#### **ドキュメントバージョンからタグを削除する (Remove a tag from a document version)**

ワークブックまたはデータモデルのバージョンからタグを削除すると、バージョンはバージョン履歴から引き続きアクセス可能ですが、タグ付きバージョンへのアクセス権しか持たない人はドキュメントへのアクセスを失います。

> 💡
> 間違ったドキュメントバージョンにタグを付けた場合や、タグ付きバージョンへのアクセスのみを持つユーザーのアクセスを制限したい場合にタグを削除することがあります。タグ付きバージョンを更新したい場合は、このドキュメントの「[タグ付きワークブックバージョンに変更を加える](https://help.sigmacomputing.com/docs/add-version-tags#make-changes-to-a-tagged-workbook-version)」を参照してください。

ドキュメントバージョンからタグを削除するには：
1.  ドキュメント名の隣にある下矢印()をクリックしてドキュメントメニューを開きます。
2.  `Versions` > `Version history`を選択します。
    > 💡
    > 各バージョンの詳細な変更を折りたたむには、最新バージョンの隣にある下矢印を選択します。
3.  タグ付きバージョンを探し、`More` > `Remove this tag`を選択します。
4.  タグを削除すると、タグ付きバージョンがキャンバスに表示されます。

#### **タグ付きワークブックバージョンのソースを交換する (Swap the source of a tagged workbook version)**
> 📘
> ワークブックに複数のデータソースからの要素が含まれている場合、タグ付きワークブックバージョンのソースを交換することはできません。

タグ付きワークブックバージョンのソースを交換するには、例えば「testing」とタグ付けされたワークブックにテストデータ接続を使用し、「production」とタグ付けされたワークブックに本番データ接続に交換するなど、以下の手順に従います。手順は、ワークブックがデータソースとしてデータモデルを使用しているかどうかによって異なります。
* [タグ付きワークブックバージョンで使用されるデータモデルソースを交換する](#swap-the-data-model-source-used-by-a-tagged-workbook-version)
* [タグ付きワークブックバージョンで使用されるデータセットまたは接続ソースを交換する](#swap-the-dataset-or-connection-source-used-by-a-tagged-workbook-version)

ワークブックのデータソースの変更に関する詳細は、「[ワークブックまたは要素のデータソースを変更する](https://help.sigmacomputing.com/docs/change-the-data-source-for-a-workbook-or-element)」を参照してください。

##### **タグ付きワークブックバージョンで使用されるデータモデルソースを交換する (Swap the data model source used by a tagged workbook version)**
ワークブックがデータソースとしてデータモデルを使用しており、タグ付きワークブックバージョンが公開バージョンとは異なるデータソースを使用するようにしたい場合は、まずデータモデルにタグを付けてタグ付きデータモデルのソースを交換し、次にワークブックにタグを付けてタグ付きデータモデルをソースとして使用します。
ワークブックがデータソースとして使用するデータモデルが、別のデータモデルに基づいている場合は、そのソースデータモデルにもタグを付けます。
> 💡
> データソースで使用される接続を交換する場合、ワークブックバージョンではなくデータモデルバージョンにタグを付けてソースを交換すると、データソースへのアクセスをより簡単に管理および制御できます。

* **データモデルにタグを付けてソースを交換する**
    1.  編集のためにデータモデルを開き、タグを付けるバージョンを選択します。
    2.  `Set tag on version`モーダルが表示されます。
    3.  `Choose tag`で、データモデルに適用するタグを選択します。ワークブックで使用する予定の同じタグを選択します。
    4.  `Swap sources of the tagged version`のチェックボックスを選択します。
    5.  `Set tag`をクリックします。
    6.  `Swap sources`モーダルで、`Sources of tagged data model`に、タグ付きバージョンで使用する新しいデータソースを選択します。代わりにデータベースまたはカタログ、スキーマ、またはテーブルを変更したい場合は、現在のオブジェクト名にカーソルを合わせ、`Select`をクリックして別のオブジェクトを選択し、`Confirm`をクリックします。
    7.  `Swap and tag`を選択します。

* **ワークブックにタグを付けて、ソースをタグ付きデータモデルに交換する**
    1.  編集のためにワークブックを開き、タグを付けるバージョンを選択します。
    2.  `Set tag on version`モーダルが表示されます。
    3.  `Choose tag`で、ワークブックバージョンに適用するタグを選択します。
    4.  `Swap sources of the tagged version`のチェックボックスを選択します。
    5.  `Set tag`をクリックします。
    6.  `Swap sources`モーダルで、`Sources of tagged workbook`についてドロップダウンメニューを開き、対応するタグ付きバージョンのデータモデルを選択します。
        > 📘
        > ワークブックに複数のデータソースが含まれている場合、各データソースのソースを交換するオプションが表示されます。
    7.  `Swap and tag`を選択します。

##### **タグ付きワークブックバージョンで使用されるデータセットまたは接続ソースを交換する (Swap the dataset or connection source used by a tagged workbook version)**
タグ付きワークブックバージョンに異なる接続パス、データベース、またはスキーマを選択するには、以下を実行します。
1.  編集のためにワークブックを開き、タグを付けるバージョンを選択します。
2.  `Set tag on version`モーダルが表示されます。
3.  `Choose tag`で、ワークブックバージョンに適用するタグを選択します。
4.  `Swap sources of the tagged version`のチェックボックスを選択し、`Set tag`をクリックします。
5.  `Swap sources`モーダルで、`Sources of tagged data model`に、タグ付きバージョンで使用する新しいデータソースを選択します。
6.  `Swap and tag`をクリックします。
タグ付きバージョンのワークブックは、新しい接続を使用するように更新されます。ワークブックがデータセットを使用している場合、新しい接続上にデータセットのコピーが作成されます。


#### **タグ付きワークブックバージョンに変更を加える (Make changes to a tagged workbook version)**

タグ付きバージョンのワークブックに変更を加えたい場合は、まずタグ付きバージョンをドラフトに戻し、変更を加え、変更を公開し、バージョンに再度タグを付ける必要があります。

例えば、「testing」タグでワークブックバージョンにタグを付けた後、本番環境で使用する準備ができたことを示すために「production」タグでワークブックにタグを付ける開発ライフサイクルに従う場合、「testing」タグで反復作業を行いたい場合があります。

「testing」タグ付きバージョンのワークブックを更新するには、以下を実行します。
1.  編集のためにワークブックを開きます。
2.  ドキュメント名の隣にある下矢印()をクリックしてドキュメントメニューを開きます。
3.  `Versions` > `Version history`を選択します。
4.  タグ付きバージョンを探し、関連するバージョンの日付を選択して開きます。
5.  そのバージョンについて、`More` > `Restore version as draft`を選択します。
6.  ドラフトで希望の変更を加えます。
7.  変更が終わったら、変更を公開します。
8.  ドキュメントメニューを開き、`Versions` > `Version history`を選択して、バージョン履歴を再度開きます。
9.  バージョン履歴には、`Restored version from <date>`という項目が表示され、そのバージョンの上にさらなる変更がリストされます。
10. 変更を含む最新の公開バージョンについて、`More > Set tag on this version`を選択します。
11. 最新バージョンにタグが付けられ、内容が一致するように更新されます。以前にタグ付けされたバージョンは、グレーアウトされたバージョンタグでリストされます。
    > 📘
    > 以前のバージョンからtestingタグを削除しないでください。そうすると、そのタグ付きバージョンのワークブックへのアクセス権しか持たない人はアクセスを失います。異なるバージョンに再度タグを付けると、共有は維持されます。
12. 保存して作業を続けたい他の変更があった場合は、タグ付きバージョンを最新のドラフトとして復元する前のバージョンに戻り、`More > Restore version as draft`を選択します。

#### **タグ付きバージョンを別のタグに更新する (Update a tagged version to use another tag)**
例えば、「staging」バージョンタグから「production」バージョンタグにタグ付きワークブックバージョンを昇格させたい場合は、以下を実行します。
1.  編集のためにワークブックを開きます。
2.  ドキュメント名の隣にある下矢印()をクリックしてドキュメントメニューを開きます。
3.  `Versions`を選択し、表示したいタグ（例：「Staging」）を選択します。
    タグ付きバージョンが開きます。
4.  ドキュメントメニューを開き、`Versions` > `Tag this version`を選択します。
    `Set tag on version`モーダルが開きます。
5.  モーダルで、関連オプションを選択し、`Set tag`を選択します。
    「Production」タグがバージョンに追加されます。
6.  次に、バージョンから「Staging」タグを削除します。ドキュメントメニューを開き、`Versions` > `Version history`を選択します。
7. バージョン履歴で、「Staging」タグが適用されているバージョンを探し、`More` > `Remove this tag`を選択します。
8. モーダルで、このタグ付きバージョンへのアクセス権のみが付与されているユーザー、またはタグ付きバージョンへのリンクを使用する埋め込みが、タグを削除した後にアクセスを失うことを承認し、`Remove`を選択します。
   バージョンは、現在のタグが「Production」、以前のタグが「Staging」として表示されます。

#### **バージョンタグを使用してフォルダへのアクセスを制限する (Restrict access to a folder using a version tag)**
バージョンタグを使用してドキュメントへのアクセスを管理する場合、ワークスペースまたはフォルダを設定してアクセスをより簡単に管理できます。
ワークスペースまたはフォルダをユーザーまたはチームと共有し、それらのユーザーまたはチームに特定のタグへのアクセス権を付与できます。そうすると、そのワークスペースまたはフォルダ内のワークブックまたはデータモデルは、それらのユーザーまたはチームがアクセスできるようにするために、そのタグが適用されている必要があります。

例えば、5つの地域をカバーする営業組織がある場合、各地域にワークスペースを作成し、各営業チームにその地域のタグを持つワークスペースへの`Can explore`アクセス権を付与できます。
そうすると、ワークスペース内のすべてのドキュメントには、対応するタグ付きバージョンが必要です。この例では、Sales US-Eastワークスペース内のすべてのワークブックには、Sales US-Eastチームのメンバーがワークブックの`East`バージョンを表示および探索できるように、`East`とタグ付けされたバージョンが必要です。

ワークスペースでチームメンバーに`Can contribute`や`Can manage`などの昇格された権限を付与すると、それらのチームメンバーはワークスペース内のドキュメントのすべてのバージョンにアクセスできます。
ワークスペースおよびフォルダレベルで設定された権限は、ワークスペースまたはフォルダ内のワークブックおよびドキュメントに継承されます。詳細は、「[フォルダを共有する](https://help.sigmacomputing.com/docs/share-a-folder)」を参照してください。

#### **タグ付きバージョンのワークブックへのリンク (Link to a tagged version of a workbook)**
タグ付きバージョンのワークブックに直接リンクしたい場合（例えば、タグ付きバージョンのワークブックを埋め込むなど）、URLでタグ名を参照します。
例えば、ワークブックに`staging`タグを追加した場合、`staging`でタグ付けされたワークブックバージョンのURLには以下が含まれます。
`/workbook/My-Workbook-{workbook_id}/tag/staging`

埋め込みにも同じ構成が適用されます。`staging`タグはURLに追加されます。
`/embed/{embed_id}/tag/staging`

他のURLパラメータと同様に、スペースや特殊文字を含むバージョンタグ名はエンコードされます。例えば、「Staging Copy」という名前のバージョンタグの場合は`staging%20copy`となります。「[Embed URL parameters](https://help.sigmacomputing.com/docs/embed-url-parameters)」を参照してください。

### 5-4. マテリアライゼーション

#### 5-4-1-1. マテリアライゼーションについて (About materialization)

> 🚩
> データモデル内のデータ要素とデータセットのマテリアライゼーションは、一般的に利用可能です。
> ワークブック内のデータ要素のマテリアライゼーションは、パブリックベータです。
> このドキュメントはパブリックベータ機能について説明しており、現在作成中です。この通知およびSigmaサービス内の機能に対応するベータフラグが削除されるまで、このドキュメントは公開されたドキュメントの一部とは見なされません。他のベータ機能と同様、以下で説明する機能は、迅速で反復的な変更の対象となります。Sigmaサービスでの最新の体験は、このドキュメントの内容と異なる場合があります。
> ベータ機能は、[ベータ機能](https://help.sigmacomputing.com/docs/beta-features)の免責事項の対象となります。

マテリアライゼーションは、レポートの速度とパフォーマンスを向上させます。データモデル、ワークブック、およびデータセットに対してマテリアライゼーションを設定できます。

##### **マテリアライゼーションについて (About materialization)**
データ要素間の複雑な結合や、カーディナリティが高く複数のグルーピングレベルと計算列を持つデータセットなど、コストのかかる、または長時間実行されるクエリを使用するデータソースがある場合、マテリアライゼーションを設定することでクエリのパフォーマンスが向上し、コンピューティングコストの削減に役立ちます。

マテリアライゼーションは、データセットまたはデータ要素のコピーをテーブルとして、または場合によっては動的テーブルとして、あなたのウェアハウスに書き戻します。マテリアライズされたデータは、Sigmaサービスによって管理されるスキーマ内のクラウドデータウェアハウスに、すべての書き戻しデータに使用されるのと同じデータベースまたはカタログとスキーマに保存されます。マテリアライズされたテーブルは、先頭に `t_mat` または `T_ID` が付くか、末尾に `_MAT` が付き、Sigmaの接続エクスプローラーには表示されません。

##### **マテリアライゼーションが使用されるとき (When materialization is used)**
マテリアライゼーションを使用する要素を表示または操作すると、Sigmaのクエリコンパイラは自動的かつ透過的に最新のマテリアライゼーションを使用します。あなたのクラウドデータウェアハウスはクエリを再計算しません。
ワークブックページのコントロールがマテリアライズされた要素を対象としている場合、コントロールの値を変更するとライブデータにクエリが実行されます。代わりに、コントロールをワークブックまたはデータモデルの子要素を対象にしてください。「[マテリアライゼーションのベストプラクティス](#best-practices-for-materialization)」を参照してください。
ワークブックまたはデータモデルのマテリアライズされたデータセットまたはマテリアライズされた要素を編集すると、マテリアライズされたデータは使用されず、正確な結果を保証するために基盤となるデータにクエリが実行されます。

##### **データモデルとワークブックのマテリアライゼーションとデータセットのマテリアライゼーションの比較**
ワークブックとデータモデルのマテリアライズされたデータ要素は、マテリアライズされたデータセットとはいくつかの違いがあります。
* データセットを公開すると、変更がマテリアライゼーションの正確さに影響しない場合でも、マテリアライゼーションが実行されます。マテリアライズされた要素を持つワークブックまたはデータモデルを公開すると、公開された変更がマテリアライゼーションに影響する場合にのみ、マテリアライゼーションが実行されます。
* データセットに複数のグルーピングレベルが含まれている場合、1つのグルーピングレベルしかマテリアライズできません。ワークブックまたはデータモデルのデータ要素に複数のグルーピングレベルが含まれている場合、各グルーピングレベルをマテリアライズできます。
* ワークブックとデータモデルのデータ要素の未使用のマテリアライゼーションは、自動的に一時停止できます。未使用のデータセットのマテリアライゼーションは自動的に一時停止できません。詳細は「[マテリアライゼーションの管理](https://help.sigmacomputing.com/docs/manage-materializations)」を参照してください。
* Snowflake接続でマテリアライゼーションを使用する場合、ワークブックとデータモデルのマテリアライズされたデータ要素は一時テーブルを使用します。一時テーブルの詳細については、Snowflakeドキュメントの「[Working with Temporary and Transient Tables](https://docs.snowflake.com/en/user-guide/tables-temp-transient)」を参照してください。

##### **動的テーブルによる増分マテリアライゼーション (Incremental materialization with dynamic tables)**
デフォルトでは、マテリアライゼーションは毎回新しいテーブルを作成します。Snowflake接続でマテリアライゼーションを使用する場合、代わりにマテリアライゼーションに動的テーブルを使用するように接続を構成できます。多くの場合、動的テーブルは増分更新を可能にし、つまり、マテリアライゼーションが実行されると、変更されたデータのみが更新されます。

マテリアライゼーションに動的テーブルを使用するには：
1.  マテリアライゼーションに動的テーブルを使用するように接続を構成します。「[Connect to Snowflake](https://help.sigmacomputing.com/docs/connect-to-snowflake)」の「書き込みアクセスを構成する」を参照してください。
2.  マテリアライゼーションに使用される動的テーブルを構築するためにクエリされる可能性のあるデータベーステーブルで、変更追跡を有効にします。Snowflakeドキュメントの動的テーブル作成に関する「[Enable change tracking](https://docs.snowflake.com/en/user-guide/dynamic-tables-creating#enabling-change-tracking-on-underlying-objects)」を参照してください。

これらのステップを完了すると、マテリアライゼーションは動的テーブルを使用し、利用可能であれば増分リフレッシュを使用します。増分リフレッシュが利用できない場合は、完全なリフレッシュが実行されます。動的テーブルが利用できないかサポートされていない場合は、テーブルが使用されます。要素のマテリアライゼーション履歴を確認して、どの方法が使用されたかを確認できます。「[マテリアライズされたデータ要素のステータスを確認する](https://help.sigmacomputing.com/docs/schedule-materialization-for-a-data-model-or-workbook#review-the-status-of-a-materialized-data-element)」を参照してください。

増分リフレッシュが使用されない場合や、動的テーブルが使用されない場合についての詳細は、Snowflakeドキュメントの「[Known limitations for dynamic tables](https://docs.snowflake.com/en/user-guide/dynamic-tables-limitations)」を参照してください。

既存のマテリアライゼーションスケジュールは、次回のスケジュールされた実行の一部として動的テーブルを使用しようとします。ワークブックとデータモデルのデータ要素のみが、動的テーブルによる増分マテリアライゼーションを使用できます。マテリアライズされたデータセットは動的テーブルを使用しません。

##### **マテリアライゼーションのベストプラクティス (Best practices for materialization)**
* マテリアライゼーションをスケジュールする際は、データの更新時間を考慮してください。データウェアハウスのデータがスケジュールで更新される場合、Sigmaのマテリアライゼーションスケジュールがそのデータ更新の完了後に開始するようにしてください。
* データが使用されないと予想されるときにマテリアライゼーションが実行されるようにスケジュールし、ユーザーがデータにアクセスする前に完了させます。必要であれば、マテリアライゼーションに使用する専用のコンピューティングリソースを作成します。例えば、マテリアライゼーションをゆっくり実行するが、リソースの使用量が少ない小さなコンピューティングリソースを作成します。
* 上流の要素をマテリアライズする場合、下流のマテリアライズされた要素のマテリアライゼーションスケジュールが、上流の要素のマテリアライゼーションの完了後に開始するようにしてください。
* データ構造の変更が将来のマテリアライゼーションの失敗を引き起こさないように、データモデルまたはデータセットを設定する際には、[マテリアライゼーションの制限](#materialization-limitations)を考慮してください。
* マテリアライズされたデータソースと要素の子要素にコントロールを対象として、信頼性の高いインタラクションと出力を確保します。
* 長時間実行されるクエリのタイムアウト制限を考慮してください。マテリアライゼーションクエリは、[接続で構成されたSigmaのクエリタイムアウト](https://help.sigmacomputing.com/docs/manage-workbook-refresh-options#set-a-query-id-cache-duration)を使用せず、代わりにデータプラットフォームで使用されるコンピューティングリソースで定義された設定（例えば、Snowflakeの仮想ウェアハウスのクエリタイムアウト設定など）を使用します。

##### **マテリアライゼーションの制限 (Materialization limitations)**
一部のデータ構造はマテリアライズできません。[行レベルのセキュリティ](https://help.sigmacomputing.com/docs/set-up-row-level-security)を持つデータセットなど、一つ以上の[システム関数](https://help.sigmacomputing.com/docs/system-functions)を使用する列がデータに含まれている場合、マテリアライゼーションは実行に失敗します。

マテリアライゼーションは実行時のデータの固定出力を反映するため、一部のデータ構造は予期しない結果を生むことがあります。
* データセットが[パラメータ](https://help.sigmacomputing.com/docs/create-and-manage-dataset-parameters)を使用する場合、マテリアライゼーションはパラメータの初期値を使用して実行されます。パラメータへの将来の変更は影響しません。
* ワークブックまたはデータモデルのデータ要素が一つ以上の[コントロール](https://help.sigmacomputing.com/docs/intro-to-control-elements)の対象となっている場合、マテリアライゼーションはコントロールの初期値を使用して実行されます。マテリアライゼーション後、コントロールを使用してマテリアライズされたデータ要素と対話すると、マテリアライズされたデータは使用されず、代わりにクエリが実行されて最新のデータが取得されます。代わりに、コントロールを子要素を対象にしてください。

ワークブックやデータモデルのデータ要素は、ルックアップ、[結合](https://help.sigmacomputing.com/docs/join-data-in-workbooks)、リレーションシップなどで他のデータ要素を参照していてもマテリアライズできますが、ソースデータ要素の一つがマテリアライズできない場合を除きます。
データセットは、ルックアップ、リンク、または[結合](https://help.sigmacomputing.com/docs/join-data)などで他のデータセットを参照していてもマテリアライズできますが、ソースデータセットの一つがマテリアライズできない場合を除きます。
OAuth認証を使用してデータプラットフォームに接続している場合、ワークブックやデータモデルのデータ要素はマテリアライズできますが、データセットはマテリアライズできません。

##### **マテリアライゼーションを設定する (Set up materialization)**
データモデルやワークブックの要素、またはデータセットにマテリアライゼーションを設定するには：
* [データモデルまたはワークブックのマテリアライゼーションをスケジュールする](https://help.sigmacomputing.com/docs/schedule-materialization-for-a-data-model-or-workbook)
* [データセットのマテリアライゼーションをスケジュールする](https://help.sigmacomputing.com/docs/dataset-materialization-api)
* 
#### 5-4-1-2. データモデルまたはワークブックのマテリアライゼーションをスケジュールする (ベータ版)

> 🚩
> データモデル内のデータ要素のマテリアライゼーションは一般的に利用可能です。
> ワークブック内のデータ要素のマテリアライゼーションはパブリックベータです。
> このドキュメントはパブリックベータ機能について説明しており、現在作成中です。この通知およびSigmaサービス内の機能に対応するベータフラグが削除されるまで、このドキュメントは公開されたドキュメントの一部とは見なされません。他のベータ機能と同様、以下で説明する機能は、迅速で反復的な変更の対象となります。Sigmaサービスでの最新の体験は、このドキュメントの内容と異なる場合があります。
> ベータ機能は、[ベータ機能](https://help.sigmacomputing.com/docs/beta-features)の免責事項の対象となります。

マテリアライゼーションをスケジュールすることにより、ワークブックまたはデータモデル内のデータ要素をマテリアライズします。構成したマテリアライゼーションスケジュールは、下流の要素のデータの鮮度に影響します。制限事項やベストプラクティスを含む詳細については、「[マテリアライゼーションについて](https://help.sigmacomputing.com/docs/about-materialization)」を参照してください。データモデルがバージョンタグを使用している場合は、「[バージョンタグ付きデータモデルのマテリアライゼーションをスケジュールする](https://help.sigmacomputing.com/docs/schedule-materialization-for-a-version-tagged-data-model)」を参照してください。

##### **要件 (Requirements)**
* 接続で[書き込みアクセス](https://help.sigmacomputing.com/docs/set-up-write-access)が有効になっている必要があります。
* データモデルでマテリアライゼーションをスケジュールするには、`Schedule materializations`および`Create, edit, and publish datasets`権限が有効になっているアカウントタイプを割り当てられている必要があります。
* ワークブックでマテリアライゼーションをスケジュールするには、`Schedule materializations`および`Create, edit, and publish workbooks`権限が有効になっているアカウントタイプを割り当てられている必要があります。
* ワークブックまたはデータモデルに対する`Can Edit`アクセス権が必要です。

##### **データ要素のマテリアライゼーションスケジュールを作成する (Create a data element materialization schedule)**
ワークブックまたはデータモデル内の特定のデータ要素をマテリアライズできます。
> 📘
> データ要素は1つのマテリアライゼーションスケジュールしか持てませんが、1つのスケジュールで複数の要素をマテリアライズするように作成できます。

1.  編集のためにデータモデルまたはワークブックを開きます。
2.  マテリアライズしたい要素を探し、`More`をクリックして要素メニューを開きます。
3.  `Advanced options` > `Schedule materialization...`を選択します。
4.  `Materialization schedules`モーダルで、データ要素をマテリアライズするスケジュールを設定します。
    * (任意) `Daily`のドロップダウンを選択し、`Weekly`, `Monthly`, または`Custom`を選択します。
        * `Daily`の場合、`Once a day`または`Multiple times`を選択します。
        * `Weekly`の場合、マテリアライゼーションジョブを実行する曜日を選択し、`Once a day`または`Multiple times`を選択します。
        * `Monthly`の場合、マテリアライゼーションジョブを実行する月の日と時刻を選択します。
        * `Custom`の場合、cron構文を使用してスケジュールを指定します。
    * `Multiple times`を選択した場合は、頻度を指定します。例えば、午前9時から午後6時までの間、毎時15分に2時間ごとなど。
    * (任意) ドロップダウンメニューを使用して、デフォルトのスケジュールタイムゾーンを調整します。
    > 📘
    > 要素に複数のグルーピングレベルが含まれている場合、マテリアライズするグルーピングレベルを選択します。Sigmaは選択されたグルーピングレベルとその上位のすべてのレベルをマテリアライズします。グループ化された要素の最も粒度の細かいレベル（All source columns）をマテリアライズすることは、しばしば不要でコストがかかる可能性があります。
5.  `Save schedules`をクリックします。
マテリアライゼーションの実行は、ワークブックの最新の公開バージョンを使用して直ちに開始されます。
> 🚩
> データプラットフォームへの認証にOAuthを使用する場合、マテリアライゼーションジョブはマテリアライゼーションをスケジュールしたユーザーとして実行されます。代わりにサービスアカウントを使用してマテリアライゼーションを実行するには、ワークブックをサービスアカウントとして実行します。「[Run a workbook with service account credentials](https://help.sigmacomputing.com/docs/run-a-workbook-with-service-account-credentials)」を参照してください。

##### **依存マテリアライゼーションスケジュールを設定する (Set up a dependent materialization schedule)**
親要素と子要素の両方をマテリアライズする場合、子要素に対して依存マテリアライゼーションスケジュールを設定できます。依存マテリアライゼーションスケジュールでは、一つ以上の子要素のマテリアライゼーションは、親要素のマテリアライゼーションが正常に完了した後に実行されます。依存マテリアライゼーションは、子要素のデータが親要素で利用可能な最新のデータを反映することを保証するのに役立ちます。

親要素は、同じワークブック、データモデル、またはデータモデルをまたいで、複数のレベル上流にある場合があります。親要素と子要素を特定するには、ワークブックまたはデータモデルの[データリネージ](https://help.sigmacomputing.com/docs/view-workbook-data-lineage)を確認してください。

依存マテリアライゼーションスケジュールを設定するには、以下を実行します。
1.  編集のためにデータモデルまたはワークブックを開きます。
2.  マテリアライズしたい子要素を探し、`More`をクリックして要素メニューを開きます。
3.  `Advanced options > Schedule materialization...`を選択します。
4.  `Materialization schedules`モーダルが、選択した要素のドラフトスケジュールと共に開きます。
5.  `Frequency`セクションの`Select a run time`で、オプションを選択します。
    * 子要素を親要素のマテリアライゼーションが正常に終了した後にのみマテリアライズするには、`After selected parent schedule finishes`を選択し、ドロップダウンメニューで関連する親スケジュールを選択します。
    * 親要素のマテリアライゼーションスケジュールとは別に、子要素を独自のスケジュールでマテリアライズするには、`Manual Time`を選択し、頻度を指定します。
6.  [任意] 同じスケジュールで複数の要素をマテリアライズしたい場合は、`+ Add element`を選択し、別の要素を選択します。
7.  `Save schedules`を選択します。
保存後、依存スケジュールは親スケジュールと同じスケジュールの一部として表示されます。親スケジュールが一時停止または失敗した場合、依存スケジュールも一時停止または失敗します。
> 📘
> 親要素のマテリアライゼーションスケジュールが削除された場合、依存スケジュールは親要素に設定された頻度と一致するように更新されます。

##### **マテリアライズされたデータ要素のステータスを確認する (Review the status of a materialized data element)**
マテリアライゼーションのステータスはいくつかの場所で確認できます。
* ワークブックまたはデータモデルでデータ要素を表示すると、要素メニューにマテリアライゼーションのステータスが表示されます。
* データ要素のリネージを確認すると、マテリアライゼーションのステータスが表示されます。

データ要素のマテリアライゼーション履歴を確認するには：
1.  編集のためにデータモデルまたはワークブックを開きます。
2.  マテリアライズしたい要素を探し、`More`をクリックして要素メニューを開きます。
3.  `Advanced options` > `Schedule materialization...`を選択します。
4.  `Materialization schedules`モーダルで、`History`を選択します。
5.  ワークブックまたはデータモデル内のすべての要素のマテリアライゼーション履歴を確認します。
    * マテリアライゼーションのステータスを確認します。失敗したマテリアライゼーションについては、エラーメッセージをコピーできます。
    * マテリアライゼーションの開始時刻と実行時間を確認します。
    * 総行数と総バイト数でマテリアライズされたデータの量を確認します。
    * `More`を選択して要素を直ちにマテリアライズするか、その要素をマテリアライズするスケジュールに移動します。

##### **スケジュールされたマテリアライゼーションを実行する (Run a scheduled materialization for a data element)**
スケジュールされたマテリアライゼーションを持つデータ要素を直ちにマテリアライズするには：
1.  マテリアライズされたデータ要素を選択します。
2.  メニューで、`View materialization info` ()を選択します。
    * このオプションが利用できない場合、要素はマテリアライズされていません。「[データ要素のマテリアライゼーションスケジュールを作成する](https://help.sigmacomputing.com/docs/schedule-materialization-for-a-data-model-or-workbook#create-a-data-element-materialization-schedule)」を参照してください。
3.  表示されるメニューで、`Materialize now`をクリックします。
マテリアライゼーションの実行は、ワークブックの最新の公開バージョンを使用して直ちに開始されます。

また、スケジュールからデータ要素のマテリアライゼーションを実行することもできます。例えば、同じスケジュール内のすべてまたは複数の要素のマテリアライゼーションを直ちに実行したい場合などです。
1.  マテリアライズされたデータ要素を選択します。
2.  `More`をクリックして要素メニューを開きます。
3.  `Advanced options` > `Schedule materialization...`を選択します。
4.  `Materialization schedules`モーダルで、スケジュール内の要素を確認し、直ちにマテリアライズするものを選択します。
    * スケジュール内のすべての要素をマテリアライズするには、ヘッダー行で`More` > `Materialize all now`を選択します。
    * スケジュール内の個々の要素をマテリアライズするには、要素の行を探し、`More` > `Materialize now`を選択します。
マテリアライゼーションの実行は、ワークブックの最新の公開バージョンを使用して直ちに開始されます。

##### **マテリアライゼーションスケジュールを管理する (Manage the materialization schedule for a data element)**
マテリアライゼーションスケジュールを変更して、マテリアライズの頻度やどの要素がマテリアライズされるかを変更できます。また、スケジュールから一つ以上の要素を削除したり、スケジュール全体を削除したりすることもできます。要素またはスケジュール全体を削除すると、関連するテーブルは24時間以内にデータプラットフォームから削除されます。

1.  編集のためにデータモデルまたはワークブックを開きます。
2.  マテリアライズしたい要素を探し、`More`をクリックして要素メニューを開きます。
3.  `Advanced options` > `Schedule materialization...`を選択します。
4.  `Materialization schedules`モーダルで、希望の変更を加えます。
    * スケジュールの頻度を修正する。
    * スケジュールから要素を削除する。要素の行を探し、`More` > `Remove element`を選択します。
    * `Delete schedule`を選択してスケジュールを削除する。

管理者として、追加のマテリアライゼーション機能を管理するには、「[マテリアライゼーションの管理](https://help.sigmacomputing.com/docs/manage-materializations)」を参照してください。

#### 5-4-1-3. データセットのマテリアライゼーションをスケジュールする (Schedule materialization for a dataset)

マテリアライゼーションをスケジュールすることにより、データセットをマテリアライズします。構成したマテリアライゼーションスケジュールは、下流の要素のデータの鮮度に影響します。制限事項やベストプラクティスを含む詳細については、「[マテリアライゼーションについて](https://help.sigmacomputing.com/docs/about-materialization)」を参照してください。

##### **要件 (Requirements)**
* 接続で[書き込みアクセス](https://help.sigmacomputing.com/docs/set-up-write-access)が有効になっている必要があります。
* データセットでマテリアライゼーションをスケジュールするには、`Schedule materializations`および`Create, edit, and publish datasets`権限が有効になっているアカウントタイプを割り当てられている必要があります。
* データセットに対する`Can Edit`アクセス権が必要です。

##### **データセットのマテリアライゼーションスケジュールを作成する (Create a materialization schedule for a dataset)**
データセットをマテリアライズするには：
1.  マテリアライズしたいデータセットを開きます。
2.  `Materialization`タブを選択し、`Create Schedule`をクリックします。
3.  `Add Materialization Schedule`モーダルで、マテリアライズされたデータを更新するためのスケジュールを定義します。
4.  `Save`をクリックします。
データの最初のマテリアライゼーションは直ちに開始されます。

##### **データセットのマテリアライゼーションのステータスを確認する (Review the status of a dataset materialization)**
データセットがマテリアライズされている場合、データセットのヘッダーでマテリアライゼーションのステータスを確認できます。
1.  データセットヘッダーで、情報アイコン()をクリックしてデータセット情報を開きます。
2.  `Materialization`セクションで、ステータスを確認します。最終更新日や次回更新日などの詳細を表示するには、ステータスにカーソルを合わせます。

Adminアカウントタイプを割り当てられたユーザーは、いつでも`Materialization`タブからマテリアライゼーションのステータスと履歴を表示できます。「[Manage materializations](https://help.sigmacomputing.com/docs/manage-materializations)」を参照してください。

##### **データセットのマテリアライゼーションジョブを実行する (Run a materialization job for a dataset)**
スケジュールされたマテリアライゼーションを手動で実行するには、以下を実行します。
1.  データセットを開き、`Materialization`タブを選択します。
2.  `Schedule`セクションで、`Run Now`をクリックします。

##### **データセットのマテリアライゼーションスケジュールを修正する (Modify a dataset materialization schedule)**
データセットのマテリアライゼーションスケジュールに変更を加えるには：
1.  データセットを開き、`Materialization`タブを選択します。
2.  `Schedule`セクションで、`More` > `Edit Schedule`をクリックします。
3.  新しいスケジュールを定義します。
4.  `Save`をクリックします。
マテリアライゼーションスケジュールは直ちに変更されます。次のマテリアライゼーションは、次のスケジュールされた時刻に行われます。

##### **データセットのマテリアライゼーションスケジュールを削除する (Delete a dataset materialization schedule)**
データセットのマテリアライゼーションスケジュールを削除し、マテリアライズされたデータを接続されたデータプラットフォームから削除するには：
1.  データセットを開き、`Materialization`タブを選択します。
2.  `Schedule`セクションで、`More` > `Remove Schedule`をクリックします。
3.  表示される確認画面で、`Remove`を選択します。
Sigmaは自動的にウェアハウスからマテリアライズされたテーブルを削除します。テーブルが削除されるまで最大24時間かかることがあります。

#### 5-4-1-4. バージョンタグ付きデータモデルのマテリアライゼーションをスケジュールする (Schedule materialization for a version-tagged data model)

一つ以上のタグ付きバージョンを持つデータモデルがある場合、データモデルの各バージョンに対して[マテリアライゼーション](https://help.sigmacomputing.com/docs/about-materialization)スケジュールを設定できます。例えば、「testing」と「production」のタグ付きバージョンのデータモデルがある場合、各タグのデータ要素に対してマテリアライゼーションをスケジュールでき、これにより、そのタグ付きバージョンのデータモデルに依存する下流の要素のパフォーマンスを向上させることができます。

バージョンタグ付きデータモデルの要素のマテリアライゼーションをスケジュールする際には、[マテリアライゼーションのベストプラクティス](https://help.sigmacomputing.com/docs/about-materialization#best-practices-for-materialization)が引き続き適用されます。マテリアライゼーションのスケジューリングに関する詳細は、「[データモデルまたはワークブックのマテリアライゼーションをスケジュールする](https://help.sigmacomputing.com/docs/schedule-materialization-for-a-data-model-or-workbook)」を参照してください。

##### **要件 (Requirements)**
* この機能を使用するには、[データをマテリアライズする権限](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を持つアカウントタイプを割り当てられている必要があります。
* データ要素をマテリアライズするには、データソースの接続で書き込みアクセスが有効になっている必要があります。

##### **タグ付きデータモデルのマテリアライゼーションをスケジュールする (Schedule materialization for a tagged data model)**
少なくとも一つのタグ付きバージョンを持つデータモデルについて、タグ付きバージョンの一つ以上のデータ要素のマテリアライゼーションをスケジュールします。データモデルの異なるタグ付きバージョン間で同じデータ要素のマテリアライゼーションをスケジュールしたい場合は、各タグ付きバージョンに対してスケジュールを作成します。

1.  データモデルを開きます。
2.  ドキュメントヘッダーで、更新データボタンの隣にある`More options` > `Materialization schedule...`をクリックします。
3.  `Materialization`モーダルで、`+ New schedule`をクリックします。マテリアライゼーションスケジュールがない場合は、`Add schedule`をクリックします。
    > 💡
    > 代わりに既存のスケジュールを複製するには、複製したいスケジュールを探し、`More` > `Duplicate schedule`を選択します。
4.  `Version`で、 を選択してバージョンを修正し、ドロップダウンでスケジュールを適用するバージョンタグを選択します。
5.  `Elements`で、スケジュールにデータ要素を追加します。公開バージョンまたはデータモデルの別のタグ付きバージョンでマテリアライズされているのと同じ要素をタグ付きバージョンでマテリアライズするには、`+ Add element`を選択し、`Copy elements from schedule of other versions`を選択します。
6.  スケジュールの頻度を設定します。
    * (任意) `Daily`のドロップダウンを選択し、`Weekly`, `Monthly`, または`Custom`を選択します。
    * `Daily`の場合、`Once a day`または`Multiple times`を選択します。
    * `Weekly`の場合、マテリアライゼーションジョブを実行する曜日を選択し、`Once a day`または`Multiple times`を選択します。
    * `Monthly`の場合、マテリアライゼーションジョブを実行する月の日と時刻を選択します。
    * `Custom`の場合、cron構文を使用してスケジュールを指定します。
    * `Multiple times`を選択した場合は、頻度を指定します。
    * (任意) ドロップダウンメニューを使用して、デフォルトのスケジュールタイムゾーンを調整します。
7.  スケジュールを保存します。

> 📘
> タグをデータモデルの新しいバージョンに昇格させる（例えば、古いバージョンのデータモデルから最新の公開バージョンにタグを移動するなど）と、新しいマテリアライゼーションの実行が開始されます。新しくタグ付けされたバージョンのマテリアライゼーションが実行されている間は、以前にタグ付けされたバージョンのデータモデルのマテリアライズされたデータが使用されます。

#### 5-4-2-1. パフォーマンス向上のためのベストプラクティス (Best practices for improved performance)

このドキュメントでは、パフォーマンスに関連するいくつかのベストプラクティスを集めて、検討のために提供します。

##### **データセットを使用してクエリ負荷を削減する (Use datasets to reduce query loads)**
Sigmaはデータセットを使用して、データ定義を一元化し、ワークブックにソースデータを提供します。データセットの使用に関する詳細は、「[Data modeling In Sigma](https://help.sigmacomputing.com/docs/datasets)」および「[Data modeling tutorial](https://help.sigmacomputing.com/docs/tutorial-data-modeling-with-datasets)」を参照してください。

データセットレベルでフィルターを使用することにより、ワークブックのクエリで返される不要なデータの量を削減します。フィルターは、制限しすぎることなく無関係なデータを削減します。最も関連性の高いデータのみを表示することで、インサイト発見のプロセスがはるかに速くなります。マテリアライゼーションと組み合わせると、クエリの実行も速くなります。

* **データセットの時間範囲フィルター (Dataset time range filters)**
    相対日付フィルターを使用して、Sigmaのクエリが特定の時間範囲のデータのみを返すようにします。詳細は、「[Add relative date filters](https://help.sigmacomputing.com/docs/dataset-filters#add-relative-date-filters)」および「[Dataset filters](https://help.sigmacomputing.com/docs/dataset-filters)」を参照してください。
* **データセットパラメータ (Dataset parameters)**
    データセットパラメータを作成し、ワークシートで使用して、データが必要なものだけにフィルタリングされるようにします。詳細は、「[Dataset parameters](https://help.sigmacomputing.com/docs/dataset-parameters)」を参照してください。

##### **データセットとワークブック要素をマテリアライズしてコンピューティングコストを削減する (Materialize datasets and workbook elements to reduce compute costs)**
マテリアライゼーションを使用すると、データセットとワークブック要素をテーブルとしてウェアハウスに書き戻すことができ、これによりコンピューティングコストを削減できます。マテリアライゼーションは、データウェアハウスがデータセットを要素または下流のSigma分析で使用する際に再計算を回避できるようにすることで、クエリのパフォーマンスを向上させます。詳細は、「[Materialization](https://help.sigmacomputing.com/docs/about-materialization)」を参照してください。

##### **CDWでクエリキャッシュを使用する (Use a query cache in the CDW)**
一部のクラウドデータウェアハウス（CDW）には、Sigmaが追加のコンピューティングコストを発生させることなくクエリ結果を取得するために使用できるクエリ結果キャッシュがあります。これにより、パフォーマンスが向上します。詳細は、「[Set a cache duration](https://help.sigmacomputing.com/docs/set-a-cache-duration)」を参照してください。

##### **ワークブックのパフォーマンスを向上させるためのその他のヒント (More tips for improving workbook performance)**
過剰な結合、繰り返されるロジック、未使用のデータ、フィルターの過負荷は、ワークブックを遅くする可能性があります。パフォーマンスのヒントについては、Sigmaコミュニティの「[How to improve workbook performance](https://community.sigmacomputing.com/dashboards-and-workbooks/how-to-improve-workbook-performance-224)」を参照してください。

#### 5-4-2-2. ウェアハウスビューの作成と管理 (Create and manage warehouse views)

ウェアハウスビューは、あなたのデータプラットフォームに保存される仮想テーブルです。テーブル、ピボットテーブル、入力テーブル、およびチャートからウェアハウスビューを作成し、Sigmaまたはあなたのデータエコシステム内の他の任意のアプリケーションを使用してそれらにクエリを実行できます。ウェアハウスビューはクエリを簡素化し、関連性のある最新のデータサブセットをデータプラットフォームから直接取得することを可能にします。

このドキュメントでは、ワークブックとデータモデルでウェアハウスビューを作成および管理する方法について説明します。管理者ポータルの `Warehouse Views` ページに関する情報については、「[Review warehouse view details](https://help.sigmacomputing.com/docs/review-warehouse-view-details)」を参照してください。

> 📘
> この機能は、すべてのデータプラットフォーム接続でサポートされているわけではありません。あなたの接続がサポートしているかを確認するには、「[Supported data platforms and feature compatibility](https://help.sigmacomputing.com/docs/region-and-feature-support)」を参照してください。

##### **システムとユーザー要件 (System and user requirements)**
ウェアハウスビューを作成および管理する機能には、以下が必要です。
* 要素のデータソースは、[書き込みアクセス](https://help.sigmacomputing.com/docs/set-up-write-access)が有効になっている接続からデータを取得する必要があります。
* `Create warehouse views` 権限が有効になっている[アカウントタイプ](https://help.sigmacomputing.com/docs/account-type-and-license-overview)を割り当てられている必要があります。
* あなたはワークブックまたはデータモデルの所有者であるか、そのワークブックまたはデータモデルに対する `Can edit` [アクセス権](https://help.sigmacomputing.com/docs/share-a-workbook)を付与されている必要があります。

##### **ウェアハウスビューについて (About warehouse views)**
データベーステーブルにデータを保存する代わりに、ウェアハウスビューは、Sigmaの個々のデータ要素または入力テーブルによって定義された特定のクエリロジックを表現するSQLステートメントを保存します。

ウェアハウスビューを作成すると、あなたのデータプラットフォームとSigmaの間にライブリンクが確立されます。ビューはデータ要素または入力テーブルを信頼できる唯一の情報源（source of truth）として参照し、要素の基盤となるデータの最新バージョンを反映するように自動的に更新されます。

ウェアハウスビューはデータプラットフォームに直接クエリを実行するため、マテリアライゼーションとは動作が異なります。しかし、マテリアライズされた要素からウェアハウスビューを作成することもでき、その場合、ビューは要素のマテリアライズされた基盤となるデータテーブルにクエリを実行します。

##### **ウェアハウスビューについて (About warehouse views)**
データベーステーブルにデータを保存する代わりに、ウェアハウスビューは、Sigmaの個々のデータ要素または入力テーブルによって定義された特定のクエリロジックを表現するSQLステートメントを保存します。

ウェアハウスビューを作成すると、あなたのデータプラットフォームとSigmaの間にライブリンクが確立されます。ビューはデータ要素または入力テーブルを信頼できる唯一の情報源（source of truth）として参照し、要素の基盤となるデータの最新バージョンを反映するように自動的に更新されます。

ウェアハウスビューはデータプラットフォームに直接クエリを実行するため、マテリアライゼーションとは動作が異なります。しかし、マテリアライズされた要素からウェアハウスビューを作成することもでき、その場合、ビューは要素のマテリアライズされた基盤となるデータテーブルにクエリを実行します。

##### **ウェアハウスビューの考慮事項 (Warehouse view considerations)**
ウェアハウスビューを作成する際には、以下の制限と制約を考慮してください。
* ウェアハウスビューは、ドキュメントの公開バージョンから作成されます。データモデルまたはワークブックのタグ付きバージョンからウェアハウスビューを作成することはできません。ワークブックのカスタムビューと保存済みビューもサポートされていません。ドラフトでウェアハウスビューが作成された場合、以下のいずれかの結果となります。
    * 要素がドラフトにのみ存在する場合、Sigmaはワークブックまたはデータモデルが公開され、要素が公開バージョンに存在するときにビューを作成します。
    * 要素が公開バージョンに存在するが、ドラフトに未保存の変更が含まれている場合、Sigmaは要素の公開バージョンに基づいてビューを作成します。これはドラフトのデータと一致しない可能性があります。
    * 要素が公開バージョンに存在し、ドラフトに未保存の変更がない場合、Sigmaは要素の公開バージョンに基づいてビューを作成します。これはドラフトのデータと一致します。
* 以下の動的な条件はサポートされていません。
    * **要素内でパラメータとして参照されるコントロール値:** コントロール値は、クエリがユーザー入力に依存するため、要素のSQLステートメントで明示的に定義されません。
    * **相対日付フィルター:** 相対日付フィルター（`Last`, `Next`, `Current`など）は、要素のSQLステートメントで明示的に定義できない現在の日付基準に依存します。
* グループ化されたテーブルからウェアハウスビューを作成する場合、ウェアハウスビューに使用するグルーピングレベルを定義することはできません。
* データ要素に[列レベルのセキュリティ](https://help.sigmacomputing.com/docs/column-level-security)が含まれている場合、ウェアハウスビューを作成することはできません。
* データ要素が[転置](https://help.sigmacomputing.com/docs/transpose-a-table)されている場合、ウェアハウスビューを作成することはできません。

##### **ビューを作成する (Create a view)**
ウェアハウスビューを作成するには、以下を実行します。
1.  公開済みのワークブックまたはデータモデルを開き、ウェアハウスビューを作成したい要素を探します。
2.  要素ツールバーで、`More` をクリックして要素メニューを開き、`Advanced options` > `Create warehouse view` を選択します。
3.  `Create Warehouse View` モーダルで、Sigmaはビューの名前を自動生成します。必要に応じて名前を編集し、`Create` をクリックします。この名前は、データプラットフォームにビューを保存する際にも使用されます。

Sigmaはビューが正常に作成されると通知します。また、要素ツールバーでステータスをプレビューしたり、`View warehouse view info` をクリックしてビューの詳細を確認したりすることもできます。
> 📘
> Sigmaがビューを作成した後、要素に適用されたフィルターやその他の変更は、ワークブックが再公開されたときにのみビューに保存されます。

要素ごとに作成できるウェアハウスビューは1つだけです。同じデータの複数のビューを作成する必要がある場合は、要素を複製し、必要に応じてデータを調整して、別のウェアハウスビューを作成できます。

Sigmaはビューが正常に作成されると通知します。また、要素ツールバーでステータスをプレビューしたり、`View warehouse view info` をクリックしてビューの詳細を確認したりすることもできます。
> 📘
> Sigmaがビューを作成した後、要素に適用されたフィルターやその他の変更は、ワークブックが再公開されたときにのみビューに保存されます。

要素ごとに作成できるウェアハウスビューは1つだけです。同じデータの複数のビューを作成する必要がある場合は、要素を複製し、必要に応じてデータを調整して、別のウェアハウスビューを作成できます。

##### **ビューの名前を変更する (Rename a view)**
ウェアハウスビューの名前を変更するには、以下を実行します。
1.  ワークブックまたはデータモデルを開き、名前を変更したいウェアハウスビューに関連付けられた要素を探します。
2.  要素ツールバーで、`More`をクリックして要素メニューを開き、`Advanced options` > `Manage warehouse view`を選択します。
3.  `Manage Warehouse View`モーダルで、`Name`フィールドに新しい名前を入力し、`Update`をクリックします。
     ウェアハウスビューの名前とパスが更新されます。

要素ツールバーでウェアハウスビューの更新ステータスをプレビューするか、`View warehouse view info`をクリックしてビューの詳細を確認できます。「[ウェアハウスビューのステータス](#warehouse-view-statuses)」を参照してください。
##### **ビューを削除する (Delete a view)**
ウェアハウスビューを削除するには、以下を実行します。
1.  ワークブックまたはデータモデルを開き、削除したいウェアハウスビューに関連付けられた要素を探します。
2.  要素ツールバーで、`More` > `Advanced options` > `Manage warehouse view` を選択します。
3.  `Manage Warehouse View` モーダルで、`Delete` をクリックします。
4.  `Confirm Delete` モーダルで、`Delete` をクリックします。

##### **ウェアハウスビューのステータス (Warehouse view statuses)**
ウェアハウスビューには以下のステータスが適用されます。

| ステータス | 説明 |
| :--- | :--- |
| **Pending** | Sigmaはワークブックが公開されるとビューを作成または更新します。|
| **Successful** | Sigmaはビューの作成または更新に成功しました。|
| **In Progress** | Sigmaは現在ビューを作成または更新中です。|
| **Failed** | ビューの作成または更新ができませんでした。失敗ステータスの原因を表示するには、ウェアハウスビュー詳細で`Failed`ステータスインジケータにカーソルを合わせます。|

##### **トラブルシューティング (Troubleshooting)**
特定の要素に対してウェアハウスビューを作成できない場合は、以下のいずれかが真であるかを確認してください。
* 現在、探索（exploration）で作業している。ウェアハウスビューを作成する前に、探索をワークブックとして保存する必要があります。
* 別のウェアハウスビューをソースとするデータ要素または入力テーブルに対してウェアハウスビューを作成しようとしている。ビューは他のビューをクエリできません。
* 要素データが[コントロール値をパラメータとして参照している](https://help.sigmacomputing.com/docs/reference-workbook-control-values-in-sql-statements)。
* 要素タイプが現在ウェアハウスビューをサポートしていない。

### 5-5. クエリの調査

#### 5-5-1. ワークブックとデータモデルのクエリを調査する (Examine workbook and data model queries)

ワークブックまたはデータモデルを開くと、Sigmaは最適化されたSQLクエリを生成・実行し、接続されたデータプラットフォームからデータを取得します。クエリ結果は、安全にあなたのウェブブラウザに返されます。

ワークブックまたはデータモデルの**クエリ履歴**を開くことで、ブラウザセッション中に実行されたクエリの構文やその他の詳細を確認できます。データセットのクエリ履歴に関する詳細は、「[データセットのクエリを調査する](https://help.sigmacomputing.com/docs/examine-dataset-queries)」を参照してください。

**クエリ履歴**は、ユーザーセッション中にワークブックから実行された最近のクエリの概要を表示し、クエリのランタイムや現在のステータスを含みます。個々のクエリをさらに深く掘り下げて、基盤となるSQLを表示したり、トラブルシューティングのためのリクエストIDを収集したり、エラーを調査したりすることができます。

##### **最近のクエリを表示する (View recent queries)**
クエリ履歴は、既存のセッション中にワークブックまたはデータモデルから実行された最近のクエリを表示します。ドキュメントの個々のクエリのリストは、各クエリの詳細を自動的に表示します。

1.  ドキュメントヘッダーで、更新データボタンの隣にある`More options`をクリックします。
2.  `Query history`を選択します。

##### **ブラウザの計算を表示する (View browser calculations)**
一部のクエリはデータプラットフォームから結果を返し、その他はデータプラットフォームの結果キャッシュから、さらに他の結果はブラウザキャッシュから返されます。
デフォルトでは、ブラウザで実行された計算はデータプラットフォームに送信されないため、クエリ履歴から非表示になっています。ブラウザの計算履歴を表示するには、以下を実行します。

1.  ドキュメントヘッダーで、更新データボタンの隣にある`More options`をクリックします。
2.  `Query history`を選択します。
3.  `Query history`モーダルの上部で、`View browser calculations`トグルをオンにします。
4.  `Execution Path`列で`Browser`エントリを確認します。

##### **個々のクエリ詳細を表示する (View individual query details)**
生成されたSQL、完全な実行時間、トラブルシューティング用のリクエストIDなど、個々のクエリの詳細を表示するには、以下を実行します。
1.  ドキュメントヘッダーで、更新データボタンの隣にある`More options`をクリックします。
2.  `Query history`を選択します。
3.  調査したいクエリを選択します。Sigmaは選択されたクエリの詳細を表示します。
    * 要素名を選択して、クエリが実行されたデータ要素を開きます。
    * 実行時間と期間を確認します。
    * 生成されたSQLを表示およびコピーします。
    * 失敗したクエリの場合、エラーメッセージを確認します。
    * トラブルシューティングの際にSigmaサポートと共有するためのリクエストIDをコピーします。

##### **クエリを一時停止および再開する (Pause and resume queries)**
データプラットフォームに対して自動的にクエリを実行せずにドキュメントに変更を加えるには、クエリを一時停止します。
1.  ドキュメントヘッダーで、更新データボタンの隣にある`More options`をクリックします。
2.  `Pause queries`を選択します。
クエリを一時停止した後にクエリの実行を再開するには、`Resume queries`を選択します。

##### **クエリ履歴のリファレンス (Query history reference)**
ステータス、実行時間、リクエストタイプ、および実行パスの詳細については、以下のセクションを参照してください。

* **クエリステータスタイプ (Query status types)**

| ステータス | 詳細 |
| :--- | :--- |
| **Completed** | クエリは正常に実行されました。|
| **Running** | クエリは現在実行中です。デフォルトでは、Sigmaはクエリのタイムアウトを120秒（2分）に設定しています。 |
| **Errored** | クエリ実行中にエラーが発生しました。行を選択してクエリ詳細とエラーメッセージを表示します。 |
| **Paused** | ドキュメント上のクエリは一時停止しています。クエリの実行を再開して最新データを取得するには、ドキュメントヘッダーの`Refresh queries`をクリックします。 |
| **Canceled** | クエリはキャンセルされました。これは、クエリが終了する前に別のドキュメントタブに切り替えた場合や、クエリが終了する前にドキュメントに変更が加えられた場合に発生する可能性があります。 |

* **クエリ実行時間 (Query run time)**
    正常に完了したクエリとタイムアウトしたクエリに対して、詳細なクエリ実行時間の内訳が利用可能です。クエリの実行時間は、ネットワークトラフィック、キューの遅延、またはデータプラットフォームの処理時間によって変動する可能性があります。実行時間の内訳により、クエリが遅延したかどうか、どの段階で遅延したかを確認できます。

    実行時間は3つの部分に分かれています。
    * **Queue duration (キュー期間):** クエリがデータプラットフォームに送信される前にSigmaのキューで待機する時間。特定のデータプラットフォームでは、Sigmaキューはデータプラットフォームに送信される同時リクエストの数を制限するために使用されます。
    * **Sigma runtime (Sigmaランタイム):** キューの期間とデータプラットフォームの時間を除く、Sigmaがクエリを処理するのにかかる時間。失敗したクエリやキャンセルされたクエリは、クエリがデータプラットフォームのタイムアウトにより失敗した場合でも、すべての実行時間をSigmaに帰属させます。
    * **Warehouse runtime (ウェアハウスランタイム):** Sigmaがデータプラットフォームにリクエストを送信してから応答を受け取るまでの時間。これは、おおよそデータプラットフォームがクエリの実行に費やした時間と同等です。
    * **Result fetch time (結果取得時間):** Sigmaがデータプラットフォームから結果を取得するのにかかる時間。
    * **Details unavailable (詳細利用不可):** PDFダウンロードなどの一部のエクスポートクエリでは、実行時間の内訳詳細は利用できません。

    未完了のクエリやダウンロード/エクスポートリクエストは、詳細な実行時間の内訳を表示しません。
    特定のクエリの実行時間（例えば、キューイング時間が著しく長いなど）に懸念がある場合は、Sigmaサポートにお問い合わせください。

* **クエリリクエストタイプ (Query request types)**
    Sigmaは、異なるタイプの情報を取得するために、データプラットフォームに対して異なるタイプの最適化されたクエリを作成します。
    ドキュメントのクエリ履歴を調査する際、以下のようなリクエストタイプが表示されることがあります。

| リクエストタイプ | 詳細 |
| :--- | :--- |
| **Data Prefetch Query** | 表示されているデータ要素によって使用されるデータソースを取得します。<br>例えば、10個の表示されているKPI要素のデータを取得するために10個の個別のクエリを実行する代わりに、1つのクエリを実行してデータソースを取得します。|
| **<Element name> <Element type>**<br>例：<br>EVENTS Visualization: bar | 要素のデータを取得します。|
| **SQL Preview** | データモデルの概要を表示するために使用されるデータを取得します。|
| **Filter Top Values** | 列の詳細を表示する際や、データ要素のリストフィルターを開く際など、トップの値を取得します。|
| **<Element name> Count Rows** | 列の詳細を取得する際や、データモデルの概要で折りたたまれた要素を表示する際など、要素の行数を取得します。|
| **<Element name> Column statistics** | ワークブックまたはデータモデルの列の詳細を表示する際など、列の統計情報を取得します。|
| **Export Query** | スケジュールされた、またはオンデマンドのワークブック、ページ、または要素のエクスポートを実行するために最新のデータを取得します。|
| **<Element name> Export Query** | CSVやJSONなどの生データ形式で要素をダウンロードするために最新のデータを取得します。|

* **クエリ実行パス詳細 (Query execution path details)**
    Sigmaで利用可能なデータに応じて、クエリの実行パスは異なる場合があります。

| 実行パス | 詳細 |
| :--- | :--- |
| **Warehouse** | 最適化されたSQLクエリでデータプラットフォームを直接クエリしてデータを取得します。|
| **Warehouse (cache)** | 特定のデータプラットフォームで利用可能。クエリIDを使用して、データプラットフォームのクエリ結果キャッシュからデータを取得するクエリを実行します。詳細は、「[Set a query ID cache duration](https://help.sigmacomputing.com/docs/set-a-query-id-cache-duration)」を参照してください。|
| **Warehouse (materialized)** | マテリアライズされたテーブルにクエリを実行してデータを取得します。「[About materialization](https://help.sigmacomputing.com/docs/about-materialization)」を参照してください。|
| **Browser** | ブラウザキャッシュからデータを取得し、アルファクエリを使用して計算を実行します。詳細は、「[Caching and data freshness](https://help.sigmacomputing.com/docs/caching-and-data-freshness)」を参照してください。|

詳細は、「[Caching and data freshness](https://help.sigmacomputing.com/docs/caching-and-data-freshness)」を参照してください。

### 5-5-2. データセットのクエリを調査する (Examine dataset queries)

#### **最近のクエリを表示する (View recent queries)**
クエリ履歴モーダルは、既存のセッション内に開いているドキュメントから実行された最近のクエリを表示します。
あなたのドキュメントの個々のクエリリストは、各クエリのステータス、アクションタイプ、開始時刻、実行時間を自動的に表示します。

1.  データセットのワークシートタブを開きます。
2.  データセットのツールバーの一番左にある更新ボタンの隣にあるキャレットアイコンをクリックします。
3.  `Query history...`をクリックします。

#### **個々のクエリを表示する (View an individual query)**
1.  データセットの`Worksheet`タブを開きます。
2.  データセットのツールバーの一番左にある更新ボタンの隣にあるキャレットアイコンをクリックします。
3.  `Query history...`をクリックします。
4.  調査したいクエリをクリックします。
5.  クエリ詳細ビューを探索します：
    * Sigmaが生成したSQLを表示およびコピーします。
    * クエリが失敗した場合、エラーも`Query Details`の下に表示されます。

#### **クエリステータスタイプ (Query status types)**
これらはSigma内で可能なクエリステータスタイプです。

| | |
| :--- | :--- |
| **Completed** | あなたのクエリは正常に実行されました！ |
| **Running** | あなたのクエリは現在実行中です。 |
| **Errored** | 何か問題があります。クエリ詳細ビューを開いてエラーメッセージを確認してください。 |
| **Paused** | ドキュメント上のクエリは一時停止しています。クエリを再開するには、ドキュメントツールバーの`Play`をクリックしてください。 |
| **Canceled** | クエリはキャンセルされました。これは、クエリが実行される前にドキュメントに追加の変更が加えられた場合に発生する可能性があります。この状況では、Sigmaは新しいクエリのみを実行します。 |

> 📘
> デフォルトでは、Sigmaはクエリのタイムアウトを120秒（2分）に設定しています。組織の管理者は、接続ごとにこれをカスタマイズするオプションがあります。

#### **クエリ実行時間の内訳 (Query runtime breakdown)**
正常に完了したクエリとタイムアウトしたクエリに対して、詳細なクエリ実行時間の内訳が利用可能です。クエリの実行時間は、ネットワークトラフィック、キューの遅延、またはデータウェアハウスの処理時間によって変動する可能性があります。Sigmaの実行時間の内訳により、クエリが遅延したかどうか、いつ遅延したかを確認できます。

実行時間は3つの部分に分かれています。
| | |
| :--- | :--- |
| **Queue duration** | クエリがウェアハウスに送信される前にSigmaのキューで待機する時間。 |
| **Sigma runtime** | キューの期間とウェアハウスの時間を除く、Sigmaがクエリを処理するのにかかる時間。 |
| **Warehouse runtime**| Sigmaがデータウェアハウスにリクエストを送信してから応答を受け取るまでの時間。これは、おおよそウェアハウスがクエリの実行に費やした時間です。 |

未完了のクエリは、詳細な実行時間の内訳を表示しません。この機能は、ダウンロード/エクスポートリクエストでも利用できません。

#### **クエリを一時停止および再開する (Pause and resume queries)**
ウェアハウスに対して自動的にクエリを実行せずにドキュメントに変更を加えるために、クエリを一時停止できます。

1.  データセットの`Worksheet`タブを開きます。
2.  データセットのツールバーの一番左にある更新/再生ボタンの隣にあるキャレットアイコンをクリックします。
3.  `Pause queries`または`Resume queries`をクリックします。
   
### 5-5-3. クエリIDキャッシュ期間を設定する (Set a query ID cache duration)

一部のクラウドデータウェアハウス（CDW）には、Sigmaが追加のコンピューティングコストを発生させることなくクエリ結果を取得するために使用できるクエリ結果キャッシュがあります。CDWで利用可能な場合、SigmaはクエリIDを使用してキャッシュされたデータにアクセスします。これにより、パフォーマンスが向上します。

ワークブックには、クエリIDのキャッシュ期間、つまり存続期間（TTL）の設定があります。デフォルトの期間は10分です。詳細については、「[Caching and data freshness](https://help.sigmacomputing.com/docs/caching-and-data-freshness)」を参照してください。

実際のクエリ結果はSigmaではなく、CDWにキャッシュされます。通常、CDWキャッシュは結果のコピーの形をとり、24時間保存されます。
TTL期間内にソースデータが変更された場合、キャッシュされた結果は無関係または不正確なデータを反映します。

クエリの結果を返そうとする場合、`Cache duration`設定を使用して、結果キャッシュが特定の分数だけ古いことを指定できます。

#### **要件 (Requirements)**
* この機能は、SnowflakeやBigQueryを含む、結果キャッシュをサポートするCDWでのみ利用可能です。
* ワークブックのクエリIDキャッシュ期間を設定するには、組織の`Admin`である必要があります。

#### **クエリキャッシュID期間を設定する (Set a query cache ID duration)**
1.  ワークブックのヘッダーにある更新ボタンの右側にあるキャレット（▼）ボタンをクリックします。
2.  `Data refresh`を選択します。
    `Data Refresh Settings`モーダルが開きます。
3.  `Cache duration`の下で、分または時間で期間を設定します。
4.  `Save`をクリックします。

### 5-5-4. キャッシュとデータの鮮度 (Caching and data freshness)

ワークブックまたはデータモデルを開くと、Sigmaは最適化されたSQLクエリを生成・実行し、接続されたデータプラットフォームからデータを取得します。Sigmaはあなたのデータを保存せず、ブラウザのキャッシングとウェアハウスレベルのキャッシングを使用して、ウェアハウスのオーバーヘッドを削減しつつ、新鮮なデータを保証します。

#### **Sigmaがウェアハウスのオーバーヘッドを削減する方法 (How Sigma reduces warehouse overhead)**
データ要素が更新されると、Sigmaはウェアハウスへのオーバーヘッドを削減しようと試みます。Sigmaが従うステップは以下の通りです。
1.  ブラウザキャッシュを確認する
2.  アルファクエリを試す
3.  CDWの結果IDキャッシュを試す（一部のCDWでのみ利用可能）
4.  ウェアハウスに再度クエリを実行する

> 🚩
> 手動更新またはスケジュールされた更新は、すべてのキャッシングオプションをバイパスします。「[Manage workbook refresh options](https://help.sigmacomputing.com/docs/manage-workbook-refresh-options)」を参照してください。

どのクエリがどこで実行されているかの詳細については、ワークブック、データモデル、またはデータセットのクエリ履歴を確認してください。「[Examine workbook and data model queries](https://help.sigmacomputing.com/docs/examine-workbook-queries)」および「[Examine dataset queries](https://help.sigmacomputing.com/docs/examine-dataset-queries)」を参照してください。

##### **ブラウザキャッシュを確認する (Check browser cache)**
ブラウザキャッシュは、ブラウザですぐにアクセスできるデータを占めます。キャッシュは空であるため、最初にワークブックまたはデータモデルを開いたときにはブラウザキャッシュは利用できませんが、変更を加えるにつれて、Sigmaは可能な場合に結果を表示するために自動的にブラウザキャッシュを使用します。
データ要素に変更を加えると、Sigmaはまずブラウザに既にある既存のデータが、更新された要素でまだ機能するかどうかを確認します。
これは、以下のような場合に発生する可能性があります。
* 列の名前が変更されたり、移動されたりした場合

##### **アルファクエリを試す (Try alpha query)**
ブラウザ内のデータを直接使用できない場合、Sigmaはブラウザ内の既存のデータを使用して新しい値を再計算できるかどうかを確認します。
これは、以下のような場合に発生する可能性があります。
* 新しい集計列が追加された場合

##### **クエリIDキャッシュを試す (Try query ID cache)**
クエリキャッシュは、SnowflakeやBigQueryのように、データウェアハウスが結果キャッシングをサポートしている場合にのみ使用されます。
これは、以下のような場合に発生する可能性があります。
* データを再グループ化する場合

Sigmaはクエリ結果を保存せず、ウェアハウスから返されたクエリIDのみを保存し、そのIDを使用してデータウェアハウスのキャッシュから結果を取得します。

##### **クエリIDキャッシュ期間を設定する (Set a query ID cache duration)**
SnowflakeやBigQueryなど、一部のデータプラットフォームは、クエリIDを使用してキャッシュから過去のクエリの結果を返すことをサポートしています。
ワークブックのキャッシュ期間、つまり存続期間（TTL）とは、SigmaがクエリIDを使用してCDWの結果キャッシュから結果を取得しようと試みる期間を指します。
SigmaがクエリIDキャッシュをクエリに使用できると判断し、CDWに対して最後にクエリが実行された時刻がクエリIDキャッシュ期間内である場合、Sigmaはウェアハウスに対してクエリを再実行しようとはしません。
ウェアハウスに対して最後にクエリが実行された時刻がクエリIDキャッシュ期間外である場合、SigmaはクエリIDを使用してCDWの結果キャッシュから結果を取得してワークブックをレンダリングし、並行してウェアハウスに対してクエリを実行します。最新の結果がウェアハウスから返されると、Sigmaはワークブック要素を更新します。
TTLの変更に関する情報については、「[Set a query ID cache duration](https://help.sigmacomputing.com/docs/set-a-query-id-cache-duration)」を参照してください。

##### **手動更新と更新スケジュール (Manual refresh and refresh schedules)**
必要に応じて、更新スケジュールを使用してください。詳細は「[workbook refresh options](https://help.sigmacomputing.com/docs/manage-workbook-refresh-options)」を参照してください。
> 🚩
> Sigmaはクエリ結果を保存せず、ウェアハウスから返されたクエリIDのみを保存します。すべてのデータ更新は、ウェアハウス内のデータに再度クエリを実行します。自動更新を設定すると、接続に負荷がかかり、多額のウェアハウスコストが発生する可能性があります。
